[{"title":"åˆæ¢xxljob","url":"/2022/02/13/0.0.1%E5%88%9D%E6%8E%A2xxljob/","content":"ä¸‹è½½åœ°å€\næ­å»ºxxljobéœ€è¦æå‰å‡†å¤‡å¥½\nmaven3+jdk8+mysql5.7+\n\n1.é¦–å…ˆåˆå§‹åŒ–SQLè„šæœ¬å»ºç«‹å¿…é¡»çš„åº“å’Œè¡¨\n2.å¯¹äºè§£å‹çš„æ–‡ä»¶åˆ†ä¸ºä¸‰ä¸ªæ¨¡å—xxl-job-adminï¼šè°ƒåº¦ä¸­å¿ƒxxl-job-coreï¼šå…¬å…±ä¾èµ–xxl-job-executor-samplesï¼šæ‰§è¡Œå™¨Sampleç¤ºä¾‹ï¼ˆé€‰æ‹©åˆé€‚çš„ç‰ˆæœ¬æ‰§è¡Œå™¨ï¼Œå¯ç›´æ¥ä½¿ç”¨ï¼Œä¹Ÿå¯ä»¥å‚è€ƒå…¶å¹¶å°†ç°æœ‰é¡¹ç›®æ”¹é€ æˆæ‰§è¡Œå™¨ï¼‰    ï¼šxxl-job-executor-sample-springbootï¼šSpringbootç‰ˆæœ¬ï¼Œé€šè¿‡Springbootç®¡ç†æ‰§è¡Œå™¨ï¼Œæ¨èè¿™ç§æ–¹å¼ï¼›    ï¼šxxl-job-executor-sample-framelessï¼šæ— æ¡†æ¶ç‰ˆæœ¬ï¼›\n\nå…¶ä¸­ï¼šxxl-job-coreæ˜¯éœ€è¦å¼•å…¥çš„æºç åŒ…åç»­æˆ‘ä»¬å¯ä»¥ç”¨ä»¥ä¸‹å½¢å¼å¼•å…¥\n&lt;dependency&gt;    &lt;groupId&gt;com.xuxueli&lt;/groupId&gt;    &lt;artifactId&gt;xxl-job-core&lt;/artifactId&gt;    &lt;version&gt;2.3.0&lt;/version&gt;&lt;/dependency&gt;\n\nxxl-job-adminæ˜¯æˆ‘ä»¬çš„è°ƒåº¦ä¸­å¿ƒï¼Œæˆ‘ä»¬åªéœ€è¦æŠŠè¿™ä¸ªé¡¹ç›®å•ç‹¬æ‹¿å‡ºæ¥è¿è¡Œå°±è¡Œäº†ï¼Œä¸‹é¢æ˜¯è¿è¡Œç»“æœ\n\nxxl-job-executor-sample-springbootæ˜¯æˆ‘ä»¬åç»­ç”¨bootå¯ä»¥å‚ç…§çš„æ¨¡æ¿ï¼Œå½“ç„¶ä¹Ÿå¯ä»¥ç›´æ¥ç”¨æ¥ä½¿ç”¨\n3.xxl-job-adminé…ç½®å…ˆä¿®æ”¹æ•°æ®åº“çš„åœ°å€ï¼Œä¹Ÿå°±æ˜¯ä¸Šé¢åˆå§‹åŒ–çš„åœ°å€\næ³¨æ„åœ¨æ•°æ®åº“åœ°å€å“ªé‡ŒåŠ ä¸Šæ—¶åŒºå±æ€§ï¼Œå¦åˆ™ä¹±ç \n\nç„¶åä¿®æ”¹è­¦æŠ¥é‚®ç®±é…ç½®\n\n4.è­¦æŠ¥é‚®ç®±é…ç½®\nå»è‡ªå·±å¯¹åº”é‚®ç®±çš„è®¾ç½®é‡Œé¢æ‰¾åˆ°smtpå¹¶å¼€å¯\næ³¨æ„ï¼šspring.mail.passwordçš„å¯†ç æ˜¯QQé‚®ç®±å¼€å¯SMTPçš„æˆæƒç è€ŒéQQå¯†ç \n\nè¿™é‡Œéœ€è¦æ³¨æ„ä¸åŒé‚®ç®±æœ‰ä¸åŒçš„æ”¶å‘ä»¶host\næ¯”å¦‚æ–°æµª\nå‘ä»¶:POP3æœåŠ¡å™¨ä¸ºï¼špop3.sina.com.cnæ”¶ä»¶:SMTPæœåŠ¡å™¨ä¸ºï¼šsmtp.sina.com.cn\nqq\nå‘ä»¶:POP3æœåŠ¡å™¨ä¸ºï¼špop.qq.comæ”¶ä»¶:SMTPæœåŠ¡å™¨ä¸ºï¼šsmtp.qq.com\næ³¨æ„ ä¸èƒ½è‡ªå·±é‚®ç®±å‘è‡ªå·±é‚®ç®±ï¼Œå¦åˆ™æ”¶ä¸åˆ°\n\nä¸Šé¢å°±æ˜¯æ”¶ä»¶çš„å†…å®¹\n5.bootæ•´åˆxxljobå¼•å…¥ä¾èµ–\n&lt;dependency&gt;    &lt;groupId&gt;com.xuxueli&lt;/groupId&gt;    &lt;artifactId&gt;xxl-job-core&lt;/artifactId&gt;    &lt;version&gt;2.3.0&lt;/version&gt;&lt;/dependency&gt;\n\né…ç½®æ–‡ä»¶æ•´åˆ\npackage com.example.demo.config;import com.xxl.job.core.executor.impl.XxlJobSpringExecutor;import org.slf4j.Logger;import org.slf4j.LoggerFactory;import org.springframework.beans.factory.annotation.Value;import org.springframework.context.annotation.Bean;import org.springframework.context.annotation.Configuration;@Configurationpublic class xxlConfig &#123;    private Logger logger = LoggerFactory.getLogger(xxlConfig.class);    @Value(&quot;$&#123;xxl.job.admin.addresses&#125;&quot;)    private String adminAddresses;    @Value(&quot;$&#123;xxl.job.accessToken&#125;&quot;)    private String accessToken;    @Value(&quot;$&#123;xxl.job.executor.appname&#125;&quot;)    private String appname;    @Value(&quot;$&#123;xxl.job.executor.address&#125;&quot;)    private String address;    @Value(&quot;$&#123;xxl.job.executor.ip&#125;&quot;)    private String ip;    @Value(&quot;$&#123;xxl.job.executor.port&#125;&quot;)    private int port;    @Value(&quot;$&#123;xxl.job.executor.logpath&#125;&quot;)    private String logPath;    @Value(&quot;$&#123;xxl.job.executor.logretentiondays&#125;&quot;)    private int logRetentionDays;    @Bean    public XxlJobSpringExecutor xxlJobExecutor() &#123;        logger.info(&quot;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; xxl-job config init.&quot;);        XxlJobSpringExecutor xxlJobSpringExecutor = new XxlJobSpringExecutor();        xxlJobSpringExecutor.setAdminAddresses(adminAddresses);        xxlJobSpringExecutor.setAppname(appname);        xxlJobSpringExecutor.setAddress(address);        xxlJobSpringExecutor.setIp(ip);        xxlJobSpringExecutor.setPort(port);        xxlJobSpringExecutor.setAccessToken(accessToken);        xxlJobSpringExecutor.setLogPath(logPath);        xxlJobSpringExecutor.setLogRetentionDays(logRetentionDays);        return xxlJobSpringExecutor;    &#125;&#125;\n\napplication.properties\n# å¯åŠ¨ç«¯å£å’Œè®¿é—®è·¯å¾„server.port=8089server.servlet.context-path=/todo# è°ƒåº¦ä¸­å¿ƒï¼ˆxxl-job-adminï¼‰çš„éƒ¨ç½²åœ°å€ï¼Œå¦‚è°ƒåº¦ä¸­å¿ƒé›†ç¾¤éƒ¨ç½²å­˜åœ¨å¤šä¸ªåœ°å€åˆ™ç”¨é€—å·åˆ†éš”ã€‚æ‰§è¡Œå™¨å°†ä¼šä½¿ç”¨è¯¥åœ°å€è¿›è¡Œ&quot;æ‰§è¡Œå™¨å¿ƒè·³æ³¨å†Œ&quot;å’Œ&quot;ä»»åŠ¡ç»“æœå›è°ƒ&quot;ï¼›# ä¸ºç©ºåˆ™å…³é—­è‡ªåŠ¨æ³¨å†Œï¼›åˆ™éœ€è¦æ‰‹åŠ¨æ³¨å†Œxxl.job.admin.addresses=http://127.0.0.1:8080/xxl-job-admin### æ‰§è¡Œå™¨é€šè®¯TOKEN [é€‰å¡«]ï¼šéç©ºæ—¶å¯ç”¨ï¼›xxl.job.accessToken=### æ‰§è¡Œå™¨AppName [é€‰å¡«]ï¼šæ‰§è¡Œå™¨å¿ƒè·³æ³¨å†Œåˆ†ç»„ä¾æ®ï¼›ä¸ºç©ºåˆ™å…³é—­è‡ªåŠ¨æ³¨å†Œxxl.job.executor.appname=job-to-do### æ‰§è¡Œå™¨æ³¨å†Œ [é€‰å¡«]ï¼šä¼˜å…ˆä½¿ç”¨è¯¥é…ç½®ä½œä¸ºæ³¨å†Œåœ°å€ï¼Œä¸ºç©ºæ—¶ä½¿ç”¨å†…åµŒæœåŠ¡ â€IP:PORTâ€œ ä½œä¸ºæ³¨å†Œåœ°å€ã€‚ä»è€Œæ›´çµæ´»çš„æ”¯æŒå®¹å™¨ç±»å‹æ‰§è¡Œå™¨åŠ¨æ€IPå’ŒåŠ¨æ€æ˜ å°„ç«¯å£é—®é¢˜ã€‚xxl.job.executor.address=### æ‰§è¡Œå™¨IP [é€‰å¡«]ï¼šé»˜è®¤ä¸ºç©ºè¡¨ç¤ºè‡ªåŠ¨è·å–IPï¼Œå¤šç½‘å¡æ—¶å¯æ‰‹åŠ¨è®¾ç½®æŒ‡å®šIPï¼Œè¯¥IPä¸ä¼šç»‘å®šHostä»…ä½œä¸ºé€šè®¯å®ç”¨ï¼›åœ°å€ä¿¡æ¯ç”¨äº &quot;æ‰§è¡Œå™¨æ³¨å†Œ&quot; å’Œ &quot;è°ƒåº¦ä¸­å¿ƒè¯·æ±‚å¹¶è§¦å‘ä»»åŠ¡&quot;ï¼›xxl.job.executor.ip=xxl.job.executor.port=9998### æ‰§è¡Œå™¨è¿è¡Œæ—¥å¿—æ–‡ä»¶å­˜å‚¨ç£ç›˜è·¯å¾„ [é€‰å¡«] ï¼šéœ€è¦å¯¹è¯¥è·¯å¾„æ‹¥æœ‰è¯»å†™æƒé™ï¼›ä¸ºç©ºåˆ™ä½¿ç”¨é»˜è®¤è·¯å¾„ï¼›xxl.job.executor.logpath=/data/applogs/xxl-job/jobhandler### æ‰§è¡Œå™¨æ—¥å¿—æ–‡ä»¶ä¿å­˜å¤©æ•° [é€‰å¡«] ï¼š è¿‡æœŸæ—¥å¿—è‡ªåŠ¨æ¸…ç†, é™åˆ¶å€¼å¤§äºç­‰äº3æ—¶ç”Ÿæ•ˆ; å¦åˆ™, å¦‚-1, å…³é—­è‡ªåŠ¨æ¸…ç†åŠŸèƒ½ï¼›xxl.job.executor.logretentiondays=30\n\n6.å®šæ—¶ä»»åŠ¡çš„åˆ›å»ºæ–¹å¼\n@XxlJobæ³¨è§£æ˜¯æ–°ç‰ˆæœ¬æä¾›çš„æ–¹å¼ï¼Œä¸éœ€è¦ç»§æ‰¿\næ—§ç‰ˆæ–¹å¼æ˜¯ç»§æ‰¿IJobHanderç„¶åé‡å†™executeæ–¹æ³•\n7.ç•Œé¢ä»‹ç»\n\n æ³¨æ„  å½“åˆ é™¤ä»»åŠ¡æ—¶ï¼Œä»»åŠ¡æ—¥å¿—ä¹Ÿä¼šè·Ÿç€åˆ é™¤ \n","tags":["java","ä¸­é—´ä»¶"]},{"title":"å®šæ—¶ä»»åŠ¡ä½¿ç”¨æ€»ç»“","url":"/2022/04/04/0.0.2%E5%AE%9A%E6%97%B6%E4%BB%BB%E5%8A%A1%E4%BD%BF%E7%94%A8%E6%80%BB%E7%BB%93/","content":"ç›¸ä¿¡å®šæ—¶ä»»åŠ¡å¤§å®¶éƒ½ä¸é™Œç”Ÿï¼Œå¯èƒ½åœ¨ä¸ªäººé¡¹ç›®ä¸­ä½¿ç”¨å®šæ—¶ä»»åŠ¡ä¼šæ¯”è¾ƒå°‘ï¼Œä½†æ˜¯åœ¨ä¸šåŠ¡å¤æ‚çš„å…¬å¸ä¸­ï¼Œå®šæ—¶ä»»åŠ¡æ˜¯ä¸å¯æˆ–ç¼ºçš„ä¸€éƒ¨åˆ†ï¼Œæœ‰æ—¶å€™ä¹Ÿå¯ä»¥è´¯ç©¿æ•´ä¸ªé¡¹ç›®çš„æµç¨‹è¿è½¬ã€‚\nä»€ä¹ˆæ˜¯å®šæ—¶ä»»åŠ¡crondç±»ä¼¼äºæˆ‘ä»¬å¹³æ—¶ç”Ÿæ´»ä¸­çš„é—¹é’Ÿï¼Œå¯ä»¥å®šæ—¶å«ä½ èµ·åºŠï¼Œè€Œåœ¨é¡¹ç›®ä¸­å°±æ˜¯å®šæ—¶æ‰§è¡Œä¸€æ®µæŒ‡å®šçš„ä»£ç \nä¸ºä»€ä¹ˆè¦ä½¿ç”¨crondå‘¢\n1.å¦‚æœå¯¹äºä¸€äº›æ•°æ®å®æ—¶æ€§è¦æ±‚æ²¡é‚£ä¹ˆé«˜ï¼Œæˆ‘ä»¬å¯ä»¥æŠŠæ•°æ®æå‰ä¸¢åˆ°ç¼“å­˜ä¸­ï¼Œè¿™ä¸ªæ—¶å€™å°±éœ€è¦ä½¿ç”¨å®šæ—¶ä»»åŠ¡å»è·‘äº†ï¼Œæ¯”å¦‚æ¯å¤©å‡Œæ™¨3ç‚¹å®šæ—¶æŠŠæ•°æ®åŒæ­¥åˆ°ç¼“å­˜ï¼Œé”™å³°åŒæ­¥é¿å¼€ç™½å¤©äººæµé‡å¤§çš„æ—¶å€™æ¶ˆè€—èµ„æº\n2.æ¯”å¦‚å‡Œæ™¨2ç‚¹æœ‰æŠ¢è´­æ¥å£/æˆ–è€…ä¸šåŠ¡å¼€å…³éœ€è¦è¿›è¡Œå˜æ›´å¼€å¯ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨å®šæ—¶ä»»åŠ¡å»è¿›è¡Œå˜æ›´ï¼Œä¸ç”¨äººä¸ºå»å®ˆç€å˜æ›´ï¼Œè€Œä¸”æ‰§è¡Œæ—¶é—´æ›´å‡†ç¡®ï¼ˆå¯ä»¥æ»šå»ç¡å¤§è§‰.jpgï¼‰\n3.è¿˜å¯ä»¥è¿›è¡Œæ•°æ®çš„å®šæ—¶å¤‡ä»½ï¼Œæ¯”å¦‚å¤‡ä»½é…ç½®æ–‡ä»¶ï¼Œé˜²æ­¢å®•æœºçš„æ—¶å€™é…ç½®æ–‡ä»¶çš„æ¢å¤ç­‰ç­‰\nå®šæ—¶ä»»åŠ¡å®ç°æ–¹å¼1.Threadå„ä½äº²çˆ±çš„æœ‹å‹ï¼Œæ²¡é”™ï¼ŒThreadçœŸçš„å¯ä»¥åšå®šæ—¶ä»»åŠ¡.\nå¦‚æœä½ å»çœ‹è¿‡ä¸€äº›å®šæ—¶ä»»åŠ¡æ¡†æ¶çš„æºç ï¼Œå®ƒä»¬çš„åº•å±‚ä¹Ÿä¼šä½¿ç”¨Threadç±»ï¼ˆéœ€è¦æ³¨æ„ç”¨tryâ€¦â€¦catchæ•è·å¼‚å¸¸ï¼Œå¦åˆ™å‡ºç°å¼‚å¸¸ï¼Œå°±ç›´æ¥é€€å‡ºå¾ªç¯ï¼‰\npublic static void init() &#123;    new Thread(() -&gt; &#123;        while (true) &#123;            try &#123;                System.out.println(&quot;doSameThing&quot;);                Thread.sleep(1000 * 60 * 5);            &#125; catch (Exception e) &#123;                log.error(e);            &#125;        &#125;    &#125;).start();&#125;\n\nä½¿ç”¨åœºæ™¯ï¼šæ¯”å¦‚é¡¹ç›®ä¸­æœ‰æ—¶éœ€è¦æ¯éš”10åˆ†é’Ÿå»ä¸‹è½½æŸä¸ªæ–‡ä»¶ï¼Œæˆ–è€…æ¯éš”5åˆ†é’Ÿå»è¯»å–æ¨¡æ¿æ–‡ä»¶ç”Ÿæˆé™æ€htmlé¡µé¢ç­‰ç­‰ï¼Œä¸€äº›ç®€å•çš„å‘¨æœŸæ€§ä»»åŠ¡åœºæ™¯ã€‚\nä¼˜ç¼ºç‚¹ï¼š\n\nä¼˜ç‚¹ï¼šè¿™ç§å®šæ—¶ä»»åŠ¡éå¸¸ç®€å•ï¼Œå­¦ä¹ æˆæœ¬ä½ï¼Œå®¹æ˜“å…¥æ‰‹ï¼Œå¯¹äºé‚£äº›ç®€å•çš„å‘¨æœŸæ€§ä»»åŠ¡ï¼Œæ˜¯ä¸ªä¸é”™çš„é€‰æ‹©ã€‚\nç¼ºç‚¹ï¼šä¸æ”¯æŒæŒ‡å®šæŸä¸ªæ—¶é—´ç‚¹æ‰§è¡Œä»»åŠ¡ï¼Œä¸æ”¯æŒå»¶è¿Ÿæ‰§è¡Œç­‰æ“ä½œï¼ŒåŠŸèƒ½è¿‡äºå•ä¸€ï¼Œæ— æ³•åº”å¯¹ä¸€äº›è¾ƒä¸ºå¤æ‚çš„åœºæ™¯ã€‚\n\n2.TimerTimer ç±»æ˜¯jdkä¸“é—¨æä¾›çš„å®šæ—¶å™¨å·¥å…·ï¼Œç”¨æ¥åœ¨åå°çº¿ç¨‹è®¡åˆ’æ‰§è¡ŒæŒ‡å®šä»»åŠ¡ï¼Œåœ¨ java.util åŒ…ä¸‹ï¼Œè¦è·Ÿ TimerTask ä¸€èµ·é…åˆä½¿ç”¨ã€‚\n@Testpublic void Timer()&#123;    Timer timer = new Timer();    // 1.éœ€è¦æ‰§è¡Œçš„å†…å®¹    // 2.å»¶æ—¶å¤šä¹…æ‰§è¡Œ    // 3.æ‰§è¡Œå‘¨æœŸ    timer.schedule(new TimerTask() &#123;        @Override        public void run() &#123;            System.out.println(123);        &#125;    &#125;,200,1000);&#125;\n\nä¼˜ç¼ºç‚¹ï¼š\n\nä¼˜ç‚¹ï¼šéå¸¸æ–¹ä¾¿å®ç°å¤šä¸ªå‘¨æœŸæ€§çš„å®šæ—¶ä»»åŠ¡ï¼Œå¹¶ä¸”æ”¯æŒå»¶è¿Ÿæ‰§è¡Œï¼Œè¿˜æ”¯æŒåœ¨æŒ‡å®šæ—¶é—´ä¹‹åæ”¯æŒï¼ŒåŠŸèƒ½è¿˜ç®—å¼ºå¤§ã€‚\nç¼ºç‚¹ï¼šå¦‚æœå…¶ä¸­ä¸€ä¸ªä»»åŠ¡è€—æ—¶éå¸¸é•¿ï¼Œä¼šå½±å“å…¶ä»–ä»»åŠ¡çš„æ‰§è¡Œã€‚å¹¶ä¸”å¦‚æœ TimerTask æŠ›å‡º RuntimeException ï¼Œ Timer ä¼šåœæ­¢æ‰€æœ‰ä»»åŠ¡çš„è¿è¡Œï¼Œæ‰€ä»¥é˜¿é‡Œå·´å·´å¼€å‘è€…è§„èŒƒä¸­ä¸å»ºè®®ä½¿ç”¨å®ƒ\n\n3.Scheduled æ³¨è§£ï¼ˆå¸¸ç”¨ï¼‰ç”±äºxmlæ–¹å¼å¤ªå¤è€äº†ï¼Œæˆ‘ä»¬ä»¥springbooté¡¹ç›®ä¸­æ³¨è§£æ–¹å¼ä¸ºä¾‹\n1.å¼•å…¥ä¾èµ–\n&lt;dependency&gt;    &lt;groupId&gt;org.springframework&lt;/groupId&gt;    &lt;artifactId&gt;spring-context&lt;/artifactId&gt;&lt;/dependency&gt;\n\n2.åœ¨springbootå¯åŠ¨ç±»ä¸ŠåŠ ä¸Š @EnableScheduling æ³¨è§£\n@EnableScheduling@SpringBootApplicationpublic class Application &#123;    â€¦â€¦&#125;\n\n3.ä½¿ç”¨ @Scheduled æ³¨è§£å®šä¹‰å®šæ—¶è§„åˆ™\nimport org.springframework.stereotype.Component;import java.text.SimpleDateFormat;import java.util.Date;@Componentpublic class CronJob &#123;    @Scheduled(cron = &quot;0/5 * * * * ?&quot;)    public void autoGetMessage()&#123;        System.out.println(&quot;å½“æœŸæ‰§è¡Œæ—¶é—´ï¼š&quot; + new SimpleDateFormat(&quot;yyyyå¹´MMæœˆddæ—¥ HH:mm:ss&quot;).format(new Date()));    &#125;&#125;\n\nä¼˜ç¼ºç‚¹ï¼š\n\nä¼˜ç‚¹ï¼šé‡‡ç”¨cronè¡¨è¾¾å¼ï¼Œæ¯”è¾ƒæ–¹ä¾¿ï¼Œspringæ¡†æ¶è‡ªå¸¦çš„å®šæ—¶åŠŸèƒ½ï¼Œspringbootåšäº†éå¸¸å¥½çš„å°è£…ï¼Œå¼€å¯å’Œå®šä¹‰å®šæ—¶ä»»åŠ¡éå¸¸å®¹æ˜“ï¼Œå¯ä»¥æ»¡è¶³ç»å¤§å¤šæ•°å•æœºç‰ˆçš„ä¸šåŠ¡åœºæ™¯ã€‚å•ä¸ªä»»åŠ¡æ—¶ï¼Œå½“å‰æ¬¡çš„è°ƒåº¦å®Œæˆåï¼Œå†æ‰§è¡Œä¸‹ä¸€æ¬¡ä»»åŠ¡è°ƒåº¦ã€‚\né»˜è®¤å•çº¿ç¨‹ï¼Œå¦‚æœå‰é¢çš„ä»»åŠ¡æ‰§è¡Œæ—¶é—´å¤ªé•¿ï¼Œå¯¹åé¢ä»»åŠ¡çš„æ‰§è¡Œæœ‰å½±å“ã€‚ä¸æ”¯æŒé›†ç¾¤æ–¹å¼éƒ¨ç½²ï¼Œä¸èƒ½åšæ•°æ®å­˜å‚¨å‹å®šæ—¶ä»»åŠ¡ã€‚\n\n5.spring quartzï¼ˆå¸¸ç”¨ï¼‰quartz æ˜¯ OpenSymphony å¼€æºç»„ç»‡åœ¨ Job scheduling é¢†åŸŸçš„å¼€æºé¡¹ç›®ï¼Œæ˜¯ç”±javaå¼€å‘çš„ä¸€ä¸ªå¼€æºçš„ä»»åŠ¡æ—¥ç¨‹ç®¡ç†ç³»ç»Ÿã€‚\nquartzèƒ½åšä»€ä¹ˆï¼Ÿ\n\nä½œä¸šè°ƒåº¦ï¼šè°ƒç”¨å„ç§æ¡†æ¶çš„ä½œä¸šè„šæœ¬ï¼Œä¾‹å¦‚shell,hiveç­‰ã€‚\nå®šæ—¶ä»»åŠ¡ï¼šåœ¨æŸä¸€é¢„å®šçš„æ—¶åˆ»ï¼Œæ‰§è¡Œä½ æƒ³è¦æ‰§è¡Œçš„ä»»åŠ¡\n\n1.å¼•å…¥ç›¸å…³ä¾èµ–\n&lt;dependency&gt;    &lt;groupId&gt;org.quartz-scheduler&lt;/groupId&gt;    &lt;artifactId&gt;quartz&lt;/artifactId&gt;    &lt;version&gt;2.3.0&lt;/version&gt;&lt;/dependency&gt;\n\n2.å®šæ—¶ä»»åŠ¡æ‰§è¡Œç±»ç»§æ‰¿QuartzJobBean\npublic class DateTimeJob extends QuartzJobBean &#123;    @Override    protected void executeInternal(JobExecutionContext jobExecutionContext) throws JobExecutionException &#123;        //è·å–JobDetailä¸­å…³è”çš„æ•°æ®        String msg = (String) jobExecutionContext.getJobDetail().getJobDataMap().get(&quot;msg&quot;);        System.out.println(&quot;current time :&quot;+new SimpleDateFormat(&quot;yyyy-MM-dd HH:mm:ss&quot;).format(new Date()) + &quot;---&quot; + msg);    &#125;&#125;\n\n3.è°ƒåº¦é…ç½®\n@Configurationpublic class QuartzConfig &#123;    @Bean    public JobDetail printTimeJobDetail()&#123;        return JobBuilder.newJob(DateTimeJob.class)//PrintTimeJobæˆ‘ä»¬çš„ä¸šåŠ¡ç±»                .withIdentity(&quot;DateTimeJob&quot;)//å¯ä»¥ç»™è¯¥JobDetailèµ·ä¸€ä¸ªid                //æ¯ä¸ªJobDetailå†…éƒ½æœ‰ä¸€ä¸ªMapï¼ŒåŒ…å«äº†å…³è”åˆ°è¿™ä¸ªJobçš„æ•°æ®ï¼Œåœ¨Jobç±»ä¸­å¯ä»¥é€šè¿‡contextè·å–                .usingJobData(&quot;msg&quot;, &quot;Hello Quartz&quot;)//å…³è”é”®å€¼å¯¹                .storeDurably()//å³ä½¿æ²¡æœ‰Triggerå…³è”æ—¶ï¼Œä¹Ÿä¸éœ€è¦åˆ é™¤è¯¥JobDetail                .build();    &#125;    @Bean    public Trigger printTimeJobTrigger() &#123;        CronScheduleBuilder cronScheduleBuilder = CronScheduleBuilder.cronSchedule(&quot;0/1 * * * * ?&quot;);        return TriggerBuilder.newTrigger()                .forJob(printTimeJobDetail())//å…³è”ä¸Šè¿°çš„JobDetail                .withIdentity(&quot;quartzTaskService&quot;)//ç»™Triggerèµ·ä¸ªåå­—                .withSchedule(cronScheduleBuilder)                .build();    &#125;&#125;\n\nä¼˜ç¼ºç‚¹ï¼š\n\nä¼˜ç‚¹ï¼šé»˜è®¤æ˜¯å¤šçº¿ç¨‹å¼‚æ­¥æ‰§è¡Œï¼Œå•ä¸ªä»»åŠ¡æ—¶ï¼Œåœ¨ä¸Šä¸€ä¸ªè°ƒåº¦æœªå®Œæˆæ—¶ï¼Œä¸‹ä¸€ä¸ªè°ƒåº¦æ—¶é—´åˆ°æ—¶ï¼Œä¼šå¦èµ·ä¸€ä¸ªçº¿ç¨‹å¼€å§‹æ–°çš„è°ƒåº¦ï¼Œå¤šä¸ªä»»åŠ¡ä¹‹é—´äº’ä¸å½±å“ã€‚æ”¯æŒå¤æ‚çš„ cron è¡¨è¾¾å¼ï¼Œå®ƒèƒ½è¢«é›†ç¾¤å®ä¾‹åŒ–ï¼Œæ”¯æŒåˆ†å¸ƒå¼éƒ¨ç½²\nç¼ºç‚¹ï¼šç›¸å¯¹äºspring taskå®ç°å®šæ—¶ä»»åŠ¡æˆæœ¬æ›´é«˜ï¼Œéœ€è¦æ‰‹åŠ¨é…ç½® QuartzJobBean ã€ JobDetailå’Œ Trigger ç­‰ã€‚éœ€è¦å¼•å…¥äº†ç¬¬ä¸‰æ–¹çš„ quartz åŒ…ï¼Œæœ‰ä¸€å®šçš„å­¦ä¹ æˆæœ¬ã€‚ä¸æ”¯æŒå¹¶è¡Œè°ƒåº¦ï¼Œä¸æ”¯æŒå¤±è´¥å¤„ç†ç­–ç•¥å’ŒåŠ¨æ€åˆ†ç‰‡çš„ç­–ç•¥ç­‰ã€‚\n\nä»¥ä¸‹ä¸¤ç§é…ç½®å‚è€ƒæ–¹å¼\nspringXMLé…ç½®æ–¹å¼\nSpringBooté…ç½®æ–¹å¼\n6.xxl-jobï¼ˆå¸¸ç”¨ï¼šåˆ†å¸ƒå¼å®šæ—¶ä»»åŠ¡ä¸»æµï¼‰xxl-job æ˜¯å¤§ä¼—ç‚¹è¯„ï¼ˆè®¸é›ªé‡Œï¼‰å¼€å‘çš„ä¸€ä¸ªåˆ†å¸ƒå¼ä»»åŠ¡è°ƒåº¦å¹³å°ï¼Œå…¶æ ¸å¿ƒè®¾è®¡ç›®æ ‡æ˜¯å¼€å‘è¿…é€Ÿã€å­¦ä¹ ç®€å•ã€è½»é‡çº§ã€æ˜“æ‰©å±•ã€‚ç°å·²å¼€æ”¾æºä»£ç å¹¶æ¥å…¥å¤šå®¶å…¬å¸çº¿ä¸Šäº§å“çº¿ï¼Œå¼€ç®±å³ç”¨ã€‚\nxxl-job æ¡†æ¶å¯¹ quartz è¿›è¡Œäº†æ‰©å±•ï¼Œä½¿ç”¨ mysql æ•°æ®åº“å­˜å‚¨æ•°æ®ï¼Œå¹¶ä¸”å†…ç½®jettyä½œä¸º RPCæœåŠ¡è°ƒç”¨ã€‚\nå…·ä½“é…ç½®å¯ä»¥å‚è€ƒä¹‹å‰æœ¬äººå†™çš„ã€åˆæ¢xxljobã€‘\nä¼˜ç¼ºç‚¹ï¼š\n\nä¼˜ç‚¹ï¼šæœ‰ç•Œé¢ç®¡ç†å®šæ—¶ä»»åŠ¡ï¼Œæ”¯æŒå¼¹æ€§æ‰©å®¹ç¼©å®¹ã€åŠ¨æ€åˆ†ç‰‡ã€æ•…éšœè½¬ç§»ã€å¤±è´¥æŠ¥è­¦ç­‰åŠŸèƒ½ã€‚å®ƒçš„åŠŸèƒ½éå¸¸å¼ºå¤§ï¼Œå¾ˆå¤šå¤§å‚åœ¨ç”¨ï¼Œå¯ä»¥æ»¡è¶³ç»å¤§å¤šæ•°ä¸šåŠ¡åœºæ™¯ã€‚\nç¼ºç‚¹ï¼šå’Œ quartz ä¸€æ ·ï¼Œé€šè¿‡æ•°æ®åº“åˆ†å¸ƒå¼é”ï¼Œæ¥æ§åˆ¶ä»»åŠ¡ä¸èƒ½é‡å¤æ‰§è¡Œã€‚åœ¨ä»»åŠ¡éå¸¸å¤šçš„æƒ…å†µä¸‹ï¼Œæœ‰ä¸€äº›æ€§èƒ½é—®é¢˜ã€‚\n\nåˆ†å¸ƒå¼å®šæ—¶ä»»åŠ¡åœ¨å‰é¢æåˆ°Timer/ScheduledExecutorService/SpringTask(@Schedule)éƒ½æ˜¯å•æœºçš„ï¼Œä½†æˆ‘ä»¬ä¸€æ—¦ä¸Šäº†ç”Ÿäº§ç¯å¢ƒï¼Œåº”ç”¨éƒ¨ç½²å¾€å¾€éƒ½æ˜¯é›†ç¾¤æ¨¡å¼çš„ã€‚\nåœ¨é›†ç¾¤ä¸‹ï¼Œæˆ‘ä»¬ä¸€èˆ¬æ˜¯å¸Œæœ›æŸä¸ªå®šæ—¶ä»»åŠ¡åªåœ¨æŸå°æœºå™¨ä¸Šæ‰§è¡Œï¼Œé‚£è¿™æ—¶å€™ï¼Œå•æœºå®ç°çš„å®šæ—¶ä»»åŠ¡å°±ä¸å¤ªå¥½å¤„ç†äº†ã€‚\nQuartzæ˜¯æœ‰é›†ç¾¤éƒ¨ç½²æ–¹æ¡ˆçš„ï¼Œæ‰€ä»¥æœ‰çš„äººä¼šåˆ©ç”¨æ•°æ®åº“è¡Œé”æˆ–è€…ä½¿ç”¨Redisåˆ†å¸ƒå¼é”æ¥è‡ªå·±å®ç°å®šæ—¶ä»»åŠ¡è·‘åœ¨æŸä¸€å°åº”ç”¨æœºå™¨ä¸Šï¼›åšè‚¯å®šæ˜¯èƒ½åšçš„ï¼ŒåŒ…æ‹¬æœ‰äº›æŒºå‡ºåçš„åˆ†å¸ƒå¼å®šæ—¶ä»»åŠ¡æ¡†æ¶ä¹Ÿæ˜¯è¿™æ ·åšçš„ï¼Œèƒ½è§£å†³é—®é¢˜ã€‚\nä½†æˆ‘ä»¬é‡åˆ°çš„é—®é¢˜ä¸å•å•åªæœ‰è¿™äº›ï¼Œæ¯”å¦‚æˆ‘æƒ³è¦æ”¯æŒå®¹é”™åŠŸèƒ½ï¼ˆå¤±è´¥é‡è¯•ï¼‰ã€åˆ†ç‰‡åŠŸèƒ½ã€æ‰‹åŠ¨è§¦å‘ä¸€æ¬¡ä»»åŠ¡ã€æœ‰ä¸€ä¸ªæ¯”è¾ƒå¥½çš„ç®¡ç†å®šæ—¶ä»»åŠ¡çš„åå°ç•Œé¢ã€è·¯ç”±è´Ÿè½½å‡è¡¡ç­‰ç­‰ã€‚è¿™äº›åŠŸèƒ½ï¼Œå°±æ˜¯ä½œä¸ºã€Œåˆ†å¸ƒå¼å®šæ—¶ä»»åŠ¡æ¡†æ¶ã€æ‰€å…·å¤‡çš„ã€‚\nåˆ†å¸ƒå¼å®šæ—¶ä»»åŠ¡æ¡†æ¶åˆå¯ä»¥åˆ†æˆäº†ä¸¤ä¸ªæµæ´¾ï¼šä¸­å¿ƒåŒ–å’Œå»ä¸­å¿ƒåŒ–\n\næ‰€è°“çš„ã€Œä¸­å¿ƒåŒ–ã€æŒ‡çš„æ˜¯ï¼šè°ƒåº¦å™¨å’Œæ‰§è¡Œå™¨åˆ†ç¦»ï¼Œè°ƒåº¦å™¨ç»Ÿä¸€è¿›è¡Œè°ƒåº¦ï¼Œé€šçŸ¥æ‰§è¡Œå™¨å»æ‰§è¡Œå®šæ—¶ä»»åŠ¡\næ‰€è°“çš„ã€Œå»ä¸­å¿ƒåŒ–ã€æŒ‡çš„æ˜¯ï¼šè°ƒåº¦å™¨å’Œæ‰§è¡Œå™¨è€¦åˆï¼Œè‡ªå·±è°ƒåº¦è‡ªå·±æ‰§è¡Œ\n\nå¯¹äºã€Œä¸­å¿ƒåŒ–ã€æµæ´¾æ¥è¯´ï¼Œå­˜å‚¨ç›¸å…³çš„ä¿¡æ¯å¾ˆå¯èƒ½æ˜¯åœ¨æ•°æ®åº“ï¼ˆDataBaseï¼‰ï¼Œè€Œæˆ‘ä»¬å¼•å…¥çš„clientåŒ…å®é™…ä¸Šå°±æ˜¯æ‰§è¡Œå™¨ç›¸å…³çš„ä»£ç ã€‚è°ƒåº¦å™¨å®ç°äº†ä»»åŠ¡è°ƒåº¦çš„é€»è¾‘ï¼Œè¿œç¨‹è°ƒç”¨æ‰§è¡Œå™¨è§¦å‘å¯¹åº”çš„é€»è¾‘ã€‚\n\nè°ˆè°ˆå®šæ—¶ä»»åŠ¡ä½¿ç”¨åœºæ™¯æˆ‘ç°åœ¨å…¬å¸å¯¹äºå®šæ—¶ä»»åŠ¡çš„ä¸»è¦ä½¿ç”¨åœºæ™¯æ˜¯æ›´æ–°ç¼“å­˜ï¼Œæ¸…æ´—æ•°æ®ï¼Œå®šæ—¶æ¨é€ï¼Œå®šæ—¶æ‹‰å•ç­‰ç­‰\nå…ˆè¯´è¯´æ›´æ–°ç¼“å­˜ï¼šå°±æ˜¯æ¯éš”ä¸€æ®µæ—¶é—´å»æ‰§è¡Œæ“ä½œï¼Œå¯èƒ½ä¸€å¤©åªéœ€è¦æ›´æ–°ä¸€æ¬¡å½“å¤©çš„ç¼“å­˜æ•°æ®ï¼Œä¸€èˆ¬ä¼šé€‰æ‹©æ”¾åœ¨å‡Œæ™¨äººæµé‡å°‘çš„æ—¶å€™æ‰§è¡Œã€‚\næ¸…æ´—æ•°æ®å’Œå®šæ—¶æ‹‰å•å°±æ¯”è¾ƒåƒï¼Œä¼šæ¯”å¦‚æ¯é—´éš”15åˆ†é’Ÿå»è¿›è¡Œä¸€æ¬¡æ‰«è¡¨ï¼Œçœ‹çœ‹æœ‰æ²¡æœ‰éœ€è¦è¿›è¡Œæ‰§è¡Œçš„æµç¨‹\nå®šæ—¶æ¨é€å°±æ˜¯ä½ æƒ³çš„é‚£æ ·ï¼Œå®šæ—¶æ¨é€æ¶ˆæ¯æˆ–è€…å®šæ—¶æ‰§è¡Œä»£ç çš„å¼€å…³\nå¯¹äºä»¥ä¸Šçš„æ“ä½œï¼Œæˆ‘ä»¬å¯ä»¥åˆ†ä¸ºä¸¤ç§ï¼Œå…¨é‡æ›´æ–°å’Œå¢é‡æ›´æ–°\nå…¨é‡æ›´æ–°ï¼šè¿™ä¸ªæ¯”è¾ƒå¸¸ç”¨ï¼Œå°±æ˜¯ä¸€æ¬¡æ€§å…¨éƒ¨æŸ¥è¯¢å‡ºæ¥ï¼Œç„¶åä¸€æ¬¡æ€§æ›´æ–°åˆ°ç¼“å­˜é‡Œé¢å»\npublic void zxMachineBuild()&#123;\t// 1.æŸ¥è¯¢éœ€è¦ç¼“å­˜çš„æ•°æ®    List&lt;Tax&gt; taxs = tConfigPolicyMapper.getTConfigTax();    // 2.æ‹¼æ¥å­˜å‚¨æ ¼å¼    Map&lt;String,Object&gt; map = new HashMap&lt;&gt;();    for(Tax tax:taxs)&#123;        â€¦â€¦        map.put(tax.getPindex(),tax);\t&#125;    // 3.æ›´æ–°åˆ°redis    redisService.batchPutInPipelined(map,60*60*24);&#125;\n\næ³¨æ„ï¼šå› ä¸ºä»¥ä¸Šä½¿ç”¨çš„æ˜¯æœ‰è¿‡æœŸæ—¶é—´çš„ï¼Œå¦‚æœæ­£å¸¸è·‘çš„è¯ä¸€èˆ¬ä¼šå…ˆåˆ åå¢ï¼Œå¦‚æœæ˜¯redisçš„è¯å¯ä»¥ç›´æ¥å…¨éƒ¨è¦†ç›–ï¼ˆä½¿ç”¨åœºæ™¯ä¸€èˆ¬æ˜¯åˆå§‹åŒ–çš„æ—¶å€™æˆ–è€…æ•°æ®é‡è·‘ï¼‰\nå¢é‡æ›´æ–°ï¼šå¢é‡çš„åŸºç¡€å°±æ˜¯å…¨é‡ï¼Œå…ˆå…¨é‡æ›´æ–°åï¼Œå†ç”¨å¢é‡æ–¹å¼åŒæ­¥æ›´æ–°ï¼Œä¸€èˆ¬åˆ©ç”¨èŠ‚ç‚¹æˆ–è€…çŠ¶æ€å»è¿›è¡Œæ›´æ–°\næˆ‘ä»¬å¸¸ç”¨çš„æ›´æ–°æ–¹å¼\næ ¹æ®çŠ¶æ€æ›´æ–°\npublic void zxMachineBuild(String type)&#123;\t// 1.æŸ¥è¯¢éœ€è¦å¢é‡çš„æ•°æ®    List&lt;Tax&gt; taxs = tConfigPolicyMapper.getTConfigTax(type);    // 2.æ‹¼æ¥å­˜å‚¨æ ¼å¼    Map&lt;String,Object&gt; map = new HashMap&lt;&gt;();    for(Tax tax:taxs)&#123;        â€¦â€¦        map.put(tax.getPindex(),tax);\t&#125;    // 3.æ›´æ–°åˆ°redisï¼Œæ ¹æ®æ•°æ®åˆ¤æ–­ä½¿ç”¨è¿‡æœŸè¿˜æ˜¯ç²¾å‡†åˆ é™¤    redisService.batchPutInPipelined(map,60*60*24);    // 4.æ›´æ–°çŠ¶æ€    tConfigPolicyMapper.updateTConfigType(taxs);&#125;\n\næ ¹æ®èŠ‚ç‚¹æ›´æ–°:å‡è®¾æˆ‘ä½¿ç”¨redisæ¥å­˜å‚¨æˆ‘çš„èŠ‚ç‚¹ï¼ˆä¸€èˆ¬ä¼šä½¿ç”¨idä½œä¸ºèŠ‚ç‚¹ï¼Œä»¥ä¸‹ä¾‹å­ä½¿ç”¨æ—¶é—´èŠ‚ç‚¹ï¼‰\npublic void zxMachineBuild()&#123;    // è·å–ä¸Šæ¬¡æ›´æ–°çš„æ—¶é—´èŠ‚ç‚¹    long nodeTime = redisService.getNodeTime();\t// è·å–åœ¨è¯¥æ—¶é—´èŠ‚ç‚¹ä¹‹åçš„æ•°æ®ï¼ˆæ ¹æ®æ—¶é—´æ’åºï¼‰    List&lt;Tax&gt; taxs = tConfigPolicyMapper.getTConfigTax(nodeTime);    // æ‹¼æ¥å­˜å‚¨æ ¼å¼    Map&lt;String,Object&gt; map = new HashMap&lt;&gt;();    for(Tax tax:taxs)&#123;        â€¦â€¦        map.put(tax.getPindex(),tax);        // å¦‚æœä¸æ ¹æ®æ—¶é—´æ’åºå°±æ¯”è¾ƒè·å–        if(tax.getCreateTime() != null &amp;&amp; tax.getCreateTime() &gt; nodeTime)&#123;\t\t\tnodeTime = tax.getCreateTime();        &#125;\t&#125;    // 3.æ›´æ–°åˆ°redisï¼Œæ ¹æ®æ•°æ®åˆ¤æ–­ä½¿ç”¨è¿‡æœŸè¿˜æ˜¯ç²¾å‡†åˆ é™¤    redisService.batchPutInPipelined(map,60*60*24);    // 4.æ›´æ–°æ—¶é—´èŠ‚ç‚¹åˆ°redisï¼ˆè·å–æœ€åä¸€ä¸ªçš„æ—¶é—´èŠ‚ç‚¹ï¼‰    redisService.updateNodeTime(nodeTime);&#125;\n\nè¿›é˜¶ï¼ˆæ¨èï¼‰\npublic void zxMachineBuild()&#123;    // éšæœºä¸€ä¸ªuuid    String uuid = UUID.randomUUID().toString().replaceAll(&quot;-&quot;,&quot;&quot;);    // é”å®š    tConfigPolicyMapper.Lock(uuid);\t// æŸ¥è¯¢æå‰é”å®šå¥½çš„æ•°æ®    List&lt;Tax&gt; taxs = tConfigPolicyMapper.getTConfigTax(uuid);    // æ‹¼æ¥å­˜å‚¨æ ¼å¼    Map&lt;String,Object&gt; map = new HashMap&lt;&gt;();    for(Tax tax:taxs)&#123;        â€¦â€¦        map.put(tax.getPindex(),tax);        // å¦‚æœä¸æ ¹æ®æ—¶é—´æ’åºå°±æ¯”è¾ƒè·å–        if(tax.getCreateTime() != null &amp;&amp; tax.getCreateTime() &gt; nodeTime)&#123;\t\t\tnodeTime = tax.getCreateTime();        &#125;\t&#125;    // æ›´æ–°åˆ°redisï¼Œæ ¹æ®æ•°æ®åˆ¤æ–­ä½¿ç”¨è¿‡æœŸè¿˜æ˜¯ç²¾å‡†åˆ é™¤    redisService.batchPutInPipelined(map,60*60*24);    // æ›´æ–°é”å®šçŠ¶æ€ä¸ºå·²è·‘    tConfigPolicyMapper.updateNodeTime(taxs);&#125;\n\nä½¿ç”¨ä»¥ä¸Šæ–¹å¼çš„å¥½å¤„å°±æ˜¯å¯ä»¥ç›´æ¥å…ˆé”å®šè‡ªå·±éœ€è¦è·‘çš„éƒ¨åˆ†ï¼Œé˜²æ­¢å…¶ä»–çš„å®šæ—¶ä»»åŠ¡æŠ¢å \n## å–t_pao_lowprice_taobaoæ•°æ®å‡ºæ¥ï¼Œè®¾ç½®state=â€˜Lâ€™ é”ä½update [t_pao_lowprice_taobao] set lockname=&#x27;guid&#x27;,locktime=GETDATE(),state=&#x27;L&#x27; from [t_pao_lowprice_taobao] a join (select top 2 id from [t_pao_lowprice_taobao] where lockname is null and state=&#x27;N&#x27; order by createtime asc) b on a.id=b.id\n\n## locknameã€å¯¹åº”ä»£ç çš„uuidã€‘ çŠ¶æ€ä¸ºstate=â€˜Lâ€™ è·å–éœ€è¦è·‘çš„æ•°æ®ï¼Œå¼€çº¿ç¨‹å»è·‘select * from [t_pao_lowprice_taobao] where lockname=&#x27;guid&#x27; and state=&#x27;L&#x27;\n\næ€»ç»“å¯èƒ½åœ¨ä¸ªäººé¡¹ç›®ä¸­ï¼Œå¯¹äºå®šæ—¶ä»»åŠ¡çš„éœ€æ±‚æ²¡æœ‰é‚£ä¹ˆå¤šï¼Œä¸ä¼šå»é‡è§†è¿™ä¸€å—ï¼Œä½†æ˜¯åœ¨å®é™…å·¥ä½œä¸­ï¼Œå®šæ—¶ä»»åŠ¡å¾€å¾€æ‰®æ¼”ç€é‡è¦çš„è§’è‰²\nä¸åŒçš„å®šæ—¶ä»»åŠ¡æœ‰ä¸åŒçš„ä¼˜ç¼ºç‚¹ï¼Œå¾€å¾€æˆ‘ä»¬å»é€‰æ‹©é€‚åˆè‡ªå·±çš„é‚£ç§æ–¹å¼ï¼Œå°±éœ€è¦å¯¹äºå…¶ç§ç±»æœ‰ä¸€å®šçš„äº†è§£ï¼Œæ€æ ·æ‰èƒ½æ›´é«˜æ•ˆçš„å»è¿›è¡Œå¼€å‘ï¼Œå°½é‡é¿å…ä½¿ç”¨åˆ°ä¸€åŠå› ä¸ºå…¶åº•å±‚è®¾è®¡çš„åŸå› å¯¼è‡´BUGã€‚\nç°åœ¨åŸºæœ¬ä¹Ÿä½¿ç”¨E-Job(ElasticJob)æˆ–è€…X-Job(XXLJob)è¿™ç§åˆ†å¸ƒå¼å®šæ—¶ä»»åŠ¡ï¼Œå®ƒä»¬éƒ½æœ‰å¹¿æ³›çš„ç”¨æˆ·åŸºç¡€å’Œå®Œæ•´çš„æŠ€æœ¯æ–‡æ¡£\n\nX-Job ä¾§é‡çš„ä¸šåŠ¡å®ç°çš„ç®€å•å’Œç®¡ç†çš„æ–¹ä¾¿ï¼Œå­¦ä¹ æˆæœ¬ç®€å•ï¼Œå¤±è´¥ç­–ç•¥å’Œè·¯ç”±ç­–ç•¥ä¸°å¯Œã€‚æ¨èä½¿ç”¨åœ¨â€œç”¨æˆ·åŸºæ•°ç›¸å¯¹å°‘ï¼ŒæœåŠ¡å™¨æ•°é‡åœ¨ä¸€å®šèŒƒå›´å†…â€çš„æƒ…æ™¯ä¸‹ä½¿ç”¨\nE-Job å…³æ³¨çš„æ˜¯æ•°æ®ï¼Œå¢åŠ äº†å¼¹æ€§æ‰©å®¹å’Œæ•°æ®åˆ†ç‰‡çš„æ€è·¯ï¼Œä»¥ä¾¿äºæ›´å¤§é™åº¦çš„åˆ©ç”¨åˆ†å¸ƒå¼æœåŠ¡å™¨çš„èµ„æºã€‚ä½†æ˜¯å­¦ä¹ æˆæœ¬ç›¸å¯¹é«˜äº›ï¼Œæ¨èåœ¨â€œæ•°æ®é‡åºå¤§ï¼Œä¸”éƒ¨ç½²æœåŠ¡å™¨æ•°é‡è¾ƒå¤šâ€æ—¶ä½¿ç”¨\n\nå•æœºçš„å®šæ—¶ä»»åŠ¡ç°åœ¨åŸºæœ¬ä¸æ¨èä½¿ç”¨äº†ï¼Œç»´æŠ¤èµ·æ¥æ¯”è¾ƒéº»çƒ¦\nå¯¹äºå®šæ—¶ä»»åŠ¡ï¼Œä¸ªäººç†è§£ç¨‹åº¦æœ‰é™ï¼Œä½¿ç”¨çš„åœºæ™¯å¾€å¾€æ›´åŠ å¤æ‚ä¸èƒ½æ¯ç‚¹éƒ½è€ƒè™‘åˆ°ï¼Œæ¬¢è¿å¤§å®¶èƒ½æå‡ºè‡ªå·±çš„æƒ³æ³•\næ¯”å¦‚åˆ†å¸ƒå¼å®šæ—¶ä»»åŠ¡ä¸‹å¦‚ä½•å»ä¿è¯äº‹åŠ¡çš„ä¸€è‡´æ€§ï¼Œå•æœºå®šæ—¶ä»»åŠ¡åˆå¦‚ä½•å»ä¿è¯æ•°æ®ä¸é‡å¤ç­‰ç­‰åœºæ™¯éƒ½éœ€è¦å»æŒ–æ˜â€¦â€¦\nå‚è€ƒæŒ‡å—ï¼š\n\nä»€ä¹ˆæ˜¯å®šæ—¶ä»»åŠ¡\nåç§å¸¸ç”¨å®šæ—¶ä»»åŠ¡\nSpringbootå®šæ—¶ä»»åŠ¡ä»¥åŠä¼˜ç¼ºç‚¹\nSpringé›†æˆQuartzå®šæ—¶å™¨\nä¸ºä»€ä¹ˆè¦ç”¨åˆ†å¸ƒå¼å®šæ—¶ä»»åŠ¡\nåˆ†å¸ƒå¼å®šæ—¶ä»»åŠ¡æ¡†æ¶é€‰å‹\n\n"},{"title":"åˆ†æ®µæ‰§è¡Œ","url":"/2022/05/01/0.0.3%E5%88%86%E6%AE%B5%E6%89%A7%E8%A1%8C/","content":"int batchSize = 1000;if(dataList.size() &lt;= batchSize)&#123;    insertByStocks(dataList,type);&#125;else &#123;    for(int i = 0;i &lt; dataList.size();i+=batchSize)&#123;        if((i + batchSize)&gt; dataList.size())&#123;            batchSize = dataList.size()-i;        &#125;        insertByStocks(dataList.subList(i,i+batchSize),type);    &#125;&#125;\nbatchSize: æ¯æ¬¡æ‰§è¡Œå¤šå°‘æ¡\ndataList:  æ•°æ®åˆ—è¡¨\ninsertByStocksï¼šéœ€è¦æ‰§è¡Œçš„æ–¹æ³•\n","tags":["å·¥å…·ç±»","ç®—æ³•å…¬å¼"]},{"title":"ç®€å•åæ§½ä¸€ä¸‹xml","url":"/2022/01/08/0.0.6%E7%AE%80%E5%8D%95%E5%90%90%E6%A7%BD%E4%B8%80%E4%B8%8Bxml/","content":"\næè¿°\n\nè¿‘æœŸä¸ä¾›åº”å•†å¯¹æ¥çš„æ—¶å€™ï¼Œå¯¹æ–¹çš„æ¥å£è¿˜æ˜¯æ¯”è¾ƒç¨³å®šçš„xmlæ¥å£ï¼Œä¸å½“ä¸‹æµè¡Œçš„jsonçš„ä¾¿æ·æ€§ç›¸æ¯”è¿˜æ˜¯ä¸å¤ªæ–¹ä¾¿ï¼Œä¸­é—´æˆ‘ä¹Ÿä½¿ç”¨äº†å‡ ç§å·¥å…·ç±»ï¼Œå¾ˆéš¾æœ‰å®Œå…¨é€‚é…çš„ï¼Œä¸‹æ–‡æˆ‘å°†è®²è¿°æˆ‘è§£æxmlçš„å†ç¨‹\n\nåˆæ¬¡æ¥è§¦\n\nç¬¬ä¸€æ¬¡æ¥è§¦xmlæ¥å£æ˜¯åœ¨å¯¹æ¥ç‰©æµæ¸ é“å•†çš„æ—¶å€™ï¼Œå½“æ—¶ä»–ä»¬ä½¿ç”¨çš„å¯¹æ¥æ–¹å¼ä¸ºsoapæ ¼å¼ï¼Œåˆšæ¥è§¦è§£æèµ·æ¥ç®€ç›´è¦äº†è€å‘½ï¼Œä»€ä¹ˆæ˜¯soapå‘¢ï¼Ÿæ˜¯åŸºäºxmlçš„ç®€æ˜“åè®®ï¼Œå¸¸ç”¨äºwebservieï¼Œå®ƒæœ‰è‡ªå·±çš„ä¸€å¥—ç¼–ç è§„åˆ™ï¼Œå¦‚ä¸‹\n\nè¿™ç§è¯·æ±‚ç½‘ä¸Šè§£ææ–¹å¼å°±å¾ˆå°‘ï¼Œå¾ˆå¤šåªæœ‰è§£ææ²¡æœ‰æ„é€ ï¼Œæ–‡æœ¬ä¹Ÿä¸å¤ªå…¨ï¼Œç›®å‰è§è¿‡å†™çš„æ¯”è¾ƒå¥½çš„è§£æå¦‚ä¸‹ï¼šhttps://blog.csdn.net/RUANJIAOXIAOZI/article/details/90770534\nå½“ç„¶è¿˜æœ‰xsdæ¨¡å¼çš„xml\nå› ä¸ºè¿™æ¬¡è®²çš„æ˜¯xmlè§£æï¼Œä¸Šé¢åªæ˜¯ä¸¾ä¸ªæ —å­ï¼Œè®©ä½ ä»¬ä½“ä¼šä¸€ä¸‹xmlçš„å˜ç§æœ‰å¤šéš¾ğŸ˜­\nè¿™ç§æ¥å£ä¸è¿‡åˆ†çš„è¯´ï¼Œè‡³å°‘åå¹´å¾€ä¸Šçš„æ¶æ„äº†\n\nä½¿ç”¨dom4j/jsoupè§£æ\n\ndom4jåº”è¯¥æ˜¯æœ€ç»å…¸è§£æxmlçš„apiäº†ï¼Œæ€§èƒ½ä¼˜å¼‚ï¼ŒåŠŸèƒ½å¼ºå¤§ã€‚ä½†æ˜¯ä½¿ç”¨èµ·æ¥è¿˜æ˜¯ç•¥ä¸ºéº»çƒ¦ï¼Œæœ‰ç‚¹åƒç”¨javaçš„jsoupå»çˆ¬å–ç½‘é¡µï¼Œéœ€è¦ä¸€ä¸ªä¸€ä¸ªèŠ‚ç‚¹çš„å»æ‰¾\nDom4jè·å–xmlçš„ä¸‰ç§æ–¹å¼1.è¯»å–xmlæ–‡ä»¶ï¼Œè·å¾—documentå¯¹è±¡    SAXReader reader = new SAXReader();    Document document = reader.read(new File(&quot;test.xml&quot;));2.ç›´æ¥è§£æxmlå½¢å¼çš„æ–‡æœ¬    String text = &quot;&lt;tag&gt;&lt;/tag&gt;&quot;;\tDocument document = DocumentHelper.parseText(text);3.ä¸»åŠ¨åˆ›å»ºdocumentå¯¹è±¡    Document document = DocumentHelper.createDocument();\tElement root = document.addElement(&quot;tag&quot;);\n\njsoupè§£æhtmlæ–¹å¼Document document = Jsoup.parse(html);Element postList = document.getElementById(&quot;post_list&quot;);Elements titleEle = postItem.select(&quot;.post_item_body a[class=&#x27;titlelnk&#x27;]&quot;);\n\nä»¥ä¸Šè¿™ç§è§£ææ–¹å¼ï¼Œå±äºæ‰€è§å³æ‰€å¾—éšæ—¶å¯å–ï¼Œä½†æ˜¯å¾€å¾€å¯è¯»æ€§æ¯”è¾ƒå·®ï¼Œå¦‚å›¾\nå½“ç„¶å¦‚æœä½ ä¸å«Œéº»çƒ¦ï¼Œjsoupä¹Ÿå¯ä»¥è§£æxmlçš„ğŸ˜\npublic class JosupTest &#123;    public static void main(String[] args) throws IOException &#123;        //1. è·å–Documentå¯¹è±¡ï¼Œæ ¹æ®xmlæ–‡æ¡£è·å–        //2. è·å–user.xmlçš„path        String path = Objects.requireNonNull(JosupTest.class.getClassLoader().getResource(&quot;User.xml&quot;)).getPath();        //3. è§£æxmlæ–‡æ¡£ï¼ŒåŠ è½½æ–‡æ¡£è¿›å†…å­˜ï¼Œè·å–domæ ‘-----&gt;Document        Document document = Jsoup.parse(new File(path),&quot;UTF-8&quot;);        //4. è·å–å…ƒç´ å¯¹è±¡Elements(ç±»å‹ä¸ºArrayList)        Elements elements = document.getElementsByTag(&quot;name&quot;);        //5. æµ‹è¯•è·å–å…ƒç´ çš„ä¸ªæ•°æ˜¯å¦ç¬¦åˆï¼Œxmlæ–‡ä»¶ä¸­çš„ä¸ªæ•°        System.out.println(elements.size());        //5. æµ‹è¯•è·å–ç¬¬ä¸€ä¸ªå…ƒç´         Element element = elements.get(0);        //5. æµ‹è¯•è·å–ç¬¬ä¸€ä¸ªå…ƒç´ çš„æ–‡æœ¬å†…å®¹        String name = element.text();        //5. æµ‹è¯•è·å–ç¬¬ä¸€ä¸ªå…ƒç´ çš„åå­—æ˜¯å¦æ­£ç¡®        System.out.println(name);    &#125;&#125;\n\n\nåˆ©ç”¨fastjsonè¿›è¡Œè½¬æ¢\n\nfastjsonå’Œgsonè¿™ä¸¤ç§è§£ææ–¹å¼æ˜¯æˆ‘ä½¿ç”¨æœ€å¤šçš„ä¸¤ç§è§£ææ–¹å¼\ngsonï¼šå¿«é€Ÿï¼Œé«˜æ•ˆï¼Œä»£ç é‡å°‘ï¼Œé¢å‘å¯¹è±¡ï¼Œä½†æ˜¯ç›¸å¯¹fastjsonå’Œjackjsonï¼Œå®ƒçš„å„æ–¹é¢æ€§èƒ½éƒ½è¢«ç¢¾å‹\nfastjsonï¼šæ€§èƒ½æœ€é«˜ï¼Œæ”¯æŒå¤šç§ç±»å‹è§£æï¼Œç”±äºfastjsonå¤ªä¾§é‡æ€§èƒ½ï¼Œå¯¹äºéƒ¨åˆ†é«˜çº§ç‰¹æ€§æ”¯æŒä¸å¤Ÿï¼Œæœ‰ä¸€éƒ¨åˆ†è‡ªå®šä¹‰ç‰¹æ€§å®Œå…¨åç¦»äº†jsonå’Œjsè§„èŒƒï¼Œå¯èƒ½å¯¼è‡´ä¸å…¶ä»–æ¡†æ¶ä¸å…¼å®¹çš„bugï¼Œå¹¶ä¸”æ–‡æ¡£ç¼ºå¤±è¾ƒå¤šï¼Œè€Œä¸”ä»£ç ç¼ºå°‘æ³¨é‡Šè¾ƒä¸ºæ™¦æ¶©ï¼Œè¿‘å‡ å¹´ä¹Ÿå‡ºç°è¿‡ä¸€äº›é«˜å±æ¼æ´\nå¦‚æœè¦ä½¿ç”¨fastjsonè§£æxmlä¸ºjsonæ ¼å¼å°±éœ€è¦ä½¿ç”¨å·¥å…·ç±»çš„å½¢å¼è¿›è¡Œè½¬æ¢\npackage com.service.zl.model;import java.util.List;import org.dom4j.Attribute;import org.dom4j.Document;import org.dom4j.DocumentException;import org.dom4j.DocumentHelper;import org.dom4j.Element;import com.alibaba.fastjson.JSONArray;import com.alibaba.fastjson.JSONObject;/** * xmlå·¥å…·ç±» * @author sleep * @date 2016-09-13 */public class XmlTools &#123;    /**     * String è½¬ org.dom4j.Document     * @param xml     * @return     * @throws DocumentException     */    public static Document strToDocument(String xml) throws DocumentException &#123;        return DocumentHelper.parseText(xml);    &#125;    /**     * org.dom4j.Document è½¬  com.alibaba.fastjson.JSONObject     * @param xml     * @return     * @throws DocumentException     */    public static JSONObject documentToJSONObject(String xml) throws DocumentException &#123;        return elementToJSONObject(strToDocument(xml).getRootElement());    &#125;    /**     * org.dom4j.Element è½¬  com.alibaba.fastjson.JSONObject     * @param node     * @return     */    public static JSONObject elementToJSONObject(Element node) &#123;        JSONObject result = new JSONObject();        // å½“å‰èŠ‚ç‚¹çš„åç§°ã€æ–‡æœ¬å†…å®¹å’Œå±æ€§        List&lt;Attribute&gt; listAttr = node.attributes();// å½“å‰èŠ‚ç‚¹çš„æ‰€æœ‰å±æ€§çš„list        for (Attribute attr : listAttr) &#123;// éå†å½“å‰èŠ‚ç‚¹çš„æ‰€æœ‰å±æ€§            result.put(attr.getName(), attr.getValue());        &#125;        // é€’å½’éå†å½“å‰èŠ‚ç‚¹æ‰€æœ‰çš„å­èŠ‚ç‚¹        List&lt;Element&gt; listElement = node.elements();// æ‰€æœ‰ä¸€çº§å­èŠ‚ç‚¹çš„list        if (!listElement.isEmpty()) &#123;            for (Element e : listElement) &#123;// éå†æ‰€æœ‰ä¸€çº§å­èŠ‚ç‚¹                if (e.attributes().isEmpty() &amp;&amp; e.elements().isEmpty()) // åˆ¤æ–­ä¸€çº§èŠ‚ç‚¹æ˜¯å¦æœ‰å±æ€§å’Œå­èŠ‚ç‚¹                    result.put(e.getName(), e.getTextTrim());// æ²’æœ‰åˆ™å°†å½“å‰èŠ‚ç‚¹ä½œä¸ºä¸Šçº§èŠ‚ç‚¹çš„å±æ€§å¯¹å¾…                else &#123;                    if (!result.containsKey(e.getName())) // åˆ¤æ–­çˆ¶èŠ‚ç‚¹æ˜¯å¦å­˜åœ¨è¯¥ä¸€çº§èŠ‚ç‚¹åç§°çš„å±æ€§                        result.put(e.getName(), new JSONArray());// æ²¡æœ‰åˆ™åˆ›å»º                    ((JSONArray) result.get(e.getName())).add(elementToJSONObject(e));// å°†è¯¥ä¸€çº§èŠ‚ç‚¹æ”¾å…¥è¯¥èŠ‚ç‚¹åç§°çš„å±æ€§å¯¹åº”çš„å€¼ä¸­                &#125;            &#125;        &#125;        return result;    &#125;&#125;\n\nä¸Šé¢å·¥å…·ç±»å¯ä»¥ç›´æ¥æŠŠxmlè½¬ä¸ºjsonæ ¼å¼ï¼Œéå¸¸æ–¹ä¾¿ï¼Œä½†æ˜¯å±€é™æ€§å¤ªå¤§   åªèƒ½å•å‘è§£æï¼Œæ‰€ä»¥æœ€å¥½çš„æ–¹å¼è¿˜æ˜¯å»ºç«‹å®ä½“ç±»çš„æ–¹å¼\n\njaxbå’Œjackson\n\njaxbï¼šå®ƒæ˜¯ä¸€ä¸ªä¸šç•Œçš„æ ‡å‡†ï¼Œæ˜¯ä¸€é¡¹å¯ä»¥æ ¹æ®xmlç”Ÿæˆjavaç±»çš„æŠ€æœ¯ã€‚ä¹Ÿå¯ä»¥æ ¹æ®xmlå®ä¾‹æ–‡æ¡£åå‘ç”Ÿæˆjavaå¯¹è±¡æ ‘çš„æ–¹æ³•ï¼Œä¸saxå’Œdomä¸åŒï¼Œä¸éœ€è¦äº†è§£xmlè§£ææŠ€æœ¯ï¼Œå°±ä¸¤ç§æ“ä½œjavaå¯¹è±¡è½¬xmlå’Œxmlè½¬javaå¯¹è±¡\njacksonï¼šå®ƒæ€§èƒ½ä»‹äºfastjsonå’Œgsonä¹‹é—´ï¼Œä½†æ˜¯å®ƒæ˜¯ç›®å‰æœ€æµè¡Œçš„apiï¼Œè§„èŒƒæ€§é«˜ï¼Œæ¼æ´ä¹Ÿæ²¡æœ‰fastjsonå¤šï¼Œè¿˜æ”¯æŒjsonå’Œxmlè½¬æ¢ï¼Œç›®å‰å¸‚åœºä¸Šæœ€å¥½ç”¨çš„apiä¹‹ä¸€\nå…ˆæ¥çœ‹çœ‹jaxbçš„è§£æxmlæ–¹å¼\n@XmlRootElement(name = &quot;ServicesError&quot;)public class TaoBaoBaseRequest implements Serializable &#123;    private String errorCode;    private String errorMessage;    @XmlElement(name = &quot;ErrorCode&quot;)    public String getErrorCode() &#123;        return errorCode;    &#125;    public void setErrorCode(String errorCode) &#123;        this.errorCode = errorCode;    &#125;    @XmlElement(name = &quot;ErrorMessage&quot;)    public String getErrorMessage() &#123;        return errorMessage;    &#125;    public void setErrorMessage(String errorMessage) &#123;        this.errorMessage = errorMessage;    &#125;&#125;\n\njaxbçš„è§£æå¯ä»¥å‚è€ƒè¿™ç¯‡æ–‡ç« ï¼šhttps://blog.csdn.net/wn084/article/details/80853587\nä»¥ä¸‹æ˜¯jackjsonçš„è§£æ\npackage com.model.taobao;import com.alibaba.fastjson.JSON;import com.fasterxml.jackson.annotation.JsonInclude;import com.fasterxml.jackson.databind.MapperFeature;import com.fasterxml.jackson.dataformat.xml.XmlMapper;import com.fasterxml.jackson.dataformat.xml.annotation.JacksonXmlProperty;import com.fasterxml.jackson.dataformat.xml.annotation.JacksonXmlRootElement;import javax.xml.bind.annotation.XmlRootElement;import javax.xml.stream.XMLStreamException;import java.io.IOException;/** * ClassName: test &lt;br/&gt; * Description: &lt;br/&gt; * date: 2022/1/30 9:08&lt;br/&gt; * * @author Administrator&lt;br /&gt; */public class test &#123;    public static void main(String[] args) throws IOException, XMLStreamException &#123;        String xml = &quot;&lt;?xml version=\\&quot;1.0\\&quot; encoding=\\&quot;UTF-8\\&quot; standalone=\\&quot;no\\&quot; ?&gt;&lt;DataList Airlines=\\&quot;ALL\\&quot; Dpt=\\&quot;KMG\\&quot; Arr=\\&quot;JJN\\&quot; Date=\\&quot;20220301\\&quot; Carrier=\\&quot;SC\\&quot; Cabin = \\&quot;U\\&quot; Code=\\&quot;SC9260\\&quot;&gt;&lt;/DataList&gt;&quot;;        DataList dataList1 = xmlToObject(xml, DataList.class);        System.out.println(JSON.toJSONString(dataList1));    &#125;    public static String objectToXml(Object object) throws IOException &#123;        XmlMapper xmlMapper= new XmlMapper();        xmlMapper.setDefaultUseWrapper(false);        /* å­—æ®µä¸ºnullï¼Œè‡ªåŠ¨å¿½ç•¥ï¼Œä¸å†åºåˆ—åŒ– */        xmlMapper.setSerializationInclusion(JsonInclude.Include.NON_NULL);        /* è®¾ç½®è½¬æ¢æ¨¡å¼ */        xmlMapper.enable(MapperFeature.USE_STD_BEAN_NAMING);        String resultXml = xmlMapper.writeValueAsString(object);        return resultXml;    &#125;    public static &lt;T&gt; T xmlToObject(String xml,Class&lt;T&gt; clazz) throws IOException, XMLStreamException &#123;        XmlMapper xmlMapper= new XmlMapper();        xmlMapper.setDefaultUseWrapper(false);        /* å­—æ®µä¸ºnullï¼Œè‡ªåŠ¨å¿½ç•¥ï¼Œä¸å†åºåˆ—åŒ– */        xmlMapper.setSerializationInclusion(JsonInclude.Include.NON_NULL);        /* è®¾ç½®è½¬æ¢æ¨¡å¼ */        xmlMapper.enable(MapperFeature.USE_STD_BEAN_NAMING);        return xmlMapper.readValue(xml, clazz);    &#125;&#125;@JacksonXmlRootElementclass DataList&#123;    @JacksonXmlProperty(isAttribute = true)    private String Airlines;    @JacksonXmlProperty(isAttribute = true)    private String Dpt;    @JacksonXmlProperty(isAttribute = true)    private String Arr;    @JacksonXmlProperty(isAttribute = true)    private String Date;    @JacksonXmlProperty(isAttribute = true)    private String Carrier;    @JacksonXmlProperty(isAttribute = true)    private String Cabin;    @JacksonXmlProperty(isAttribute = true)    private String Code;    public String getAirlines() &#123;        return Airlines;    &#125;    public void setAirlines(String airlines) &#123;        Airlines = airlines;    &#125;    public String getDpt() &#123;        return Dpt;    &#125;    public void setDpt(String dpt) &#123;        Dpt = dpt;    &#125;    public String getArr() &#123;        return Arr;    &#125;    public void setArr(String arr) &#123;        Arr = arr;    &#125;    public String getDate() &#123;        return Date;    &#125;    public void setDate(String date) &#123;        Date = date;    &#125;    public String getCarrier() &#123;        return Carrier;    &#125;    public void setCarrier(String carrier) &#123;        Carrier = carrier;    &#125;    public String getCabin() &#123;        return Cabin;    &#125;    public void setCabin(String cabin) &#123;        Cabin = cabin;    &#125;    public String getCode() &#123;        return Code;    &#125;    public void setCode(String code) &#123;        Code = code;    &#125;    public DataList() &#123;    &#125;&#125;\n\né‡Œé¢å†™äº†ä¸€ä¸ªå·¥å…·ç±»ï¼šobjectToXmlå’ŒxmlToObjectå¯ä»¥è½¬æ¢xmlå’Œå®ä½“ç±»==æ³¨æ„è¸©å‘==\nå‘ä¸€ï¼šå¤§å°å†™é—®é¢˜@JacksonXmlProperty(localName = &quot;Apid&quot;)private Integer Apid;private Integer getApid()&#123;    return this.Apid&#125;æŠŠæ³¨è§£æ”¾åœ¨æˆå‘˜å˜é‡ä¸Šé¢ï¼Œä¼šè§£æå‡ºä¸¤ä¸ªapidå­—æ®µï¼Œä¸€ä¸ªæ˜¯&lt;Apid&gt;&lt;/Apid&gt;,å¦ä¸€ä¸ªæ˜¯&lt;apid&gt;&lt;apid&gt;è¿™æ˜¯å› ä¸ºJacksonçš„å¤„ç†æœºåˆ¶ä¼šè‡ªåŠ¨ä»å±æ€§æ–¹æ³•ä¸Šè·å–æˆå‘˜å˜é‡åï¼Œç„¶è€Œåœ¨javaä¸­ï¼Œè¦ä¹ˆä»¥é©¼å³°å‘½åï¼Œè¦ä¹ˆå‰ä¸¤ä¸ªå­—æ¯éƒ½å¤§å†™ï¼Œæ‰èƒ½ç”¨getæ–¹æ³•æ­£ç¡®åœ°è·å–å±æ€§ï¼Œæ‰€ä»¥ä½¿ç”¨getApidè·å–çš„æˆå‘˜åç§°å°±æ˜¯apidï¼Œè¢«jacksonè§£æäº†å‡ºæ¥ã€‚åˆå› ä¸ºæˆå‘˜å˜é‡ä¸Šä¹ŸåŠ äº†æ³¨è§£ï¼Œæ‰€ä»¥ä¹Ÿä¼šè¢«è§£æã€‚è¿™å°±é€ æˆäº†xmlæ–‡ä»¶ç”Ÿæˆäº†ä¸¤ä¸ªapidæ ‡ç­¾ã€‚æ­£ç¡®çš„åšæ³•æ˜¯æŠŠæ³¨è§£å†™åˆ°getæ–¹æ³•ä¸Šé¢æ­£ç¡®å†™æ³•ï¼šprivate Integer Apid;@JacksonXmlProperty(localName = &quot;Apid&quot;)private Integer getApid()&#123;    return this.Apid&#125; å‘äºŒï¼šJacksonå°è£…listé—®é¢˜è¿™ä¸ªé—®é¢˜æ’æŸ¥çš„æ—¶å€™å¼‚å¸¸å›°éš¾â€¦â€¦å¼€å§‹ä»¥ä¸ºæ˜¯å°è£…çš„é—®é¢˜â€¦â€¦â€¦â€¦(åæ§½ä¸€ä¸‹ï¼Œè¿™ä¸ªå¤–åŒ…é¡¹ç›®ä½¿ç”¨å¤§é‡xmläº¤äº’ï¼Œä½†æ˜¯åˆç”¨ä¸äº†webserviceå°±å¾—æŒ‰ç…§å›ºå®šæ ¼å¼è§£æå°è£…xml.....æ”¹åŠ¨ä¹Ÿè´¼å›°éš¾ã€‚ã€‚ã€‚)â€¦â€¦æœ€åè¿˜æ˜¯ç¡®å®šäº†æ˜¯jacksonçš„é—®é¢˜private List&lt;Integer&gt; APID;@JacksonXmlProperty(localName = &quot;APID&quot;)@JacksonXmlElementWrapper(useWrapping = false)public List&lt;Integer&gt; getAPID() &#123;return APID;&#125;å¼€å§‹APIDè¿™ä¸ªlistä¸€ç›´è¢«åŒ…è£…äº†ä¸¤å±‚ï¼æ­£ç¡®ç»“æœåº”è¯¥æ˜¯&lt;APID&gt;111&lt;/APID&gt;ä½†æ˜¯å¾—åˆ°çš„æ˜¯&lt;APID&gt;&lt;APID&gt;111&lt;/APID&gt;&lt;/APID&gt;é—®é¢˜å‡ºåœ¨JacksonXmlElementWrapperå¦‚æœä¸æŒ‡å®šçš„è¯è¿™ä¸ªå€¼é»˜è®¤æ˜¯true\n\n\næ€»ç»“\n\nç›®å‰æ„Ÿè§‰è§£æxmlçš„apiè¿˜æ˜¯æ¯”è¾ƒå¤šçš„ï¼Œé’ˆå¯¹xmlçš„å„ç§å¥‡å¥‡æ€ªæ€ªçš„æ ¼å¼ï¼Œå¹¶ä¸æ˜¯éƒ½èƒ½å…¼å®¹åˆ°ï¼Œç›®å‰æ„Ÿè§‰æœ€å¥½ç”¨çš„è¿˜æ˜¯jackson+Lombokèƒ½æ¯”è¾ƒå¥½çš„å¿«é€Ÿè§£å†³é—®é¢˜ï¼Œå½“ç„¶è¦æ³¨æ„lombokçš„ä¾µå…¥æ€§å’Œjdkçš„ç‰ˆæœ¬é€‰æ‹©æœ€å¥½çš„æ–¹å¼å»è§£å†³ï¼Œæœ‰äº›æ–¹å¼è™½ç„¶ä¸æ–¹ä¾¿ï¼Œä½†æ˜¯å®ƒå°±æ˜¯èƒ½è§£å†³é—®é¢˜â€¦â€¦\n","tags":["java","xml"]},{"title":"ç¼“å­˜åŒå†™ä¸ä¸€è‡´","url":"/2022/03/07/0.0.5%E7%BC%93%E5%AD%98%E5%8F%8C%E5%86%99%E4%B8%8D%E4%B8%80%E8%87%B4/","content":"ç¼“å­˜æ•°æ®åº“åŒå†™ä¸ä¸€è‡´\né«˜å¹¶å‘ä¸‹ç¼“å­˜ä¸æ•°æ®åº“åŒå†™ä¸ä¸€è‡´è§£å†³æ–¹æ¡ˆ\n\næ­£å¸¸çš„ç¼“å­˜æ•°æ®åº“æ›´æ–°çš„æ—¶å€™åº”è¯¥æ˜¯å…ˆæ‰§è¡Œçº¿ç¨‹1ï¼Œç„¶åæ‰§è¡Œçº¿ç¨‹2\n\nå¦‚æœçº¿ç¨‹1å¡é¡¿äº†ä¸€ä¸‹ï¼Œè¿™æ—¶å°±ä¼šé€ æˆæ•°æ®åº“å’Œç¼“å­˜ä¸ä¸€è‡´çš„æƒ…å†µçº¿ç¨‹1æŠŠçº¿ç¨‹2æ›´æ–°çš„ç¼“å­˜æ•°æ®ç»™è¦†ç›–äº†\n\næœ€å¼€å§‹çš„ç¼“å­˜ä¸ä¸€è‡´é—®é¢˜ä»¥åŠè§£å†³æ–¹æ¡ˆ\né—®é¢˜ï¼šå…ˆä¿®æ”¹æ•°æ®åº“ï¼Œå†åˆ é™¤ç¼“å­˜ï¼Œå¦‚æœåˆ é™¤ç¼“å­˜å¤±è´¥äº†ï¼Œé‚£ä¹ˆä¼šå¯¼è‡´æ•°æ®åº“ä¸­æ˜¯æ–°æ•°æ®ï¼Œç¼“å­˜ä¸­æ˜¯æ—§æ•°æ®ï¼Œæ•°æ®å‡ºç°ä¸ä¸€è‡´ã€‚\n\nè§£å†³æ€è·¯ï¼šã€€ã€€å…ˆåˆ é™¤ç¼“å­˜ï¼Œå†ä¿®æ”¹æ•°æ®åº“ï¼Œå¦‚æœåˆ é™¤ç¼“å­˜æˆåŠŸäº†ä¿®æ”¹æ•°æ®åº“å¤±è´¥äº†ï¼Œé‚£ä¹ˆæ•°æ®åº“ä¸­æ˜¯æ—§æ•°æ®ï¼Œç¼“å­˜ä¸­æ˜¯ç©ºçš„ï¼Œé‚£ä¹ˆæ•°æ®ä¸ä¼šä¸ä¸€è‡´ï¼Œå› ä¸ºè¯»çš„æ—¶å€™ç¼“å­˜æ²¡æœ‰ï¼Œåˆ™è¯»æ•°æ®åº“ä¸­æ—§æ•°æ®ï¼Œç„¶åæ›´æ–°åˆ°ç¼“å­˜ä¸­ã€‚\n\n2ã€å¹¶å‘ä¸‹æ•°æ®ç¼“å­˜ä¸ä¸€è‡´é—®é¢˜åˆ†æé—®é¢˜ï¼šã€€ã€€ç¬¬ä¸€ä¸ªè¯·æ±‚æ•°æ®å‘ç”Ÿå˜æ›´ï¼Œå…ˆåˆ é™¤äº†ç¼“å­˜ï¼Œç„¶åè¦å»ä¿®æ”¹æ•°æ®åº“ï¼Œæ­¤æ—¶è¿˜æ²¡æ¥å¾—åŠå»ä¿®æ”¹ï¼›ã€€ã€€ç¬¬äºŒä¸ªè¯·æ±‚è¿‡æ¥å»è¯»ç¼“å­˜ï¼Œå‘ç°ç¼“å­˜ç©ºäº†ï¼Œå»æŸ¥è¯¢æ•°æ®åº“ï¼ŒæŸ¥åˆ°äº†ä¿®æ”¹å‰çš„æ—§æ•°æ®ï¼Œæ”¾åˆ°äº†ç¼“å­˜ä¸­ï¼›ã€€ã€€ç¬¬ä¸‰ä¸ªè¯·æ±‚è¯»å–ç¼“å­˜ä¸­çš„æ•°æ® (æ­¤æ—¶ç¬¬ä¸€ä¸ªè¯·æ±‚å·²ç»å®Œæˆäº†æ•°æ®åº“ä¿®æ”¹çš„æ“ä½œ)ã€‚ã€€ã€€å®Œäº†ï¼Œæ•°æ®åº“å’Œç¼“å­˜ä¸­çš„æ•°æ®ä¸ä¸€æ ·äº†ã€‚ã€‚ã€‚ã€‚\n\nåˆ†æåŸå› ï¼š\nåªæœ‰åœ¨å¯¹åŒä¸€æ¡æ•°æ®å¹¶å‘è¯»å†™çš„æ—¶å€™ï¼Œæ‰å¯èƒ½ä¼šå‡ºç°è¿™ç§é—®é¢˜ã€‚å…¶å®å¦‚æœè¯´ä½ çš„å¹¶å‘é‡å¾ˆä½çš„è¯ï¼Œç‰¹åˆ«æ˜¯è¯»å¹¶å‘å¾ˆä½ï¼Œæ¯å¤©è®¿é—®é‡å°±1ä¸‡æ¬¡ï¼Œé‚£ä¹ˆå¾ˆå°‘çš„æƒ…å†µä¸‹ï¼Œä¼šå‡ºç°åˆšæ‰æè¿°çš„é‚£ç§ä¸ä¸€è‡´çš„åœºæ™¯;ä½†å¦‚æœæ¯å¤©çš„æ˜¯ä¸Šäº¿çš„æµé‡ï¼Œæ¯ç§’å¹¶å‘è¯»æ˜¯å‡ ä¸‡ï¼Œæ¯ç§’åªè¦æœ‰æ•°æ®æ›´æ–°çš„è¯·æ±‚ï¼Œå°±å¯èƒ½ä¼šå‡ºç°ä¸Šè¿°çš„æ•°æ®åº“+ç¼“å­˜ä¸ä¸€è‡´çš„æƒ…å†µã€‚\nå†…å­˜é˜Ÿåˆ—æ•°æ®åº“çš„ç¼“å­˜æ›´æ–°ä¸è¯»å–æ“ä½œè¿›è¡Œä¸²è¡ŒåŒ–ï¼Œä¸€ä¸ªé˜Ÿåˆ—å¯¹åº”ä¸€ä¸ªå·¥ä½œçº¿ç¨‹ï¼Œæ¯ä¸ªå·¥ä½œçº¿ç¨‹ä¸²è¡Œæ‹¿åˆ°å¯¹åº”çš„æ“ä½œï¼Œç„¶åä¸€æ¡ä¸€æ¡çš„æ‰§è¡Œã€‚\n  ã€€ã€€1. é¦–å…ˆæˆ‘ä»¬çš„é¡¹ç›®é‡Œç»´æŠ¤ä¸€ç»„çº¿ç¨‹æ± å’Œå†…å­˜é˜Ÿåˆ—ã€‚  ã€€ã€€2. æ›´æ–°æ•°æ®çš„æ—¶å€™ï¼Œæ ¹æ®æ•°æ®çš„å”¯ä¸€æ ‡è¯†å°†è¯·æ±‚è·¯ç”±åˆ°ä¸€ä¸ªjvmé˜Ÿåˆ—ä¸­ï¼Œå»æ›´æ–°æ•°æ®åº“,ç„¶åè¯·æ±‚ç»“æŸã€‚  ã€€ã€€3. è¯»å–æ•°æ®çš„æ—¶å€™ï¼Œå…ˆæŸ¥ç¼“å­˜ï¼Œå¦‚æœå‘ç°æ•°æ®ä¸åœ¨ç¼“å­˜ä¸­ï¼Œé‚£ä¹ˆå°†æ ¹æ®å”¯ä¸€æ ‡è¯†è·¯ç”±ä¹‹åï¼Œä¹Ÿå‘é€åŒä¸€ä¸ªjvmå†…éƒ¨çš„é˜Ÿåˆ—ä¸­ï¼Œé‡æ–°è¯»å–æ•°æ®åº“åæ›´æ–°ç¼“å­˜,æœ€åè¯·æ±‚ç»“æŸã€‚\n\nç¼ºç‚¹ï¼š\n1.å®ç°èµ·æ¥éº»çƒ¦ï¼Œä¸åŒçš„keyå¯èƒ½éœ€è¦æä¸åŒçš„é˜Ÿåˆ—\n2.å¦‚æœç³»ç»ŸæŒ‚äº†ï¼Œè¿˜å¾—è¿˜åŸè¿™äº›æ•°æ®ï¼Œå¦‚æœå‡ºç°äº†å¼‚å¸¸ï¼Œè¿˜ä¼šé€ æˆè„æ•°æ®\nå»¶æ—¶åŒåˆ \nå»¶æ—¶åŒåˆ æ–¹æ¡ˆæ‰§è¡Œæ­¥éª¤1.åˆ é™¤redis2.æ›´æ–°æ•°æ®åº“3.å»¶æ—¶50æ¯«ç§’4.åˆ é™¤redis\n\né—®é¢˜ä¸€ï¼šä¸ºä½•è¦å»¶æ—¶50æ¯«ç§’ï¼Ÿè¿™æ˜¯ä¸ºäº†æˆ‘ä»¬åœ¨ç¬¬äºŒæ¬¡åˆ é™¤redisä¹‹å‰èƒ½å®Œæˆæ•°æ®åº“çš„æ›´æ–°æ“ä½œã€‚å‡è±¡ä¸€ä¸‹ï¼Œå¦‚æœæ²¡æœ‰ç¬¬ä¸‰æ­¥æ“ä½œæ—¶ï¼Œæœ‰å¾ˆå¤§æ¦‚ç‡ï¼Œåœ¨ä¸¤æ¬¡åˆ é™¤redisæ“ä½œæ‰§è¡Œå®Œæ¯•ä¹‹åï¼Œæ•°æ®åº“çš„æ•°æ®è¿˜æ²¡æœ‰æ›´æ–°ï¼Œæ­¤æ—¶è‹¥æœ‰è¯·æ±‚è®¿é—®æ•°æ®ï¼Œä¾¿ä¼šå‡ºç°æˆ‘ä»¬ä¸€å¼€å§‹æåˆ°çš„é‚£ä¸ªé—®é¢˜ã€‚\né—®é¢˜äºŒ: ä¸ºä½•è¦ä¸¤æ¬¡åˆ é™¤redis?å¦‚æœæˆ‘ä»¬æ²¡æœ‰ç¬¬äºŒæ¬¡åˆ é™¤æ“ä½œï¼Œæ­¤æ—¶æœ‰è¯·æ±‚è®¿é—®æ•°æ®ï¼Œæœ‰å¯èƒ½æ˜¯è®¿é—®çš„ä¹‹å‰æœªåšä¿®æ”¹çš„redisæ•°æ®ï¼Œåˆ é™¤æ“ä½œæ‰§è¡Œåï¼Œredisä¸ºç©ºï¼Œæœ‰è¯·æ±‚è¿›æ¥æ—¶ï¼Œä¾¿ä¼šå»è®¿é—®æ•°æ®åº“ï¼Œæ­¤æ—¶æ•°æ®åº“ä¸­çš„æ•°æ®å·²æ˜¯æ›´æ–°åçš„æ•°æ®ï¼Œä¿è¯äº†æ•°æ®çš„ä¸€è‡´æ€§ã€‚\n\nç¼ºç‚¹ï¼š\n1.æ²¡æœ‰ä»æ ¹æœ¬ä¸Šé¢å»è§£å†³é—®é¢˜ï¼Œå¦‚æœæ›´æ–°ç¼“å­˜æ—¶é—´è¶…è¿‡50msï¼Œé‚£ä¹ˆè¿˜æ˜¯å¤±è´¥çš„ï¼Œå¦‚æœè¦ä¸€ç›´ä¿è¯ä¼‘çœ æ—¶é—´å¤§äºæ›´æ–°æ—¶é—´ï¼Œè¿™æ ·ä¼šä¸ä¼šé€ æˆé˜»å¡\n2.å¦‚æœä¸€ä¸ªæ¥å£è¯·æ±‚æœ‰é™åˆ¶æ—¶é—´ï¼Œè¿™ä¼‘çœ æ—¶é—´ä¼šå½±å“ç”¨æˆ·ä½“éªŒï¼Œå½±å“æ¥å£çš„å“åº”é€Ÿåº¦\nåˆ†å¸ƒå¼é”å¦‚æœåŠ åˆ†å¸ƒå¼é”å¯ä»¥ç›´æ¥ä¿è¯æ¯ä¸ªçº¿ç¨‹çš„æ‰§è¡Œé¡ºåºï¼Œä¹Ÿæ˜¯ä¸€ç§ä¸²è¡Œæ“ä½œ\nè¿™ä¸ªè¿˜æ˜¯æ¯”è¾ƒæ¨èä½¿ç”¨çš„ï¼Œæ¯”å†…å­˜ä¸²è¡Œå®ç°ç®€å•ï¼Œè€Œä¸”ç¨³å®š\n\nç¼ºç‚¹ï¼š\n1.åˆ†å¸ƒå¼é”ä¼šæœ‰æ€§èƒ½é—®é¢˜ï¼Œä¼šå¯¼è‡´å¹¶å‘é‡å¾ˆä½ï¼ˆåŠ é”æ°¸è¿œä¸æ˜¯æœ€ä¼˜çš„æ–¹æ¡ˆï¼‰\nè¯»å†™é”redissonä¸­é—´é‡Œé¢å®ç°äº†è¯»å†™é”ï¼Œè¯»é”ä¸è¯»é”ä¹‹é—´æ˜¯ä¸ä¼šäº’æ–¥çš„å’Œæ²¡åŠ é”ä¸€æ ·ï¼Œå†™é”ä¸å†™é”ä¼šäº’æ–¥\nä¸€èˆ¬éƒ½æ˜¯è¯»å¤šå†™å°‘\n\næ€»ç»“ä¸€èˆ¬æ¥è¯´ï¼Œå°±æ˜¯å¦‚æœä½ çš„ç³»ç»Ÿä¸æ˜¯ä¸¥æ ¼è¦æ±‚ç¼“å­˜+æ•°æ®åº“å¿…é¡»ä¸€è‡´æ€§çš„è¯ï¼Œç¼“å­˜å¯ä»¥ç¨å¾®çš„è·Ÿæ•°æ®åº“å¶å°”æœ‰ä¸ä¸€è‡´çš„æƒ…å†µï¼Œé‚£æœ€å¥½ä¸è¦ä¸Šè¿°çš„ä¸²è¡ŒåŒ–çš„è¿™ä¸ªæ–¹æ¡ˆï¼Œå› ä¸ºè¯»è¯·æ±‚å’Œå†™è¯·æ±‚ä¸²è¡ŒåŒ–ï¼Œä¸²åˆ°ä¸€ä¸ªå†…å­˜é˜Ÿåˆ—é‡Œå»ï¼Œè¿™æ ·æ˜¯å¯ä»¥ä¿è¯ä¸€å®šä¸ä¼šå‡ºç°ä¸ä¸€è‡´çš„æƒ…å†µã€‚ä½†æ˜¯ï¼Œä¸²è¡ŒåŒ–ä¹‹åï¼Œå°±ä¼šå¯¼è‡´ç³»ç»Ÿçš„ååé‡ä¼šå¤§å¹…åº¦çš„é™ä½ï¼Œä½ å°±éœ€è¦ç”¨æ¯”æ­£å¸¸æƒ…å†µä¸‹å¤šå‡ å€çš„æœºå™¨å»æ”¯æ’‘çº¿ä¸Šçš„ä¸€ä¸ªè¯·æ±‚ã€‚\nä»¥ä¸Šæ˜¯æœ¬äººå¯¹ç¼“å­˜æ•°æ®åº“ä¸ä¸€è‡´æƒ…å†µçš„äº†è§£ï¼Œæœ¬äººèƒ½åŠ›æœ‰é™ï¼Œå¦‚æœ‰é—®é¢˜è¿˜æœ›åŒ…å«ï¼Œä¹Ÿæ¬¢è¿æŒ‡æ­£ã€‚è°¢è°¢ï¼\n","tags":["redis","æ•°æ®åº“","ç¼“å­˜"]},{"title":"ä½¿ç”¨rediså®ç°åˆ†å¸ƒå¼é”","url":"/2022/03/02/0.0.8%E4%BD%BF%E7%94%A8redis%E5%AE%9E%E7%8E%B0%E5%88%86%E5%B8%83%E5%BC%8F%E9%94%81/","content":"\nJavaä¸­æä¾›äº†ç§ç±»ä¸°å¯Œçš„é”ï¼Œæ¯ç§é”å› å…¶ç‰¹æ€§çš„ä¸åŒï¼Œåœ¨é€‚å½“çš„åœºæ™¯ä¸‹åˆç†é€‰æ‹©èƒ½å±•ç°éå¸¸é«˜çš„æ•ˆç‡\n\nåˆ†å¸ƒå¼é”ä¸€èˆ¬æœ‰ä¸‰ç§å®ç°æ–¹å¼ï¼šæ•°æ®åº“ä¹è§‚é”ï¼ŒRedisåˆ†å¸ƒå¼é”ï¼ŒZookeeperåˆ†å¸ƒå¼é”\næœ¬ç¯‡åšå®¢ä¸»è¦è¯¦ç»†ä»‹ç»redisåˆ†å¸ƒå¼é”çš„è¿›åŒ–ï¼Œè¿›åŒ–æ‰€è§£å†³çš„åœºæ™¯é—®é¢˜\nå¯é æ€§é¦–å…ˆï¼Œä¸ºäº†ç¡®ä¿åˆ†å¸ƒå¼é”çš„å¯ç”¨æ€§ï¼Œæˆ‘ä»¬éœ€è¦ç¡®ä¿é”èƒ½åŒæ—¶æ»¡è¶³ä»¥ä¸‹å››ä¸ªæ¡ä»¶\n\näº’æ–¥æ€§:åœ¨ä»»æ„æ—¶åˆ»ï¼Œåªæœ‰ä¸€ä¸ªå®¢æˆ·ç«¯èƒ½æŒæœ‰é”ã€‚\nä¸ä¼šå‘ç”Ÿæ­»é”:å³ä½¿æœ‰ä¸€ä¸ªå®¢æˆ·ç«¯åœ¨æŒæœ‰é”çš„æœŸé—´å´©æºƒè€Œæ²¡æœ‰ä¸»åŠ¨è§£é”ï¼Œä¹Ÿèƒ½ä¿è¯åç»­å…¶ä»–å®¢æˆ·ç«¯èƒ½åŠ é”ã€‚\nå…·æœ‰å®¹é”™æ€§:åªè¦å¤§éƒ¨åˆ†çš„RedisèŠ‚ç‚¹æ­£å¸¸è¿è¡Œï¼Œå®¢æˆ·ç«¯å°±å¯ä»¥åŠ é”å’Œè§£é”ã€‚\nè§£é“ƒè¿˜é¡»ç³»é“ƒäºº:åŠ é”å’Œè§£é”å¿…é¡»æ˜¯åŒä¸€ä¸ªå®¢æˆ·ç«¯ï¼Œå®¢æˆ·ç«¯è‡ªå·±ä¸èƒ½æŠŠåˆ«äººåŠ çš„é”ç»™è§£äº†ã€‚\n\nå®ç°åŸç†åœ¨å•æœºä¸‹å¯ä»¥ç”¨synchronizedåŒæ­¥ä»£ç å—åŠ é”\n@Autowiredprivate StringRedisTemplate redisTemplate;@Testpublic void deductStock()&#123;    synchronized (this)&#123;        int stock = Integer.parseInt(redisTemplate.opsForValue().get(&quot;stock&quot;));        if(stock &gt; 0)&#123;            int realStock = stock - 1;            redisTemplate.opsForValue().set(&quot;stock&quot;,realStock + &quot;&quot;);            System.out.println(&quot;æ‰£å‡æˆåŠŸï¼Œå‰©ä½™åº“å­˜ï¼š&quot; + realStock);        &#125;else&#123;            System.out.println(&quot;æ‰£å‡å¤±è´¥ï¼Œåº“å­˜ä¸è¶³&quot;);        &#125;    &#125;&#125;\n\nä½†æ˜¯åœ¨çœŸå®çš„åœºæ™¯ä¸‹ï¼Œå¾€å¾€æ˜¯å¤šå°æœåŠ¡å™¨åšè´Ÿè½½ï¼Œè€Œsynchronizedæ˜¯è¿›ç¨‹çº§åˆ«çš„ï¼Œåªåœ¨å½“å‰è¿›ç¨‹æœ‰æ•ˆ\nå¦‚æœæ˜¯åšäº†è´Ÿè½½çš„æœåŠ¡å™¨ï¼Œå¾€å¾€æ§åˆ¶ä¸ä½è¯·æ±‚ï¼Œä¾ç„¶ä¼šæœ‰å¹¶å‘é—®é¢˜ï¼Œåœ¨å¹¶å‘ä½çš„æƒ…å†µä¸‹å¯èƒ½ä¸ä¼šå‡ºç°é—®é¢˜\nè¿™ç§æƒ…å†µä¸‹å°±å¾—ç”¨åˆ†å¸ƒå¼é”\nåœ¨redisä¸­ï¼Œåˆ©ç”¨setnxå‘½ä»¤çš„ç‰¹æ€§å¯ä»¥è½»æ¾å®ç°åˆ†å¸ƒå¼é”\n\nåªåœ¨é”® key ä¸å­˜åœ¨çš„æƒ…å†µä¸‹ï¼Œå°†é”® key çš„å€¼è®¾ç½®ä¸º value ã€‚è‹¥é”® key å·²ç»å­˜åœ¨ï¼Œ åˆ™ SETNX å‘½ä»¤ä¸åšä»»ä½•åŠ¨ä½œã€‚\nè¿”å›å€¼ï¼šå‘½ä»¤åœ¨è®¾ç½®æˆåŠŸæ—¶è¿”å› 1 ï¼Œè®¾ç½®å¤±è´¥æ—¶è¿”å› 0 ã€‚\n\n\n@Autowiredprivate StringRedisTemplate redisTemplate;@Testpublic void deductStock()&#123;    String locKey = &quot;lockey&quot;;    // å¦‚æœå­˜åœ¨åˆ™true,æˆåŠŸåˆ™æ–°å¢è¿”å›false    Boolean result = redisTemplate.opsForValue().setIfAbsent(locKey, &quot;lock&quot;);    // å¦‚æœå­˜åœ¨ï¼Œç›´æ¥è¿”å›å¤±è´¥    if(!result)&#123;        System.out.println(&quot;error_code&quot;);        return    &#125;    int stock = Integer.parseInt(redisTemplate.opsForValue().get(&quot;stock&quot;));    if(stock &gt; 0)&#123;        int realStock = stock - 1;        redisTemplate.opsForValue().set(&quot;stock&quot;,realStock + &quot;&quot;);        System.out.println(&quot;æ‰£å‡æˆåŠŸï¼Œå‰©ä½™åº“å­˜ï¼š&quot; + realStock);    &#125;else&#123;        System.out.println(&quot;æ‰£å‡å¤±è´¥ï¼Œåº“å­˜ä¸è¶³&quot;);    &#125;    // åˆ é™¤keyï¼Œè¡¨ç¤ºå·²ç»è§£é”    redisTemplate.delete(locKey);  &#125;\n\nä»¥ä¸Šä»£ç æ˜¯ç®€å•çš„redisé”ï¼Œå¦‚æœåœ¨åŠ é”å’Œè§£é”ä¸­é—´ï¼Œå‡ºç°äº†å¼‚å¸¸ï¼Œåˆ™redisé‡Œé¢ä¼šä¸€ç›´åŠ ä¸Šè¿™æŠŠé”\n\næ‰€ä»¥å‡çº§ä¸€ä¸‹ï¼Œè®©æˆ‘ä»¬çš„ä»£ç æ›´å¥å£®ï¼Œä½¿ç”¨try catch finally  ä¿è¯ä¸€å®šä¼šé‡Šæ”¾é”\n@Autowiredprivate StringRedisTemplate redisTemplate;@Testpublic void deductStock()&#123;    String locKey = &quot;lockey&quot;;    // å¦‚æœå­˜åœ¨åˆ™true,æˆåŠŸåˆ™æ–°å¢è¿”å›false    Boolean result = redisTemplate.opsForValue().setIfAbsent(locKey, &quot;lock&quot;);    // å¦‚æœå­˜åœ¨ï¼Œç›´æ¥è¿”å›å¤±è´¥    if(!result)&#123;        System.out.println(&quot;error_code&quot;);    &#125;    try &#123;        int stock = Integer.parseInt(redisTemplate.opsForValue().get(&quot;stock&quot;));        if(stock &gt; 0)&#123;            int realStock = stock - 1;            redisTemplate.opsForValue().set(&quot;stock&quot;,realStock + &quot;&quot;);            System.out.println(&quot;æ‰£å‡æˆåŠŸï¼Œå‰©ä½™åº“å­˜ï¼š&quot; + realStock);        &#125;else&#123;            System.out.println(&quot;æ‰£å‡å¤±è´¥ï¼Œåº“å­˜ä¸è¶³&quot;);        &#125;    &#125;finally &#123;    \t// åˆ é™¤keyï¼Œè¡¨ç¤ºå·²ç»è§£é”        redisTemplate.delete(locKey);    &#125;&#125;\n\nå¦‚æœåœ¨è¿™ä¸ªæ—¶å€™ï¼Œrediså®•æœºäº†ï¼Œä¾ç„¶ä¼šå‡ºç°ä¸€ç›´é”æ­»çš„æƒ…å†µ\n\nè¿™ä¸ªæ—¶å€™æˆ‘ä»¬å¯ä»¥ç»™é”è®¾ç½®ä¸€ä¸ªè¶…æ—¶æ—¶é—´ï¼Œè¿™æ ·å¯ä»¥ä¿è¯é”è‡ªåŠ¨é‡Šæ”¾ï¼Œä¸ä¼šä¸€ç›´é”æ­»\n@Testpublic void deductStock()&#123;    String locKey = &quot;lockey&quot;;    // å¦‚æœå­˜åœ¨åˆ™true,æˆåŠŸåˆ™æ–°å¢è¿”å›false    Boolean result = redisTemplate.opsForValue().setIfAbsent(locKey, &quot;lock&quot;);    // è®¾ç½®è¶…æ—¶æ—¶é—´ï¼Œé˜²æ­¢é”ä¸€ç›´ä¸é‡Šæ”¾    redisTemplate.expire(locKey,10, TimeUnit.SECONDS);    // å¦‚æœå­˜åœ¨ï¼Œç›´æ¥è¿”å›å¤±è´¥    if(!result)&#123;        System.out.println(&quot;error_code&quot;);    &#125;    try &#123;        int stock = Integer.parseInt(redisTemplate.opsForValue().get(&quot;stock&quot;));        if(stock &gt; 0)&#123;            int realStock = stock - 1;            redisTemplate.opsForValue().set(&quot;stock&quot;,realStock + &quot;&quot;);            System.out.println(&quot;æ‰£å‡æˆåŠŸï¼Œå‰©ä½™åº“å­˜ï¼š&quot; + realStock);        &#125;else&#123;            System.out.println(&quot;æ‰£å‡å¤±è´¥ï¼Œåº“å­˜ä¸è¶³&quot;);        &#125;    &#125;finally &#123;        // åˆ é™¤keyï¼Œè¡¨ç¤ºå·²ç»è§£é”        redisTemplate.delete(locKey);    &#125;&#125;\n\nä¸Šé¢ä»£ç çœ‹èµ·æ¥æ²¡æœ‰é—®é¢˜ï¼Œä½†æ˜¯å®é™…ä¼šå­˜åœ¨åŸå­æ€§é—®é¢˜\n\nè¿™æ—¶å€™æˆ‘ä»¬å¯ä»¥æŠŠ\nredisTemplate.opsForValue().setIfAbsent(locKey, &quot;lock&quot;);\n\næ›¿æ¢ä¸º\nredisTemplate.opsForValue().setIfAbsent(locKey, &quot;lock&quot;,10,TimeUnit.SECONDS);\n\npublic void deductStock()&#123;    String locKey = &quot;lockey&quot;;    // å¦‚æœå­˜åœ¨åˆ™true,æˆåŠŸåˆ™æ–°å¢è¿”å›false,è®¾ç½®è¶…æ—¶æ—¶é—´ï¼Œé˜²æ­¢é”ä¸€ç›´ä¸é‡Šæ”¾    Boolean result = redisTemplate.opsForValue().setIfAbsent(locKey, &quot;lock&quot;,10,TimeUnit.SECONDS);    // å¦‚æœå­˜åœ¨ï¼Œç›´æ¥è¿”å›å¤±è´¥    if(!result)&#123;        System.out.println(&quot;error_code&quot;);    &#125;    try &#123;        int stock = Integer.parseInt(redisTemplate.opsForValue().get(&quot;stock&quot;));        if(stock &gt; 0)&#123;            int realStock = stock - 1;            redisTemplate.opsForValue().set(&quot;stock&quot;,realStock + &quot;&quot;);            System.out.println(&quot;æ‰£å‡æˆåŠŸï¼Œå‰©ä½™åº“å­˜ï¼š&quot; + realStock);        &#125;else&#123;            System.out.println(&quot;æ‰£å‡å¤±è´¥ï¼Œåº“å­˜ä¸è¶³&quot;);        &#125;    &#125;finally &#123;        // åˆ é™¤keyï¼Œè¡¨ç¤ºå·²ç»è§£é”        redisTemplate.delete(locKey);    &#125;&#125;\n\nä¸Šé¢çš„ä»£ç åœ¨é«˜å¹¶å‘åœºæ™¯ä¼šå­˜åœ¨é—®é¢˜\n\nå¦‚æœå­˜åœ¨ä¸Šé¢è¿™ç§æƒ…å†µï¼Œåˆ™æ°¸è¿œåŠ ä¸ä¸Šé”ï¼Œå‰é¢çš„ç”¨æˆ·ï¼Œä¼šä¸€ç›´é‡Šæ”¾åé¢ç”¨æˆ·çš„é”ï¼Œä¼šå­˜åœ¨è¶…å–çš„é—®é¢˜\nè¿™æ—¶æˆ‘ä»¬å°±éœ€è¦ç”¨åˆ°uuidæ¥è¿›è¡ŒåŠ é”è§£é“ƒè¿˜é¡»ç³»é“ƒäºº\npublic void deductStock()&#123;    String locKey = &quot;lockey&quot;;    // å¢åŠ uuidé˜²æ­¢è¢«å…¶ä»–ç”¨æˆ·é‡Šæ”¾é”    String clientId = UUID.randomUUID().toString();    // å¦‚æœå­˜åœ¨åˆ™true,æˆåŠŸåˆ™æ–°å¢è¿”å›false,è®¾ç½®è¶…æ—¶æ—¶é—´ï¼Œé˜²æ­¢é”ä¸€ç›´ä¸é‡Šæ”¾    Boolean result = redisTemplate.opsForValue().setIfAbsent(locKey, clientId,10,TimeUnit.SECONDS);    // å¦‚æœå­˜åœ¨ï¼Œç›´æ¥è¿”å›å¤±è´¥    if(!result)&#123;        System.out.println(&quot;error_code&quot;);    &#125;    try &#123;        int stock = Integer.parseInt(redisTemplate.opsForValue().get(&quot;stock&quot;));        if(stock &gt; 0)&#123;            int realStock = stock - 1;            redisTemplate.opsForValue().set(&quot;stock&quot;,realStock + &quot;&quot;);            System.out.println(&quot;æ‰£å‡æˆåŠŸï¼Œå‰©ä½™åº“å­˜ï¼š&quot; + realStock);        &#125;else&#123;            System.out.println(&quot;æ‰£å‡å¤±è´¥ï¼Œåº“å­˜ä¸è¶³&quot;);        &#125;    &#125;finally &#123;        // å¦‚æœuuidç›¸åŒåˆ™é‡Šæ”¾é”        if(clientId.equals(redisTemplate.opsForValue().get(locKey)))&#123;            // åˆ é™¤keyï¼Œè¡¨ç¤ºå·²ç»è§£é”            redisTemplate.delete(locKey);        &#125;    &#125;&#125;\n\nä»¥ä¸Šä»£ç è§£å†³äº†é”è¢«å…¶ä»–äººé‡Šæ”¾çš„é—®é¢˜ï¼Œä½†æ˜¯è¿˜æ˜¯ä¼šå­˜åœ¨ä¸€äº›é—®é¢˜\n\nå¾ˆå¤šäººæƒ³çš„æ˜¯å¯¹äºè¶…æ—¶æ—¶é—´ï¼Œå¯ä»¥è®¾ç½®é•¿ä¸€ç‚¹ï¼Œä½†æ˜¯è¿™ç§æƒ…å†µæ²»æ ‡ä¸æ²»æœ¬ï¼Œè¿˜æ˜¯ä¼šæœ‰å¯èƒ½å‡ºç°\nä»¥ä¸Šè¿™ç§æƒ…å†µéœ€è¦ç”¨åˆ°é”ç»­å‘½ï¼Œåå°å¼€ä¸€ä¸ªå®šæ—¶ä»»åŠ¡ï¼Œæ¯è¿‡ä¸€æ®µæ—¶é—´æ£€æŸ¥é”çš„ä¸šåŠ¡æ˜¯å¦è¿˜åœ¨æ‰§è¡Œï¼Œå¦‚æœæ²¡æ‰§è¡Œå®Œï¼Œå°±é‡ç½®é”çš„è¶…æ—¶æ—¶é—´\nå¸‚é¢ä¸Šæœ‰å¾ˆå¤šå¤§ç‰›å¯¹äºè¿™ç§æƒ…å†µæä¾›äº† è§£å†³æ–¹æ¡ˆ\nRedissonæˆ‘ä»¬å¯ä»¥ä½¿ç”¨redissonæ¥ä½¿ç”¨åˆ†å¸ƒå¼é”ï¼Œç®€åŒ–äº†æˆ‘ä»¬åŠ é”çš„æ­¥éª¤\n&lt;dependency&gt;   &lt;groupId&gt;org.redisson&lt;/groupId&gt;   &lt;artifactId&gt;redisson&lt;/artifactId&gt;   &lt;version&gt;3.16.8&lt;/version&gt;&lt;/dependency&gt;  \n\n@Beanpublic Redisson redisson()&#123;    // å•æœºæ¨¡å¼    Config config = new  Config();    config.useSingleServer().setAddress(&quot;redis://localhost:6379&quot;).setDatabase(0);    return (Redisson)Redisson.create(config);&#125;\n\nä»£ç å®ç°\n@Autowiredprivate Redisson redisson;@Autowiredprivate StringRedisTemplate redisTemplate;@Testpublic void deductStock()&#123;    String locKey = &quot;lockey&quot;;    RLock lock = redisson.getLock(locKey);    try &#123;        // åŠ é”        lock.lock();        int stock = Integer.parseInt(redisTemplate.opsForValue().get(&quot;stock&quot;));        if(stock &gt; 0)&#123;            int realStock = stock - 1;            redisTemplate.opsForValue().set(&quot;stock&quot;,realStock + &quot;&quot;);            System.out.println(&quot;æ‰£å‡æˆåŠŸï¼Œå‰©ä½™åº“å­˜ï¼š&quot; + realStock);        &#125;else&#123;            System.out.println(&quot;æ‰£å‡å¤±è´¥ï¼Œåº“å­˜ä¸è¶³&quot;);        &#125;    &#125;finally &#123;        // è§£é”        lock.unlock();    &#125;&#125;\n\nä¸»è¦æ˜¯é€šè¿‡luaè„šæœ¬å®ç°ä»£ç çš„åŸå­æ€§\n&lt;T&gt; RFuture&lt;T&gt; tryLockInnerAsync(long waitTime, long leaseTime, TimeUnit unit, long threadId, RedisStrictCommand&lt;T&gt; command) &#123;        return evalWriteAsync(getRawName(), LongCodec.INSTANCE, command,                &quot;if (redis.call(&#x27;exists&#x27;, KEYS[1]) == 0) then &quot; +                        &quot;redis.call(&#x27;hincrby&#x27;, KEYS[1], ARGV[2], 1); &quot; +                        &quot;redis.call(&#x27;pexpire&#x27;, KEYS[1], ARGV[1]); &quot; +                        &quot;return nil; &quot; +                        &quot;end; &quot; +                        &quot;if (redis.call(&#x27;hexists&#x27;, KEYS[1], ARGV[2]) == 1) then &quot; +                        &quot;redis.call(&#x27;hincrby&#x27;, KEYS[1], ARGV[2], 1); &quot; +                        &quot;redis.call(&#x27;pexpire&#x27;, KEYS[1], ARGV[1]); &quot; +                        &quot;return nil; &quot; +                        &quot;end; &quot; +                        &quot;return redis.call(&#x27;pttl&#x27;, KEYS[1]);&quot;,                Collections.singletonList(getRawName()), unit.toMillis(leaseTime), getLockName(threadId));    &#125;\n\n\n1.åŠ é”æœºåˆ¶ï¼š\nçº¿ç¨‹å»è·å–é”ï¼Œè·å–æˆåŠŸï¼šæ‰§è¡Œluaè„šæœ¬ï¼Œä¿å­˜æ•°æ®åˆ°redisæ•°æ®åº“\nçº¿ç¨‹å»è·å–é”ï¼Œè·å–å¤±è´¥: ä¸€ç›´é€šè¿‡whileå¾ªç¯å°è¯•è·å–é”ï¼Œè·å–æˆåŠŸåï¼Œæ‰§è¡Œluaè„šæœ¬ï¼Œä¿å­˜æ•°æ®åˆ°redisæ•°æ®åº“ã€‚\n2.çœ‹é—¨ç‹—\nåœ¨ä¸€ä¸ªåˆ†å¸ƒå¼ç¯å¢ƒä¸‹ï¼Œå‡å¦‚ä¸€ä¸ªçº¿ç¨‹è·å¾—é”åï¼Œçªç„¶æœåŠ¡å™¨å®•æœºäº†ï¼Œé‚£ä¹ˆè¿™ä¸ªæ—¶å€™åœ¨ä¸€å®šæ—¶é—´åè¿™ä¸ªé”ä¼šè‡ªåŠ¨é‡Šæ”¾ï¼Œä½ ä¹Ÿå¯ä»¥è®¾ç½®é”çš„æœ‰æ•ˆæ—¶é—´(ä¸è®¾ç½®é»˜è®¤30ç§’ï¼‰ï¼Œè¿™æ ·çš„ç›®çš„ä¸»è¦æ˜¯é˜²æ­¢æ­»é”çš„å‘ç”Ÿã€‚\n //è®¾ç½®é”1ç§’è¿‡å»redissonLock.lock(&quot;redisson&quot;, 1);/*** ä¸šåŠ¡é€»è¾‘éœ€è¦å’¨è¯¢2ç§’*/redissonLock.release(&quot;redisson&quot;);/*** çº¿ç¨‹1 è¿›æ¥è·å¾—é”åï¼Œçº¿ç¨‹ä¸€åˆ‡æ­£å¸¸å¹¶æ²¡æœ‰å®•æœºï¼Œä½†å®ƒçš„ä¸šåŠ¡é€»è¾‘éœ€è¦æ‰§è¡Œ2ç§’ï¼Œè¿™å°±ä¼šæœ‰ä¸ªé—®é¢˜ï¼Œåœ¨ çº¿ç¨‹1 æ‰§è¡Œ1ç§’åï¼Œè¿™ä¸ªé”å°±è‡ªåŠ¨è¿‡æœŸäº†* é‚£ä¹ˆè¿™ä¸ªæ—¶å€™ çº¿ç¨‹2 è¿›æ¥äº†ã€‚é‚£ä¹ˆå°±å­˜åœ¨ çº¿ç¨‹1å’Œçº¿ç¨‹2 åŒæ—¶åœ¨è¿™æ®µä¸šåŠ¡é€»è¾‘é‡Œæ‰§è¡Œä»£ç ï¼Œè¿™å½“ç„¶æ˜¯ä¸åˆç†çš„ã€‚* è€Œä¸”å¦‚æœæ˜¯è¿™ç§æƒ…å†µï¼Œé‚£ä¹ˆåœ¨è§£é”æ—¶ç³»ç»Ÿä¼šæŠ›å¼‚å¸¸ï¼Œå› ä¸ºè§£é”å’ŒåŠ é”å·²ç»ä¸æ˜¯åŒä¸€çº¿ç¨‹äº†ï¼Œå…·ä½“åé¢ä»£ç æ¼”ç¤ºã€‚*/\n\næ‰€ä»¥è¿™ä¸ªæ—¶å€™çœ‹é—¨ç‹—å°±å‡ºç°äº†ï¼Œå®ƒçš„ä½œç”¨å°±æ˜¯ çº¿ç¨‹1 ä¸šåŠ¡è¿˜æ²¡æœ‰æ‰§è¡Œå®Œï¼Œæ—¶é—´å°±è¿‡äº†ï¼Œçº¿ç¨‹1 è¿˜æƒ³æŒæœ‰é”çš„è¯ï¼Œå°±ä¼šå¯åŠ¨ä¸€ä¸ªwatch dogåå°çº¿ç¨‹ï¼Œä¸æ–­çš„å»¶é•¿é”keyçš„ç”Ÿå­˜æ—¶é—´ã€‚\næ³¨æ„ æ­£å¸¸è¿™ä¸ªçœ‹é—¨ç‹—çº¿ç¨‹æ˜¯ä¸å¯åŠ¨çš„ï¼Œè¿˜æœ‰å°±æ˜¯è¿™ä¸ªçœ‹é—¨ç‹—å¯åŠ¨åå¯¹æ•´ä½“æ€§èƒ½ä¹Ÿä¼šæœ‰ä¸€å®šå½±å“ï¼Œæ‰€ä»¥ä¸å»ºè®®å¼€å¯çœ‹é—¨ç‹—ã€‚\n3.ä¸ºå•¥ä½¿ç”¨luaè„šæœ¬\nå¦‚æœä½ çš„ä¸šåŠ¡é€»è¾‘å¤æ‚çš„è¯ï¼Œé€šè¿‡å°è£…åœ¨luaè„šæœ¬ä¸­å‘é€ç»™redisï¼Œè€Œä¸”redisæ˜¯å•çº¿ç¨‹çš„ï¼Œè¿™æ ·å°±ä¿è¯è¿™æ®µå¤æ‚ä¸šåŠ¡é€»è¾‘æ‰§è¡Œçš„åŸå­æ€§ã€‚\n4.åˆ†å¸ƒå¼é”çš„ç¼ºé™·\nRedisåˆ†å¸ƒå¼é”ä¼šæœ‰ä¸ªç¼ºé™·ï¼Œå°±æ˜¯åœ¨Rediså“¨å…µæ¨¡å¼ä¸‹:\nå®¢æˆ·ç«¯1 å¯¹æŸä¸ªmasterèŠ‚ç‚¹å†™å…¥äº†redissoné”ï¼Œæ­¤æ—¶ä¼šå¼‚æ­¥å¤åˆ¶ç»™å¯¹åº”çš„ slaveèŠ‚ç‚¹ã€‚ä½†æ˜¯è¿™ä¸ªè¿‡ç¨‹ä¸­ä¸€æ—¦å‘ç”Ÿ masterèŠ‚ç‚¹å®•æœºï¼Œä¸»å¤‡åˆ‡æ¢ï¼ŒslaveèŠ‚ç‚¹ä»å˜ä¸ºäº† masterèŠ‚ç‚¹ã€‚\nè¿™æ—¶å®¢æˆ·ç«¯2 æ¥å°è¯•åŠ é”çš„æ—¶å€™ï¼Œåœ¨æ–°çš„masterèŠ‚ç‚¹ä¸Šä¹Ÿèƒ½åŠ é”ï¼Œæ­¤æ—¶å°±ä¼šå¯¼è‡´å¤šä¸ªå®¢æˆ·ç«¯å¯¹åŒä¸€ä¸ªåˆ†å¸ƒå¼é”å®Œæˆäº†åŠ é”ã€‚\nè¿™æ—¶ç³»ç»Ÿåœ¨ä¸šåŠ¡è¯­ä¹‰ä¸Šä¸€å®šä¼šå‡ºç°é—®é¢˜ï¼Œå¯¼è‡´å„ç§è„æ•°æ®çš„äº§ç”Ÿã€‚\nç¼ºé™·åœ¨å“¨å…µæ¨¡å¼æˆ–è€…ä¸»ä»æ¨¡å¼ä¸‹ï¼Œå¦‚æœ masterå®ä¾‹å®•æœºçš„æ—¶å€™ï¼Œå¯èƒ½å¯¼è‡´å¤šä¸ªå®¢æˆ·ç«¯åŒæ—¶å®ŒæˆåŠ é”ã€‚\n","tags":["redis","åˆ†å¸ƒå¼é”"]},{"title":"æ•°æ®åº“ä¸­é—´ä»¶","url":"/2022/04/17/0.0.9%E6%95%B0%E6%8D%AE%E5%BA%93%E4%B8%AD%E9%97%B4%E4%BB%B6/","content":"æ•°æ®åº“ä¸­é—´ä»¶Cobarï¼šé˜¿é‡Œå›¢é˜Ÿå¼€å‘ï¼Œå·²ç»å¤šå¹´æ²¡æœ‰ç»´æŠ¤æ›´æ–°\nMyCatï¼šåŸºäºCobaräºŒæ¬¡å¼€å‘ï¼Œå¼€æºç¤¾åŒºç»´æŠ¤\nOneProxyï¼šä¸å¼€æºçš„å•†ä¸šä¸­é—´ä»¶ä¸“æ³¨æ€§èƒ½å’Œç¨³å®šæ€§\nKingShardï¼šGOè¯­è¨€å¼€å‘ï¼Œåœ¨ä¸æ–­å®Œå–„\nVitessï¼šyoutobeç”Ÿäº§åœ¨ä½¿ç”¨ï¼Œä¸æ”¯æŒMySqlåŸç”Ÿåè®®\nAtlasï¼š360å›¢é˜ŸåŸºäºMySqlProxyæ”¹å†™ï¼Œé«˜å¹¶å‘ä¸‹ä¸ç¨³å®š\nMaxScaleï¼šMaxScaleæ˜¯mariadbç ”å‘çš„ä¸­é—´ä»¶\nMysqlRouteï¼šMySqlå®˜æ–¹Oracleå…¬å¸å‘å¸ƒçš„ä¸­é—´ä»¶\nShardingJDBCï¼šç°åœ¨æ¯”è¾ƒä¸»æµçš„ä¸­é—´ä»¶\nSQLè§£æ&gt;æŸ¥è¯¢ä¼˜åŒ–&gt;SQLè·¯ç”±&gt;SQLæ”¹å†™&gt;SQLæ‰§è¡Œ&gt;ç»“æœå½’å¹¶\n","tags":["åˆ†åº“åˆ†è¡¨","å¤šæ•°æ®æº","mysql"]},{"title":"åˆ†åº“åˆ†è¡¨æ€æƒ³","url":"/2022/04/10/0.0.4%E5%88%86%E5%BA%93%E5%88%86%E8%A1%A8%E6%80%9D%E6%83%B3/","content":"\néšç€å•åº“ä¸­çš„æ•°æ®é‡è¶Šæ¥è¶Šå¤§ã€æ•°æ®åº“çš„æŸ¥è¯¢QPSè¶Šæ¥è¶Šé«˜ï¼Œç›¸åº”çš„ï¼Œå¯¹æ•°æ®åº“çš„è¯»å†™æ‰€éœ€è¦çš„æ—¶é—´ä¹Ÿè¶Šæ¥è¶Šå¤šã€‚æ•°æ®åº“çš„è¯»å†™æ€§èƒ½å¯èƒ½ä¼šæˆä¸ºä¸šåŠ¡å‘å±•çš„ç“¶é¢ˆã€‚å¯¹åº”çš„ï¼Œå°±éœ€è¦åšæ•°æ®åº“æ€§èƒ½æ–¹é¢çš„ä¼˜åŒ–ã€‚\n\nåœºæ™¯ä¸€ï¼šå¦‚æœæ•°æ®åº“çš„æŸ¥è¯¢QPSã€è¿æ¥æ•°ã€‘è¿‡é«˜ï¼Œå°±éœ€è¦è€ƒè™‘æ‹†åº“ï¼Œé€šè¿‡åˆ†åº“æ¥åˆ†æ‹…å•ä¸ªæ•°æ®åº“çš„è¿æ¥å‹åŠ›ã€‚æ¯”å¦‚ï¼Œå¦‚æœæŸ¥è¯¢QPSä¸º3500ï¼Œå‡è®¾å•åº“å¯ä»¥æ”¯æ’‘1000ä¸ªQPSçš„è¯ï¼Œé‚£ä¹ˆå°±å¯ä»¥è€ƒè™‘æ‹†åˆ†æˆ4ä¸ªåº“ï¼Œæ¥åˆ†æ•£æŸ¥è¯¢è¿æ¥å‹åŠ›ã€‚\nåœºæ™¯äºŒï¼šå¦‚æœå•è¡¨æ•°æ®é‡è¿‡å¤§ï¼Œå°±éœ€è¦è€ƒè™‘åˆ†è¡¨ï¼Œå½“æ•°æ®é‡è¶…è¿‡ä¸€å®šé‡çº§åï¼Œæ— è®ºæ˜¯å¯¹äºæ•°æ®æŸ¥è¯¢è¿˜æ˜¯æ•°æ®æ›´æ–°ï¼Œåœ¨ç»è¿‡ç´¢å¼•ä¼˜åŒ–ç­‰çº¯æ•°æ®åº“å±‚é¢çš„ä¼ ç»Ÿä¼˜åŒ–æ‰‹æ®µä¹‹åï¼Œè¿˜æ˜¯å¯èƒ½å­˜åœ¨æ€§èƒ½é—®é¢˜ã€‚è¿™æ˜¯é‡å˜äº§ç”Ÿäº†è´¨å˜ï¼Œè¿™æ—¶å€™å°±éœ€è¦å»æ¢ä¸ªæ€è·¯æ¥è§£å†³é—®é¢˜ï¼Œæ¯”å¦‚ï¼šä»æ•°æ®ç”Ÿäº§æºå¤´ã€æ•°æ®å¤„ç†æºå¤´æ¥è§£å†³é—®é¢˜ï¼Œæ—¢ç„¶æ•°æ®é‡å¾ˆå¤§ï¼Œé‚£æˆ‘ä»¬å°±æ¥ä¸ªåˆ†è€Œæ²»ä¹‹ï¼ŒåŒ–æ•´ä¸ºé›¶ã€‚è¿™å°±äº§ç”Ÿäº†åˆ†è¡¨ï¼ŒæŠŠæ•°æ®æŒ‰ç…§ä¸€å®šçš„è§„åˆ™æ‹†åˆ†æˆå¤šå¼ è¡¨ï¼Œæ¥è§£å†³å•è¡¨ç¯å¢ƒä¸‹æ— æ³•è§£å†³çš„å­˜å–æ€§èƒ½é—®é¢˜ã€‚\nåœºæ™¯ä¸‰ï¼šå¦‚æœå•æ•°æ®åº“å®•æœºï¼Œå¯èƒ½æ‰€æœ‰æ•°æ®éƒ½ä¼šä¸¢å¤±ï¼Œå°±éœ€è¦è€ƒè™‘æ•°æ®æ‹†åˆ†\n\nå•åº“éƒ¨ç½²æƒ…å†µä¸‹ï¼Œå¦‚æœæ•°æ®åº“å®•æœºï¼Œé‚£ä¹ˆæ•…éšœå½±å“å°±æ˜¯100%ï¼Œè€Œä¸”æ¢å¤å¯èƒ½è€—æ—¶å¾ˆé•¿ã€‚\nå¦‚æœæˆ‘ä»¬æ‹†åˆ†æˆ2ä¸ªåº“ï¼Œåˆ†åˆ«éƒ¨ç½²åœ¨ä¸åŒçš„æœºå™¨ä¸Šï¼Œæ­¤æ—¶å…¶ä¸­1ä¸ªåº“å®•æœºï¼Œé‚£ä¹ˆæ•…éšœå½±å“å°±æ˜¯50%ï¼Œè¿˜æœ‰50%çš„æ•°æ®å¯ä»¥ç»§ç»­æœåŠ¡ã€‚\nå¦‚æœæˆ‘ä»¬æ‹†åˆ†æˆ4ä¸ªåº“ï¼Œåˆ†åˆ«éƒ¨ç½²åœ¨ä¸åŒçš„æœºå™¨ä¸Šï¼Œæ­¤æ—¶å…¶ä¸­1ä¸ªåº“å®•æœºï¼Œé‚£ä¹ˆæ•…éšœå½±å“å°±æ˜¯25%ï¼Œè¿˜æœ‰75%çš„æ•°æ®å¯ä»¥ç»§ç»­æœåŠ¡ï¼Œæ¢å¤è€—æ—¶ä¹Ÿä¼šå¾ˆçŸ­ã€‚\n\nå½“ç„¶ï¼Œæˆ‘ä»¬ä¹Ÿä¸èƒ½æ— é™åˆ¶çš„æ‹†åº“ï¼Œè¿™ä¹Ÿæ˜¯ç‰ºç‰²å­˜å‚¨èµ„æºæ¥æå‡æ€§èƒ½ã€å¯ç”¨æ€§çš„æ–¹å¼ï¼Œæ¯•ç«Ÿèµ„æºæ€»æ˜¯æœ‰é™çš„ã€‚\nåˆ†åº“åˆ†è¡¨æ˜¯ä»€ä¹ˆåˆ†åº“åˆ†è¡¨å°±æ˜¯ä¸ºäº†è§£å†³ç”±äºæ•°æ®é‡è¿‡å¤§è€Œå¯¼è‡´æ•°æ®åº“æ€§èƒ½é™ä½çš„é—®é¢˜ï¼Œå°†åŸæ¥ç‹¬ç«‹çš„æ•°æ®åº“æ‹†åˆ†æˆè‹¥å¹²æ•°æ®åº“ç»„æˆ ï¼Œå°†æ•°æ®å¤§è¡¨æ‹†åˆ†æˆè‹¥å¹²æ•°æ®è¡¨ç»„æˆï¼Œä½¿å¾—å•ä¸€æ•°æ®åº“ã€å•ä¸€æ•°æ®è¡¨çš„æ•°æ®é‡å˜å°ï¼Œä»è€Œè¾¾åˆ°æå‡æ•°æ®åº“æ€§èƒ½çš„ç›®çš„ã€‚\nåˆ†åº“åˆ†è¡¨æœ‰å“ªäº›åˆ†åº“åˆ†è¡¨åŒ…æ‹¬åˆ†åº“å’Œåˆ†è¡¨ä¸¤ä¸ªéƒ¨åˆ†ï¼Œåœ¨ç”Ÿäº§ä¸­é€šå¸¸åŒ…æ‹¬ï¼šå‚ç›´åˆ†è¡¨ã€å‚ç›´åˆ†åº“ã€æ°´å¹³åˆ†åº“ã€æ°´å¹³åˆ†è¡¨å››ç§æ–¹å¼\nå‚ç›´åˆ†è¡¨åœ¨ç”µå•†çš„åœºæ™¯ä¸­ï¼Œå•†å“å¾€å¾€åªä¼šåœ¨ç”¨æˆ·æ„Ÿå…´è¶£çš„æ—¶å€™æ‰ä¼šæŸ¥çœ‹è¯¥å•†å“çš„è¯¦ç»†æè¿°ï¼Œå› æ­¤ï¼Œå•†å“ä¿¡æ¯ä¸­å•†å“è¯¦æƒ…è®¿é—®çš„é¢‘ç‡æ²¡æœ‰é‚£ä¹ˆé«˜ï¼Œè€Œä¸”ä¸€èˆ¬å ç”¨çš„å†…å­˜ç©ºé—´ä¼šè¾ƒå¤§ï¼Œè®¿é—®å•ä¸ªæ•°æ®IOæ—¶é—´è¾ƒé•¿\nåä¹‹ï¼Œå•†å“åç§°ï¼Œå›¾ç‰‡å’Œä»·æ ¼ç­‰è¿™äº›å…³é”®æ€§å­—æ®µçš„è®¿é—®é¢‘ç‡è¾ƒé«˜ã€‚\né’ˆå¯¹è¿™ä¸¤ç§æ•°æ®çš„ç‰¹æ€§ï¼Œæˆ‘ä»¬å¯ä»¥è€ƒè™‘è¿›è¡Œå‚ç›´åˆ†è¡¨ï¼Œè®¿é—®é¢‘ç‡ä½çš„å•†å“è¯¦æƒ…å•ç‹¬æ‹†åˆ†ä¸ºä¸€å¼ è¡¨ï¼Œè®¿é—®é¢‘ç‡é«˜çš„å­—æ®µæ”¾åœ¨ä¸€å¼ è¡¨ï¼Œé€šè¿‡å•†å“çš„idè¿›è¡Œå…³è”\n\nå‚ç›´åˆ†è¡¨å®šä¹‰ï¼šå°†ä¸€ä¸ªè¡¨æŒ‰ç…§å­—æ®µåˆ†æˆå¤šè¡¨ï¼Œæ¯ä¸ªè¡¨å­˜å‚¨å…¶ä¸­ä¸€éƒ¨åˆ†å­—æ®µ\nä¼˜ç‚¹ï¼š\n\nä¸ºäº†é¿å…IOäº‰æŠ¢å¹¶å‡å°‘é”è¡¨çš„å‡ ç‡ï¼ŒæŸ¥çœ‹è¯¦æƒ…çš„ç”¨æˆ·ä¸å•†å“ä¿¡æ¯æµè§ˆäº’ä¸å½±å“ \nå……åˆ†å‘æŒ¥çƒ­é—¨æ•°æ®çš„æ“ä½œæ•ˆç‡ï¼Œå•†å“ä¿¡æ¯çš„æ“ä½œçš„é«˜æ•ˆç‡ä¸ä¼šè¢«å•†å“æè¿°çš„ä½æ•ˆç‡æ‰€æ‹–ç´¯\n\nä¸€èˆ¬æ¥è¯´ï¼ŒæŸä¸šåŠ¡å®ä½“ä¸­çš„å„ä¸ªæ•°æ®é¡¹çš„è®¿é—®é¢‘æ¬¡æ˜¯ä¸ä¸€æ ·çš„ï¼Œéƒ¨åˆ†æ•°æ®é¡¹å¯èƒ½æ˜¯å ç”¨å­˜å‚¨ç©ºé—´æ¯”è¾ƒå¤§çš„BLOBæˆ–æ˜¯TEXTã€‚ä¾‹å¦‚ä¸Šä¾‹ä¸­çš„å•†å“æè¿°ã€‚æ‰€ä»¥ï¼Œå½“è¡¨æ•°æ®é‡å¾ˆå¤§æ—¶ï¼Œå¯ä»¥å°†è¡¨æŒ‰å­—æ®µåˆ‡å¼€ï¼Œå°†çƒ­é—¨å­—æ®µã€å†·é—¨å­—æ®µåˆ†å¼€æ”¾ç½®åœ¨ä¸åŒåº“ä¸­ï¼Œè¿™äº›åº“å¯ä»¥æ”¾åœ¨ä¸åŒçš„å­˜å‚¨è®¾å¤‡ä¸Šï¼Œé¿å…IOäº‰æŠ¢ã€‚\nå‚ç›´åˆ‡åˆ†å¸¦æ¥çš„æ€§èƒ½æå‡ä¸»è¦é›†ä¸­åœ¨çƒ­é—¨æ•°æ®çš„æ“ä½œæ•ˆç‡ä¸Šï¼Œè€Œä¸”ç£ç›˜äº‰ç”¨æƒ…å†µå‡å°‘ã€‚\né€šå¸¸æˆ‘ä»¬æŒ‰ä»¥ä¸‹åŸåˆ™è¿›è¡Œå‚ç›´æ‹†åˆ†ï¼š\n\næŠŠä¸å¸¸ç”¨çš„å­—æ®µå•ç‹¬æ”¾åœ¨ä¸€å¼ è¡¨\næŠŠtextï¼Œblobç­‰å¤§å­—æ®µæ‹†åˆ†å‡ºæ¥æ”¾åœ¨é™„è¡¨ä¸­\nç»å¸¸ç»„åˆæŸ¥è¯¢çš„åˆ—æ”¾åœ¨ä¸€å¼ è¡¨ä¸­\n\nå‚ç›´åˆ†åº“é€šè¿‡å‚ç›´åˆ†è¡¨æ€§èƒ½å¾—åˆ°äº†ä¸€å®šç¨‹åº¦çš„æå‡ï¼Œä½†æ˜¯è¿˜æ²¡æœ‰è¾¾åˆ°è¦æ±‚ï¼Œå¹¶ä¸”ç£ç›˜ç©ºé—´ä¹Ÿå¿«ä¸å¤Ÿäº†ï¼Œå› ä¸ºæ•°æ®è¿˜æ˜¯å§‹ç»ˆé™åˆ¶åœ¨ä¸€å°æœåŠ¡å™¨ï¼Œåº“å†…å‚ç›´åˆ†è¡¨åªè§£å†³äº†å•ä¸€è¡¨æ•°æ®é‡è¿‡å¤§çš„é—®é¢˜ï¼Œä½†æ²¡æœ‰å°†è¡¨åˆ†å¸ƒåˆ°ä¸åŒçš„æœåŠ¡å™¨ä¸Šï¼Œå› æ­¤æ¯ä¸ªè¡¨è¿˜æ˜¯ç«äº‰åŒä¸€ä¸ªç‰©ç†æœºçš„CPUã€å†…å­˜ã€ç½‘ç»œIOã€ç£ç›˜ã€‚ \n\nå‚ç›´åˆ†åº“å®šä¹‰ï¼šæŒ‰ç…§ä¸šåŠ¡å°†è¡¨è¿›è¡Œåˆ†ç±»ï¼Œåˆ†å¸ƒåˆ°ä¸åŒçš„æ•°æ®åº“ä¸Šé¢ï¼Œæ¯ä¸ªåº“å¯ä»¥æ”¾åœ¨ä¸åŒçš„æœåŠ¡å™¨ä¸Šï¼Œå®ƒçš„æ ¸å¿ƒç†å¿µæ˜¯ä¸“åº“ä¸“ç”¨\nä¼˜ç‚¹ï¼š\n\nè§£å†³ä¸šåŠ¡å±‚é¢çš„è€¦åˆï¼Œä¸šåŠ¡æ¸…æ™°\nèƒ½å¯¹ä¸åŒä¸šåŠ¡çš„æ•°æ®è¿›è¡Œåˆ†çº§ç®¡ç†ã€ç»´æŠ¤ã€ç›‘æ§ã€æ‰©å±•ç­‰\né«˜å¹¶å‘åœºæ™¯ä¸‹ï¼Œå‚ç›´åˆ†åº“ä¸€å®šç¨‹åº¦çš„æå‡IOã€æ•°æ®åº“è¿æ¥æ•°ã€é™ä½å•æœºç¡¬ä»¶èµ„æºçš„ç“¶é¢ˆ \n\nå‚ç›´åˆ†åº“é€šè¿‡å°†è¡¨æŒ‰ä¸šåŠ¡åˆ†ç±»ï¼Œç„¶ååˆ†å¸ƒåœ¨ä¸åŒæ•°æ®åº“ï¼Œå¹¶ä¸”å¯ä»¥å°†è¿™äº›æ•°æ®åº“éƒ¨ç½²åœ¨ä¸åŒæœåŠ¡å™¨ä¸Šï¼Œä»è€Œè¾¾åˆ°å¤šä¸ªæœåŠ¡å™¨å…±åŒåˆ†æ‘Šå‹åŠ›çš„æ•ˆæœï¼Œä½†æ˜¯ä¾ç„¶æ²¡æœ‰è§£å†³å•è¡¨æ•°æ®é‡è¿‡å¤§çš„é—®é¢˜\næ°´å¹³åˆ†åº“ç»è¿‡å‚ç›´åˆ†åº“åï¼Œæ•°æ®åº“æ€§èƒ½é—®é¢˜å¾—åˆ°ä¸€å®šç¨‹åº¦çš„è§£å†³ï¼Œä½†æ˜¯éšç€ä¸šåŠ¡é‡çš„å¢é•¿ï¼ŒPRODUCT_DB(å•†å“åº“)å•åº“å­˜å‚¨æ•°æ®å·²ç»è¶…å‡ºé¢„ä¼°ã€‚ç²—ç•¥ä¼°è®¡ï¼Œç›®å‰æœ‰8wåº—é“ºï¼Œæ¯ä¸ªåº—é“ºå¹³å‡150ä¸ªä¸åŒè§„æ ¼çš„å•†å“ï¼Œå†ç®—ä¸Šå¢é•¿ï¼Œé‚£å•†å“æ•°é‡å¾—å¾€1500w+ä¸Šé¢„ä¼°ï¼Œå¹¶ä¸”PRODUCT_DB(å•†å“åº“)å±äºè®¿é—®éå¸¸é¢‘ç¹çš„èµ„æºï¼Œå•å°æœåŠ¡å™¨å·²ç»æ— æ³•æ”¯æ’‘ã€‚æ­¤æ—¶è¯¥å¦‚ä½•ä¼˜åŒ–ï¼Ÿ\nè¿™æ—¶å€™æˆ‘ä»¬éœ€è¦è€ƒè™‘ä½¿ç”¨æ°´å¹³åˆ†åº“ï¼Œé€šè¿‡åˆ†åº“è§„åˆ™å°†å•†å“ä¿¡æ¯åˆ†åˆ«æ”¾åœ¨ä¸¤ä¸ªåº“ä¸­\n\nä¹Ÿå°±æ˜¯è¯´ï¼Œè¦æ“ä½œæŸæ¡æ•°æ®ï¼Œå…ˆåˆ†æè¿™æ¡æ•°æ®æ‰€å±çš„åº—é“ºIDã€‚å¦‚æœåº—é“ºIDä¸ºåŒæ•°ï¼Œå°†æ­¤æ“ä½œæ˜ å°„è‡³RRODUCT_DB1(å•†å“åº“1)ï¼›å¦‚æœåº—é“ºIDä¸ºå•æ•°ï¼Œå°†æ“ä½œæ˜ å°„è‡³RRODUCT_DB2(å•†å“åº“2)ã€‚æ­¤æ“ä½œè¦è®¿é—®æ•°æ®åº“åç§°çš„è¡¨è¾¾å¼ä¸ºRRODUCT_DB[åº—é“ºID%2 + 1] ã€‚\n æ°´å¹³åˆ†åº“å®šä¹‰ï¼šæ˜¯æŠŠåŒä¸€ä¸ªè¡¨çš„æ•°æ®æŒ‰ä¸€å®šè§„åˆ™æ‹†åˆ°ä¸åŒçš„æ•°æ®åº“ä¸­ï¼Œæ¯ä¸ªåº“å¯ä»¥æ”¾åœ¨ä¸åŒçš„æœåŠ¡å™¨ä¸Š\nä¼˜ç‚¹ï¼š\n\nè§£å†³äº†å•åº“å¤§æ•°æ®ï¼Œé«˜å¹¶å‘çš„æ€§èƒ½ç“¶é¢ˆ\næé«˜äº†ç³»ç»Ÿçš„ç¨³å®šæ€§åŠå¯ç”¨æ€§\n\nå½“ä¸€ä¸ªåº”ç”¨éš¾ä»¥å†ç»†ç²’åº¦çš„å‚ç›´åˆ‡åˆ†ï¼Œæˆ–åˆ‡åˆ†åæ•°æ®é‡è¡Œæ•°å·¨å¤§ï¼Œå­˜åœ¨å•åº“è¯»å†™ã€å­˜å‚¨æ€§èƒ½ç“¶é¢ˆï¼Œè¿™æ—¶å€™å°±éœ€è¦è¿›è¡Œæ°´å¹³åˆ†åº“äº†ï¼Œç»è¿‡æ°´å¹³åˆ‡åˆ†çš„ä¼˜åŒ–ï¼Œå¾€å¾€èƒ½è§£å†³å•åº“å­˜å‚¨é‡åŠæ€§èƒ½ç“¶é¢ˆã€‚ä½†ç”±äºåŒä¸€ä¸ªè¡¨è¢«åˆ†é…åœ¨ä¸åŒçš„æ•°æ®åº“ï¼Œéœ€è¦é¢å¤–è¿›è¡Œæ•°æ®æ“ä½œçš„è·¯ç”±å·¥ä½œï¼Œå› æ­¤å¤§å¤§æå‡äº†ç³»ç»Ÿå¤æ‚åº¦\næ°´å¹³åˆ†è¡¨æŒ‰ç…§æ°´å¹³åˆ†åº“çš„æ€è·¯å¯¹ä»–æŠŠPRODUCT_DB_X(å•†å“åº“)å†…çš„è¡¨ä¹Ÿå¯ä»¥è¿›è¡Œæ°´å¹³æ‹†åˆ†ï¼Œå…¶ç›®çš„ä¹Ÿæ˜¯ä¸ºè§£å†³å•è¡¨æ•°æ®é‡å¤§çš„é—®é¢˜\n\nä¸æ°´å¹³åˆ†åº“çš„æ€è·¯ç±»ä¼¼ï¼Œä¸è¿‡è¿™æ¬¡æ“ä½œçš„ç›®æ ‡æ˜¯è¡¨ï¼Œå•†å“ä¿¡æ¯åŠå•†å“æè¿°è¢«åˆ†æˆäº†ä¸¤å¥—è¡¨ã€‚\nå¦‚æœå•†å“IDä¸ºåŒæ•°ï¼Œå°†æ­¤æ“ä½œæ˜ å°„è‡³å•†å“ä¿¡æ¯1è¡¨ï¼›å¦‚æœå•†å“IDä¸ºå•æ•°ï¼Œå°†æ“ä½œæ˜ å°„è‡³å•†å“ä¿¡æ¯2è¡¨ã€‚æ­¤æ“ä½œè¦è®¿é—®è¡¨åç§°çš„è¡¨è¾¾å¼ä¸ºå•†å“ä¿¡æ¯[å•†å“ID%2 + 1] \n æ°´å¹³åˆ†è¡¨å®šä¹‰ï¼šåœ¨åŒä¸€ä¸ªæ•°æ®åº“å†…ï¼ŒæŠŠåŒä¸€ä¸ªè¡¨çš„æ•°æ®æŒ‰ä¸€å®šè§„åˆ™æ‹†åˆ°å¤šä¸ªè¡¨ä¸­\nä¼˜ç‚¹ï¼š\n\nä¼˜åŒ–å•ä¸€è¡¨æ•°æ®é‡è¿‡å¤§è€Œäº§ç”Ÿçš„æ€§èƒ½é—®é¢˜ \né¿å…IOäº‰æŠ¢å¹¶å‡å°‘é”è¡¨çš„å‡ ç‡\n\nåº“å†…çš„æ°´å¹³åˆ†è¡¨ï¼Œè§£å†³äº†å•ä¸€è¡¨æ•°æ®é‡è¿‡å¤§çš„é—®é¢˜ï¼Œåˆ†å‡ºæ¥çš„å°è¡¨ä¸­åªåŒ…å«ä¸€éƒ¨åˆ†æ•°æ®ï¼Œä»è€Œä½¿å¾—å•ä¸ªè¡¨çš„æ•°æ®é‡å˜å°ï¼Œæé«˜æ£€ç´¢æ€§èƒ½\nå°ç»“ä¸€èˆ¬æ¥è¯´ï¼Œåœ¨ç³»ç»Ÿè®¾è®¡é˜¶æ®µå°±åº”è¯¥æ ¹æ®ä¸šåŠ¡è€¦åˆæ¾ç´§æ¥ç¡®å®šå‚ç›´åˆ†åº“ï¼Œå‚ç›´åˆ†è¡¨æ–¹æ¡ˆï¼Œåœ¨æ•°æ®é‡åŠè®¿é—®å‹åŠ›ä¸æ˜¯ç‰¹åˆ«å¤§çš„æƒ…å†µï¼Œé¦–å…ˆè€ƒè™‘ç¼“å­˜ã€è¯»å†™åˆ†ç¦»ã€ç´¢å¼•æŠ€æœ¯ç­‰æ–¹æ¡ˆã€‚è‹¥æ•°æ®é‡æå¤§ï¼Œä¸”æŒç»­å¢é•¿ï¼Œå†è€ƒè™‘æ°´å¹³åˆ†åº“æ°´å¹³åˆ†è¡¨æ–¹æ¡ˆï¼Œå› ä¸ºå®ƒä¹Ÿä¼šå¸¦æ¥ä¸€äº›é—®é¢˜ï¼š\n\näº‹åŠ¡ä¸€è‡´æ€§é—®é¢˜\n\nç”±äºåˆ†åº“åˆ†è¡¨æŠŠæ•°æ®åˆ†å¸ƒåœ¨ä¸åŒåº“ç”šè‡³ä¸åŒæœåŠ¡å™¨ï¼Œä¸å¯é¿å…ä¼šå¸¦æ¥åˆ†å¸ƒå¼äº‹åŠ¡é—®é¢˜\n\n\nè·¨èŠ‚ç‚¹å…³è”æŸ¥è¯¢\n\nåœ¨æ²¡æœ‰åˆ†åº“å‰ï¼Œæˆ‘ä»¬æ£€ç´¢å•†å“æ—¶å¯ä»¥é€šè¿‡ä»¥ä¸‹SQLå¯¹åº—é“ºä¿¡æ¯è¿›è¡Œå…³è”æŸ¥è¯¢ï¼š \nSELECT p.*,r.[åœ°ç†åŒºåŸŸåç§°],s.[åº—é“ºåç§°],s.[ä¿¡èª‰] FROM [å•†å“ä¿¡æ¯] p LEFT JOIN [åœ°ç†åŒºåŸŸ] r ON p.[äº§åœ°] = r.[åœ°ç†åŒºåŸŸç¼–ç ] LEFT JOIN [åº—é“ºä¿¡æ¯] s ON p.id = s.[æ‰€å±åº—é“º] WHERE...ORDER BY...LIMIT...\n\nä½†å‚ç›´åˆ†åº“å**[å•†å“ä¿¡æ¯]å’Œ[åº—é“ºä¿¡æ¯]**ä¸åœ¨ä¸€ä¸ªæ•°æ®åº“ï¼Œç”šè‡³ä¸åœ¨ä¸€å°æœåŠ¡å™¨ï¼Œæ— æ³•è¿›è¡Œå…³è”æŸ¥è¯¢ã€‚ \nå¯å°†åŸå…³è”æŸ¥è¯¢åˆ†ä¸ºä¸¤æ¬¡æŸ¥è¯¢ï¼Œç¬¬ä¸€æ¬¡æŸ¥è¯¢çš„ç»“æœé›†ä¸­æ‰¾å‡ºå…³è”æ•°æ®idï¼Œç„¶åæ ¹æ®idå‘èµ·ç¬¬äºŒæ¬¡è¯·æ±‚å¾—åˆ°å…³è”æ•°æ®ï¼Œæœ€åå°†è·å¾—åˆ°çš„æ•°æ®è¿›è¡Œæ‹¼è£…ï¼ˆå½’å¹¶ï¼‰\n\n\nè·¨èŠ‚ç‚¹åˆ†é¡µï¼Œæ’åºå‡½æ•°\n\nè·¨èŠ‚ç‚¹å¤šåº“è¿›è¡ŒæŸ¥è¯¢æ—¶limitåˆ†é¡µã€order byæ’åºç­‰é—®é¢˜ï¼Œå°±å˜å¾—æ¯”è¾ƒå¤æ‚äº†ã€‚éœ€è¦å…ˆåœ¨ä¸åŒçš„åˆ†ç‰‡èŠ‚ç‚¹ä¸­å°†æ•°æ®è¿›è¡Œæ’åºå¹¶è¿”å›ï¼Œç„¶åå°†ä¸åŒåˆ†ç‰‡è¿”å›çš„ç»“æœé›†è¿›è¡Œæ±‡æ€»å’Œå†æ¬¡æ’åº\næ‰€ä»¥è¯·æ±‚é¡µæ•°è¶Šå¤§ï¼Œç³»ç»Ÿçš„æ€§èƒ½ä¹Ÿä¼šè¶Šå·®\nåœ¨ä½¿ç”¨Maxã€Minã€Sumã€Countä¹‹ç±»çš„å‡½æ•°è¿›è¡Œè®¡ç®—çš„æ—¶å€™ï¼Œä¸æ’åºåˆ†é¡µåŒç†ï¼Œä¹Ÿéœ€è¦å…ˆåœ¨æ¯ä¸ªåˆ†ç‰‡ä¸Šæ‰§è¡Œç›¸åº”çš„å‡½æ•°ï¼Œç„¶åå°†å„ä¸ªåˆ†ç‰‡çš„ç»“æœé›†è¿›è¡Œæ±‡æ€»å’Œå†æ¬¡è®¡ç®—ï¼Œæœ€ç»ˆå°†ç»“æœè¿”å›\n\n\nä¸»é”®é¿é‡\n\nåœ¨åˆ†åº“åˆ†è¡¨ç¯å¢ƒä¸­ï¼Œç”±äºè¡¨ä¸­æ•°æ®åŒæ—¶å­˜åœ¨ä¸åŒæ•°æ®åº“ä¸­ï¼Œä¸»é”®å€¼å¹³æ—¶ä½¿ç”¨çš„è‡ªå¢é•¿å°†æ— ç”¨æ­¦ä¹‹åœ°ï¼ŒæŸä¸ªåˆ†åŒºæ•°æ®åº“ç”Ÿæˆçš„IDæ— æ³•ä¿è¯å…¨å±€å”¯ä¸€ã€‚å› æ­¤éœ€è¦å•ç‹¬è®¾è®¡å…¨å±€ä¸»é”®ï¼Œä»¥é¿å…è·¨åº“ä¸»é”®é‡å¤é—®é¢˜\n\n\nå…¬å…±è¡¨\n\nå®é™…çš„åº”ç”¨åœºæ™¯ä¸­ï¼Œå‚æ•°è¡¨ã€æ•°æ®å­—å…¸è¡¨ç­‰éƒ½æ˜¯æ•°æ®é‡è¾ƒå°ï¼Œå˜åŠ¨å°‘ï¼Œè€Œä¸”å±äºé«˜é¢‘è”åˆæŸ¥è¯¢çš„ä¾èµ–è¡¨\nå¯ä»¥å°†è¿™ç±»è¡¨åœ¨æ¯ä¸ªæ•°æ®åº“éƒ½ä¿å­˜ä¸€ä»½ï¼Œæ‰€æœ‰å¯¹å…¬å…±è¡¨çš„æ›´æ–°æ“ä½œéƒ½åŒæ—¶å‘é€åˆ°æ‰€æœ‰åˆ†åº“æ‰§è¡Œ\n\n\n\nç”±äºåˆ†åº“åˆ†è¡¨ä¹‹åï¼Œæ•°æ®è¢«åˆ†æ•£åœ¨ä¸åŒçš„æ•°æ®åº“ã€æœåŠ¡å™¨ã€‚å› æ­¤ï¼Œå¯¹æ•°æ®çš„æ“ä½œä¹Ÿå°±æ— æ³•é€šè¿‡å¸¸è§„æ–¹å¼å®Œæˆï¼Œå¹¶ä¸”å®ƒè¿˜å¸¦æ¥äº†ä¸€ç³»åˆ—çš„é—®é¢˜ã€‚æ‰€ä»¥ä½¿ç”¨ä¹‹å‰éœ€è¦æŠŠä»¥ä¸Šä¼šå¸¦æ¥çš„é—®é¢˜ä»”ç»†è€ƒè™‘è¿›å»\n","tags":["æ•°æ®åº“","åˆ†åº“åˆ†è¡¨"]},{"title":"è§£å†³å¾®ä¿¡å°ç¨‹åºé”®ç›˜ä¸Šç§»","url":"/2022/02/16/0.0.7%E8%A7%A3%E5%86%B3%E5%BE%AE%E4%BF%A1%E5%B0%8F%E7%A8%8B%E5%BA%8F%E9%94%AE%E7%9B%98%E4%B8%8A%E7%A7%BB/","content":"åœ¨å¾®ä¿¡å¼€å‘è€…å·¥å…·æ²¡æœ‰å‡ºç°ä¸Šç§»çš„æƒ…å†µï¼Œä½†æ˜¯ä¸€åˆ°çœŸæœºè°ƒè¯•å°±å‡ºç°äº†ï¼ŒæŠŠé¡µé¢è®¾ç½®å›ºå®šå¸ƒå±€ä¹Ÿä¸ç®¡ç”¨ç„¶åæŸ¥è¯¢å¾®ä¿¡å®˜æ–¹æ–‡æ¡£ï¼Œæ˜¯è¿™æ ·è§£é‡Šçš„å°ç¨‹åºåœ¨inputæ¡†è¾“å…¥æ—¶ï¼Œé»˜è®¤ä¼šå¼€å¯è‡ªåŠ¨ä¸Šæ¨çš„åŠŸèƒ½ï¼Œä½†æ˜¯æœ‰çš„æ—¶å€™ä¼šå‡ºç°å¡é¡¿çš„ç°è±¡ï¼Œæƒ³å…³é—­è‡ªåŠ¨ä¸Šæ¨ï¼ŒæŠŠadjust-positionè®¾ç½®ä¸ºfalseå°±å¯ä»¥äº†\n&lt;van-row  gutter=&quot;20&quot;&gt;    &lt;van-col span=&quot;24&quot;&gt;       &lt;van-field          left-icon=&quot;eye-o&quot;          adjust-position=&quot;false&quot;           placeholder=&quot;è¯·è¾“å…¥å¯†ç &quot;          name=&quot;input&quot;  type=&quot;password&quot;  model:value=&quot;&#123;&#123;password&#125;&#125;&quot;       /&gt;    &lt;/van-col&gt; &lt;/van-row&gt;\n\næŒ‰é“ç†åº”è¯¥å°±ä¸ä¼šå‡ºç°äº†ï¼Œç»“æœå°±æ˜¯ä¸ç”Ÿæ•ˆï¼Œç»è¿‡å‡ è½®çæåæ‰å‘ç°éœ€è¦åŠ &#123;&#123;&#125;&#125;\n&lt;van-row  gutter=&quot;20&quot;&gt;   &lt;van-col span=&quot;24&quot;&gt;      &lt;van-field         left-icon=&quot;eye-o&quot;         adjust-position=&quot;&#123;&#123; false &#125;&#125;&quot;          placeholder=&quot;è¯·è¾“å…¥å¯†ç &quot;         name=&quot;input&quot;  type=&quot;password&quot;  model:value=&quot;&#123;&#123;password&#125;&#125;&quot;      /&gt;   &lt;/van-col&gt;&lt;/van-row&gt;\nè¯·å¤§å®¶è°¨æ…è¸©å‘\n","tags":["å°ç¨‹åº"]},{"title":"è‡ªå®šä¹‰æ³¨è§£","url":"/2022/04/22/0.1.1%E8%87%AA%E5%AE%9A%E4%B9%89%E6%B3%A8%E8%A7%A3/","content":"ç®€ä»‹æ³¨è§£æ˜¯ä¸€ç§èƒ½è¢«æ·»åŠ åˆ°javaæºä»£ç ä¸­çš„å…ƒæ•°æ®ï¼Œæ–¹æ³•ã€ç±»ã€å‚æ•°å’ŒåŒ…éƒ½å¯ä»¥ç”¨æ³¨è§£æ¥ä¿®é¥°ã€‚æ³¨è§£å¯ä»¥çœ‹ä½œæ˜¯ä¸€ç§ç‰¹æ®Šçš„æ ‡è®°ï¼Œå¯ä»¥ç”¨åœ¨æ–¹æ³•ã€ç±»ã€å‚æ•°å’ŒåŒ…ä¸Šï¼Œç¨‹åºåœ¨ç¼–è¯‘æˆ–è€…è¿è¡Œæ—¶å¯ä»¥æ£€æµ‹åˆ°è¿™äº›æ ‡è®°è€Œè¿›è¡Œä¸€äº›ç‰¹æ®Šçš„å¤„ç†\nå…ƒæ³¨è§£ä»‹ç»å…ƒæ³¨è§£çš„ä½œç”¨å°±æ˜¯è´Ÿè´£æ³¨è§£å…¶ä»–æ³¨è§£ï¼ŒJava5.0å®šä¹‰äº†4ä¸ªæ ‡å‡†çš„meta-annotationç±»å‹ï¼Œå®ƒä»¬è¢«ç”¨æ¥æä¾›å¯¹å…¶å®ƒ annotationç±»å‹ä½œè¯´æ˜\n\n@Target\n@Retention\n@Documented\n@Inherited\n\nå¯¹åº”çš„å‚æ•°è¯¦æƒ…è¯´æ˜è§æœ«å°¾\nä¿®é¥°ç¬¦ï¼šè®¿é—®ä¿®é¥°ç¬¦å¿…é¡»ä¸ºpublic,ä¸å†™é»˜è®¤ä¸ºpubic\nå…³é”®å­—ï¼šå…³é”®å­—ä¸º@interface\næ³¨è§£åç§°ï¼š æ³¨è§£åç§°ä¸ºè‡ªå®šä¹‰æ³¨è§£çš„åç§°\næ³¨è§£å†…å®¹ï¼šæ³¨è§£ä¸­å†…å®¹ï¼Œå¯¹æ³¨è§£çš„æè¿°\n\nä»¥ä¸‹å†…å®¹é‡‡ç”¨æšä¸¾æ–¹å¼è¿›è¡Œæ³¨è§£\n\n1.å®šä¹‰æšä¸¾public enum newChannelEnum &#123;    BVC(&quot;BVC&quot;,&quot;bvc_timeout&quot;,&quot;BVC&quot;,&quot;BVC_config&quot;),    ACC(&quot;ACC&quot;,&quot;acc_timeout&quot;,&quot;ACC&quot;,&quot;ACC_config&quot;);    // æ¸ é“ç®€ç§°    private String channel;    // è¶…æ—¶æ—¶é—´é…ç½®    private String timeout;    // å…¨å    private String name;    // æ¥å£è¯¦æƒ…é…ç½®    private String interfaceName;    newChannelEnum(String channel, String timeout, String name, String interfaceName) &#123;        this.channel = channel;        this.timeout = timeout;        this.name = name;        this.interfaceName = interfaceName;    &#125;    public String getInterfaceName() &#123;        return interfaceName;    &#125;    public String getChannel() &#123;        return channel;    &#125;    public String getTimeout() &#123;        return timeout;    &#125;    public void setTimeout(String timeout) &#123;        this.timeout = timeout;    &#125;    public String getName() &#123;        return name;    &#125;&#125;\n\n2.å®šä¹‰æ³¨è§£@Target(&#123;ElementType.METHOD,ElementType.FIELD,ElementType.PARAMETER&#125;)@Retention(RetentionPolicy.RUNTIME)@Documentedpublic @interface InterfaceTagConfig &#123;    newChannelEnum method();&#125;\n\n3.å®šä¹‰æ³¨è§£å·¥å…·ç±»public class InterfaceTarHelper &#123;    // ä½ éœ€è¦ä½¿ç”¨æ³¨è§£çš„å®ä½“ç±»    private static final InterfaceDefault CLASS_LOAD_PATH = new InterfaceDefault();    // å­˜æ”¾æ ‡è®°äº†è‡ªå®šä¹‰æ³¨è§£æ–¹æ³•çš„MAP    private static final Map&lt;String,Method&gt; METHOD_MAP = new ConcurrentHashMap&lt;String,Method&gt;();    // æ–¹æ³•    private Method method;    static &#123;        // è·å–æ‰€æœ‰æ–¹æ³•        Method[] methods = CLASS_LOAD_PATH.getClass().getMethods();        for (Method method : methods) &#123;            // ç­›é€‰æ‰“äº†æ³¨è§£çš„æ–¹æ³•ï¼Œå¹¶å­˜å…¥MAP            InterfaceTagConfig annotation = method.getAnnotation(InterfaceTagConfig.class);            if(annotation != null)&#123;                METHOD_MAP.put(String.valueOf(annotation.method()),method);            &#125;        &#125;    &#125;        public static InterfaceTarHelper getInstance(newChannelEnum methodEnum)&#123;        InterfaceTarHelper helper = new InterfaceTarHelper();        // æ ¹æ®æšä¸¾è·å–æ–¹æ³•        helper.method = METHOD_MAP.get(String.valueOf(methodEnum));        return helper;    &#125;    public Object getSearchFlightDetail(Object... args) &#123;        try &#123;            // æ–¹æ³•ä¼ å‚æ•°            return method.invoke(CLASS_LOAD_PATH, args);        &#125; catch (IllegalAccessException e) &#123;            e.printStackTrace();        &#125; catch (InvocationTargetException e) &#123;            e.printStackTrace();        &#125;        return null;    &#125;&#125;\n\n4.ä½¿ç”¨æ³¨è§£public class NewSearch &#123;    @InterfaceTarget(method = InterfaceTagConfig.BVC)    public static void BVCValidation(InterfaceParam param)&#123;â€¦â€¦&#125;        @InterfaceTarget(method = InterfaceTagConfig.ACC)    public static void ACCValidation(InterfaceParam param)&#123;â€¦â€¦&#125;&#125;\n\n5.è°ƒç”¨æ–¹æ³•public class SearchUtils &#123;    public static void getData_new(String channel, InterfaceParam param) throws Exception &#123;        // è·å–å¯¹åº”çš„æšä¸¾        newChannelEnum enums = newChannelEnum.getEnums(channel);        // è°ƒç”¨å¯¹åº”çš„æ³¨è§£        InterfaceHelper.getInstance(enums).getSearchFlightDetail(param);    &#125;&#125;\n\n6.é™„é‡Š@Targetè¡¨æ˜è¯¥æ³¨è§£å¯ä»¥åº”ç”¨çš„javaå…ƒç´ ç±»å‹\n\n\n\nTargetç±»å‹\næè¿°\n\n\n\nElementType.TYPE\nåº”ç”¨äºç±»ã€æ¥å£ï¼ˆåŒ…æ‹¬æ³¨è§£ç±»å‹ï¼‰ã€æšä¸¾\n\n\nElementType.FIELD\nåº”ç”¨äºå±æ€§ï¼ˆåŒ…æ‹¬æšä¸¾ä¸­çš„å¸¸é‡ï¼‰\n\n\nElementType.METHOD\nåº”ç”¨äºæ–¹æ³•\n\n\nElementType.PARAMETER\nåº”ç”¨äºæ–¹æ³•çš„å½¢å‚\n\n\nElementType.CONSTRUCTOR\nåº”ç”¨äºæ„é€ å‡½æ•°\n\n\nElementType.LOCAL_VARIABLE\nåº”ç”¨äºå±€éƒ¨å˜é‡\n\n\nElementType.ANNOTATION_TYPE\nåº”ç”¨äºæ³¨è§£ç±»å‹\n\n\nElementType.PACKAGE\nåº”ç”¨äºåŒ…\n\n\nElementType.TYPE_PARAMETER\n1.8ç‰ˆæœ¬æ–°å¢ï¼Œåº”ç”¨äºç±»å‹å˜é‡\n\n\nElementType.TYPE_USE\n1.8ç‰ˆæœ¬æ–°å¢ï¼Œåº”ç”¨äºä»»ä½•ä½¿ç”¨ç±»å‹çš„è¯­å¥ä¸­ï¼ˆä¾‹å¦‚å£°æ˜è¯­å¥ã€æ³›å‹å’Œå¼ºåˆ¶è½¬æ¢è¯­å¥ä¸­çš„ç±»å‹ï¼‰\n\n\n@Retentionè¡¨æ˜è¯¥æ³¨è§£çš„ç”Ÿå‘½å‘¨æœŸ\n\n\n\nç”Ÿå‘½å‘¨æœŸç±»å‹\næè¿°\n\n\n\nRetentionPolicy.SOURCE\nç¼–è¯‘æ—¶è¢«ä¸¢å¼ƒï¼Œä¸åŒ…å«åœ¨ç±»æ–‡ä»¶ä¸­\n\n\nRetentionPolicy.CLASS\nJVMåŠ è½½æ—¶è¢«ä¸¢å¼ƒï¼ŒåŒ…å«åœ¨ç±»æ–‡ä»¶ä¸­ï¼Œé»˜è®¤å€¼\n\n\nRetentionPolicy.RUNTIME\nç”±JVM åŠ è½½ï¼ŒåŒ…å«åœ¨ç±»æ–‡ä»¶ä¸­ï¼Œåœ¨è¿è¡Œæ—¶å¯ä»¥è¢«è·å–åˆ°\n\n\n@Documentè¡¨æ˜è¯¥æ³¨è§£æ ‡è®°çš„å…ƒç´ å¯ä»¥è¢«Javadoc æˆ–ç±»ä¼¼çš„å·¥å…·æ–‡æ¡£åŒ–\n@Inheritedè¡¨æ˜ä½¿ç”¨äº†@Inheritedæ³¨è§£çš„æ³¨è§£ï¼Œæ‰€æ ‡è®°çš„ç±»çš„å­ç±»ä¹Ÿä¼šæ‹¥æœ‰è¿™ä¸ªæ³¨è§£\n","tags":["java","è‡ªå®šä¹‰æ³¨è§£","åå°„"]},{"title":"aopçš„ç®€å•ä½¿ç”¨","url":"/2022/04/25/0.1.2aop%E7%9A%84%E7%AE%80%E5%8D%95%E4%BD%BF%E7%94%A8/","content":"ç®€ä»‹\n AOP çš„å…¨ç§°æ˜¯â€œAspect Oriented Programmingâ€ï¼Œå³é¢å‘åˆ‡é¢ç¼–ç¨‹ï¼Œå’Œ OOPï¼ˆé¢å‘å¯¹è±¡ç¼–ç¨‹ï¼‰ç±»ä¼¼ï¼Œä¹Ÿæ˜¯ä¸€ç§ç¼–ç¨‹æ€æƒ³\n\nAOP é‡‡å–æ¨ªå‘æŠ½å–æœºåˆ¶ï¼ˆåŠ¨æ€ä»£ç†ï¼‰ï¼Œå–ä»£äº†ä¼ ç»Ÿçºµå‘ç»§æ‰¿æœºåˆ¶çš„é‡å¤æ€§ä»£ç ï¼Œå…¶åº”ç”¨ä¸»è¦ä½“ç°åœ¨äº‹åŠ¡å¤„ç†ã€æ—¥å¿—ç®¡ç†ã€æƒé™æ§åˆ¶ã€å¼‚å¸¸å¤„ç†ç­‰æ–¹é¢ã€‚ä¸»è¦ä½œç”¨æ˜¯åˆ†ç¦»åŠŸèƒ½æ€§éœ€æ±‚å’ŒéåŠŸèƒ½æ€§éœ€æ±‚ï¼Œä½¿å¼€å‘äººå‘˜å¯ä»¥é›†ä¸­å¤„ç†æŸä¸€ä¸ªå…³æ³¨ç‚¹æˆ–è€…æ¨ªåˆ‡é€»è¾‘ï¼Œå‡å°‘å¯¹ä¸šåŠ¡ä»£ç çš„ä¾µå…¥ï¼Œå¢å¼ºä»£ç çš„å¯è¯»æ€§å’Œå¯ç»´æŠ¤æ€§ã€‚\nAOP çš„ä½œç”¨å°±æ˜¯ä¿è¯å¼€å‘è€…åœ¨ä¸ä¿®æ”¹æºä»£ç çš„å‰æä¸‹ï¼Œä¸ºç³»ç»Ÿä¸­çš„ä¸šåŠ¡ç»„ä»¶æ·»åŠ æŸç§é€šç”¨åŠŸèƒ½AOP å°±æ˜¯ä»£ç†æ¨¡å¼çš„å…¸å‹åº”ç”¨ã€‚\nç›®å‰æœ€æµè¡Œçš„ AOP æ¡†æ¶æœ‰ä¸¤ä¸ªï¼Œåˆ†åˆ«ä¸º Spring AOP å’Œ AspectJ\n\nSpring AOP æ˜¯åŸºäº AOP ç¼–ç¨‹æ¨¡å¼çš„ä¸€ä¸ªæ¡†æ¶ï¼Œå®ƒèƒ½å¤Ÿæœ‰æ•ˆçš„å‡å°‘ç³»ç»Ÿé—´çš„é‡å¤ä»£ç ï¼Œè¾¾åˆ°æ¾è€¦åˆçš„ç›®çš„ã€‚Spring AOP ä½¿ç”¨çº¯ Java å®ç°ï¼Œä¸éœ€è¦ä¸“é—¨çš„ç¼–è¯‘è¿‡ç¨‹å’Œç±»åŠ è½½å™¨ï¼Œåœ¨è¿è¡ŒæœŸé—´é€šè¿‡ä»£ç†æ–¹å¼å‘ç›®æ ‡ç±»æ¤å…¥å¢å¼ºçš„ä»£ç ã€‚æœ‰ä¸¤ç§å®ç°æ–¹å¼ï¼šåŸºäºæ¥å£çš„ JDK åŠ¨æ€ä»£ç†å’ŒåŸºäºç»§æ‰¿çš„ CGLIB åŠ¨æ€ä»£ç†\nAspectJ æ˜¯ä¸€ä¸ªåŸºäº Java è¯­è¨€çš„ AOP æ¡†æ¶ï¼Œä» Spring 2.0 å¼€å§‹ï¼ŒSpring AOP å¼•å…¥äº†å¯¹ AspectJ çš„æ”¯æŒã€‚AspectJ æ‰©å±•äº† Java è¯­è¨€ï¼Œæä¾›äº†ä¸€ä¸ªä¸“é—¨çš„ç¼–è¯‘å™¨ï¼Œåœ¨ç¼–è¯‘æ—¶æä¾›æ¨ªå‘ä»£ç çš„æ¤å…¥\n\nspring4.0æ‰§è¡Œé¡ºåºæ­£å¸¸æ‰§è¡Œé¡ºåº\n\naroundå¼€å§‹ â€“ before â€“ æ–¹æ³•è°ƒç”¨ â€“  aroundç»“æŸ â€“ after æ‰§è¡Œ â€“ afterReturning æ‰§è¡Œ\n\nå¼‚å¸¸æ‰§è¡Œé¡ºåº\n\naroundå¼€å§‹ â€“ before â€“ æ–¹æ³•è°ƒç”¨ â€“  aroundç»“æŸ â€“ after æ‰§è¡Œ â€“ afterThrowing æ‰§è¡Œ\n\nspring5.28æ‰§è¡Œé¡ºåºæ­£å¸¸æ‰§è¡Œé¡ºåº\n\naroundå¼€å§‹ â€“ before â€“ æ–¹æ³•è°ƒç”¨ â€“ afterReturning æ‰§è¡Œ â€“ after æ‰§è¡Œ â€“  aroundç»“æŸ\n\nå¼‚å¸¸æ‰§è¡Œé¡ºåº\n\naroundå¼€å§‹ â€“ before â€“ æ–¹æ³•è°ƒç”¨ â€“ afterThrowing æ‰§è¡Œ â€“ after æ‰§è¡Œ â€“  aroundç»“æŸ\n\næ™®é€šä½¿ç”¨ï¼ˆç›´æ¥åŒ¹é…åŒ…ï¼‰import org.aspectj.lang.JoinPoint;import org.aspectj.lang.ProceedingJoinPoint;import org.aspectj.lang.annotation.*;import org.slf4j.Logger;import org.slf4j.LoggerFactory;import org.springframework.stereotype.Component;import org.springframework.web.context.request.RequestContextHolder;import org.springframework.web.context.request.ServletRequestAttributes;import javax.servlet.http.HttpServletRequest;import java.util.Arrays;/** * @Author dw * @ClassName MyAop * @Description AOP å„ä¸ªé€šçŸ¥ä½¿ç”¨ç¤ºä¾‹ï¼š * @EnableAspectJAutoProxy ï¼š é»˜è®¤å·²å¼€å¯ä¸éœ€è¦å†æ·»åŠ å“åº”çš„æ³¨è§£ * @Date 2021/8/15 0:21 * @Version 1.0 */@Aspect@Componentpublic class MyAop &#123;    private final Logger log = LoggerFactory.getLogger(this.getClass());    /**     * å®šä¹‰åˆ‡å…¥ç‚¹ (ä¸€ä¸ªåˆ‡é¢ç±»ä¸­å¯ä»¥å®šä¹‰å¤šä¸ªåˆ‡å…¥ç‚¹)     * æ‹¦æˆªæ‰€æœ‰ com.dw.study.controller åŒ…ä»¥åŠå­åŒ…ä¸‹æ‰€æœ‰ç±»çš„æ‰€æœ‰æ–¹æ¡ˆ     * ç¬¬ä¸€ä¸ª * è¡¨ç¤ºæ‰€æœ‰è¿”å›å€¼     * ç¬¬äºŒä¸ª * è¡¨ç¤ºæ‰€æœ‰ç±»     * ç¬¬ä¸‰ä¸ª * è¡¨ç¤ºæ‰€æœ‰çš„æ–¹æ³•å     * ä¸¤ä¸ª .. è¡¨ç¤ºå½“å‰åŒ…ä»¥åŠå­åŒ…     **/    @Pointcut(&quot;execution(* com.dw.study.controller..*.*(..))&quot;)    public void aspect() &#123;&#125;        /**     * å‰ç½®é€šçŸ¥ï¼Œç›®æ ‡æ–¹æ³•è°ƒç”¨å‰è¢«è°ƒç”¨     * é™¤@Aroundå¤–ï¼Œæ¯ä¸ªæ–¹æ³•é‡Œéƒ½å¯ä»¥åŠ æˆ–è€…ä¸åŠ å‚æ•°JoinPointã€‚     * JoinPointåŒ…å«äº†ç±»åã€è¢«åˆ‡é¢çš„æ–¹æ³•åã€å‚æ•°ç­‰å±æ€§ã€‚     **/    @Before(value = &quot;aspect()&quot;)    public void before(JoinPoint joinPoint) &#123;        log.info(&quot;AOP before æ‰§è¡Œ... ï¼šå‚æ•°ç±»å‹ï¼š&#123;&#125;&quot;, joinPoint.getArgs());    &#125;    /**     * æœ€ç»ˆé€šçŸ¥ï¼Œç›®æ ‡æ–¹æ³•æ‰§è¡Œå®Œä¹‹åæ‰§è¡Œ     **/    @After(value = &quot;aspect()&quot;)    public void after(JoinPoint joinPoint) &#123;        log.info(&quot;AOP after æ‰§è¡Œ...  ï¼š&#123;&#125;&quot;, joinPoint.toLongString());    &#125;    /**     * åç½®è¿”å›é€šçŸ¥     * å¦‚æœå‚æ•°ä¸­çš„ç¬¬ä¸€ä¸ªå‚æ•°ä¸ºJoinPointï¼Œåˆ™ç¬¬äºŒä¸ªå‚æ•°ä¸ºè¿”å›å€¼çš„ä¿¡æ¯     * å¦‚æœå‚æ•°ä¸­çš„ç¬¬ä¸€ä¸ªå‚æ•°ä¸ä¸ºJoinPointï¼Œåˆ™ç¬¬ä¸€ä¸ªå‚æ•°ä¸ºreturningä¸­å¯¹åº”çš„å‚æ•°     * returning åªæœ‰ç›®æ ‡æ–¹æ³•è¿”å›å€¼ä¸é€šçŸ¥æ–¹æ³•å…·æœ‰ç›¸åº”å‚æ•°ç±»å‹æ—¶æ‰èƒ½æ‰§è¡Œåç½®è¿”å›é€šçŸ¥ï¼Œå¦åˆ™ä¸æ‰§è¡Œ     * é™¤äº†ä½¿ç”¨ä¸Šé¢å®šä¹‰å¥½çš„åˆ‡é¢aspect()ï¼Œ ä¹Ÿå¯ä»¥ç›´æ¥ä½¿ç”¨è¡¨è¾¾å¼ã€‚     **/    @AfterReturning(value = &quot;execution(* com.dw.study.controller..*.*(..))&quot;, returning = &quot;result&quot;)    public void afterReturning(JoinPoint joinPoint, Object result) &#123;        log.info(&quot;AOP afterReturning æ‰§è¡Œ...  ï¼šè¿”å›ç»“æœï¼š&#123;&#125;&quot;, result);    &#125;    /**     * ç¯ç»•é€šçŸ¥     * ç¯ç»•é€šçŸ¥éå¸¸å¼ºå¤§ï¼Œå¯ä»¥å†³å®šç›®æ ‡æ–¹æ³•æ˜¯å¦æ‰§è¡Œï¼Œä»€ä¹ˆæ—¶å€™æ‰§è¡Œï¼Œæ‰§è¡Œæ—¶æ˜¯å¦éœ€è¦æ›¿æ¢æ–¹æ³•å‚æ•°ï¼Œæ‰§è¡Œå®Œæ¯•æ˜¯å¦éœ€è¦æ›¿æ¢è¿”å›å€¼ã€‚     * ç¯ç»•é€šçŸ¥ç¬¬ä¸€ä¸ªå‚æ•°å¿…é¡»æ˜¯org.aspectj.lang.ProceedingJoinPointç±»å‹     * 2ï¼šproceedingJoinPoint.proceed() æ‰§è¡Œè¢«ä»£ç†çš„æ–¹æ³•     **/    @Around(value = &quot;aspect()&quot;)    public Object around(ProceedingJoinPoint proceedingJoinPoint) &#123;        try &#123;            log.info(&quot;AOP aroundå¼€å§‹... æ‰§è¡Œæ–¹æ³•... ï¼š&#123;&#125;&quot;, proceedingJoinPoint.getSignature().getName());            Object proceed = proceedingJoinPoint.proceed();            log.info(&quot;AOP aroundç»“æŸ... æ‰§è¡Œæ–¹æ³•... ï¼š&#123;&#125;&quot;, proceedingJoinPoint.getSignature().getName());            return proceed;        &#125; catch (Throwable throwable) &#123;            log.info(&quot;AOP around æ‰§è¡Œé”™è¯¯... error ï¼š&#123;&#125;&quot;, throwable.getMessage());            throwable.printStackTrace();            return &quot;æ‰§è¡Œaroundå‡ºé”™ã€‚ã€‚ã€‚&quot;;        &#125;    &#125;    /**     * åç½®å¼‚å¸¸é€šçŸ¥     * å®šä¹‰ä¸€ä¸ªåå­—ï¼Œè¯¥åå­—ç”¨äºåŒ¹é…é€šçŸ¥å®ç°æ–¹æ³•çš„ä¸€ä¸ªå‚æ•°åï¼Œå½“ç›®æ ‡æ–¹æ³•æŠ›å‡ºå¼‚å¸¸è¿”å›åï¼Œå°†æŠŠç›®æ ‡æ–¹æ³•æŠ›å‡ºçš„å¼‚å¸¸ä¼ ç»™é€šçŸ¥æ–¹æ³•ï¼›     * throwing åªæœ‰ç›®æ ‡æ–¹æ³•æŠ›å‡ºçš„å¼‚å¸¸ä¸é€šçŸ¥æ–¹æ³•ç›¸åº”å‚æ•°å¼‚å¸¸ç±»å‹æ—¶æ‰èƒ½æ‰§è¡Œåç½®å¼‚å¸¸é€šçŸ¥ï¼Œå¦åˆ™ä¸æ‰§è¡Œï¼Œ     **/    @AfterThrowing(value = &quot;aspect()&quot;, throwing = &quot;exception&quot;)    public void afterThrowing(JoinPoint joinPoint, Throwable exception) &#123;        log.error(&quot;AOP afterThrowing æ‰§è¡Œ... , msg : &#123;&#125;&quot;, exception.getMessage());        if (exception instanceof NullPointerException)            log.info(&quot;ç©ºæŒ‡é’ˆå¼‚å¸¸&quot;);    &#125;&#125;\n\nè‡ªå®šä¹‰æ³¨è§£åŒ¹é…(æ— å‚)1.è‡ªå®šä¹‰æ³¨è§£@Retention(RetentionPolicy.RUNTIME)@Target(ElementType.METHOD)public @interface MethodAspect &#123;&#125;\n\n2.å®šä¹‰åˆ‡é¢@Aspect@Componentpublic class MyAop &#123;    private final Logger log = LoggerFactory.getLogger(this.getClass());/**     * åŸºäºæ³¨è§£å®šä¹‰åˆ‡å…¥ç‚¹ 2     * å¯¹äºæ³¨è§£äº† @MethodAspectçš„æ–¹æ³•è¿›è¡Œæ‹¦æˆª     * è¡¨ç¤ºæ ‡æ³¨äº†ç‰¹å®šæ³¨è§£çš„ç›®æ ‡æ–¹æ³•é“¾æ¥ç‚¹ã€‚å¦‚@annotation(com.dw.study.TestAnnotation)è¡¨ç¤ºä»»ä½•æ ‡æ³¨äº†@TestAnnotationæ³¨è§£çš„ç›®æ ‡ç±»æ–¹æ³•ã€‚     */    @Pointcut(&quot;@annotation(com.dw.study.customAnnotation.MethodAspect)&quot;)    public void testMyAnnotationAspect() &#123;&#125;    /**     * å‰ç½®é€šçŸ¥ï¼Œç›®æ ‡æ–¹æ³•è°ƒç”¨å‰è¢«è°ƒç”¨     * é™¤@Aroundå¤–ï¼Œæ¯ä¸ªæ–¹æ³•é‡Œéƒ½å¯ä»¥åŠ æˆ–è€…ä¸åŠ å‚æ•°JoinPointã€‚     * JoinPointåŒ…å«äº†ç±»åã€è¢«åˆ‡é¢çš„æ–¹æ³•åã€å‚æ•°ç­‰å±æ€§ã€‚     **/    @Before(value = &quot;testMyAnnotationAspect()&quot;)    public void before(JoinPoint joinPoint) &#123;        log.info(&quot;AOP before æ‰§è¡Œ... ï¼šå‚æ•°ç±»å‹ï¼š&#123;&#125;&quot;, joinPoint.getArgs());    &#125;&#125;\n\n3.æ‰«æ@RequestMapping(&quot;hello&quot;)@MethodAspectpublic String hello()&#123;    return &quot;SpringBoot-HelloWorld&quot;;&#125;\n\nè‡ªå®šä¹‰æ³¨è§£åŒ¹é…(å¸¦å‚)1.è‡ªå®šä¹‰æ³¨è§£@Retention(RetentionPolicy.RUNTIME)@Target(ElementType.METHOD)public @interface MethodAspect &#123;    /**     * ä¼ å€¼     * @return     */    String value();    /**     * æè¿°     * @return     */    String description() default &quot;default description&quot;;&#125;\n\n2.å®šä¹‰åˆ‡é¢å¦‚æœéœ€è¦è·å–@annotationä¸­çš„å€¼ï¼Œéœ€è¦å’Œæ–¹æ³•å‚æ•°åç›¸åŒ\n@Aspect@Componentpublic class MyAop &#123;    private final Logger log = LoggerFactory.getLogger(this.getClass());    /**     * åŸºäºæ³¨è§£å®šä¹‰åˆ‡å…¥ç‚¹ 2     * å¯¹äºæ³¨è§£äº† @MethodAspectçš„æ–¹æ³•è¿›è¡Œæ‹¦æˆª     * è¡¨ç¤ºæ ‡æ³¨äº†ç‰¹å®šæ³¨è§£çš„ç›®æ ‡æ–¹æ³•é“¾æ¥ç‚¹ã€‚å¦‚@annotation(com.dw.study.TestAnnotation)è¡¨ç¤ºä»»ä½•æ ‡æ³¨äº†@TestAnnotationæ³¨è§£çš„ç›®æ ‡ç±»æ–¹æ³•ã€‚     */    @Pointcut(&quot;@annotation(com.dw.study.customAnnotation.MethodAspect)&quot;)    public void testMyAnnotationAspect() &#123;&#125;    /**     * å‰ç½®é€šçŸ¥ï¼Œç›®æ ‡æ–¹æ³•è°ƒç”¨å‰è¢«è°ƒç”¨     * é™¤@Aroundå¤–ï¼Œæ¯ä¸ªæ–¹æ³•é‡Œéƒ½å¯ä»¥åŠ æˆ–è€…ä¸åŠ å‚æ•°JoinPointã€‚     * JoinPointåŒ…å«äº†ç±»åã€è¢«åˆ‡é¢çš„æ–¹æ³•åã€å‚æ•°ç­‰å±æ€§ã€‚     * @annotationä¸­çš„å€¼ï¼Œéœ€è¦å’Œæ–¹æ³•å‚æ•°åç›¸åŒ(é‡è¦)     **/    @Before(value = &quot;testMyAnnotationAspect() &amp;&amp; @annotation(methodAspect)&quot;)    public void before(JoinPoint joinPoint, MethodAspect methodAspect) &#123;        log.info(&quot;AOP before æ‰§è¡Œ... ï¼šå‚æ•°ç±»å‹ï¼š&#123;&#125;&quot;, joinPoint.getArgs());        log.info(&quot;before-value== &quot;+ methodAspect.value() + &quot;before-description== &quot; + methodAspect.description());        // æ¥æ”¶åˆ°è¯·æ±‚ï¼Œè®°å½•è¯·æ±‚å†…å®¹        ServletRequestAttributes attributes = (ServletRequestAttributes) RequestContextHolder.getRequestAttributes();        HttpServletRequest request = attributes.getRequest();        // è®°å½•ä¸‹è¯·æ±‚å†…å®¹        System.out.println(&quot;URL : &quot; + request.getRequestURL().toString());        System.out.println(&quot;HTTP_METHOD : &quot; + request.getMethod());        System.out.println(&quot;IP : &quot; + request.getRemoteAddr());        System.out.println(&quot;CLASS_METHOD : &quot; + joinPoint.getSignature().getDeclaringTypeName() + &quot;.&quot; + joinPoint.getSignature().getName());        System.out.println(&quot;ARGS : &quot; + Arrays.toString(joinPoint.getArgs()));    &#125;    /**     * ç¯ç»•é€šçŸ¥     * ç¯ç»•é€šçŸ¥éå¸¸å¼ºå¤§ï¼Œå¯ä»¥å†³å®šç›®æ ‡æ–¹æ³•æ˜¯å¦æ‰§è¡Œï¼Œä»€ä¹ˆæ—¶å€™æ‰§è¡Œï¼Œæ‰§è¡Œæ—¶æ˜¯å¦éœ€è¦æ›¿æ¢æ–¹æ³•å‚æ•°ï¼Œæ‰§è¡Œå®Œæ¯•æ˜¯å¦éœ€è¦æ›¿æ¢è¿”å›å€¼ã€‚     * ç¯ç»•é€šçŸ¥ç¬¬ä¸€ä¸ªå‚æ•°å¿…é¡»æ˜¯org.aspectj.lang.ProceedingJoinPointç±»å‹     * 2ï¼šproceedingJoinPoint.proceed() æ‰§è¡Œè¢«ä»£ç†çš„æ–¹æ³•     *   @annotationä¸­çš„å€¼ï¼Œéœ€è¦å’Œæ–¹æ³•å‚æ•°åç›¸åŒ     **/    @Around(value = &quot;testMyAnnotationAspect() &amp;&amp; @annotation(methodAspect)&quot;)    public Object around(ProceedingJoinPoint proceedingJoinPoint, MethodAspect methodAspect) &#123;        try &#123;            log.info(&quot;AOP aroundå¼€å§‹... æ‰§è¡Œæ–¹æ³•... ï¼š&#123;&#125;&quot;, proceedingJoinPoint.getSignature().getName());            log.info(&quot;around-value== &quot;+ methodAspect.value() + &quot;around-description== &quot; + methodAspect.description());            Object proceed = proceedingJoinPoint.proceed();            log.info(&quot;AOP aroundç»“æŸ... æ‰§è¡Œæ–¹æ³•... ï¼š&#123;&#125;&quot;, proceedingJoinPoint.getSignature().getName());            return proceed;        &#125; catch (Throwable throwable) &#123;            log.info(&quot;AOP around æ‰§è¡Œé”™è¯¯... error ï¼š&#123;&#125;&quot;, throwable.getMessage());            throwable.printStackTrace();            return &quot;æ‰§è¡Œaroundå‡ºé”™ã€‚ã€‚ã€‚&quot;;        &#125;    &#125;&#125;\n\né™„æ–‡ä¸ºäº†æ›´å¥½åœ°ç†è§£ AOPï¼Œæˆ‘ä»¬éœ€è¦äº†è§£ä¸€äº›å®ƒçš„ç›¸å…³æœ¯è¯­ã€‚è¿™äº›ä¸“ä¸šæœ¯è¯­å¹¶ä¸æ˜¯ Spring ç‰¹æœ‰çš„ï¼Œæœ‰äº›ä¹ŸåŒæ ·é€‚ç”¨äºå…¶å®ƒ AOP æ¡†æ¶ï¼Œå¦‚ AspectJã€‚\nå®ƒä»¬çš„å«ä¹‰å¦‚ä¸‹è¡¨æ‰€ç¤ºï¼š\n\n\n\nåç§°\nè¯´æ˜\n\n\n\nJoinpointï¼ˆè¿æ¥ç‚¹ï¼‰\næŒ‡é‚£äº›è¢«æ‹¦æˆªåˆ°çš„ç‚¹ï¼Œåœ¨ Spring ä¸­ï¼ŒæŒ‡å¯ä»¥è¢«åŠ¨æ€ä»£ç†æ‹¦æˆªç›®æ ‡ç±»çš„æ–¹æ³•ã€‚\n\n\nPointcutï¼ˆåˆ‡å…¥ç‚¹ï¼‰\næŒ‡è¦å¯¹å“ªäº› Joinpoint è¿›è¡Œæ‹¦æˆªï¼Œå³è¢«æ‹¦æˆªçš„è¿æ¥ç‚¹ã€‚\n\n\nAdviceï¼ˆé€šçŸ¥ï¼‰\næŒ‡æ‹¦æˆªåˆ° Joinpoint ä¹‹åè¦åšçš„äº‹æƒ…ï¼Œå³å¯¹åˆ‡å…¥ç‚¹å¢å¼ºçš„å†…å®¹ã€‚\n\n\nTargetï¼ˆç›®æ ‡ï¼‰\næŒ‡ä»£ç†çš„ç›®æ ‡å¯¹è±¡ã€‚\n\n\nWeavingï¼ˆæ¤å…¥ï¼‰\næŒ‡æŠŠå¢å¼ºä»£ç åº”ç”¨åˆ°ç›®æ ‡ä¸Šï¼Œç”Ÿæˆä»£ç†å¯¹è±¡çš„è¿‡ç¨‹ã€‚\n\n\nProxyï¼ˆä»£ç†ï¼‰\næŒ‡ç”Ÿæˆçš„ä»£ç†å¯¹è±¡ã€‚\n\n\nAspectï¼ˆåˆ‡é¢ï¼‰\nåˆ‡å…¥ç‚¹å’Œé€šçŸ¥çš„ç»“åˆã€‚\n\n\nAdvice ç›´è¯‘ä¸ºé€šçŸ¥ï¼Œä¹Ÿæœ‰çš„èµ„æ–™ç¿»è¯‘ä¸ºâ€œå¢å¼ºå¤„ç†â€ï¼Œå…±æœ‰ 5 ç§ç±»å‹ï¼Œå¦‚ä¸‹è¡¨æ‰€ç¤ºï¼š\n\n\n\né€šçŸ¥\nè¯´æ˜\n\n\n\nbeforeï¼ˆå‰ç½®é€šçŸ¥ï¼‰\né€šçŸ¥æ–¹æ³•åœ¨ç›®æ ‡æ–¹æ³•è°ƒç”¨ä¹‹å‰æ‰§è¡Œ\n\n\nafterï¼ˆåç½®é€šçŸ¥ï¼‰\né€šçŸ¥æ–¹æ³•åœ¨ç›®æ ‡æ–¹æ³•è¿”å›æˆ–å¼‚å¸¸åè°ƒç”¨\n\n\nafter-returningï¼ˆè¿”å›åé€šçŸ¥ï¼‰\né€šçŸ¥æ–¹æ³•ä¼šåœ¨ç›®æ ‡æ–¹æ³•è¿”å›åè°ƒç”¨\n\n\nafter-throwingï¼ˆæŠ›å‡ºå¼‚å¸¸é€šçŸ¥ï¼‰\né€šçŸ¥æ–¹æ³•ä¼šåœ¨ç›®æ ‡æ–¹æ³•æŠ›å‡ºå¼‚å¸¸åè°ƒç”¨\n\n\naroundï¼ˆç¯ç»•é€šçŸ¥ï¼‰\né€šçŸ¥æ–¹æ³•ä¼šå°†ç›®æ ‡æ–¹æ³•å°è£…èµ·æ¥\n\n\nexecutionè¡¨è¾¾å¼ï¼šç”¨äºåŒ¹é…æ–¹æ³•æ‰§è¡Œçš„è¿æ¥ç‚¹ï¼Œå±äºæ–¹æ³•çº§åˆ«ï¼Œ è¯­æ³•ï¼š execution(ä¿®é¥°ç¬¦ è¿”å›å€¼ç±»å‹ æ–¹æ³•åï¼ˆå‚æ•°ï¼‰å¼‚å¸¸)\n\n\n\nè¯­æ³•å‚æ•°\næè¿°\n\n\n\nä¿®é¥°ç¬¦\nå¯é€‰ï¼Œå¦‚publicï¼Œprotectedï¼Œå†™åœ¨è¿”å›å€¼å‰ï¼Œä»»æ„ä¿®é¥°ç¬¦å¡«*å·å°±å¯ä»¥\n\n\nè¿”å›å€¼ç±»å‹\nå¿…é€‰ï¼Œå¯ä»¥ä½¿ç”¨*æ¥ä»£è¡¨ä»»æ„è¿”å›å€¼\n\n\næ–¹æ³•å\nå¿…é€‰ï¼Œå¯ä»¥ç”¨*æ¥ä»£è¡¨ä»»æ„æ–¹æ³•\n\n\nå‚æ•°\nå¿…é€‰ï¼Œ ()ä»£è¡¨æ˜¯æ²¡æœ‰å‚æ•°ï¼Œ(..)ä»£è¡¨æ˜¯åŒ¹é…ä»»æ„æ•°é‡ï¼Œä»»æ„ç±»å‹çš„å‚æ•°ï¼Œå½“ç„¶ä¹Ÿå¯ä»¥æŒ‡å®šç±»å‹çš„å‚æ•°è¿›è¡ŒåŒ¹é…ï¼Œå¦‚è¦æ¥å—ä¸€ä¸ªStringç±»å‹çš„å‚æ•°ï¼Œåˆ™(java.lang.String), ä»»æ„æ•°é‡çš„Stringç±»å‹å‚æ•°ï¼š(java.lang.String..)ç­‰ç­‰ã€‚ã€‚ã€‚\n\n\nå¼‚å¸¸\nå¯é€‰ï¼Œè¯­æ³•ï¼šthrows å¼‚å¸¸ï¼Œå¼‚å¸¸æ˜¯å®Œæ•´å¸¦åŒ…åï¼Œå¯ä»¥æ˜¯å¤šä¸ªï¼Œç”¨é€—å·åˆ†éš”\n\n\nexecution()è¡¨è¾¾å¼æ¡ˆä¾‹ï¼š\n\næ‹¦æˆªcom.dw.studyåŒ…ä¸‹çš„æ‰€æœ‰å­åŒ…é‡Œçš„ä»»æ„ç±»çš„ä»»æ„æ–¹æ³•execution(* com.dw.study..*.*(..))\næ‹¦æˆªcom.dw.study.Test2Controllerä¸‹çš„ä»»æ„æ–¹æ³•execution(* **com.dw.study**.Test2Controller.*(..))\næ‹¦æˆªä»»ä½•ä¿®é¥°ç¬¦ä¸ºpublicçš„æ–¹æ³•execution(public * * (..))\næ‹¦æˆªcom.dw.studyä¸‹çš„æ‰€æœ‰å­åŒ…é‡Œçš„ä»¥okå¼€å¤´çš„æ–¹æ³•execution(* **com.dw.study**..*.ok* (..))\n\nJoinPointJoinPointå¯¹è±¡å°è£…äº†SpringAopä¸­åˆ‡é¢æ–¹æ³•çš„ä¿¡æ¯,åœ¨åˆ‡é¢æ–¹æ³•ä¸­æ·»åŠ JoinPointå‚æ•°,å°±å¯ä»¥è·å–åˆ°å°è£…äº†è¯¥æ–¹æ³•ä¿¡æ¯çš„JoinPointå¯¹è±¡ã€‚ é™¤ @Around å¤–ï¼Œæ¯ä¸ªé€šçŸ¥çš„æ–¹æ³•é‡Œéƒ½å¯ä»¥åŠ æˆ–è€…ä¸åŠ å‚æ•°JoinPointã€‚JoinPointåŒ…å«äº†ç±»åã€è¢«åˆ‡é¢çš„æ–¹æ³•åã€å‚æ•°ç­‰å±æ€§ã€‚@Around å‚æ•°å¿…é¡»ä¸º ProceedingJoinPoint\n\n\n\næ–¹æ³•å\nåŠŸèƒ½\n\n\n\nSignature getSignature();\nè·å–å°è£…äº†ç½²åä¿¡æ¯çš„å¯¹è±¡,åœ¨è¯¥å¯¹è±¡ä¸­å¯ä»¥è·å–åˆ°ç›®æ ‡æ–¹æ³•å,æ‰€å±ç±»çš„Classç­‰ä¿¡æ¯\n\n\nObject[] getArgs();\nè·å–ä¼ å…¥ç›®æ ‡æ–¹æ³•çš„å‚æ•°å¯¹è±¡\n\n\nObject getTarget();\nè·å–è¢«ä»£ç†çš„å¯¹è±¡\n\n\nObject getThis();\nè·å–ä»£ç†å¯¹è±¡\n\n\nProceedingJoinPoint ProceedingJoinPointå¯¹è±¡æ˜¯JoinPoint çš„å­æ¥å£, è¯¥å¯¹è±¡åªç”¨åœ¨@Aroundçš„åˆ‡é¢æ–¹æ³•ä¸­ï¼š\n\n\n\næ–¹æ³•å\nåŠŸèƒ½\n\n\n\nObject proceed() throws Throwable\næ‰§è¡Œç›®æ ‡æ–¹æ³•\n\n\nObject proceed(Object[] var1) throws Throwable\nä¼ å…¥çš„æ–°çš„å‚æ•°å»æ‰§è¡Œç›®æ ‡æ–¹æ³•\n\n\nå°ç»“AOP æ˜¯ Spring çš„æ ¸å¿ƒä¹‹ä¸€ï¼Œåœ¨ Spring ä¸­ç»å¸¸ä¼šä½¿ç”¨ AOP æ¥ç®€åŒ–ç¼–ç¨‹ã€‚\n åœ¨ Spring æ¡†æ¶ä¸­ä½¿ç”¨ AOP ä¸»è¦æœ‰ä»¥ä¸‹ä¼˜åŠ¿ï¼š\n\næä¾›å£°æ˜å¼ä¼ä¸šæœåŠ¡ï¼Œç‰¹åˆ«æ˜¯ä½œä¸º EJB å£°æ˜å¼æœåŠ¡çš„æ›¿ä»£å“ã€‚æœ€é‡è¦çš„æ˜¯ï¼Œè¿™ç§æœåŠ¡æ˜¯å£°æ˜å¼äº‹åŠ¡ç®¡ç†ã€‚\nå…è®¸ç”¨æˆ·å®ç°è‡ªå®šä¹‰åˆ‡é¢ã€‚åœ¨æŸäº›ä¸é€‚åˆç”¨ OOP ç¼–ç¨‹çš„åœºæ™¯ä¸­ï¼Œé‡‡ç”¨ AOP æ¥è¡¥å……ã€‚\nå¯ä»¥å¯¹ä¸šåŠ¡é€»è¾‘çš„å„ä¸ªéƒ¨åˆ†è¿›è¡Œéš”ç¦»ï¼Œä»è€Œä½¿ä¸šåŠ¡é€»è¾‘å„éƒ¨åˆ†ä¹‹é—´çš„è€¦åˆåº¦é™ä½ï¼Œæé«˜ç¨‹åºçš„å¯é‡ç”¨æ€§ï¼ŒåŒæ—¶ä¹Ÿæé«˜äº†å¼€å‘æ•ˆç‡ã€‚\n\nå‚è€ƒ\nSpring AOPï¼šåŸºäºAspectJæ³¨è§£å¼€å‘\n\nç»†è¯´SpringAopè¯¦è§£\n\nhttps://zhuanlan.zhihu.com/p/395709988\n\n\n","tags":["aop"]},{"title":"ipåœ°å€ç™½åå•æ ¡éªŒ","url":"/2022/04/04/0.1.3ip%E5%9C%B0%E5%9D%80%E7%99%BD%E5%90%8D%E5%8D%95%E6%A0%A1%E9%AA%8C/","content":"package com.service.taobao.util;import org.springframework.context.annotation.Configuration;import javax.servlet.http.HttpServletRequest;import java.util.ArrayList;import java.util.HashSet;import java.util.List;import java.util.Set;import java.util.regex.Pattern;/** * @ClassName WhiteIPInterceptor * @Description //TODO * @Author yinjuan * @Date 2022-01-12 16:45 * @Version 1.0 */public class WhiteIPInterceptor &#123;    // IPçš„æ­£åˆ™    private static Pattern pattern = Pattern            .compile(&quot;(1\\\\d&#123;1,2&#125;|2[0-4]\\\\d|25[0-5]|\\\\d&#123;1,2&#125;)\\\\.&quot; + &quot;(1\\\\d&#123;1,2&#125;|2[0-4]\\\\d|25[0-5]|\\\\d&#123;1,2&#125;)\\\\.&quot;                    + &quot;(1\\\\d&#123;1,2&#125;|2[0-4]\\\\d|25[0-5]|\\\\d&#123;1,2&#125;)\\\\.&quot; + &quot;(1\\\\d&#123;1,2&#125;|2[0-4]\\\\d|25[0-5]|\\\\d&#123;1,2&#125;)&quot;);    private static final String DEFAULT_ALLOW_ALL_FLAG = &quot;*&quot;;\t// å…è®¸æ‰€æœ‰ipæ ‡å¿—ä½    private static final String DEFAULT_DENY_ALL_FLAG = &quot;0&quot;; \t// ç¦æ­¢æ‰€æœ‰ipæ ‡å¿—ä½    /**     * Description: è·å–è®¿é—®çš„ipåœ°å€     * @param request     * @return     */    public static String getIpAddr(HttpServletRequest request) &#123;        String ip = request.getHeader(&quot;X-Forwarded-For&quot;);        if (ip == null || ip.length() == 0 || &quot;unknown&quot;.equalsIgnoreCase(ip)) &#123;            ip = request.getHeader(&quot;Proxy-Client-IP&quot;);        &#125;        if (ip == null || ip.length() == 0 || &quot;unknown&quot;.equalsIgnoreCase(ip)) &#123;            ip = request.getHeader(&quot;WL-Proxy-Client-IP&quot;);        &#125;        if (ip == null || ip.length() == 0 || &quot;unknown&quot;.equalsIgnoreCase(ip)) &#123;            ip = request.getHeader(&quot;HTTP_CLIENT_IP&quot;);        &#125;        if (ip == null || ip.length() == 0 || &quot;unknown&quot;.equalsIgnoreCase(ip)) &#123;            ip = request.getHeader(&quot;HTTP_X_FORWARDED_FOR&quot;);        &#125;        if (ip == null || ip.length() == 0 || &quot;unknown&quot;.equalsIgnoreCase(ip)) &#123;            ip = request.getRemoteAddr();        &#125;        if (&quot;0:0:0:0:0:0:0:1&quot;.equals(ip)) &#123;            ip = &quot;127.0.0.1&quot;;        &#125;        return ip;    &#125;    /**     * æ ¹æ®IPç™½åå•è®¾ç½®è·å–å¯ç”¨çš„IPåˆ—è¡¨     * @param allowIp     * @return     */    private static Set&lt;String&gt; getAvaliIpList(String allowIp) &#123;        String[] splitRex = allowIp.split(&quot;;&quot;);// æ‹†åˆ†å‡ºç™½åå•æ­£åˆ™        Set&lt;String&gt; ipList = new HashSet&lt;String&gt;(splitRex.length);        for (String allow : splitRex) &#123;            allow = allow.trim();            if (allow.contains(&quot;*&quot;)) &#123;// å¤„ç†é€šé…ç¬¦ *                String[] ips = allow.split(&quot;\\\\.&quot;);                String[] from = new String[] &#123; &quot;0&quot;, &quot;0&quot;, &quot;0&quot;, &quot;0&quot; &#125;;                String[] end = new String[] &#123; &quot;255&quot;, &quot;255&quot;, &quot;255&quot;, &quot;255&quot; &#125;;                List&lt;String&gt; tem = new ArrayList&lt;String&gt;();                for (int i = 0; i &lt; ips.length; i++)                    if (ips[i].indexOf(&quot;*&quot;) &gt; -1) &#123;                        tem = complete(ips[i]);                        from[i] = null;                        end[i] = null;                    &#125; else &#123;                        from[i] = ips[i];                        end[i] = ips[i];                    &#125;                StringBuilder fromIP = new StringBuilder();                StringBuilder endIP = new StringBuilder();                for (int i = 0; i &lt; 4; i++)                    if (from[i] != null) &#123;                        fromIP.append(from[i]).append(&quot;.&quot;);                        endIP.append(end[i]).append(&quot;.&quot;);                    &#125; else &#123;                        fromIP.append(&quot;[*].&quot;);                        endIP.append(&quot;[*].&quot;);                    &#125;                fromIP.deleteCharAt(fromIP.length() - 1);                endIP.deleteCharAt(endIP.length() - 1);                for (String s : tem) &#123;                    String ip = fromIP.toString().replace(&quot;[*]&quot;, s.split(&quot;;&quot;)[0]) + &quot;-&quot;                            + endIP.toString().replace(&quot;[*]&quot;, s.split(&quot;;&quot;)[1]);                    if (validate(ip)) &#123;                        ipList.add(ip);                    &#125;                &#125;            &#125; else if (allow.contains(&quot;/&quot;)) &#123;// å¤„ç† ç½‘æ®µ xxx.xxx.xxx./24                ipList.add(allow);            &#125; else &#123;// å¤„ç†å•ä¸ª ip æˆ–è€… èŒƒå›´                if (validate(allow)) &#123;                    ipList.add(allow);                &#125;            &#125;        &#125;        return ipList;    &#125;    /**     * \tå¯¹å•ä¸ªIPèŠ‚ç‚¹è¿›è¡ŒèŒƒå›´é™å®š     * @param arg     * @return è¿”å›é™å®šåçš„IPèŒƒå›´ï¼Œæ ¼å¼ä¸ºList[10;19, 100;199]     */    private static List&lt;String&gt; complete(String arg) &#123;        List&lt;String&gt; com = new ArrayList&lt;String&gt;();        int len = arg.length();        if (len == 1) &#123;            com.add(&quot;0;255&quot;);        &#125; else if (len == 2) &#123;            String s1 = complete(arg, 1);            if (s1 != null)                com.add(s1);            String s2 = complete(arg, 2);            if (s2 != null)                com.add(s2);        &#125; else &#123;            String s1 = complete(arg, 1);            if (s1 != null)                com.add(s1);        &#125;        return com;    &#125;    private static String complete(String arg, int length) &#123;        String from = &quot;&quot;;        String end = &quot;&quot;;        if (length == 1) &#123;            from = arg.replace(&quot;*&quot;, &quot;0&quot;);            end = arg.replace(&quot;*&quot;, &quot;9&quot;);        &#125; else &#123;            from = arg.replace(&quot;*&quot;, &quot;00&quot;);            end = arg.replace(&quot;*&quot;, &quot;99&quot;);        &#125;        if (Integer.valueOf(from) &gt; 255)            return null;        if (Integer.valueOf(end) &gt; 255)            end = &quot;255&quot;;        return from + &quot;;&quot; + end;    &#125;    /**     *\t åœ¨æ·»åŠ è‡³ç™½åå•æ—¶è¿›è¡Œæ ¼å¼æ ¡éªŒ     * @param ip     * @return     */    private static boolean validate(String ip) &#123;        String[] temp = ip.split(&quot;-&quot;);        for (String s : temp)            if (!pattern.matcher(s).matches()) &#123;                return false;            &#125;        return true;    &#125;    /**     * \tæ ¹æ®IP,åŠå¯ç”¨Ipåˆ—è¡¨æ¥åˆ¤æ–­ipæ˜¯å¦åŒ…å«åœ¨ç™½åå•ä¹‹ä¸­     * @param ip     * @param ipList     * @return     */    private static boolean isPermited(String ip, Set&lt;String&gt; ipList) &#123;        if (ipList.isEmpty() || ipList.contains(ip))            return true;        for (String allow : ipList) &#123;            if (allow.indexOf(&quot;-&quot;) &gt; -1) &#123;// å¤„ç† ç±»ä¼¼ 192.168.0.0-192.168.2.1                String[] tempAllow = allow.split(&quot;-&quot;);                String[] from = tempAllow[0].split(&quot;\\\\.&quot;);                String[] end = tempAllow[1].split(&quot;\\\\.&quot;);                String[] tag = ip.split(&quot;\\\\.&quot;);                boolean check = true;                for (int i = 0; i &lt; 4; i++) &#123;// å¯¹IPä»å·¦åˆ°å³è¿›è¡Œé€æ®µåŒ¹é…                    int s = Integer.valueOf(from[i]);                    int t = Integer.valueOf(tag[i]);                    int e = Integer.valueOf(end[i]);                    if (!(s &lt;= t &amp;&amp; t &lt;= e)) &#123;                        check = false;                        break;                    &#125;                &#125;                if (check)                    return true;            &#125; else if (allow.contains(&quot;/&quot;)) &#123;// å¤„ç† ç½‘æ®µ xxx.xxx.xxx./24                int splitIndex = allow.indexOf(&quot;/&quot;);                // å–å‡ºå­ç½‘æ®µ                String ipSegment = allow.substring(0, splitIndex); // 192.168.3.0                // å­ç½‘æ•°                String netmask = allow.substring(splitIndex + 1);// 24                // ip è½¬äºŒè¿›åˆ¶                long ipLong = ipToLong(ip);                //å­ç½‘äºŒè¿›åˆ¶                long maskLong=(2L&lt;&lt;32 -1) -(2L &lt;&lt; Integer.valueOf(32-Integer.valueOf(netmask))-1);                // ipä¸å’Œå­ç½‘ç›¸ä¸ å¾—åˆ° ç½‘ç»œåœ°å€                String calcSegment = longToIP(ipLong &amp; maskLong);                // å¦‚æœè®¡ç®—å¾—å‡ºç½‘ç»œåœ°å€å’Œåº“ä¸­ç½‘ç»œåœ°å€ç›¸åŒ åˆ™åˆæ³•                if(ipSegment.equals(calcSegment))return true;            &#125;        &#125;        return false;    &#125;    /**     * \tæ ¹æ®IPåœ°å€ï¼ŒåŠIPç™½åå•è®¾ç½®è§„åˆ™åˆ¤æ–­IPæ˜¯å¦åŒ…å«åœ¨ç™½åå•     * @param request     * @param ipWhiteConfig     * @return     */    public static boolean isPermitedByRequest(HttpServletRequest request, String ipWhiteConfig) &#123;        String ip = getIpAddr(request);        if (null == ip || &quot;&quot;.equals(ip) || null == ipWhiteConfig)            return false;        //ipæ ¼å¼ä¸å¯¹        if(!pattern.matcher(ip).matches()) return false;        if (DEFAULT_ALLOW_ALL_FLAG.equals(ipWhiteConfig))            return true;        if (DEFAULT_DENY_ALL_FLAG.equals(ipWhiteConfig))            return false;        Set&lt;String&gt; ipList = getAvaliIpList(ipWhiteConfig.replaceAll(&quot;ï¼›&quot;, &quot;;&quot;));        return isPermited(ip, ipList);    &#125;    /**     * \tæ ¹æ®IPåœ°å€ï¼ŒåŠIPç™½åå•è®¾ç½®è§„åˆ™åˆ¤æ–­IPæ˜¯å¦åŒ…å«åœ¨ç™½åå•     * @param ip     * @param ipWhiteConfig     * @return     */    public static boolean isPermited(String ip, String ipWhiteConfig) &#123;        if (null == ip || &quot;&quot;.equals(ip) || null == ipWhiteConfig)            return false;        //ipæ ¼å¼ä¸å¯¹        if(!pattern.matcher(ip).matches()) return false;        if (DEFAULT_ALLOW_ALL_FLAG.equals(ipWhiteConfig))            return true;        if (DEFAULT_DENY_ALL_FLAG.equals(ipWhiteConfig))            return false;        Set&lt;String&gt; ipList = getAvaliIpList(ipWhiteConfig.replaceAll(&quot;ï¼›&quot;, &quot;;&quot;));        return isPermited(ip, ipList);    &#125;    private static long ipToLong(String strIP) &#123;        long[] ip = new long[4];        // å…ˆæ‰¾åˆ°IPåœ°å€å­—ç¬¦ä¸²ä¸­.çš„ä½ç½®        int position1 = strIP.indexOf(&quot;.&quot;);        int position2 = strIP.indexOf(&quot;.&quot;, position1 + 1);        int position3 = strIP.indexOf(&quot;.&quot;, position2 + 1);        // å°†æ¯ä¸ª.ä¹‹é—´çš„å­—ç¬¦ä¸²è½¬æ¢æˆæ•´å‹        ip[0] = Long.parseLong(strIP.substring(0, position1));        ip[1] = Long.parseLong(strIP.substring(position1 + 1, position2));        ip[2] = Long.parseLong(strIP.substring(position2 + 1, position3));        ip[3] = Long.parseLong(strIP.substring(position3 + 1));        return (ip[0] &lt;&lt; 24) + (ip[1] &lt;&lt; 16) + (ip[2] &lt;&lt; 8) + ip[3];    &#125;    // å°†10è¿›åˆ¶æ•´æ•°å½¢å¼è½¬æ¢æˆ127.0.0.1å½¢å¼çš„IPåœ°å€    private static String longToIP(long longIP) &#123;        StringBuilder sb = new StringBuilder(&quot;&quot;);        // ç›´æ¥å³ç§»24ä½        sb.append(String.valueOf(longIP &gt;&gt;&gt; 24));        sb.append(&quot;.&quot;);        // å°†é«˜8ä½ç½®0ï¼Œç„¶åå³ç§»16ä½        sb.append(String.valueOf((longIP &amp; 0x00FFFFFF) &gt;&gt;&gt; 16));        sb.append(&quot;.&quot;);        sb.append(String.valueOf((longIP &amp; 0x0000FFFF) &gt;&gt;&gt; 8));        sb.append(&quot;.&quot;);        sb.append(String.valueOf(longIP &amp; 0x000000FF));        return sb.toString();    &#125;    public static void main(String[] args) &#123;        String ipWhilte = &quot;1.168.1.1;&quot; //è®¾ç½®å•ä¸ªIPçš„ç™½åå• //                + &quot;192.*ï¼› &quot; //è®¾ç½®ipé€šé…ç¬¦,å¯¹ä¸€ä¸ªipæ®µè¿›è¡ŒåŒ¹é…                + &quot;192.168.1.1-192.168.1.3ï¼› &quot; //è®¾ç½®ä¸€ä¸ªIPèŒƒå›´                + &quot;25.168.4.0/24 &quot;; //è¨­ç½®ä¸€ä¸ªç½‘æ®µ        System.out.println(WhiteIPInterceptor.isPermited(&quot;192.168.1.1&quot;,ipWhilte));//true    &#125;&#125;","tags":["java","ip","ç™½åå•","æ ¡éªŒ"]},{"title":"çº¿ç¨‹æ± å·¥å…·ç±»","url":"/2022/05/01/0.1.0%E7%BA%BF%E7%A8%8B%E6%B1%A0%E5%B7%A5%E5%85%B7%E7%B1%BB/","content":"1.ç¼–å†™çº¿ç¨‹æ± å·¥å…·ç±»public class ThreadUtils &#123;    public static ExecutorService newFixedThreadPool() &#123;        return new ThreadPoolExecutor(4,4, 10L, TimeUnit.MILLISECONDS,                new LinkedBlockingDeque&lt;Runnable&gt;(100),                Executors.defaultThreadFactory(),                new ThreadPoolExecutor.CallerRunsPolicy());    &#125;    /**     * ï¼ˆ1.8ç‰ˆæœ¬ï¼‰ä½¿ç”¨çº¿ç¨‹æ± è¯·æ±‚æ¥å£     */    public static &lt;T&gt; void  executerPool(List&lt;T&gt; list) throws InterruptedException &#123;        ExecutorService executorService = newFixedThreadPool();        List&lt;T&gt; collect = list.stream().filter(l -&gt; l instanceof Runnable).collect(Collectors.toList());        final CountDownLatch count=new CountDownLatch(collect.size());        for (T runnable : collect) &#123;            Customers customers = (Customers) runnable;            customers.counts(count);            executorService.execute(customers);        &#125;        count.await();        executorService.shutdown();    &#125;    /**     * ï¼ˆ1.7ç‰ˆæœ¬ï¼‰ä½¿ç”¨çº¿ç¨‹æ± è¯·æ±‚æ¥å£     */    public static &lt;T&gt; void  executerPool2(List&lt;T&gt; list) throws InterruptedException &#123;        ExecutorService executorService = newFixedThreadPool();        List&lt;Customers&gt; runnables = new ArrayList&lt;&gt;();        for (T t : list) &#123;            if(t instanceof Customers)&#123;                runnables.add((Customers) t);            &#125;        &#125;        final CountDownLatch count=new CountDownLatch(runnables.size());        for (Customers runnable : runnables) &#123;            runnable.counts(count);            executorService.execute(runnable);        &#125;        count.await();        executorService.shutdown();    &#125;&#125;\n\n2.å®šä¹‰æ¥å£ThreadFactoryså’ŒCustomerspublic interface ThreadFactorys&#123;    public abstract void counts(CountDownLatch countDownLatch);&#125;\n\npublic interface Customers extends Runnable,ThreadFactorys&#123;&#125;\n\n3.ç»§æ‰¿Customerspublic class InterfaceRunnable implements Customers&#123;    private String name;    // çº¿ç¨‹è®¡æ•°å™¨    private CountDownLatch count;    public InterfaceRunnable(String name) &#123;        this.name = name;    &#125;    @Override    public void run() &#123;        // æ‰§è¡Œæ–¹æ³•        System.out.println(name);        count.countDown();    &#125;    @Override    public void counts(CountDownLatch countDownLatch) &#123;        this.count = countDownLatch;    &#125;&#125;\n4.ä½¿ç”¨å·¥å…·ç±»è¿›è¡Œè°ƒç”¨ï¼ˆåªéœ€è¦æŠŠéœ€è¦æ‰§è¡Œçš„ç±»ç»§æ‰¿runnableæ–¹æ³•ï¼Œç„¶åç”¨listä¸¢å…¥å·¥å…·ç±»å°±è¡Œäº†ï¼‰public class ThreadController &#123;    public static void main(String[] args) throws InterruptedException &#123;        List&lt;InterfaceRunnable&gt; list = new ArrayList&lt;&gt;();        for (int i = 0; i &lt; 10; i++) &#123;            list.add(new InterfaceRunnable(&quot;æ–¹æ³•è°ƒç”¨:&quot;+i));        &#125;        ThreadUtils.executerPool(list);    &#125;&#125;","tags":["å·¥å…·ç±»","ç®—æ³•å…¬å¼"]},{"title":"javaæ–‡ä»¶ç”¨GZipå‹ç¼©gz","url":"/2022/04/04/0.1.4java%E6%96%87%E4%BB%B6%E5%8E%8B%E7%BC%A9/","content":"æè¿°ï¼šåˆ©ç”¨Gzipè¿›è¡Œæ–‡ä»¶å‹ç¼©\npackage com.util;import java.io.*;import java.util.zip.GZIPInputStream;import java.util.zip.GZIPOutputStream;public class GZipUtils &#123;    public static final int BUFFER = 1024;    public static final String EXT = &quot;.gz&quot;;   public static void main(String[] args) throws Exception &#123;       String userHome = System.getProperties().getProperty(&quot;user.home&quot;); // ç”¨æˆ·ç›®å½•ï¼Œå¦‚ï¼šC:\\Users\\chushiyun       String fileName = userHome+&quot;/01.jpg&quot;; // ç”¨æˆ·ç›®å½•ä¸‹çš„01.jpg ä¼šè¢«å‹ç¼©æˆ01.jpg.gz       compress(new File(fileName));   &#125;    /**     * æ•°æ®å‹ç¼©     *     * @param data     * @return     * @throws Exception     */    public static byte[] compress(byte[] data) throws Exception &#123;        ByteArrayInputStream bais = new ByteArrayInputStream(data);        ByteArrayOutputStream baos = new ByteArrayOutputStream();        // å‹ç¼©        compress(bais, baos);        byte[] output = baos.toByteArray();        baos.flush();        baos.close();        bais.close();        return output;    &#125;    /**     * æ–‡ä»¶å‹ç¼©     *     * @param file     * @throws Exception     */    public static void compress(File file) throws Exception &#123;        compress(file, true);    &#125;    /**     * æ–‡ä»¶å‹ç¼©     *     * @param file     * @param delete     *            æ˜¯å¦åˆ é™¤åŸå§‹æ–‡ä»¶     * @throws Exception     */    public static void compress(File file, boolean delete) throws Exception &#123;        FileInputStream fis = new FileInputStream(file);        FileOutputStream fos = new FileOutputStream(file.getPath() + EXT);        compress(fis, fos);        fis.close();        fos.flush();        fos.close();        if (delete) &#123;            file.delete();        &#125;    &#125;    /**     * æ•°æ®å‹ç¼©     *     * @param is     * @param os     * @throws Exception     */    public static void compress(InputStream is, OutputStream os)            throws Exception &#123;        GZIPOutputStream gos = new GZIPOutputStream(os);        int count;        byte data[] = new byte[BUFFER];        while ((count = is.read(data, 0, BUFFER)) != -1) &#123;            gos.write(data, 0, count);        &#125;        gos.finish();        gos.flush();        gos.close();    &#125;    /**     * æ–‡ä»¶å‹ç¼©     *     * @param path     * @throws Exception     */    public static void compress(String path) throws Exception &#123;        compress(path, true);    &#125;    /**     * æ–‡ä»¶å‹ç¼©     *     * @param path     * @param delete     *            æ˜¯å¦åˆ é™¤åŸå§‹æ–‡ä»¶     * @throws Exception     */    public static void compress(String path, boolean delete) throws Exception &#123;        File file = new File(path);        compress(file, delete);    &#125;    /**     * æ•°æ®è§£å‹ç¼©     *     * @param data     * @return     * @throws Exception     */    public static byte[] decompress(byte[] data) throws Exception &#123;        ByteArrayInputStream bais = new ByteArrayInputStream(data);        ByteArrayOutputStream baos = new ByteArrayOutputStream();        // è§£å‹ç¼©        decompress(bais, baos);        data = baos.toByteArray();        baos.flush();        baos.close();        bais.close();        return data;    &#125;    /**     * æ–‡ä»¶è§£å‹ç¼©     *     * @param file     * @throws Exception     */    public static void decompress(File file) throws Exception &#123;        decompress(file, true);    &#125;    /**     * æ–‡ä»¶è§£å‹ç¼©     *     * @param file     * @param delete     *            æ˜¯å¦åˆ é™¤åŸå§‹æ–‡ä»¶     * @throws Exception     */    public static void decompress(File file, boolean delete) throws Exception &#123;        FileInputStream fis = new FileInputStream(file);        FileOutputStream fos = new FileOutputStream(file.getPath().replace(EXT,                &quot;&quot;));        decompress(fis, fos);        fis.close();        fos.flush();        fos.close();        if (delete) &#123;            file.delete();        &#125;    &#125;    /**     * æ•°æ®è§£å‹ç¼©     *     * @param is     * @param os     * @throws Exception     */    public static void decompress(InputStream is, OutputStream os)            throws Exception &#123;        GZIPInputStream gis = new GZIPInputStream(is);        int count;        byte data[] = new byte[BUFFER];        while ((count = gis.read(data, 0, BUFFER)) != -1) &#123;            os.write(data, 0, count);        &#125;        gis.close();    &#125;    /**     * æ–‡ä»¶è§£å‹ç¼©     *     * @param path     * @throws Exception     */    public static void decompress(String path) throws Exception &#123;        decompress(path, true);    &#125;    /**     * æ–‡ä»¶è§£å‹ç¼©     *     * @param path     * @param delete     *            æ˜¯å¦åˆ é™¤åŸå§‹æ–‡ä»¶     * @throws Exception     */    public static void decompress(String path, boolean delete) throws Exception &#123;        File file = new File(path);        decompress(file, delete);    &#125;&#125;","tags":["java","gzip","å‹ç¼©"]},{"title":"mysqlåˆ›å»ºå®šæ—¶ä»»åŠ¡","url":"/2022/04/23/0.1.6mysql%E5%88%9B%E5%BB%BA%E5%AE%9A%E6%97%B6%E4%BB%BB%E5%8A%A1/","content":"\néœ€æ±‚ï¼šå®šæ—¶åˆ é™¤ä¸‰ä¸ªæœˆä¹‹å‰çš„æ•°æ®\n\n1.ç¼–å†™éœ€è¦æ‰§è¡Œçš„sqlè¯­å¥\n## å› ä¸ºè¡¨æ•°æ®è¿‡å¤§ï¼ˆå¤§çº¦2äº¿æ•°æ®ï¼‰ï¼Œéœ€è¦å…ˆæŸ¥è¯¢ä¸‰ä¸ªæœˆä¹‹å‰çš„idèŠ‚ç‚¹ï¼Œå¢åŠ æŸ¥è¯¢é€Ÿåº¦select MAX(id) from other_log_info where DATE_FORMAT(createtime,&#x27;%Y-%m-%d&#x27;) = DATE_SUB(CURDATE(),INTERVAL 3 MONTH);## æŸ¥è¯¢çš„sqlä¸€æ¬¡ä¸èƒ½åˆ é™¤å¤ªå¤šæ•°æ®ï¼Œé˜²æ­¢é”è¡¨select * from other_log_info where id &lt; (select MAX(id) from other_log_info where DATE_FORMAT(createtime,&#x27;%Y-%m-%d&#x27;) = DATE_SUB(CURDATE(),INTERVAL 3 MONTH)) LIMIT 0,1000## ç”±äºdeleteä¸èƒ½ç›´æ¥åˆ é™¤å­æŸ¥è¯¢è¡¨ä¸­çš„æ•°æ®ï¼Œå¿…é¡»ç”¨è¿‡åµŒå¥—ä¸€å±‚çš„æ–¹å¼æ¥è§£å†³## ç¬¬äºŒç§æ‰§è¡Œæ–¹å¼ï¼Œå¦‚æœå¯¹äºsqlæ¯”è¾ƒç†Ÿæ‚‰ï¼Œå¯ä»¥ç”¨å­˜å‚¨è¿‡ç¨‹çš„&quot;æ¸¸æ ‡&quot;è¿›è¡Œå¾ªç¯DELETE FROM other_log_info where id in \t(select t2.id from \t\t(select id from other_log_info where \t\t\tid &lt; (select MAX(id) from other_log_info where createtime &lt; DATE_SUB(CURDATE(),INTERVAL 3 MONTH)) LIMIT 0,1000) t2)\n\næ¸¸æ ‡ä½¿ç”¨æ–¹å¼ï¼šhttps://www.cnblogs.com/cbt-home/p/15269736.html\n\nCURDATE() è¿”å›å½“å‰æ—¥æœŸ\nCURNOW() è¿”å›å½“å‰datetime\nINTERVAL æ˜¯mysqlé—´éš”å€¼ï¼Œç”¨æ³•ä¸ºINTERVAL expr unitã€‚INTERVAL 3 DAYè¡¨ç¤ºä¸‰å¤©çš„é—´éš”\nDATE_SUB(start_date,INTERVAL expr unit);\n\n2.ç¼–å†™å­˜å‚¨è¿‡ç¨‹\nå­˜å‚¨è¿‡ç¨‹ç›¸å½“äºmysqlçš„å‡½æ•°ï¼Œå®ƒæ˜¯å­˜å‚¨åœ¨æ•°æ®åº“æœåŠ¡å™¨ä¸­çš„ä¸€ç»„sqlè¯­å¥ï¼Œé€šè¿‡è°ƒç”¨è¿™ä¸ªå‡½æ•°çš„åç§°æ¥æ‰§è¡Œè¿™äº›sqlè¯­å¥å‘½ä»¤ã€‚\n-- åˆ†éš”ç¬¦åˆ‡æ¢é˜²æ­¢â€œ;â€ç›´æ¥åˆ†éš”äº†DELIMITER //-- åˆ›å»ºå­˜å‚¨è¿‡ç¨‹CREATE procedure del_log2()BEGIN\tSELECT * FROM xxl_job_log WHERE trigger_time &lt; DATE_SUB(CURDATE(),INTERVAL 5 MONTH);END //DELIMITER ;\n\n\nDELIMITERæ˜¯åˆ†å‰²ç¬¦çš„æ„æ€ï¼Œå£°æ˜å­˜å‚¨è¿‡ç¨‹å‰å°†&quot;//&quot;å£°æ˜ä¸ºåˆ†éš”ç¬¦ï¼Œè¿™æ ·å­˜å‚¨è¿‡ç¨‹ä¸­çš„â€œ;â€æ‰ä¸ä¼šè¢«å½“ä½œåˆ†éš”ç¬¦å¤„ç†ã€‚å£°æ˜ç»“æŸåå†è¿˜åŸåˆ†éš”ç¬¦ã€‚\nå­˜å‚¨è¿‡ç¨‹ä¹Ÿå¯ä»¥å¸¦å‚æ•°ï¼Œå­˜å‚¨è¿‡ç¨‹å(å‚æ•°)\nåœ¨å£°æ˜å­˜å‚¨è¿‡ç¨‹å‰è¦å…ˆç”¨use database_nameåˆ‡æ¢åˆ°æƒ³è¦åº”ç”¨çš„æ•°æ®åº“ï¼Œå¦åˆ™å­˜å‚¨è¿‡ç¨‹ä¼šåº”ç”¨åˆ°é»˜è®¤æ•°æ®åº“ä¸­\n\næŸ¥çœ‹å­˜å‚¨è¿‡ç¨‹\n-- dbæŒ‡çš„æ•°æ®åº“åselect * from mysql.proc where db = &quot;xxl_job&quot;\n\nè°ƒç”¨å­˜å‚¨è¿‡ç¨‹\ncall del_log();\n\n3.ç¼–å†™äº‹ä»¶è°ƒåº¦å™¨ï¼ˆå®šæ—¶ä»»åŠ¡ï¼‰\n-- ç¡®è®¤æ˜¯å¦å¼€å¯äº‹ä»¶è°ƒåº¦å™¨SHOW VARIABLES LIKE &#x27;event_scheduler&#x27;;-- å¼€å¯äº‹ä»¶è°ƒåº¦å™¨SET GLOBAL event_scheduler = ON;\n\nåˆ›å»ºäº‹ä»¶\n-- åˆ›å»ºè°ƒåº¦ä»»åŠ¡(ä»2022-4-22å¼€å§‹ï¼Œæ¯å¤©æ‰§è¡Œä¸€æ¬¡del_data())create event del_event  on schedule EVERY 1 day  STARTS &#x27;2022-4-22 00:00:00&#x27; do call del_data()\n\næŸ¥çœ‹äº‹ä»¶\n-- æŸ¥çœ‹äº‹ä»¶SHOW EVENTS;\n\n\n\n\n","tags":["mysql","å®šæ—¶ä»»åŠ¡"]},{"title":"rediså­˜å‚¨Data truncation: Incorrect datetime value","url":"/2022/03/07/0.1.7redis%E5%AD%98%E5%82%A8Data-truncation-Incorrect-datetime-value/","content":"æœ€è¿‘åœ¨ç¼–å†™é¡¹ç›®æ—¶ï¼Œç”¨rediså­˜å‚¨ç»“æœä¸€ç›´æŠ¥è½¬æ¢å¼‚å¸¸å¯¹æ­¤æˆ‘æœ‰äº†ä»¥ä¸‹æ€è·¯1.åœ¨mysqlè¿›è¡Œæ ¼å¼è½¬æ¢2.åœ¨javaå…ˆè½¬æ¢3.å­˜jsonä¹‹å‰å°±è¿›è¡Œæ ¼å¼è½¬æ¢\nä½†æ˜¯ä»¥ä¸Šæ–¹æ³•éƒ½ä¸è¡Œï¼Œå› ä¸ºæ•°æ®éœ€è¦çš„æ˜¯dateç±»å‹ï¼Œå¦‚æœèµ°è½¬æ¢åˆè¿‡æ…¢æœ‰å¤§ä½¬æäº†ä¸€ä¸‹ä½¿ç”¨åºåˆ—åŒ–è§£å†³ï¼Œæˆ‘å°±å°è¯•äº†ä¸€ä¸‹ï¼Œè¿˜çœŸå¯ä»¥,ä»¥ä¸‹æ˜¯æˆ‘ç¼–å†™æ€è·¯1.é¦–å…ˆéœ€è¦åºåˆ—åŒ–çš„ç±»ç»§æ‰¿Serializableæ¥å£2.ç¼–å†™åºåˆ—åŒ–å·¥å…·ç±»\npackage com.tiantai.policy.utils;import java.io.*;public class SerializeUtil &#123;    // åºåˆ—åŒ–    public static byte[] serialize(Object object) &#123;        ObjectOutputStream oos = null;        ByteArrayOutputStream baos = null;        byte[] bytes = null;        try &#123;            baos = new ByteArrayOutputStream();            oos = new ObjectOutputStream(baos);            oos.writeObject(object);            bytes = baos.toByteArray();        &#125; catch (Exception e) &#123;            System.err.println(&quot;åºåˆ—åŒ–å¤±è´¥&quot; + e.getMessage());        &#125;        return bytes;    &#125;    // ååºåˆ—åŒ–    public static Object deserialize(byte[] bytes) throws IOException, ClassNotFoundException &#123;        ByteArrayInputStream bais = null;        ObjectInputStream ois = null;        try &#123;            bais = new ByteArrayInputStream(bytes);            ois = new ObjectInputStream(bais);        &#125; catch (Exception e) &#123;            System.err.println(&quot;ååºåˆ—åŒ–å¤±è´¥&quot; + e.getMessage());        &#125;        return ois.readObject();    &#125;&#125;\n3.ä½¿ç”¨åºåˆ—åŒ–å­˜å‚¨\nHashMap&lt;Integer , Object&gt; objectObjectHashMap = new HashMap&lt;&gt;();                                objectObjectHashMap.put(airChannelEnum.getType(), SerializeUtil.serialize(selectPage));                                redisTemplate.opsForList().leftPush(&quot;error&quot;,gson.toJson(objectObjectHashMap));\n4.ååºåˆ—åŒ–è¯»å–\nPage deserialize = (Page)SerializeUtil.deserialize(entry.getValue());\nç¬¬ä¸€ä¸ªçº¢æ¡†æ˜¯æˆ‘ç”¨gsonè¿›è¡Œjsonè½¬æ¢ç¬¬äºŒä¸ªçº¢æ¡†æ˜¯åºåˆ—åŒ–åå¼ºè½¬ä¸ºåŸå¯¹è±¡\n","tags":["java","redis","bug"]},{"title":"redisé”","url":"/2022/02/23/0.1.8redis%E9%94%81/","content":"æš‚æ—¶æ²¡æ—¶é—´æ•´ç»†èŠ‚ï¼Œç»™ä¸ªç²—ç•¥çš„è®°å½•ä¸€ä¸‹\npackage com.util.qunar;import com.service.qunar.FQunarSearchService;import com.service.zl.ValidationCabinAndPrice_QNR;import org.apache.log4j.Logger;import org.redisson.Redisson;import org.redisson.api.RLock;import org.redisson.api.RedissonClient;import org.redisson.config.Config;import org.springframework.beans.factory.InitializingBean;import org.springframework.beans.factory.annotation.Autowired;import org.springframework.stereotype.Service;import java.util.concurrent.TimeUnit;@Servicepublic class RedissonTemplate &#123;    private static volatile RedissonClient redissonClient;    private static final String LOCK_TITLE = &quot;QNRLock_&quot;;    /**     * åŠ é”     * @param lockName     * @param waitTime     * @param timeOutSecond     * @return     */    public static boolean acquireSecond(String lockName, Integer waitTime, Integer timeOutSecond)&#123;        try &#123;            String key = LOCK_TITLE + lockName;            RLock mylock = redisLock().getLock(key);            //lockæä¾›å¸¦timeoutå‚æ•°ï¼Œtimeoutç»“æŸå¼ºåˆ¶è§£é”ï¼Œé˜²æ­¢æ­»é”            //å…ˆå°è¯•åœ¨è¶…æ—¶æ—¶é—´å†…è·å–é”ï¼Œå¦‚æœæ²¡æœ‰è·å–åˆ°ï¼Œæ­¤æ—¶å¦‚æœç­‰å¾…æ—¶é—´è¿˜æœ‰å‰©ä½™è¿›å…¥å¾ªç¯ä¸æ–­å–å°è¯•è·å–é” ç›´åˆ°æ—¶é—´ç»“æŸé€€å‡º  å¾ªç¯ä¸­æ˜¯è®¢é˜…ï¼Œæ—¶é—´ç»“æŸå–æ¶ˆè®¢é˜…            return mylock.tryLock(waitTime, timeOutSecond, TimeUnit.SECONDS);        &#125; catch (InterruptedException e) &#123;            System.out.println(e);        &#125;        return false;    &#125;    /**     * è¿æ¥redis     * @return     */    private static RedissonClient redisLock()&#123;        if(redissonClient == null)&#123;            synchronized (FQunarSearchService.class)&#123;                if(redissonClient == null)&#123;                    Config config = new Config();                    config.useSingleServer().setAddress(&quot;redis://127.0.0.1:6379&quot;)                            .setPassword(&quot;123&quot;)                            .setDatabase(17);                    redissonClient = Redisson.create(config);                &#125;            &#125;        &#125;        return redissonClient;    &#125;    /**     * è§£é”     * @param lockName     */    public static void release(String lockName)&#123;        String key = LOCK_TITLE + lockName;        RLock mylock = redissonClient.getLock(key);        mylock.unlock();    &#125;&#125;","tags":["redis","åˆ†å¸ƒå¼é”"]},{"title":"mycatç®€å•ä»‹ç»","url":"/2022/04/17/0.1.5mycat%E7%AE%80%E5%8D%95%E4%BB%8B%E7%BB%8D/","content":"MyCatä»‹ç»\nå¦‚ä»Šéšç€äº’è”ç½‘çš„å‘å±•ï¼Œæ•°æ®çš„é‡çº§ä¹Ÿæ˜¯æˆæŒ‡æ•°å¼çš„å¢é•¿ï¼Œä»GBåˆ°TBåˆ°PBã€‚å¯¹æ•°æ®çš„å„ç§æ“ä½œä¹Ÿæ˜¯æ„ˆåŠ çš„å›°éš¾ï¼Œä¼ ç»Ÿçš„å…³ç³»æ€§æ•°æ®åº“å·²ç»æ— æ³•æ»¡è¶³å¿«é€ŸæŸ¥è¯¢ä¸æ’å…¥æ•°æ®çš„éœ€æ±‚,è¿™ä¸ªæ—¶å€™NoSQLçš„å‡ºç°æš‚æ—¶è§£å†³äº†è¿™ä¸€å±æœºã€‚å®ƒé€šè¿‡é™ä½æ•°æ®çš„å®‰å…¨æ€§ï¼Œå‡å°‘å¯¹äº‹åŠ¡çš„æ”¯æŒï¼Œå‡å°‘å¯¹å¤æ‚æŸ¥è¯¢çš„æ”¯æŒï¼Œæ¥è·å–æ€§èƒ½ä¸Šçš„æå‡ã€‚ä½†æ˜¯ï¼Œåœ¨æœ‰äº›åœºåˆNoSQLä¸€äº›æŠ˜è¡·æ˜¯æ— æ³•æ»¡è¶³ä½¿ç”¨åœºæ™¯çš„ï¼Œå°±æ¯”å¦‚æœ‰äº›ä½¿ç”¨åœºæ™¯æ˜¯ç»å¯¹è¦æœ‰äº‹åŠ¡ä¸å®‰å…¨æŒ‡æ ‡çš„ã€‚è¿™ä¸ªæ—¶å€™NoSQLè‚¯å®šæ˜¯æ— æ³•æ»¡è¶³çš„ï¼Œæ‰€ä»¥è¿˜æ˜¯éœ€è¦ä½¿ç”¨å…³ç³»æ€§æ•°æ®åº“ã€‚å¦‚ä½•ä½¿ç”¨å…³ç³»å‹æ•°æ®åº“è§£å†³æµ·é‡å­˜å‚¨çš„é—®é¢˜å‘¢ï¼Ÿæ­¤æ—¶å°±éœ€è¦åšæ•°æ®åº“é›†ç¾¤ï¼Œä¸ºäº†æé«˜æŸ¥è¯¢æ€§èƒ½å°†ä¸€ä¸ªæ•°æ®åº“çš„æ•°æ®åˆ†æ•£åˆ°ä¸åŒçš„æ•°æ®åº“ä¸­å­˜å‚¨ï¼Œä¸ºåº”å¯¹æ­¤é—®é¢˜å°±å‡ºç°äº†â€”â€”MyCat ã€‚\n\nMyCATçš„ç›®æ ‡æ˜¯ï¼šä½æˆæœ¬çš„å°†ç°æœ‰çš„å•æœºæ•°æ®åº“å’Œåº”ç”¨å¹³æ»‘è¿ç§»åˆ°â€äº‘â€ç«¯ï¼Œè§£å†³æµ·é‡æ•°æ®å­˜å‚¨å’Œä¸šåŠ¡è§„æ¨¡è¿…é€Ÿå¢é•¿æƒ…å†µä¸‹çš„æ•°æ®å­˜å‚¨å’Œè®¿é—®çš„ç“¶é¢ˆé—®é¢˜ ã€‚\nMycat èƒŒåæ˜¯é˜¿é‡Œæ›¾ç»å¼€æºçš„çŸ¥åäº§å“â€”â€”Cobarï¼ŒCobar çš„æ ¸å¿ƒåŠŸèƒ½å’Œä¼˜åŠ¿æ˜¯ MySQL æ•°æ®åº“åˆ†ç‰‡\nç›¸å¯¹äºcobarçš„ä¼˜åŠ¿\n\nå¯¹ cobar çš„ä»£ç è¿›è¡Œäº†å½»åº•çš„é‡æ„ï¼ŒMycatåœ¨I/Oæ–¹é¢è¿›è¡Œäº†é‡å¤§æ”¹è¿›,å°†åŸæ¥çš„BIOæ”¹æˆäº†NIO, å¹¶å‘é‡æœ‰å¤§å¹…æé«˜ \nå¢åŠ äº†å¯¹Order Byã€Group Byã€limitç­‰èšåˆåŠŸèƒ½çš„æ”¯æŒï¼ŒåŒæ—¶å…¼å®¹ç»å¤§å¤šæ•°æ•°æ®åº“æˆä¸ºé€šç”¨çš„æ•°æ®åº“ä¸­é—´ä»¶\nå¯¹äºå¼€å‘äººå‘˜æ¥è¯´æ ¹æœ¬æ„Ÿè§‰ä¸åˆ°mycatçš„å­˜åœ¨\n\nMyCatå‘å±•åˆ°ç›®å‰çš„ç‰ˆæœ¬ï¼Œå·²ç»ä¸æ˜¯ä¸€ä¸ªå•çº¯çš„MySQLä»£ç†äº†ï¼Œå®ƒçš„åç«¯å¯ä»¥æ”¯æŒMySQLã€SQL Serverã€Oracleã€DB2ã€PostgreSQLç­‰ä¸»æµæ•°æ®åº“ï¼Œä¹Ÿæ”¯æŒMongoDBè¿™ç§æ–°å‹NoSQLæ–¹å¼çš„å­˜å‚¨ï¼Œæœªæ¥è¿˜ä¼šæ”¯æŒæ›´å¤šç±»å‹çš„å­˜å‚¨ã€‚è€Œåœ¨æœ€ç»ˆç”¨æˆ·çœ‹æ¥ï¼Œæ— è®ºæ˜¯é‚£ç§å­˜å‚¨æ–¹å¼ï¼Œåœ¨MyCaté‡Œï¼Œéƒ½æ˜¯ä¸€ä¸ªä¼ ç»Ÿçš„æ•°æ®åº“è¡¨ï¼Œæ”¯æŒæ ‡å‡†çš„SQLè¯­å¥è¿›è¡Œæ•°æ®çš„æ“ä½œï¼Œè¿™æ ·ä¸€æ¥ï¼Œå¯¹å‰ç«¯ä¸šåŠ¡ç³»ç»Ÿæ¥è¯´ï¼Œå¯ä»¥å¤§å¹…é™ä½å¼€å‘éš¾åº¦ï¼Œæå‡å¼€å‘é€Ÿåº¦\nMyCatä½¿ç”¨åœºæ™¯1.é«˜å¯ç”¨æ€§ä¸MySQLè¯»å†™åˆ†ç¦»é«˜å¯ç”¨ï¼šåˆ©ç”¨MyCatå¯ä»¥è½»æ¾å®ç°çƒ­å¤‡ä»½ï¼Œå½“ä¸€å°æœåŠ¡å™¨åœæœºæ—¶ï¼Œå¯ä»¥ç”±é›†ç¾¤ä¸­çš„å¦ä¸€å°æœåŠ¡å™¨è‡ªåŠ¨æ¥ç®¡ä¸šåŠ¡ï¼Œæ— éœ€äººå·¥å¹²é¢„ï¼Œä»è€Œä¿è¯é«˜å¯ç”¨ã€‚\nè¯»å†™åˆ†ç¦»ï¼šé€šè¿‡MySQLæ•°æ®åº“çš„binlogæ—¥å¿—å®Œæˆä¸»ä»å¤åˆ¶ï¼Œå¹¶å¯ä»¥é€šè¿‡MyCatè½»æ¾å®ç°è¯»å†™åˆ†ç¦»ï¼Œå®ç°insertã€updateã€deleteèµ°ä¸»åº“ï¼Œè€Œåœ¨selectæ—¶èµ°ä»åº“ï¼Œä»è€Œç¼“è§£å•å°æœåŠ¡å™¨çš„è®¿é—®å‹åŠ›ã€‚\n2. ä¸šåŠ¡æ•°æ®åˆ†çº§å­˜å‚¨ä¿éšœä¼ä¸šçš„æ•°æ®é‡æ€»æ˜¯æ— ä¼‘æ­¢çš„å¢é•¿ï¼Œè¿™äº›æ•°æ®çš„æ ¼å¼ä¸ä¸€æ ·ï¼Œè®¿é—®æ•ˆç‡ä¸ä¸€æ ·ï¼Œé‡è¦æ€§ä¹Ÿä¸ä¸€æ ·ã€‚å¯ä»¥é’ˆå¯¹ä¸åŒçº§åˆ«çš„æ•°æ®ï¼Œé‡‡ç”¨ä¸åŒçš„å­˜å‚¨è®¾å¤‡ï¼Œé€šè¿‡åˆ†çº§å­˜å‚¨ç®¡ç†è½¯ä»¶å®ç°æ•°æ®å®¢ä½“åœ¨å­˜å‚¨è®¾å¤‡ä¹‹é—´è‡ªåŠ¨è¿ç§»åŠè‡ªåŠ¨è®¿é—®åˆ‡æ¢\n3.å¤§è¡¨æ°´å¹³æ‹†åˆ†ï¼Œé›†ç¾¤å¹¶è¡Œè®¡ç®—æ•°æ®åˆ‡åˆ†æ˜¯MyCatçš„æ ¸å¿ƒåŠŸèƒ½ï¼Œæ˜¯æŒ‡é€šè¿‡æŸç§ç‰¹å®šçš„æ¡ä»¶ï¼Œå°†å­˜æ”¾åœ¨åŒä¸€ä¸ªæ•°æ®åº“çš„æ•°æ®ï¼Œåˆ†æ•£å­˜å‚¨åœ¨å¤šä¸ªæ•°æ®åº“ä¸­ï¼Œä»¥è¾¾åˆ°åˆ†æ•£å•å°è®¾å¤‡è´Ÿè½½çš„æ•ˆæœã€‚å½“æ•°æ®åº“é‡è¶…è¿‡800ä¸‡è¡Œä¸”éœ€è¦åšåˆ†ç‰‡æ—¶ï¼Œå°±å¯ä»¥è€ƒè™‘ä½¿ç”¨MyCatå®ç°æ•°æ®åˆ‡åˆ†ã€‚\n4.æ•°æ®åº“è·¯ç”±å™¨MyCatåŸºäºMySQLå®ä¾‹çš„è¿æ¥æ± å¤ç”¨æœºåˆ¶ï¼Œå¯ä»¥è®©æ¯ä¸ªåº”ç”¨æœ€å¤§ç¨‹åº¦å…±äº«ä¸€ä¸ªMySQLå®ä¾‹çš„æ‰€æœ‰è¿æ¥æ± ï¼Œè®©æ•°æ®åº“çš„å¹¶å‘è®¿é—®èƒ½åŠ›å¤§å¤§æå‡ã€‚\n5.æ•´åˆå¤šç§æ•°æ®æºå½“ä¸€ä¸ªé¡¹ç›®ä¸­ä½¿ç”¨äº†å¤šä¸ªæ•°æ®åº“ï¼ˆOracleï¼ŒMySQLï¼ŒSQL Server,PostgreSQLï¼‰ï¼Œå¹¶é…ç½®äº†å¤šä¸ªæ•°æ®æºï¼Œæ“ä½œèµ·æ¥å°±æ¯”è¾ƒç¹çï¼Œè¿™æ—¶å°±å¯ä»¥ä½¿ç”¨MyCatè¿›è¡Œæ•´åˆï¼Œæœ€ç»ˆæˆ‘ä»¬çš„åº”ç”¨ç¨‹åºåªéœ€è¦è®¿é—®ä¸€ä¸ªæ•°æ®æºå³å¯\nMyCatåŸç†\nMyCatç›¸å½“äºMySQLçš„Serverå±‚\nMySQLç›¸å½“äºMyCatçš„å­˜å‚¨å±‚\n\n\næ‹¦æˆªï¼šæ‹¦æˆªç”¨æˆ·å‘é€çš„sql\nåˆ†æï¼šåˆ†æåˆ†ç‰‡ï¼Œè·¯ç”±åˆ†æï¼Œè¯»å†™åˆ†ç¦»åˆ†æï¼Œç¼“å­˜åˆ†æ\nåˆ†å‘ï¼šæ ¹æ®åˆ†ç‰‡è§„åˆ™åˆ†å‘ç»™å¯¹åº”çš„æ•°æ®æº\næ‹¼æ¥ï¼šæŠŠå„æ•°æ®æºè¿”å›çš„ç»“æœèšåˆ\n\nMyCatå¯¹äºç ”å‘æ¥è¯´æ˜¯é€æ˜çš„\nMyCatä½¿ç”¨ä¸‹è½½åœ°å€: https://github.com/MyCATApache/Mycat-download\næœ€æ–°ä¸‹è½½åœ°å€: http://dl.mycat.io/\n\né…ç½®schema.xml\nschema.xml ä½œä¸ºMyCatä¸­é‡è¦çš„é…ç½®æ–‡ä»¶ä¹‹ä¸€ï¼Œç®¡ç†ç€MyCatçš„é€»è¾‘åº“ã€é€»è¾‘è¡¨ä»¥åŠå¯¹åº”çš„åˆ†ç‰‡è§„åˆ™ã€DataNodeä»¥åŠDataSourceã€‚å¼„æ‡‚è¿™äº›é…ç½®ï¼Œæ˜¯æ­£ç¡®ä½¿ç”¨MyCatçš„å‰æã€‚è¿™é‡Œå°±ä¸€å±‚å±‚å¯¹è¯¥æ–‡ä»¶è¿›è¡Œè§£æã€‚\n\n\n\n\nå±æ€§\nå«ä¹‰\n\n\n\nschema\næ ‡ç­¾ç”¨äºå®šä¹‰MyCatå®ä¾‹ä¸­çš„é€»è¾‘åº“\n\n\ntable\næ ‡ç­¾å®šä¹‰äº†MyCatä¸­çš„é€»è¾‘è¡¨, ruleç”¨äºæŒ‡å®šåˆ†ç‰‡è§„åˆ™ï¼Œauto-sharding-longçš„åˆ†ç‰‡è§„åˆ™æ˜¯æŒ‰IDå€¼çš„èŒƒå›´è¿›è¡Œåˆ†ç‰‡ 1-5000000 ä¸ºç¬¬1ç‰‡  5000001-10000000 ä¸ºç¬¬2ç‰‡â€¦.  å…·ä½“è®¾ç½®æˆ‘ä»¬ä¼šåœ¨ç¬¬å››èŠ‚ä¸­è®²è§£ã€‚\n\n\ndataNode\næ ‡ç­¾å®šä¹‰äº†MyCatä¸­çš„æ•°æ®èŠ‚ç‚¹ï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬é€šå¸¸è¯´æ‰€çš„æ•°æ®åˆ†ç‰‡ã€‚\n\n\ndataHost\næ ‡ç­¾åœ¨mycaté€»è¾‘åº“ä¸­ä¹Ÿæ˜¯ä½œä¸ºæœ€åº•å±‚çš„æ ‡ç­¾å­˜åœ¨ï¼Œç›´æ¥å®šä¹‰äº†å…·ä½“çš„æ•°æ®åº“å®ä¾‹ã€è¯»å†™åˆ†ç¦»é…ç½®å’Œå¿ƒè·³è¯­å¥ã€‚\n\n\nschema.xmlæ–‡ä»¶é…ç½®(å¯æ ¹æ®è‡ªå·±çš„éœ€æ±‚åŠ å‡é…ç½®)\n&lt;?xml version=&quot;1.0&quot;?&gt;&lt;!DOCTYPE mycat:schema SYSTEM &quot;schema.dtd&quot;&gt;&lt;mycat:schema xmlns:mycat=&quot;http://io.mycat/&quot;&gt;    &lt;!-- é€»è¾‘åº“é…ç½® --&gt;\t&lt;schema name=&quot;ITCAST&quot; checkSQLschema=&quot;false&quot; sqlMaxLimit=&quot;100&quot;&gt;        &lt;!-- é€»è¾‘è¡¨é…ç½® --&gt;\t\t&lt;table name=&quot;TB_TEST&quot; dataNode=&quot;dn1,dn2,dn3&quot; rule=&quot;auto-sharding-long&quot; /&gt;\t&lt;/schema&gt;        &lt;!-- æ•°æ®èŠ‚ç‚¹é…ç½® --&gt;\t&lt;dataNode name=&quot;dn1&quot; dataHost=&quot;host1&quot; database=&quot;db1&quot; /&gt;\t&lt;dataNode name=&quot;dn2&quot; dataHost=&quot;host2&quot; database=&quot;db1&quot; /&gt;\t&lt;dataNode name=&quot;dn3&quot; dataHost=&quot;host3&quot; database=&quot;db1&quot; /&gt;        &lt;!-- èŠ‚ç‚¹ä¸»æœºé…ç½® --&gt;\t&lt;dataHost name=&quot;host1&quot; maxCon=&quot;1000&quot; minCon=&quot;10&quot; balance=&quot;0&quot;\t\twriteType=&quot;0&quot; dbType=&quot;mysql&quot; dbDriver=&quot;native&quot; switchType=&quot;1&quot;  slaveThreshold=&quot;100&quot;&gt;\t\t&lt;heartbeat&gt;select user()&lt;/heartbeat&gt;\t\t&lt;writeHost host=&quot;hostM1&quot; url=&quot;192.168.192.157:3306&quot; user=&quot;root&quot; password=&quot;itcast&quot;&gt;&lt;/writeHost&gt;\t&lt;/dataHost&gt;\t        &lt;dataHost name=&quot;host2&quot; maxCon=&quot;1000&quot; minCon=&quot;10&quot; balance=&quot;0&quot;\t\twriteType=&quot;0&quot; dbType=&quot;mysql&quot; dbDriver=&quot;native&quot; switchType=&quot;1&quot;  slaveThreshold=&quot;100&quot;&gt;\t\t&lt;heartbeat&gt;select user()&lt;/heartbeat&gt;\t\t&lt;writeHost host=&quot;hostM1&quot; url=&quot;192.168.192.158:3306&quot; user=&quot;root&quot; password=&quot;itcast&quot;&gt;&lt;/writeHost&gt;\t&lt;/dataHost&gt;\t        &lt;dataHost name=&quot;host3&quot; maxCon=&quot;1000&quot; minCon=&quot;10&quot; balance=&quot;0&quot;\t\twriteType=&quot;0&quot; dbType=&quot;mysql&quot; dbDriver=&quot;native&quot; switchType=&quot;1&quot;  slaveThreshold=&quot;100&quot;&gt;\t\t&lt;heartbeat&gt;select user()&lt;/heartbeat&gt;\t\t&lt;writeHost host=&quot;hostM1&quot; url=&quot;192.168.192.159:3306&quot; user=&quot;root&quot; password=&quot;itcast&quot;&gt;&lt;/writeHost&gt;\t&lt;/dataHost&gt;\t    &lt;/mycat:schema&gt;\n\né…ç½®è¯¦è§£\nsystemæ ‡ç­¾\n\n\nå±æ€§\nå–å€¼\nå«ä¹‰\n\n\n\ncharset\nutf8\nè®¾ç½®Mycatçš„å­—ç¬¦é›†, å­—ç¬¦é›†éœ€è¦ä¸MySQLçš„å­—ç¬¦é›†ä¿æŒä¸€è‡´\n\n\nnonePasswordLogin\n0,1\n0ä¸ºéœ€è¦å¯†ç ç™»é™†ã€1ä¸ºä¸éœ€è¦å¯†ç ç™»é™† ,é»˜è®¤ä¸º0ï¼Œè®¾ç½®ä¸º1åˆ™éœ€è¦æŒ‡å®šé»˜è®¤è´¦æˆ·\n\n\nuseHandshakeV10\n0,1\nä½¿ç”¨è¯¥é€‰é¡¹ä¸»è¦çš„ç›®çš„æ˜¯ä¸ºäº†èƒ½å¤Ÿå…¼å®¹é«˜ç‰ˆæœ¬çš„jdbcé©±åŠ¨, æ˜¯å¦é‡‡ç”¨HandshakeV10Packetæ¥ä¸clientè¿›è¡Œé€šä¿¡, 1:æ˜¯, 0:å¦\n\n\nuseSqlStat\n0,1\nå¼€å¯SQLå®æ—¶ç»Ÿè®¡, 1 ä¸ºå¼€å¯ , 0 ä¸ºå…³é—­ ;å¼€å¯ä¹‹å, MyCatä¼šè‡ªåŠ¨ç»Ÿè®¡SQLè¯­å¥çš„æ‰§è¡Œæƒ…å†µ ;mysql -h 127.0.0.1 -P 9066 -u root -pæŸ¥çœ‹MyCatæ‰§è¡Œçš„SQL, æ‰§è¡Œæ•ˆç‡æ¯”è¾ƒä½çš„SQL , SQLçš„æ•´ä½“æ‰§è¡Œæƒ…å†µã€è¯»å†™æ¯”ä¾‹ç­‰ ;show @@sql ; show @@sql.slow ; show @@sql.sum ;\n\n\nuseGlobleTableCheck\n0,1\næ˜¯å¦å¼€å¯å…¨å±€è¡¨çš„ä¸€è‡´æ€§æ£€æµ‹ã€‚1ä¸ºå¼€å¯ ï¼Œ0ä¸ºå…³é—­ ã€‚\n\n\nsqlExecuteTimeout\n1000\nSQLè¯­å¥æ‰§è¡Œçš„è¶…æ—¶æ—¶é—´ , å•ä½ä¸º s ;\n\n\nsequnceHandlerType\n0,1,2\nç”¨æ¥æŒ‡å®šMycatå…¨å±€åºåˆ—ç±»å‹ï¼Œ0 ä¸ºæœ¬åœ°æ–‡ä»¶ï¼Œ1 ä¸ºæ•°æ®åº“æ–¹å¼ï¼Œ2 ä¸ºæ—¶é—´æˆ³åˆ—æ–¹å¼ï¼Œé»˜è®¤ä½¿ç”¨æœ¬åœ°æ–‡ä»¶æ–¹å¼ï¼Œæ–‡ä»¶æ–¹å¼ä¸»è¦ç”¨äºæµ‹è¯•\n\n\nsequnceHandlerPattern\næ­£åˆ™è¡¨è¾¾å¼\nå¿…é¡»å¸¦æœ‰MYCATSEQ_æˆ–è€… mycatseq_è¿›å…¥åºåˆ—åŒ¹é…æµç¨‹ æ³¨æ„MYCATSEQ_æœ‰ç©ºæ ¼çš„æƒ…å†µ\n\n\nsubqueryRelationshipCheck\ntrue,false\nå­æŸ¥è¯¢ä¸­å­˜åœ¨å…³è”æŸ¥è¯¢çš„æƒ…å†µä¸‹,æ£€æŸ¥å…³è”å­—æ®µä¸­æ˜¯å¦æœ‰åˆ†ç‰‡å­—æ®µ .é»˜è®¤ false\n\n\nuseCompression\n0,1\nå¼€å¯mysqlå‹ç¼©åè®® , 0 : å…³é—­, 1 : å¼€å¯\n\n\nfakeMySQLVersion\n5.5,5.6\nè®¾ç½®æ¨¡æ‹Ÿçš„MySQLç‰ˆæœ¬å·\n\n\ndefaultSqlParser\n\nç”±äºMyCatçš„æœ€åˆç‰ˆæœ¬ä½¿ç”¨äº†FoundationDBçš„SQLè§£æå™¨, åœ¨MyCat1.3åå¢åŠ äº†Druidè§£æå™¨, æ‰€ä»¥è¦è®¾ç½®defaultSqlParserå±æ€§æ¥æŒ‡å®šé»˜è®¤çš„è§£æå™¨; è§£æå™¨æœ‰ä¸¤ä¸ª : druidparser å’Œ fdbparser, åœ¨MyCat1.4ä¹‹å,é»˜è®¤æ˜¯druidparser, fdbparserå·²ç»åºŸé™¤äº†\n\n\nprocessors\n1,2â€¦.\næŒ‡å®šç³»ç»Ÿå¯ç”¨çš„çº¿ç¨‹æ•°é‡, é»˜è®¤å€¼ä¸ºCPUæ ¸å¿ƒ x æ¯ä¸ªæ ¸å¿ƒè¿è¡Œçº¿ç¨‹æ•°é‡; processors ä¼šå½±å“processorBufferPool, processorBufferLocalPercent, processorExecutorå±æ€§, æ‰€æœ‰, åœ¨æ€§èƒ½è°ƒä¼˜æ—¶, å¯ä»¥é€‚å½“åœ°ä¿®æ”¹processorså€¼\n\n\nprocessorBufferChunk\n\næŒ‡å®šæ¯æ¬¡åˆ†é…Socket Direct Bufferé»˜è®¤å€¼ä¸º4096å­—èŠ‚, ä¹Ÿä¼šå½±å“BufferPoolé•¿åº¦, å¦‚æœä¸€æ¬¡æ€§è·å–å­—èŠ‚è¿‡å¤šè€Œå¯¼è‡´bufferä¸å¤Ÿç”¨, åˆ™ä¼šå‡ºç°è­¦å‘Š, å¯ä»¥è°ƒå¤§è¯¥å€¼\n\n\nprocessorExecutor\n\næŒ‡å®šNIOProcessorä¸Šå…±äº« businessExecutorå›ºå®šçº¿ç¨‹æ± çš„å¤§å°; MyCatæŠŠå¼‚æ­¥ä»»åŠ¡äº¤ç»™ businessExecutorçº¿ç¨‹æ± ä¸­, åœ¨æ–°ç‰ˆæœ¬çš„MyCatä¸­è¿™ä¸ªè¿æ¥æ± ä½¿ç”¨é¢‘æ¬¡ä¸é«˜, å¯ä»¥é€‚å½“åœ°æŠŠè¯¥å€¼è°ƒå°\n\n\npacketHeaderSize\n\næŒ‡å®šMySQLåè®®ä¸­çš„æŠ¥æ–‡å¤´é•¿åº¦, é»˜è®¤4ä¸ªå­—èŠ‚\n\n\nmaxPacketSize\n\næŒ‡å®šMySQLåè®®å¯ä»¥æºå¸¦çš„æ•°æ®æœ€å¤§å¤§å°, é»˜è®¤å€¼ä¸º16M\n\n\nidleTimeout\n30\næŒ‡å®šè¿æ¥çš„ç©ºé—²æ—¶é—´çš„è¶…æ—¶é•¿åº¦;å¦‚æœè¶…æ—¶,å°†å…³é—­èµ„æºå¹¶å›æ”¶, é»˜è®¤30åˆ†é’Ÿ\n\n\ntxIsolation\n1,2,3,4\nåˆå§‹åŒ–å‰ç«¯è¿æ¥çš„äº‹åŠ¡éš”ç¦»çº§åˆ«,é»˜è®¤ä¸º REPEATED_READ , å¯¹åº”æ•°å­—ä¸º3READ_UNCOMMITED=1;READ_COMMITTED=2;REPEATED_READ=3;SERIALIZABLE=4;\n\n\nsqlExecuteTimeout\n300\næ‰§è¡ŒSQLçš„è¶…æ—¶æ—¶é—´, å¦‚æœSQLè¯­å¥æ‰§è¡Œè¶…æ—¶,å°†å…³é—­è¿æ¥; é»˜è®¤300ç§’;\n\n\nserverPort\n8066\nå®šä¹‰MyCatçš„ä½¿ç”¨ç«¯å£, é»˜è®¤8066\n\n\nmanagerPort\n9066\nå®šä¹‰MyCatçš„ç®¡ç†ç«¯å£, é»˜è®¤9066\n\n\nserver.xmlé…ç½®\nserver.xmlå‡ ä¹ä¿å­˜äº†æ‰€æœ‰mycatéœ€è¦çš„ç³»ç»Ÿé…ç½®ä¿¡æ¯ã€‚æœ€å¸¸ç”¨çš„æ˜¯åœ¨æ­¤é…ç½®ç”¨æˆ·åã€å¯†ç åŠæƒé™ã€‚åœ¨systemä¸­æ·»åŠ UTF-8å­—ç¬¦é›†è®¾ç½®ï¼Œå¦åˆ™å­˜å‚¨ä¸­æ–‡ä¼šå‡ºç°é—®å·\n\n&lt;property name=&quot;charset&quot;&gt;utf8&lt;/property&gt;\n\nä¿®æ”¹userçš„è®¾ç½® ,  æˆ‘ä»¬è¿™é‡Œä¸º ITCAST è®¾ç½®äº†ä¸¤ä¸ªç”¨æˆ· : \n&lt;user name=&quot;root&quot;&gt;    &lt;property name=&quot;password&quot;&gt;123456&lt;/property&gt;    &lt;property name=&quot;schemas&quot;&gt;ITCAST&lt;/property&gt;&lt;/user&gt;&lt;user name=&quot;test&quot;&gt;    &lt;property name=&quot;password&quot;&gt;123456&lt;/property&gt;    &lt;property name=&quot;schemas&quot;&gt;ITCAST&lt;/property&gt;&lt;/user&gt;\n\nuseræ ‡ç­¾&lt;user name=&quot;root&quot; defaultAccount=&quot;true&quot;&gt;    &lt;property name=&quot;password&quot;&gt;123456&lt;/property&gt;    &lt;property name=&quot;schemas&quot;&gt;ITCAST&lt;/property&gt;    &lt;property name=&quot;readOnly&quot;&gt;true&lt;/property&gt;    &lt;property name=&quot;benchmark&quot;&gt;1000&lt;/property&gt;    &lt;property name=&quot;usingDecrypt&quot;&gt;0&lt;/property&gt;        &lt;!-- è¡¨çº§ DML æƒé™è®¾ç½® --&gt;    &lt;!-- \t\t    &lt;privileges check=&quot;false&quot;&gt;        &lt;schema name=&quot;TESTDB&quot; dml=&quot;0110&quot; &gt;            &lt;table name=&quot;tb01&quot; dml=&quot;0000&quot;&gt;&lt;/table&gt;            &lt;table name=&quot;tb02&quot; dml=&quot;1111&quot;&gt;&lt;/table&gt;        &lt;/schema&gt;    &lt;/privileges&gt;\t\t    --&gt;&lt;/user&gt;\n\nuseræ ‡ç­¾ä¸»è¦ç”¨äºå®šä¹‰ç™»å½•MyCatçš„ç”¨æˆ·å’Œæƒé™ :\n1). &lt;user name=â€rootâ€ defaultAccount=â€trueâ€&gt; : name å±æ€§ç”¨äºå£°æ˜ç”¨æˆ·å ;\n2). &lt;property name=â€passwordâ€&gt;123456&lt;/property&gt; : æŒ‡å®šè¯¥ç”¨æˆ·åè®¿é—®MyCatçš„å¯†ç  ;\n3). &lt;property name=â€schemasâ€&gt;ITCAST&lt;/property&gt; : èƒ½å¤Ÿè®¿é—®çš„é€»è¾‘åº“, å¤šä¸ªçš„è¯, ä½¿ç”¨ â€œ,â€ åˆ†å‰²\n4). &lt;property name=â€readOnlyâ€&gt;true&lt;/property&gt; : æ˜¯å¦åªè¯»\n5). &lt;property name=â€benchmarkâ€&gt;11111&lt;/property&gt; : æŒ‡å®šå‰ç«¯çš„æ•´ä½“è¿æ¥æ•°é‡ , 0 æˆ–ä¸è®¾ç½®è¡¨ç¤ºä¸é™åˆ¶ \n6). &lt;property name=â€usingDecryptâ€&gt;0&lt;/property&gt; : æ˜¯å¦å¯¹å¯†ç åŠ å¯†é»˜è®¤ 0 å¦ , 1 æ˜¯\njava -cp Mycat-server-1.6.7.3-release.jar io.mycat.util.DecryptUtil 0:root:123456\n\n7). &lt;privileges check=â€falseâ€&gt;\nA. å¯¹ç”¨æˆ·çš„ schema åŠ ä¸‹çº§çš„ table è¿›è¡Œç²¾ç»†åŒ–çš„ DML æƒé™æ§åˆ¶; \nB. privileges èŠ‚ç‚¹ä¸­çš„ check å±æ€§æ˜¯ç”¨ äºæ ‡è¯†æ˜¯å¦å¼€å¯ DML æƒé™æ£€æŸ¥ï¼Œ é»˜è®¤ false æ ‡è¯†ä¸æ£€æŸ¥ï¼Œå½“ç„¶ privileges èŠ‚ç‚¹ä¸é…ç½®ï¼Œç­‰åŒ check=false, ç”±äº Mycat ä¸€ä¸ªç”¨æˆ·çš„ schemas å±æ€§å¯é…ç½®å¤šä¸ª schema ï¼Œæ‰€ä»¥ privileges çš„ä¸‹çº§èŠ‚ç‚¹ schema èŠ‚ç‚¹åŒæ · å¯é…ç½®å¤šä¸ªï¼Œå¯¹å¤šåº“å¤šè¡¨è¿›è¡Œç»†ç²’åº¦çš„ DML æƒé™æ§åˆ¶;\nC. æƒé™ä¿®é¥°ç¬¦å››ä½æ•°å­—(0000 - 1111)ï¼Œå¯¹åº”çš„æ“ä½œæ˜¯ IUSD ( å¢ï¼Œæ”¹ï¼ŒæŸ¥ï¼Œåˆ  )ã€‚åŒæ—¶é…ç½®äº†åº“è·Ÿè¡¨çš„æƒé™ï¼Œå°±è¿‘åŸåˆ™ã€‚ä»¥è¡¨æƒé™ä¸ºå‡†ã€‚\nfirewall æ ‡ç­¾firewallæ ‡ç­¾ç”¨æ¥å®šä¹‰é˜²ç«å¢™ï¼›firewallä¸‹whitehostæ ‡ç­¾ç”¨æ¥å®šä¹‰ IPç™½åå• ï¼Œblacklistç”¨æ¥å®šä¹‰ SQLé»‘åå•ã€‚\n&lt;firewall&gt;    &lt;!-- ç™½åå•é…ç½® --&gt;    &lt;whitehost&gt;        &lt;host user=&quot;root&quot; host=&quot;127.0.0.1&quot;&gt;&lt;/host&gt;    &lt;/whitehost&gt;    &lt;!-- é»‘åå•é…ç½® --&gt;    &lt;blacklist check=&quot;true&quot;&gt;        &lt;property name=&quot;selelctAllow&quot;&gt;false&lt;/property&gt;    &lt;/blacklist&gt;&lt;/firewall&gt;\n\né»‘åå•æ‹¦æˆªæ˜ç»†é…ç½®:\n\n\n\né…ç½®é¡¹\nç¼ºçœå€¼\næè¿°\n\n\n\nselelctAllow\ntrue\næ˜¯å¦å…è®¸æ‰§è¡Œ SELECT è¯­å¥\n\n\nselectAllColumnAllow\ntrue\næ˜¯å¦å…è®¸æ‰§è¡Œ SELECT * FROM T è¿™æ ·çš„è¯­å¥ã€‚å¦‚æœè®¾ç½®ä¸º falseï¼Œä¸å…è®¸æ‰§è¡Œ select * from tï¼Œä½†å¯ä»¥select * from (select id, name from t) aã€‚è¿™ä¸ªé€‰é¡¹æ˜¯é˜²å¾¡ç¨‹åºé€šè¿‡è°ƒç”¨ select * è·å¾—æ•°æ®è¡¨çš„ç»“æ„ä¿¡æ¯ã€‚\n\n\nselectIntoAllow\ntrue\nSELECT æŸ¥è¯¢ä¸­æ˜¯å¦å…è®¸ INTO å­—å¥\n\n\ndeleteAllow\ntrue\næ˜¯å¦å…è®¸æ‰§è¡Œ DELETE è¯­å¥\n\n\nupdateAllow\ntrue\næ˜¯å¦å…è®¸æ‰§è¡Œ UPDATE è¯­å¥\n\n\ninsertAllow\ntrue\næ˜¯å¦å…è®¸æ‰§è¡Œ INSERT è¯­å¥\n\n\nreplaceAllow\ntrue\næ˜¯å¦å…è®¸æ‰§è¡Œ REPLACE è¯­å¥\n\n\nmergeAllow\ntrue\næ˜¯å¦å…è®¸æ‰§è¡Œ MERGE è¯­å¥ï¼Œè¿™ä¸ªåªåœ¨ Oracle ä¸­æœ‰ç”¨\n\n\ncallAllow\ntrue\næ˜¯å¦å…è®¸é€šè¿‡ jdbc çš„ call è¯­æ³•è°ƒç”¨å­˜å‚¨è¿‡ç¨‹\n\n\nsetAllow\ntrue\næ˜¯å¦å…è®¸ä½¿ç”¨ SET è¯­æ³•\n\n\ntruncateAllow\ntrue\ntruncate è¯­å¥æ˜¯å±é™©ï¼Œç¼ºçœæ‰“å¼€ï¼Œè‹¥éœ€è¦è‡ªè¡Œå…³é—­\n\n\ncreateTableAllow\ntrue\næ˜¯å¦å…è®¸åˆ›å»ºè¡¨\n\n\nalterTableAllow\ntrue\næ˜¯å¦å…è®¸æ‰§è¡Œ Alter Table è¯­å¥\n\n\ndropTableAllow\ntrue\næ˜¯å¦å…è®¸ä¿®æ”¹è¡¨\n\n\ncommentAllow\nfalse\næ˜¯å¦å…è®¸è¯­å¥ä¸­å­˜åœ¨æ³¨é‡Šï¼ŒOracle çš„ç”¨æˆ·ä¸ç”¨æ‹…å¿ƒï¼ŒWall èƒ½å¤Ÿè¯†åˆ« hintså’Œæ³¨é‡Šçš„åŒºåˆ«\n\n\nnoneBaseStatementAllow\nfalse\næ˜¯å¦å…è®¸éä»¥ä¸ŠåŸºæœ¬è¯­å¥çš„å…¶ä»–è¯­å¥ï¼Œç¼ºçœå…³é—­ï¼Œé€šè¿‡è¿™ä¸ªé€‰é¡¹å°±èƒ½å¤Ÿå±è”½ DDLã€‚\n\n\nmultiStatementAllow\nfalse\næ˜¯å¦å…è®¸ä¸€æ¬¡æ‰§è¡Œå¤šæ¡è¯­å¥ï¼Œç¼ºçœå…³é—­\n\n\nuseAllow\ntrue\næ˜¯å¦å…è®¸æ‰§è¡Œ mysql çš„ use è¯­å¥ï¼Œç¼ºçœæ‰“å¼€\n\n\ndescribeAllow\ntrue\næ˜¯å¦å…è®¸æ‰§è¡Œ mysql çš„ describe è¯­å¥ï¼Œç¼ºçœæ‰“å¼€\n\n\nshowAllow\ntrue\næ˜¯å¦å…è®¸æ‰§è¡Œ mysql çš„ show è¯­å¥ï¼Œç¼ºçœæ‰“å¼€\n\n\ncommitAllow\ntrue\næ˜¯å¦å…è®¸æ‰§è¡Œ commit æ“ä½œ\n\n\nrollbackAllow\ntrue\næ˜¯å¦å…è®¸æ‰§è¡Œ roll back æ“ä½œ\n\n\næ‹¦æˆªé…ç½®ï¼æ°¸çœŸæ¡ä»¶\n\n\n\n\nselectWhereAlwayTrueCheck\ntrue\næ£€æŸ¥ SELECT è¯­å¥çš„ WHERE å­å¥æ˜¯å¦æ˜¯ä¸€ä¸ªæ°¸çœŸæ¡ä»¶\n\n\nselectHavingAlwayTrueCheck\ntrue\næ£€æŸ¥ SELECT è¯­å¥çš„ HAVING å­å¥æ˜¯å¦æ˜¯ä¸€ä¸ªæ°¸çœŸæ¡ä»¶\n\n\ndeleteWhereAlwayTrueCheck\ntrue\næ£€æŸ¥ DELETE è¯­å¥çš„ WHERE å­å¥æ˜¯å¦æ˜¯ä¸€ä¸ªæ°¸çœŸæ¡ä»¶\n\n\ndeleteWhereNoneCheck\nfalse\næ£€æŸ¥ DELETE è¯­å¥æ˜¯å¦æ—  where æ¡ä»¶ï¼Œè¿™æ˜¯æœ‰é£é™©çš„ï¼Œä½†ä¸æ˜¯ SQL æ³¨å…¥ç±»å‹çš„é£é™©\n\n\nupdateWhereAlayTrueCheck\ntrue\næ£€æŸ¥ UPDATE è¯­å¥çš„ WHERE å­å¥æ˜¯å¦æ˜¯ä¸€ä¸ªæ°¸çœŸæ¡ä»¶\n\n\nupdateWhereNoneCheck\nfalse\næ£€æŸ¥ UPDATE è¯­å¥æ˜¯å¦æ—  where æ¡ä»¶ï¼Œè¿™æ˜¯æœ‰é£é™©çš„ï¼Œä½†ä¸æ˜¯SQL æ³¨å…¥ç±»å‹çš„é£é™©\n\n\nconditionAndAlwayTrueAllow\nfalse\næ£€æŸ¥æŸ¥è¯¢æ¡ä»¶(WHERE/HAVING å­å¥)ä¸­æ˜¯å¦åŒ…å« AND æ°¸çœŸæ¡ä»¶\n\n\nconditionAndAlwayFalseAllow\nfalse\næ£€æŸ¥æŸ¥è¯¢æ¡ä»¶(WHERE/HAVING å­å¥)ä¸­æ˜¯å¦åŒ…å« AND æ°¸å‡æ¡ä»¶\n\n\nconditionLikeTrueAllow\ntrue\næ£€æŸ¥æŸ¥è¯¢æ¡ä»¶(WHERE/HAVING å­å¥)ä¸­æ˜¯å¦åŒ…å« LIKE æ°¸çœŸæ¡ä»¶\n\n\nå…¶ä»–æ‹¦æˆªé…ç½®\n\n\n\n\nselectIntoOutfileAllow\nfalse\nSELECT â€¦ INTO OUTFILE æ˜¯å¦å…è®¸ï¼Œè¿™ä¸ªæ˜¯ mysql æ³¨å…¥æ”»å‡»çš„å¸¸è§æ‰‹æ®µï¼Œç¼ºçœæ˜¯ç¦æ­¢çš„\n\n\nselectUnionCheck\ntrue\næ£€æµ‹ SELECT UNION\n\n\nselectMinusCheck\ntrue\næ£€æµ‹ SELECT MINUS\n\n\nselectExceptCheck\ntrue\næ£€æµ‹ SELECT EXCEPT\n\n\nselectIntersectCheck\ntrue\næ£€æµ‹ SELECT INTERSECT\n\n\nmustParameterized\nfalse\næ˜¯å¦å¿…é¡»å‚æ•°åŒ–ï¼Œå¦‚æœä¸º Trueï¼Œåˆ™ä¸å…è®¸ç±»ä¼¼ WHERE ID = 1 è¿™ç§ä¸å‚æ•°åŒ–çš„ SQL\n\n\nstrictSyntaxCheck\ntrue\næ˜¯å¦è¿›è¡Œä¸¥æ ¼çš„è¯­æ³•æ£€æµ‹ï¼ŒDruid SQL Parser åœ¨æŸäº›åœºæ™¯ä¸èƒ½è¦†ç›–æ‰€æœ‰çš„SQL è¯­æ³•ï¼Œå‡ºç°è§£æ SQL å‡ºé”™ï¼Œå¯ä»¥ä¸´æ—¶æŠŠè¿™ä¸ªé€‰é¡¹è®¾ç½®ä¸º falseï¼ŒåŒæ—¶æŠŠ SQL åé¦ˆç»™ Druid çš„å¼€å‘è€…ã€‚\n\n\nconditionOpXorAllow\nfalse\næŸ¥è¯¢æ¡ä»¶ä¸­æ˜¯å¦å…è®¸æœ‰ XOR æ¡ä»¶ã€‚XOR ä¸å¸¸ç”¨ï¼Œå¾ˆéš¾åˆ¤æ–­æ°¸çœŸæˆ–è€…æ°¸å‡ï¼Œç¼ºçœä¸å…è®¸ã€‚\n\n\nconditionOpBitwseAllow\ntrue\næŸ¥è¯¢æ¡ä»¶ä¸­æ˜¯å¦å…è®¸æœ‰â€&amp;â€ã€â€~â€ã€â€|â€ã€â€^â€è¿ç®—ç¬¦ã€‚\n\n\nconditionDoubleConstAllow\nfalse\næŸ¥è¯¢æ¡ä»¶ä¸­æ˜¯å¦å…è®¸è¿ç»­ä¸¤ä¸ªå¸¸é‡è¿ç®—è¡¨è¾¾å¼\n\n\nminusAllow\ntrue\næ˜¯å¦å…è®¸ SELECT * FROM A MINUS SELECT * FROM B è¿™æ ·çš„è¯­å¥\n\n\nintersectAllow\ntrue\næ˜¯å¦å…è®¸ SELECT * FROM A INTERSECT SELECT * FROM B è¿™æ ·çš„è¯­å¥\n\n\nconstArithmeticAllow\ntrue\næ‹¦æˆªå¸¸é‡è¿ç®—çš„æ¡ä»¶ï¼Œæ¯”å¦‚è¯´ WHERE FID = 3 - 1ï¼Œå…¶ä¸­â€3 - 1â€æ˜¯å¸¸é‡è¿ç®—è¡¨è¾¾å¼ã€‚\n\n\nlimitZeroAllow\nfalse\næ˜¯å¦å…è®¸ limit 0 è¿™æ ·çš„è¯­å¥\n\n\nç¦ç”¨å¯¹è±¡æ£€æµ‹é…ç½®\n\n\n\n\ntableCheck\ntrue\næ£€æµ‹æ˜¯å¦ä½¿ç”¨äº†ç¦ç”¨çš„è¡¨\n\n\nschemaCheck\ntrue\næ£€æµ‹æ˜¯å¦ä½¿ç”¨äº†ç¦ç”¨çš„ Schema\n\n\nfunctionCheck\ntrue\næ£€æµ‹æ˜¯å¦ä½¿ç”¨äº†ç¦ç”¨çš„å‡½æ•°\n\n\nobjectCheck\ntrue\næ£€æµ‹æ˜¯å¦ä½¿ç”¨äº†â€œç¦ç”¨å¯¹å¯¹è±¡â€\n\n\nvariantCheck\ntrue\næ£€æµ‹æ˜¯å¦ä½¿ç”¨äº†â€œç¦ç”¨çš„å˜é‡â€\n\n\nreadOnlyTables\nç©º\næŒ‡å®šçš„è¡¨åªè¯»ï¼Œä¸èƒ½å¤Ÿåœ¨ SELECT INTOã€DELETEã€UPDATEã€INSERTã€MERGE ä¸­ä½œä¸ºâ€è¢«ä¿®æ”¹è¡¨â€å‡ºç°\n\n\nå¯åŠ¨Mycatbin/mycat startbin/mycat stopbin/mycat status\n\nå¯åŠ¨åç”¨mysqlé“¾æ¥å·¥å…·ç›´æ¥è¿å°±å¯ä»¥äº†\n\nåˆ†ç‰‡æµ‹è¯•è¿›å…¥mycat ï¼Œæ‰§è¡Œä¸‹åˆ—è¯­å¥åˆ›å»ºä¸€ä¸ªè¡¨\nCREATE TABLE TB_TEST (  id BIGINT(20) NOT NULL,  title VARCHAR(100) NOT NULL ,  PRIMARY KEY (id)) ENGINE=INNODB DEFAULT CHARSET=utf8 ;\n\n\n\næˆ‘ä»¬å†æŸ¥çœ‹MySQLçš„3ä¸ªåº“ï¼Œå‘ç°è¡¨éƒ½è‡ªåŠ¨åˆ›å»ºå¥½äº†\næ¥ä¸‹æ¥æ˜¯æ’å…¥è¡¨æ•°æ®ï¼Œæ³¨æ„ï¼Œåœ¨å†™ INSERT è¯­å¥æ—¶ä¸€å®šè¦å†™æŠŠå­—æ®µåˆ—è¡¨å†™å‡ºæ¥ï¼Œå¦åˆ™ä¼šå‡ºç°ä¸‹åˆ—é”™è¯¯æç¤ºï¼š\né”™è¯¯ä»£ç ï¼š 1064\npartition table, insert must provide ColumnList\næˆ‘ä»¬è¯•ç€æ’å…¥ä¸€äº›æ•°æ®ï¼š\nINSERT INTO TB_TEST(ID,TITLE) VALUES(1,&#x27;goods1&#x27;);INSERT INTO TB_TEST(ID,TITLE) VALUES(2,&#x27;goods2&#x27;);INSERT INTO TB_TEST(ID,TITLE) VALUES(3,&#x27;goods3&#x27;);\n\næˆ‘ä»¬ä¼šå‘ç°è¿™äº›æ•°æ®è¢«å†™å…¥åˆ°ç¬¬ä¸€ä¸ªèŠ‚ç‚¹ä¸­äº†ï¼Œé‚£ä»€ä¹ˆæ—¶å€™æ•°æ®ä¼šå†™åˆ°ç¬¬äºŒä¸ªèŠ‚ç‚¹ä¸­å‘¢ï¼Ÿ\næˆ‘ä»¬æ’å…¥ä¸‹é¢çš„æ•°æ®å°±å¯ä»¥æ’å…¥ç¬¬äºŒä¸ªèŠ‚ç‚¹äº†\nINSERT INTO TB_TEST(ID,TITLE) VALUES(5000001,&#x27;goods5000001&#x27;);\n\nå› ä¸ºæˆ‘ä»¬é‡‡ç”¨çš„åˆ†ç‰‡è§„åˆ™æ˜¯æ¯èŠ‚ç‚¹å­˜å‚¨500ä¸‡æ¡æ•°æ®ï¼Œæ‰€ä»¥å½“IDå¤§äº5000000åˆ™ä¼šå­˜å‚¨åˆ°ç¬¬äºŒä¸ªèŠ‚ç‚¹ä¸Šã€‚\nç›®å‰åªè®¾ç½®äº†ä¸¤ä¸ªèŠ‚ç‚¹ï¼Œå¦‚æœæ•°æ®å¤§äº1000ä¸‡æ¡ï¼Œä¼šæ€ä¹ˆæ ·å‘¢ï¼Ÿæ‰§è¡Œä¸‹åˆ—è¯­å¥æµ‹è¯•ä¸€ä¸‹\nINSERT INTO TB_TEST(ID,TITLE) VALUES(10000001,&#x27;goods10000001&#x27;);\n\nMyCatåŸç†MyCatåŸç†ä¸­æœ€é‡è¦çš„ä¸€ä¸ªåŠ¨è¯å°±æ˜¯ â€œæ‹¦æˆªâ€, å®ƒæ‹¦æˆªäº†ç”¨æˆ·å‘é€è¿‡æ¥çš„SQLè¯­å¥, é¦–å…ˆå¯¹SQLè¯­å¥åšä¸€äº›ç‰¹å®šçš„åˆ†æ,å¦‚åˆ†ç‰‡åˆ†æã€è·¯ç”±åˆ†æã€è¯»å†™åˆ†ç¦»åˆ†æã€ç¼“å­˜åˆ†æç­‰ï¼Œç„¶åå°†æ­¤SQLè¯­å¥å‘å¾€åç«¯çš„çœŸå®æ•°æ®åº“ï¼Œå¹¶å°†è¿”å›çš„ç»“æœåšé€‚å½“å¤„ç†ï¼Œæœ€ç»ˆå†è¿”å›ç»™ç”¨æˆ·ï¼Œå¦‚å›¾æ‰€ç¤ºã€‚\n\nåœ¨å›¾ä¸­,userè¡¨è¢«åˆ†ä¸ºä¸‰ä¸ªåˆ†ç‰‡èŠ‚ç‚¹dn1ã€dn2ã€dn3, ä»–ä»¬åˆ†å¸ƒå¼åœ¨ä¸‰ä¸ªMySQL Server(dataHost)ä¸Šï¼Œå› æ­¤å¯ä»¥ä½¿ç”¨1-Nå°æœåŠ¡å™¨æ¥åˆ†ç‰‡,åˆ†ç‰‡è§„åˆ™(sharding rule)ä¸ºå…¸å‹çš„å­—ç¬¦ä¸²æšä¸¾åˆ†ç‰‡è§„åˆ™, ä¸€ä¸ªè§„åˆ™çš„å®šä¹‰æ˜¯åˆ†ç‰‡å­—æ®µ+åˆ†ç‰‡å‡½æ•°ã€‚è¿™é‡Œçš„åˆ†ç‰‡å­—æ®µä¸º statusï¼Œåˆ†ç‰‡å‡½æ•°åˆ™ä¸ºå­—ç¬¦ä¸²æšä¸¾æ–¹å¼ã€‚\nMyCatæ”¶åˆ°ä¸€æ¡SQLè¯­å¥æ—¶ï¼Œé¦–å…ˆè§£æSQLè¯­å¥æ¶‰åŠåˆ°çš„è¡¨ï¼Œæ¥ç€æŸ¥çœ‹æ­¤è¡¨çš„å®šä¹‰ï¼Œå¦‚æœè¯¥è¡¨å­˜åœ¨åˆ†ç‰‡è§„åˆ™ï¼Œåˆ™è·å–SQLè¯­å¥é‡Œåˆ†ç‰‡å­—æ®µçš„å€¼ï¼Œå¹¶åŒ¹é…åˆ†ç‰‡å‡½æ•°ï¼Œå¾—åˆ°è¯¥SQLè¯­å¥å¯¹åº”çš„åˆ†ç‰‡åˆ—è¡¨ï¼Œç„¶åå°†SQLè¯­å¥å‘é€åˆ°ç›¸åº”çš„åˆ†ç‰‡å»æ‰§è¡Œï¼Œæœ€åå¤„ç†æ‰€æœ‰åˆ†ç‰‡è¿”å›çš„æ•°æ®å¹¶è¿”å›ç»™å®¢æˆ·ç«¯ã€‚ä»¥â€select * from user where status=â€™0â€™â€ ä¸ºä¾‹, æŸ¥æ‰¾ status=â€™0â€™ ,æŒ‰ç…§åˆ†ç‰‡å‡½æ•°, â€˜0â€™ å€¼å­˜æ”¾åœ¨dn1,äºæ˜¯SQLè¯­å¥è¢«å‘é€åˆ°ç¬¬ä¸€ä¸ªèŠ‚ç‚¹ä¸­æ‰§è¡Œ, ç„¶åå†å°†æŸ¥è¯¢çš„ç»“æœè¿”å›ç»™ç”¨æˆ·ã€‚\nå¦‚æœå‘é€çš„SQLè¯­å¥ä¸º â€œselect * from user where status in (â€˜0â€™,â€™1â€™)â€ , é‚£ä¹ˆSQLè¯­å¥ä¼šè¢«å‘é€åˆ°dn1,dn2å¯¹åº”çš„ä¸»æœºä¸Šæ‰§è¡Œ, ç„¶åå°†ç»“æœé›†åˆå¹¶åè¾“å‡ºç»™ç”¨æˆ·ã€‚\nå°ç»“mycatç›¸å¯¹äºshardingjdbcå¯ä»¥å•ç‹¬è¿è¡Œï¼Œè®©å¼€å‘æ„Ÿè§‰ä¸åˆ°å®ƒçš„å­˜åœ¨ï¼Œå¯ä»¥å¤šæ•°æ®æºä¹‹é—´äº¤äº’ï¼Œåªéœ€è¦è¿mycatä¸€ä¸ªæ•°æ®æºå°±è¡Œäº†ï¼Œä¹Ÿå¯ä»¥åŠ ç›‘æ§Mycat-web\nMycat-web æ˜¯ Mycat å¯è§†åŒ–è¿ç»´çš„ç®¡ç†å’Œç›‘æ§å¹³å°ï¼Œå¼¥è¡¥äº† Mycat åœ¨ç›‘æ§ä¸Šçš„ç©ºç™½ã€‚å¸® Mycat åˆ†æ‹…ç»Ÿè®¡ä»»åŠ¡å’Œé…ç½®ç®¡ç†ä»»åŠ¡ã€‚Mycat-web å¼•å…¥äº† ZooKeeper ä½œä¸ºé…ç½®ä¸­å¿ƒï¼Œå¯ä»¥ç®¡ç†å¤šä¸ªèŠ‚ç‚¹ã€‚Mycat-web ä¸»è¦ç®¡ç†å’Œç›‘æ§ Mycat çš„æµé‡ã€è¿æ¥ã€æ´»åŠ¨çº¿ç¨‹å’Œå†…å­˜ç­‰ï¼Œå…·å¤‡ IP ç™½åå•ã€é‚®ä»¶å‘Šè­¦ç­‰æ¨¡å—ï¼Œè¿˜å¯ä»¥ç»Ÿè®¡ SQL å¹¶åˆ†ææ…¢ SQL å’Œé«˜é¢‘ SQL ç­‰ã€‚ä¸ºä¼˜åŒ– SQL æä¾›ä¾æ®ã€‚\n\nmycatç°åœ¨å¼ºæ¨mycat2ï¼Œç¼ºç‚¹å°±æ˜¯æ–‡æ¡£è¿˜åœ¨å®Œå–„ä¸­ï¼Œä¸å¤Ÿå®Œå…¨ï¼Œä¸è¿‡ç›¸å¯¹äºmycat1ï¼Œåœ¨é…ç½®æ–¹é¢ä¼˜åŒ–çš„æ›´åŠ ç®€å•å®¹æ˜“å…¥æ‰‹äº†ã€‚ å»ºè®®ä»mycat1æ…¢æ…¢å­¦ä¸Šå»\n","tags":["åˆ†åº“åˆ†è¡¨","å¤šæ•°æ®æº","mysql"]},{"title":"ShardingJDBCç®€å•ä»‹ç»","url":"/2022/04/10/0.1.9ShardingJDBC%E7%AE%80%E5%8D%95%E4%BB%8B%E7%BB%8D/","content":"ShardingJDBCä»‹ç»\nShardingJDBCæ˜¯å½“å½“ç½‘ç ”å‘çš„å¼€æºåˆ†å¸ƒå¼æ•°æ®åº“ä¸­é—´ä»¶ï¼Œä» 3.0 å¼€å§‹Sharding-JDBCè¢«åŒ…å«åœ¨ Sharding-Sphereä¸­ï¼Œä¹‹åè¯¥é¡¹ç›®è¿›å…¥è¿›å…¥Apacheå­µåŒ–å™¨ï¼Œ4.0ç‰ˆæœ¬ä¹‹åçš„ç‰ˆæœ¬ä¸ºApacheç‰ˆæœ¬ã€‚\n\nShardingSphereæ˜¯ä¸€å¥—å¼€æºçš„åˆ†å¸ƒå¼æ•°æ®åº“ä¸­é—´ä»¶è§£å†³æ–¹æ¡ˆç»„æˆçš„ç”Ÿæ€åœˆï¼Œå®ƒç”±Sharding-JDBCã€Sharding-Proxyå’ŒSharding-Sidecarï¼ˆè®¡åˆ’ä¸­ï¼‰è¿™3æ¬¾ç›¸äº’ç‹¬ç«‹çš„äº§å“ç»„æˆã€‚ ä»–ä»¬å‡æä¾›æ ‡å‡†åŒ–çš„æ•°æ®åˆ†ç‰‡ã€åˆ†å¸ƒå¼äº‹åŠ¡å’Œæ•°æ®åº“æ²»ç†åŠŸèƒ½ï¼Œå¯é€‚ç”¨äºå¦‚JavaåŒæ„ã€å¼‚æ„è¯­è¨€ã€å®¹å™¨ã€äº‘åŸç”Ÿç­‰å„ç§å¤šæ ·åŒ–çš„åº”ç”¨åœºæ™¯ã€‚\nå®˜æ–¹åœ°å€ï¼šhttps://shardingsphere.apache.org/document/current/cn/overview/\nå®ƒå®šä½ä¸ºè½»é‡çº§Javaæ¡†æ¶ï¼Œåœ¨Javaçš„JDBCå±‚æä¾›çš„é¢å¤–æœåŠ¡ã€‚å®ƒä½¿ç”¨å®¢æˆ·ç«¯ç›´è¿æ•°æ®åº“ï¼Œä»¥jaråŒ…å½¢å¼æä¾›æœåŠ¡ï¼Œæ— éœ€é¢å¤–éƒ¨ç½²å’Œä¾èµ–ï¼Œå¯ç†è§£ä¸ºå¢å¼ºç‰ˆçš„JDBCé©±åŠ¨ï¼Œå®Œå…¨å…¼å®¹JDBCå’Œå„ç§ORMæ¡†æ¶\nåœ¨ maven çš„å·¥ç¨‹é‡Œé¢ï¼Œæˆ‘ä»¬ä½¿ç”¨å®ƒçš„æ–¹å¼æ˜¯å¼•å…¥ä¾èµ–ï¼Œç„¶åè¿›è¡Œé…ç½®å°±å¯ä»¥äº†ï¼Œä¸ç”¨åƒ Mycat ä¸€æ ·ç‹¬ç«‹è¿è¡Œä¸€ä¸ªæœåŠ¡ï¼Œå®¢æˆ·ç«¯ä¸éœ€è¦ä¿®æ”¹ä»»ä½•ä¸€è¡Œä»£ç ï¼ŒåŸæ¥æ˜¯ SSM è¿æ¥æ•°æ®åº“ï¼Œè¿˜æ˜¯ SSMï¼Œå› ä¸ºå®ƒæ˜¯æ”¯æŒ MyBatis çš„\nç‰¹ç‚¹Sharding-JDBCçš„æ ¸å¿ƒåŠŸèƒ½ä¸ºæ•°æ®åˆ†ç‰‡å’Œè¯»å†™åˆ†ç¦»ï¼Œé€šè¿‡Sharding-JDBCï¼Œåº”ç”¨å¯ä»¥é€æ˜çš„ä½¿ç”¨jdbcè®¿é—®å·²ç»åˆ†åº“åˆ†è¡¨ã€è¯»å†™åˆ†ç¦»çš„å¤šä¸ªæ•°æ®æºï¼Œè€Œä¸ç”¨å…³å¿ƒæ•°æ®æºçš„æ•°é‡ä»¥åŠæ•°æ®å¦‚ä½•åˆ†å¸ƒã€‚ \n\né€‚ç”¨äºä»»ä½•åŸºäºJavaçš„ORMæ¡†æ¶ï¼Œå¦‚ï¼šHibernate, Mybatis, Spring JDBC Templateæˆ–ç›´æ¥ä½¿ç”¨JDBC\nåŸºäºä»»ä½•ç¬¬ä¸‰æ–¹çš„æ•°æ®åº“è¿æ¥æ± ï¼Œå¦‚ï¼šDBCP, C3P0, BoneCP, Druid, HikariCPç­‰\næ”¯æŒä»»æ„å®ç°JDBCè§„èŒƒçš„æ•°æ®åº“ã€‚ç›®å‰æ”¯æŒMySQLï¼ŒOracleï¼ŒSQLServerå’ŒPostgreSQL\n\nåˆ†åº“åˆ†è¡¨çš„ä¸€äº›æ ¸å¿ƒåŠ¨ä½œï¼Œæ¯”å¦‚ SQL è§£æï¼Œè·¯ç”±ï¼Œæ‰§è¡Œï¼Œç»“æœå¤„ç†ï¼Œéƒ½æ˜¯ç”±å®ƒæ¥å®Œæˆçš„\n\nä¸Šå›¾å±•ç¤ºäº†Sharding-Jdbcçš„å·¥ä½œæ–¹å¼ï¼Œä½¿ç”¨Sharding-Jdbcå‰éœ€è¦äººå·¥å¯¹æ•°æ®åº“è¿›è¡Œåˆ†åº“åˆ†è¡¨\nåœ¨åº”ç”¨ç¨‹åºä¸­åŠ å…¥Sharding-Jdbcçš„JaråŒ…ï¼Œåº”ç”¨ç¨‹åºé€šè¿‡Sharding-Jdbcæ“ä½œåˆ†åº“åˆ†è¡¨åçš„æ•°æ®åº“å’Œæ•°æ®è¡¨ï¼Œç”±äºSharding-Jdbcæ˜¯å¯¹Jdbcé©±åŠ¨çš„å¢å¼ºï¼Œä½¿ç”¨Sharding-Jdbcå°±åƒä½¿ç”¨Jdbcé©±åŠ¨ä¸€æ ·ï¼Œåœ¨åº”ç”¨ç¨‹åºä¸­æ˜¯æ— éœ€æŒ‡å®šå…·ä½“è¦æ“ä½œçš„åˆ†åº“å’Œåˆ†è¡¨çš„\nä¸»è¦æ¦‚å¿µï¼šé€»è¾‘è¡¨ä¼šåœ¨ SQL è§£æå’Œè·¯ç”±æ—¶è¢«æ›¿æ¢æˆçœŸå®çš„è¡¨å\n\næ€§èƒ½å¯¹æ¯”ä»¥ä¸‹ä¸ºç½‘ä¸Šç»Ÿè®¡æ•°æ®\n1.æ€§èƒ½æŸè€—æµ‹è¯•ï¼šæœåŠ¡å™¨èµ„æºå……è¶³ã€å¹¶å‘æ•°ç›¸åŒï¼Œæ¯”è¾ƒJDBCå’ŒSharding-JDBCæ€§èƒ½æŸè€—ï¼ŒSharding-JDBCç›¸å¯¹JDBCæŸè€—ä¸è¶…è¿‡7%\n\n2.æ€§èƒ½å¯¹æ¯”æµ‹è¯•ï¼šæœåŠ¡å™¨èµ„æºä½¿ç”¨åˆ°æé™ï¼Œç›¸åŒçš„åœºæ™¯JDBCä¸Sharding-JDBCçš„ååé‡ç›¸å½“\n3.æ€§èƒ½å¯¹æ¯”æµ‹è¯•ï¼šæœåŠ¡å™¨èµ„æºä½¿ç”¨åˆ°æé™ï¼ŒSharding-JDBCé‡‡ç”¨åˆ†åº“åˆ†è¡¨åï¼ŒSharding-JDBCååé‡è¾ƒJDBCä¸åˆ†è¡¨æœ‰æ¥è¿‘2å€çš„æå‡ã€‚ \n\nShardingJDBCå¼•å…¥1.å¼•å…¥bootçš„ä¾èµ–æ•´åˆåŒ…\n&lt;dependency&gt;    &lt;groupId&gt;org.apache.shardingsphere&lt;/groupId&gt;    &lt;artifactId&gt;shardingâ€jdbcâ€springâ€bootâ€starter&lt;/artifactId&gt;    &lt;version&gt;4.0.0â€RC1&lt;/version&gt;&lt;/dependency&gt;\n\n2.åˆ›å»ºæ•°æ®åº“å’Œè¡¨\n\nåˆ›å»ºè®¢å•åº“order_db \nCREATE DATABASE `order_db` CHARACTER SET &#x27;utf8&#x27; COLLATE &#x27;utf8_general_ci&#x27;;\nåœ¨order_dbä¸­åˆ›å»ºt_order_1ã€t_order_2è¡¨ \nDROP TABLE IF EXISTS `t_order_1`;CREATE TABLE `t_order_1`(    `order_id` bigint(20) NOT NULL COMMENT &#x27;è®¢å•id&#x27;,    `price` decimal(10, 2) NOT NULL COMMENT &#x27;è®¢å•ä»·æ ¼&#x27;,    `user_id` bigint(20) NOT NULL COMMENT &#x27;ä¸‹å•ç”¨æˆ·id&#x27;,    `status` varchar(50) CHARACTER SET utf8 COLLATE utf8_general_ci NOT NULL COMMENT &#x27;è®¢å•çŠ¶æ€&#x27;,    PRIMARY KEY (`order_id`) USING BTREE)ENGINE = InnoDB CHARACTER SET = utf8 COLLATE = utf8_general_ci ROW_FORMAT = Dynamic;DROP TABLE IF EXISTS `t_order_2`;CREATE TABLE `t_order_2` (    `order_id` bigint(20) NOT NULL COMMENT &#x27;è®¢å•id&#x27;,    `price` decimal(10, 2) NOT NULL COMMENT &#x27;è®¢å•ä»·æ ¼&#x27;,    `user_id` bigint(20) NOT NULL COMMENT &#x27;ä¸‹å•ç”¨æˆ·id&#x27;,    `status` varchar(50) CHARACTER SET utf8 COLLATE utf8_general_ci NOT NULL COMMENT &#x27;è®¢å•çŠ¶æ€&#x27;,    PRIMARY KEY (`order_id`) USING BTREE)ENGINE = InnoDB CHARACTER SET = utf8 COLLATE = utf8_general_ci ROW_FORMAT = Dynamic;\n\n3.application.propertiesé…ç½®è§„åˆ™\n\nå®šä¹‰æ•°æ®æº\n# å®šä¹‰æ•°æ®æºm1ï¼Œå¹¶å¯¹m1è¿›è¡Œå®é™…çš„å‚æ•°é…ç½®spring.shardingsphere.datasource.names=m1spring.shardingsphere.datasource.m1.type=com.alibaba.druid.pool.DruidDataSourespring.shardingsphere.datasource.m1.driverâ€classâ€name=com.mysql.jdbc.Driverspring.shardingsphere.datasource.m1.url=jdbc:mysql://localhost:3306/order_db?useUnicode=truespring.shardingsphere.datasource.m1.username=rootspring.shardingsphere.datasource.m1.password=root\né…ç½®æ•°æ®èŠ‚ç‚¹\n# æŒ‡å®št_orderè¡¨çš„æ•°æ®åˆ†å¸ƒæƒ…å†µï¼Œé…ç½®æ•°æ®èŠ‚ç‚¹# ä»–åˆ†å¸ƒåœ¨m1.t_order_1ï¼Œm1.t_order_2spring.shardingsphere.sharding.tables.t_order.actualâ€dataâ€nodes=m1.t_order_$â€&gt;&#123;1..2&#125;\né…ç½®ä¸»é”®ç­–ç•¥\n# æŒ‡å®št_orderè¡¨çš„ä¸»é”®ç”Ÿæˆç­–ç•¥ä¸ºSNOWFLAKE,SNOWFLAKEæ˜¯ä¸€ç§åˆ†å¸ƒå¼è‡ªå¢ç®—æ³•ï¼Œä¿è¯idå…¨å±€å”¯ä¸€spring.shardingsphere.sharding.tables.t_order.keyâ€generator.column=order_idspring.shardingsphere.sharding.tables.t_order.keyâ€generator.type=SNOWFLAKE\né…ç½®åˆ†ç‰‡ç®—æ³•\n# æŒ‡å®št_orderè¡¨çš„åˆ†ç‰‡ç­–ç•¥ï¼Œåˆ†ç‰‡ç­–ç•¥åŒ…æ‹¬åˆ†ç‰‡é”®å’Œåˆ†ç‰‡ç®—æ³•# order_idä¸ºå¶æ•°çš„æ•°æ®è½åœ¨t_order_1ï¼Œä¸ºå¥‡æ•°çš„è½åœ¨t_order_2ï¼Œåˆ†è¡¨ç­–ç•¥çš„è¡¨è¾¾å¼ä¸º t_order_$-&gt;&#123;order_id % 2 + 1&#125;spring.shardingsphere.sharding.tables.t_order.tableâ€strategy.inline.shardingâ€column=order_idspring.shardingsphere.sharding.tables.t_order.tableâ€strategy.inline.algorithmâ€expression=t_order_$â€&gt;&#123;order_id % 2 + 1&#125;\næ—¥å¿—è¾“å‡ºsql\nspring.shardingsphere.props.sql.show=true\n\n4.æ•°æ®æ“ä½œ\n@Mapper@Componentpublic interface OrderDao &#123;    /*** æ–°å¢è®¢å•     * @param price è®¢å•ä»·æ ¼     * @param userId ç”¨æˆ·id     * @param status è®¢å•çŠ¶æ€     * @return     */    @Insert(&quot;insert into t_order(price,user_id,status) value(#&#123;price&#125;,#&#123;userId&#125;,#&#123;status&#125;)&quot;)    int insertOrder(@Param(&quot;price&quot;) BigDecimal price, @Param(&quot;userId&quot;)Long userId, @Param(&quot;status&quot;)String status);        /*** æ ¹æ®idåˆ—è¡¨æŸ¥è¯¢å¤šä¸ªè®¢å•    * @param orderIds è®¢å•idåˆ—è¡¨     * @return     */     @Select(&#123;&quot;&lt;script&gt;&quot; +        &quot;select &quot; +        &quot; * &quot; +        &quot; from t_order t&quot; +        &quot; where t.order_id in &quot; +        &quot;&lt;foreach collection=&#x27;orderIds&#x27; item=&#x27;id&#x27; open=&#x27;(&#x27; separator=&#x27;,&#x27; close=&#x27;)&#x27;&gt;&quot; +        &quot; #&#123;id&#125; &quot; +        &quot;&lt;/foreach&gt;&quot;+        &quot;&lt;/script&gt;&quot;&#125;)    List&lt;Map&gt; selectOrderbyIds(@Param(&quot;orderIds&quot;)List&lt;Long&gt; orderIds);&#125;\n\n5.æµ‹è¯•\n@Testpublic void testInsertUser()&#123;    for (int i = 0 ; i&lt;10; i++)&#123;        Long id = i + 1L;        userDao.insertUser(id,&quot;å§“å&quot;+ id);    &#125;&#125;@Testpublic void testSelectUserbyIds()&#123;    List&lt;Long&gt; userIds = new ArrayList&lt;&gt;();    userIds.add(1L);    userIds.add(2L);    List&lt;Map&gt; users = userDao.selectUserbyIds(userIds);    System.out.println(users);&#125;\n\nå°ç»“Sharding-JDBCæ‰§è¡Œæµç¨‹ï¼šSQLè§£æ =&gt; æŸ¥è¯¢ä¼˜åŒ– =&gt; SQLè·¯ç”± =&gt; SQLæ”¹å†™ =&gt; SQLæ‰§è¡Œ =&gt; ç»“æœå½’å¹¶\nç³»ç»Ÿåœ¨è®¾è®¡ä¹‹åˆå°±åº”è¯¥å¯¹ä¸šåŠ¡æ•°æ®çš„è€¦åˆæ¾ç´§è¿›è¡Œè€ƒé‡ï¼Œä»è€Œè¿›è¡Œå‚ç›´åˆ†åº“ã€å‚ç›´åˆ†è¡¨ï¼Œä½¿æ•°æ®å±‚æ¶æ„æ¸…æ™°æ˜äº†ã€‚ \nè‹¥éå¿…è¦ï¼Œæ— éœ€è¿›è¡Œæ°´å¹³åˆ‡åˆ†ï¼Œåº”å…ˆä»ç¼“å­˜æŠ€æœ¯ç€æ‰‹é™ä½å¯¹æ•°æ®åº“çš„è®¿é—®å‹åŠ›ã€‚å¦‚æœç¼“å­˜ä½¿ç”¨è¿‡åï¼Œæ•°æ®åº“è®¿é—®é‡è¿˜æ˜¯éå¸¸å¤§ï¼Œå¯ä»¥è€ƒè™‘æ•°æ®åº“è¯»ã€å†™åˆ†ç¦»åŸåˆ™ã€‚è‹¥å½“å‰æ•°æ®åº“å‹åŠ›ä¾ç„¶å¤§ï¼Œä¸”ä¸šåŠ¡æ•°æ®æŒç»­å¢é•¿æ— æ³•ä¼°é‡ï¼Œæœ€åå¯è€ƒè™‘æ°´å¹³åˆ†åº“ã€åˆ†è¡¨ï¼Œå•è¡¨æ‹†åˆ†æ•°æ®æ§åˆ¶åœ¨1000ä¸‡ä»¥å†…ã€‚ \næ³¨æ„ï¼šå¹¶ä¸æ˜¯æ‰€æœ‰çš„sqlè¯­å¥éƒ½èƒ½æ”¯æŒæ‰§è¡Œ\nè¯¦ç»†å‚è€ƒï¼šhttps://shardingsphere.apache.org/document/current/cn/features/sharding/use-norms/sql/\n","tags":["åˆ†åº“åˆ†è¡¨","å¤šæ•°æ®æº","mysql"]},{"title":"RedisTemplateç»Ÿä¸€é›†æˆ","url":"/2022/05/06/0.2.1RedisTemplate%E7%BB%9F%E4%B8%80%E9%9B%86%E6%88%90/","content":"1.é…ç½®redis-config&lt;!-- Jedis è¿æ¥æ± é…ç½® --&gt;&lt;bean id=&quot;jedisPoolConfig&quot; class=&quot;redis.clients.jedis.JedisPoolConfig&quot;&gt;   &lt;property name=&quot;maxIdle&quot; value=&quot;$&#123;redis.maxIdle&#125;&quot;&gt;&lt;/property&gt;   &lt;property name=&quot;minEvictableIdleTimeMillis&quot; value=&quot;$&#123;redis.minEvictableIdleTimeMillis&#125;&quot;&gt;&lt;/property&gt;   &lt;property name=&quot;numTestsPerEvictionRun&quot; value=&quot;$&#123;redis.numTestsPerEvictionRun&#125;&quot;&gt;&lt;/property&gt;   &lt;property name=&quot;timeBetweenEvictionRunsMillis&quot; value=&quot;$&#123;redis.timeBetweenEvictionRunsMillis&#125;&quot;&gt;&lt;/property&gt;&lt;/bean&gt;&lt;bean id=&quot;stringRedisSerializer&quot;  class=&quot;org.springframework.data.redis.serializer.StringRedisSerializer&quot; /&gt;   &lt;bean id=&quot;jdkRedisSerializer&quot;  class=&quot;org.springframework.data.redis.serializer.JdkSerializationRedisSerializer&quot; /&gt;   &lt;bean id=&quot;jedisConnectionZero&quot; class=&quot;org.springframework.data.redis.connection.jedis.JedisConnectionFactory&quot; destroy-method=&quot;destroy&quot;&gt;   &lt;property name=&quot;poolConfig&quot; ref=&quot;jedisPoolConfig&quot;&gt;&lt;/property&gt;   &lt;property name=&quot;hostName&quot; value=&quot;$&#123;redisst.hostName&#125;&quot;&gt;&lt;/property&gt;   &lt;property name=&quot;port&quot; value=&quot;$&#123;redisst.port&#125;&quot;&gt;&lt;/property&gt;   &lt;property name=&quot;timeout&quot; value=&quot;$&#123;redisst.timeout&#125;&quot;&gt;&lt;/property&gt;   &lt;property name=&quot;usePool&quot; value=&quot;$&#123;redisst.usePool&#125;&quot;&gt;&lt;/property&gt;   &lt;property name=&quot;password&quot; value=&quot;$&#123;redisst.password&#125;&quot; &gt;&lt;/property&gt;    &lt;property name=&quot;database&quot; value=&quot;$&#123;redisst.db0&#125;&quot;&gt;&lt;/property&gt;&lt;/bean&gt;&lt;bean id=&quot;redisTemplateZero&quot; class=&quot;org.springframework.data.redis.core.RedisTemplate&quot;&gt;   &lt;property name=&quot;connectionFactory&quot; ref=&quot;jedisConnectionZero&quot; /&gt;    &lt;property name=&quot;keySerializer&quot; ref=&quot;stringRedisSerializer&quot; /&gt;   &lt;property name=&quot;hashKeySerializer&quot; ref=&quot;jdkRedisSerializer&quot; /&gt;   &lt;property name=&quot;valueSerializer&quot; ref=&quot;jdkRedisSerializer&quot;/&gt;&lt;/bean&gt;\n\n2.å®šä¹‰æšä¸¾public enum CommonRedisEnums &#123;    O_DB_0(&quot;redisTemplateZero&quot;,&quot;ODB0&quot;);    // å¯¹åº”redis-configä¸­çš„beanåç§°    private String name;    // åˆ«å    private String asName;    CommonRedisEnums(String name, String asName) &#123;        this.name = name;        this.asName = asName;    &#125;    public String getName() &#123;        return name;    &#125;    public String getAsName() &#123;        return asName;    &#125;&#125;\n\n3.ä½¿ç”¨SpringAppContextHolderè·å–beanprivate static Map&lt;String,RedisTemplate&gt; redisTemplateMap = new HashMap&lt;&gt;();public static void getRedis(CommonRedisEnums enums)&#123;   if(!redisTemplateMap.containsKey(enums.getName()))&#123;      RedisTemplate redisBean = (RedisTemplate) SpringAppContextHolder            .getBean(enums.getName());      if(redisBean != null)&#123;         redisTemplateMap.put(enums.getName(),redisBean);      &#125;   &#125;&#125;\n\n4.ä½¿ç”¨å·¥å…·ç±»è¿›è¡Œè°ƒç”¨/** * æœç´¢ */public static Map&lt;String, Object&gt; searchKeys(List&lt;String&gt; keys,CommonRedisEnums enums)&#123;   getRedis(enums);   return batchQueryByKeys(keys, false,redisTemplateMap.get(enums.getName()));&#125;public static Map&lt;String, Object&gt; batchQueryByKeys(final List&lt;String&gt; keys, Boolean useParallel, final RedisTemplate redisTemplate) &#123;   if (null == keys || keys.size() == 0) &#123;      return null;   &#125;   if (null == useParallel) &#123;      useParallel = true;   &#125;   Object object = redisTemplate.execute(new RedisCallback&lt;Object&gt;() &#123;      @Override      public Object doInRedis(RedisConnection connection) throws DataAccessException &#123;         connection.openPipeline();         for (String key : keys) &#123;            byte[] bkey = redisTemplate.getStringSerializer().serialize(key);            redisTemplate.getStringSerializer().serialize(JSON.toJSONString(connection.get(bkey)));         &#125;         return connection.closePipeline();      &#125;   &#125;);   List&lt;Object&gt; results = null;   if (null == object) &#123;      return null;   &#125; else &#123;      results = (List) object;   &#125;   Map&lt;String, Object&gt; resultMap = null;   if (useParallel) &#123;      Map&lt;String, Object&gt; resultMapOne = Collections.synchronizedMap(new HashMap&lt;String, Object&gt;());      for (String t : keys) &#123;         resultMapOne.put(t, results.get(keys.indexOf(t)));      &#125;      resultMap = resultMapOne;   &#125; else &#123;      Map&lt;String, Object&gt; resultMapTwo = new HashMap&lt;&gt;();      for (String t : keys) &#123;         Object o = results.get(keys.indexOf(t));         if (null != o) &#123;            String val = (String) redisTemplate.getStringSerializer().deserialize((byte[]) o);            resultMapTwo.put(t, val);         &#125;      &#125;      resultMap = resultMapTwo;   &#125;   return resultMap;&#125;\n\nå°ç»“ä½¿ç”¨@Autowiredçš„æ—¶å€™ï¼Œå¯¹äºstaticæ ‡è¯†çš„å˜é‡æˆ–è€…æ–¹æ³•ä¸€èˆ¬æ˜¯è·å–åˆ°çš„nullå€¼å¸¸è§„çš„æ–¹æ³•å·²ç»ä½¿ç”¨ä¸äº†\n@Autowiredprivate NewRedisZeroService redisZeroService;\n\néœ€è¦ä½¿ç”¨æ³¨å…¥æ–¹æ³•çš„å½¢å¼æ¥ä½¿ç”¨\nprivate static ZXSearchNewService_new zxSearchNewService_new;private static QueueProducerService messageService;@Autowiredpublic zxSearch(QueueProducerService queueProducerService,ZXSearchNewService_new zxSearchNewService_new) &#123;    zxSearch.zxSearchNewService_new = zxSearchNewService_new;    zxSearch.messageService = queueProducerService;&#125;\n\nè¿™æ ·å°±å¯ä»¥åœ¨å·¥å…·ç±»ä¸­ä½¿ç”¨äº†ï¼Œä¸éœ€è¦é€šè¿‡ä¼ å‚çš„å½¢å¼å»è·å–\n","tags":["å·¥å…·ç±»","redis"]},{"title":"IDEAæ’ä»¶","url":"/2022/05/09/0.2.2IDEA%E6%8F%92%E4%BB%B6/","content":"æ’ä»¶å®˜ç½‘JetBrains Marketplace\nAlibaba Java Coding Guidelinesé¦–å…ˆè¦æ¨èçš„æ˜¯å’Œã€Šæ‰‹å†Œã€‹é…å¥—çš„ é˜¿é‡Œå·´å·´ Javaä»£ç è§„èŒƒæ’ä»¶ã€‚å®‰è£…è¯¥æ’ä»¶åï¼Œä»£ç è¶…è¿‡ 80 è¡Œã€æ‰‹åŠ¨åˆ›å»ºçº¿ç¨‹æ± ç­‰ï¼Œè¿™äº›å’Œã€Šæ‰‹å†Œã€‹ä¸­çš„è§„çº¦ä¸ç¬¦æ—¶ï¼ŒIDEAä¸­ä¼šç»™å‡ºè­¦å‘Šæç¤ºã€‚\njclasslib bytecode viewerä¸‹é¢è¦éš†é‡ä»‹ç»çš„æ˜¯ä¸€æ¬¾å¯è§†åŒ–çš„å­—èŠ‚ç æŸ¥çœ‹æ’ä»¶ï¼šjclasslibå¤§å®¶å¯ä»¥ç›´æ¥åœ¨ IDEA æ’ä»¶ç®¡ç†ä¸­å®‰è£…ï¼ˆå®‰è£…æ­¥éª¤ç•¥ï¼‰ä½¿ç”¨æ–¹æ³•ï¼š\n\nåœ¨ IDEA æ‰“å¼€æƒ³ç ”ç©¶çš„ç±»\nç¼–è¯‘è¯¥ç±»æˆ–è€…ç›´æ¥ç¼–è¯‘æ•´ä¸ªé¡¹ç›®ï¼ˆ å¦‚æœæƒ³ç ”ç©¶çš„ç±»åœ¨ jar åŒ…ä¸­ï¼Œæ­¤æ­¥å¯ç•¥è¿‡ï¼‰\næ‰“å¼€â€œviewâ€ èœå•ï¼Œé€‰æ‹©â€œShow Bytecode With jclasslibâ€ é€‰é¡¹\né€‰æ‹©ä¸Šè¿°èœå•é¡¹å IDEA ä¸­ä¼šå¼¹å‡º jclasslib å·¥å…·çª—å£é‚£ä¹ˆæœ‰è‡ªå¸¦çš„å¼ºå¤§çš„åæ±‡ç¼–å·¥å…· javap è¿˜æœ‰å¿…è¦ç”¨è¿™ä¸ªæ’ä»¶å—ï¼Ÿè¿™ä¸ªæ’ä»¶çš„å¼ºå¤§ä¹‹å¤„åœ¨äºï¼š\nä¸éœ€è¦æ•²å‘½ä»¤ï¼Œç®€å•ç›´æ¥ï¼Œåœ¨å³ä¾§æ–¹ä¾¿å’Œæºä»£ç è¿›è¡Œå¯¹æ¯”å­¦ä¹ ã€‚\nå­—èŠ‚ç å‘½ä»¤æ”¯æŒè¶…é“¾æ¥ï¼Œç‚¹å‡»å…¶ä¸­çš„è™šæ‹ŸæœºæŒ‡ä»¤å³å¯è·³è½¬åˆ° jvms ç›¸å…³ç« èŠ‚ï¼Œè¶…çº§æ–¹ä¾¿ã€‚è¯¥æ’ä»¶å¯¹æˆ‘ä»¬å­¦ä¹ è™šæ‹ŸæœºæŒ‡ä»¤æœ‰æå¤§çš„å¸®åŠ©ã€‚è¯¦ç»†å®‰è£…å’Œä»‹ç»å‚è€ƒå¦å¤–ä¸€ç¯‡æ‰‹è®°ï¼šhttps://www.imooc.com/article/29625\n\nCodotaå¦å¤–ä¸€ä¸ªä¸å¾—ä¸è¯´çš„å°±æ˜¯ä¸“æ ä¸­æåˆ°çš„è¾…åŠ©å¼€å‘ç¥å™¨: Codotaå¯ä»¥ç‚¹å‡»ä¸‹å›¾æ‰€ç¤ºâ€œAdd Codota to you IDEAâ€ äº†è§£å®‰è£…æ­¥éª¤è¯¥æ’ä»¶çš„å¼ºå¤§ä¹‹å¤„åœ¨äºï¼š\n\næ”¯æŒæ™ºèƒ½ä»£ç è‡ªåŠ¨æç¤ºï¼Œè¯¥åŠŸèƒ½å¯ä»¥å¢å¼º IDEA çš„ä»£ç æç¤ºåŠŸèƒ½ã€‚\næ”¯æŒ JDK å’ŒçŸ¥åç¬¬ä¸‰æ–¹åº“çš„å‡½æ•°çš„ä½¿ç”¨æ–¹æ³•æœç´¢ï¼Œå¯ä»¥çœ‹åˆ°å…¶ä»–çŸ¥åå¼€æºé¡¹ç›®å¯¹è¯¥å‡½æ•°çš„ç”¨æ³•å½“æˆ‘ä»¬ç¬¬ä¸€æ¬¡ä½¿ç”¨æŸä¸ªç±»ï¼Œå¯¹æŸä¸ªå‡½æ•°ä¸å¤Ÿç†Ÿæ‚‰æ—¶ï¼Œå¯ä»¥é€šè¿‡è¯¥æ’ä»¶æœç´¢ç›¸å…³ç”¨æ³•ï¼Œå¿«é€Ÿæ¨¡ä»¿å­¦ä¹ å¦‚ä¸Šå›¾æ‰€ç¤ºï¼Œæˆ‘ä»¬æƒ³äº†è§£ Stream ç±»ä¸­ flatMap å‡½æ•°çš„ç”¨æ³•ï¼Œå¯ä»¥ä½¿ç”¨è¯¥æ’ä»¶æŸ¥çœ‹çŸ¥åå¼€æºé¡¹ç›®çš„ç”¨æ³•æ’ä»¶çª—å£é¡¶éƒ¨è¿˜ç»™å‡ºäº†è¯¥ç±»æœ€å¸¸ç”¨çš„å‡½æ•°ï¼Œå¯ä»¥ç‚¹å‡»æŸ¥çœ‹ç›¸å…³ç”¨æ³•æ¡ˆä¾‹ï¼Œæ¯ä¸ªæ¡ˆä¾‹å³ä¾§çš„ â€œview sourceâ€å¯ä»¥è·³è½¬åˆ°è¯¥ç‰‡æ®µå¯¹åº”çš„å¼€æºé¡¹ç›®çš„æºç ä¸­\n\nAuto filling Java call argumentså¼€å‘ä¸­ï¼Œæˆ‘ä»¬é€šå¸¸ä¼šè°ƒç”¨å…¶ä»–å·²ç»ç¼–å†™å¥½çš„å‡½æ•°ï¼Œè°ƒç”¨åéœ€è¦å¡«å……å‚æ•°ï¼Œä½†æ˜¯ç»å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œä¼ å…¥çš„å˜é‡åç§°å’Œè¯¥å‡½æ•°çš„å‚æ•°åä¸€è‡´ï¼Œå½“å‚æ•°è¾ƒå¤šæ—¶ï¼Œæ‰‹åŠ¨å•ä¸ªå¡«å……å‚æ•°éå¸¸æµªè´¹æ—¶é—´è¯¥æ’ä»¶å°±å¯ä»¥å¸®ä½ è§£å†³è¿™ä¸ªé—®é¢˜å®‰è£…å®Œè¯¥æ’ä»¶ä»¥åï¼Œè°ƒç”¨ä¸€ä¸ªå‡½æ•°ï¼Œä½¿ç”¨ Alt+Enter ç»„åˆé”®ï¼Œè°ƒå‡º â€œAuto fill call parametersâ€ è‡ªåŠ¨ä½¿ç”¨è¯¥å‡½æ•°å®šä¹‰çš„å‚æ•°åå¡«å……\nGenerateO2Oã€GenerateAllSetteræˆ‘ä»¬å®šä¹‰å¥½ä» A ç±»è½¬æ¢åˆ° B ç±»çš„å‡½æ•°è½¬æ¢å‡½æ•°åï¼Œä½¿ç”¨è¿™ä¸¤ä¸ªæ’ä»¶å¯ä»¥è‡ªåŠ¨è°ƒç”¨ Getter å’Œ Setter å‡½æ•°å®è¡Œè‡ªåŠ¨è½¬æ¢å®é™…å¼€å‘ä¸­è¿˜æœ‰ä¸€ä¸ªéå¸¸å¸¸è§çš„åœºæ™¯ï¼š æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªå¯¹è±¡åï¼Œæƒ³ä¾æ¬¡è°ƒç”¨ Setter å‡½æ•°å¯¹å±æ€§èµ‹å€¼ï¼Œå¦‚æœå±æ€§è¾ƒå¤šå¾ˆå®¹æ˜“é—æ¼æˆ–è€…é‡å¤å¯ä»¥ä½¿ç”¨è¿™ GenerateAllSetter æä¾›çš„åŠŸèƒ½ï¼Œè‡ªåŠ¨è°ƒç”¨æ‰€æœ‰ Setter å‡½æ•°ï¼ˆå¯å¡«å……é»˜è®¤å€¼ï¼‰ï¼Œç„¶åè‡ªå·±å†è·Ÿè¿›å®é™…éœ€æ±‚è®¾ç½®å±æ€§å€¼\nRainbow Bracketsç”±äºå¾ˆå¤šäººæ²¡æœ‰å…»æˆå¥½çš„ç¼–ç é£æ ¼ï¼Œæ²¡æœ‰éšæ‰‹ format ä»£ç çš„ä¹ æƒ¯ï¼Œç”šè‡³æœ‰äº›åŒäº‹ä¼šå†™ä»£ç è¶…è¿‡å‡ ç™¾è¡Œï¼Œé˜…è¯»èµ·æ¥å°†éå¸¸ç—›è‹¦ç—›è‹¦çš„åŸå› ä¹‹ä¸€å°±æ˜¯æ‰¾åˆ°ä¸Šä¸‹æ–‡ï¼Œç”±äºæ‹¬å·å¤ªå¤šï¼Œä¸ç¡®å®šå½“å‰ä»£ç è¡Œæ˜¯å¦å±äºæŸä¸ªä»£ç å—ï¼Œæ­¤æ—¶è¿™ä¸ªæ’ä»¶å°±ä¼šå¸®ä¸Šå¤§å¿™æ’ä»¶ github åœ°å€ï¼šhttps://github.com/izhangzhihao/intellij-rainbow-bracketså¤§å®¶å¯ä»¥è§‚çœ‹å…¶ github é¦–é¡µçš„åŠ¨å›¾ä½“ä¼šå’Œå­¦ä¹ å…¶å¼ºå¤§åŠŸèƒ½\nMaven Helperç°åœ¨ Java é¡¹ç›®é€šå¸¸ä¼šä½¿ç”¨ maven æˆ–è€… gradle æ„å»ºï¼Œå¯¹äºmaven é¡¹ç›®æ¥è¯´ï¼Œ jar åŒ…å†²çªéå¸¸å¸¸è§é‚£ä¹ˆå¦‚ä½•æ›´å®¹æ˜“åœ°æŸ¥çœ‹å’Œè§£å†³ jar åŒ…å†²çªå‘¢ï¼Ÿå¤§å®¶å¯ä»¥å®‰è£…è¯¥æ’ä»¶ï¼Œå®‰è£…å IDEA ä¸­æ‰“å¼€ pom.xml æ–‡ä»¶æ—¶ï¼Œå°±ä¼šå¤šå‡ºä¸€ä¸ª â€œDependency Analyzerâ€ é€‰é¡¹å¡å¦‚ä¸Šå›¾æ‰€ç¤ºï¼Œè¯¥æ’ä»¶æ”¯æŒå€¼æ’ä»¶å†²çªçš„ jar åŒ…ï¼Œå¯ä»¥é€‰æ‹©å†²çªçš„ jar åŒ…å°†å…¶ exclude æ‰\nFindBugsç¨‹åºå‘˜æ€»æ˜¯æƒ³å°½å¯èƒ½åœ°é¿å…å†™ BUGï¼Œ FindBugs ä½œä¸ºé™æ€ä»£ç æ£€æŸ¥æ’ä»¶ï¼Œå¯ä»¥æ£€æŸ¥ä½ ä»£ç ä¸­çš„éšæ‚£ï¼Œå¹¶ç»™å‡ºåŸå› ã€‚å½“ç„¶è¿˜æœ‰å¾ˆå¤šç±»ä¼¼çš„é™æ€ä»£ç æ£€æŸ¥æ’ä»¶ï¼Œå¤§å®¶å¯ä»¥è‡ªè¡Œäº†è§£å®‰è£…\nSequenceDiagramSequenceDiagram å¯ä»¥æ ¹æ®ä»£ç è°ƒç”¨é“¾è·¯è‡ªåŠ¨ç”Ÿæˆæ—¶åºå›¾ï¼Œè¶…çº§èµï¼Œè¶…çº§æ¨èï¼è¿™å¯¹ç ”ç©¶æºç ï¼Œæ¢³ç†å·¥ä½œä¸­çš„ä¸šåŠ¡ä»£ç æœ‰æå¤§çš„å¸®åŠ©ï¼Œå ªç§°ç¥å™¨ã€‚å®‰è£…å®Œæˆåï¼Œåœ¨æŸä¸ªç±»çš„æŸä¸ªå‡½æ•°ä¸­ï¼Œå³é”® â€“Sequence Diagaram å³å¯è°ƒå‡ºã€‚å¦‚ä¸‹å›¾æ˜¯ Netty çš„æºç ï¼Œå¯ä»¥é€šè¿‡è¯¥æ’ä»¶ç»˜åˆ¶å‡ºå½“å‰å‡½æ•°çš„è°ƒç”¨é“¾è·¯ã€‚åŒå‡»é¡¶éƒ¨çš„ç±»åå¯ä»¥è·³è½¬åˆ°å¯¹åº”ç±»çš„æºç ä¸­ï¼ŒåŒå‡»è°ƒç”¨çš„å‡½æ•°åå¯ä»¥ç›´æ¥è°ƒå…¥æŸä¸ªå‡½æ•°çš„æºç ï¼Œæ€»ä¹‹éå¸¸å¼ºå¤§ã€‚\nJava Stream DebuggerStream éå¸¸å¥½ç”¨ï¼Œå¯ä»¥çµæ´»å¯¹æ•°æ®è¿›è¡Œæ“ä½œï¼Œä½†æ˜¯å¯¹å¾ˆå¤šåˆšæ¥è§¦çš„äººæ¥è¯´ï¼Œä¸å¥½ç†è§£ã€‚é‚£ä¹ˆ Java Stream Debugger è¿™æ¬¾ç¥å™¨çš„ IDEA å°±å¯ä»¥å¸®åˆ°ä½ ã€‚å®ƒå¯ä»¥å°† Stream çš„æ“ä½œæ­¥éª¤å¯è§†åŒ–ï¼Œéå¸¸æœ‰åŠ©äºæˆ‘ä»¬çš„å­¦ä¹ ã€‚\nKey promoter Xå¾ˆå¤šäººä¸æ„¿æ„åˆ‡æ¢ IDE å°±æ˜¯å› ä¸ºå¿«æ·é”®çš„ä¹ æƒ¯é—®é¢˜ã€‚åˆšå¥½è¿™ä¸ªæ’ä»¶å¯ä»¥æé†’å¿«æ·é”®ï¼Œæœ‰ä»£å…¥æ„Ÿï¼Œæé†’çš„å¤šäº†ä½ å°±ä¼šäº†ã€‚å¯¹äºæ–°æ‰‹å»ºè®®å®‰è£…ç†Ÿæ‚‰ä¸€ä¸‹å¿«æ·é”®ã€‚\nIDEA Mind Mapæ€ç»´å¯¼å›¾å¯¹äºæˆ‘ä»¬éœ€æ±‚åˆ†æå’ŒçŸ¥è¯†åº“å…³ç³»æ¢³ç†ååˆ†é‡è¦ã€‚æœ‰äº†è¿™ä¸ªæ’ä»¶ä»¥å IDEA ä¹Ÿå¯ä»¥ç”»æ€ç»´å¯¼å›¾äº†ã€‚è€Œä¸”åŠŸèƒ½è¿˜ååˆ†å¼ºå¤§ï¼Œè´´å›¾å•¥çš„åº”æœ‰å°½æœ‰\nCodeGlanceä»£ç ç¼–è¾‘åŒºè¿·ä½ ç¼©æ”¾æ’ä»¶ï¼Œå¯ä»¥è¿›è¡Œä»£ç çš„å…¨å±€é¢„è§ˆã€‚æ¥çœ‹çœ‹æ•ˆæœå§\nCamelCaseå‘½åé£æ ¼è½¬æ¢æ’ä»¶ï¼Œå¯ä»¥åœ¨ kebab-caseï¼ŒSNAKE_CASEï¼ŒPascalCaseï¼ŒcamelCaseï¼Œsnake_case å’Œ ç©ºæ ¼é£æ ¼ä¹‹é—´åˆ‡æ¢ã€‚å¿«æ·é”®è‹¹æœä¸º â‡§+âŒ¥+ U ï¼Œwindows ä¸‹ä¸º Shift + Alt +U\nMybatisXMybatis-plus å›¢é˜Ÿä¸º Mybatis å¼€å‘çš„æ’ä»¶ï¼Œæä¾›äº† Mapper æ¥å£å’Œ XMLä¹‹é—´çš„è·³è½¬å’Œè‡ªåŠ¨ç”Ÿæˆæ¨¡ç‰ˆçš„åŠŸèƒ½\nMyBatis Log Pluginå¦ä¸€æ¬¾å›½äººå…³äº Mybatis çš„ä½œå“ï¼Œè¯„åˆ†ä¹Ÿå¾ˆé«˜ï¼Œä½œç”¨æ˜¯å°† Mybatis ç”Ÿæˆçš„ sql è¿˜åŸä¸ºåŸå§‹æ•´ä¸ª sqlã€‚æ–¹ä¾¿åœ¨å¼€å‘ä¸­ä»æ—¥å¿—ä¸­è·Ÿè¸ªè°ƒè¯• sqlè¯­å¥https://vdn.vzuu.com/SD/04205f24-23a2-11eb-a602-d6a043673cc5.mp4?disable_local_cache=1&amp;bu=078babd7&amp;c=avc.0.0&amp;f=mp4&amp;expiration=1652064414&amp;auth_key=1652064414-0-0-ed4dc28442589dc4e9e6703457fc9811&amp;v=ali&amp;pu=078babd7\nGit Commit Templateè€æ˜¯æœ‰äººåæ§½ä½ æäº¤çš„ Git ä¸è§„èŒƒï¼Ÿä½ å¯ä»¥è¯•è¯•è¿™ä¸ªæ’ä»¶ã€‚å®ƒæä¾›äº†å¾ˆå¥½çš„ Git æ ¼å¼åŒ–æ¨¡ç‰ˆï¼Œä½ å¯ä»¥æŒ‰ç…§å®é™…æƒ…å†µæ ¼å¼åŒ–ä½ çš„æäº¤ä¿¡æ¯\nFast RequestFast Requestæ˜¯ä¸€ä¸ªåŸºäºspringmvcçš„å¸®åŠ©ä½ å¿«é€Ÿç”Ÿæˆurlå’Œå‚æ•°çš„æ’ä»¶,åŒæ—¶ä¹Ÿæ˜¯ä¸€ä¸ªhttp clientå·¥å…·,è°ƒè¯•APIçš„æ—¶å€™åªéœ€è¦ç‚¹å‡»ç”Ÿæˆå›¾æ ‡å³å¯åœ¨å·¥å…·çª—å£ç”Ÿæˆæ–¹æ³•çš„urlä»¥åŠå¯¹åº”çš„å‚æ•°ï¼Œå†ç‚¹å‡»å‘é€è¯·æ±‚æŒ‰é’®å³å¯å®Œæˆapiè°ƒè¯•ï¼Œéå¸¸å®ç”¨ï¼Œç›¸æ¯”äº Http clientå’Œrestfultoolï¼Œè¯¥æ’ä»¶æ‹¥æœ‰postmanä¸€æ ·çš„ç•Œé¢å’Œå‚æ•°ç”ŸæˆåŠŸèƒ½ï¼ŒåŸŸåç®¡ç†åŠŸèƒ½ï¼Œè‡ªå®šä¹‰å‚æ•°è§£æåŠŸèƒ½ï¼ŒåŠŸèƒ½æ›´åŠ å¼ºå¤§å…¨é¢ã€ç¼ºç‚¹ã€‘æ”¶è´¹\nEasy Javadocå¿«é€Ÿç”Ÿæˆjavadocæ–‡æ¡£ï¼Œç‚¹å‡»å¿«æ·é”®ç”Ÿæˆæ–¹æ³•æˆ–ç±»æˆ–å±æ€§çš„javadocï¼ŒåŒæ—¶æ”¯æŒå„ç§æ¸ é“çš„ç¿»è¯‘(å»ºè®®ä¸è¦ç”¨æœ‰é“ç¿»è¯‘ï¼Œä¸å‡†)\nMybatisCodeHelperProæœ€å¥½çš„Mybatisä»£ç æç¤ºï¼Œå®Œæ•´æ”¯æŒMybatisåŠ¨æ€sqlä»£ç æç¤ºï¼Œä»£ç æ£€æµ‹ï¼Œå†™sqlå‡ ä¹æ‰€æœ‰åœ°æ–¹éƒ½æœ‰ä»£ç æç¤ºï¼Œæ”¯æŒåŸºäºæ–¹æ³•ååŠ¨æ€ç”Ÿæˆsqlï¼Œç”ŸæˆåŸºç¡€å®ä½“ç±»åŠmapperï¼ŒåŠŸèƒ½éå¸¸å¼ºå¤§\nTranslationå¯¹äºè‹±æ–‡ä¸å¥½çš„å¼€å‘è€…æ¥è¯´ï¼Œè¿™æ¬¾æ’ä»¶å°±æ˜¯ç¥å™¨ï¼Œåœ¨çœ‹å„ç§æ¡†æ¶æºç çš„æ—¶å€™ååˆ†æœ‰ç”¨; é€‰æ‹©å³é”®å°±å¯ä»¥ç¿»è¯‘ï¼Œå¯¹äºæ–¹æ³•æˆ–è€…ç±»ä¸Šé¢çš„æ³¨é‡Šï¼Œåªè¦æŒ‰ä¸‹F1å°±è‡ªåŠ¨è¢«ç¿»è¯‘æˆä¸­æ–‡(å»ºè®®è‡ªå®šä¹‰å¿«æ·é”®)\nJrebelè€ç‰Œæ’ä»¶äº†ï¼Œæ”¯æŒçƒ­å¯åŠ¨ï¼Œä¿®æ”¹ä¸€äº›ä»£ç ä¸å†éœ€è¦é‡å¯åº”ç”¨ï¼Œå¤§å¤§å‡å°é¡¹ç›®é‡å¯å¸¦æ¥çš„æ—¶é—´æµªè´¹ï¼ŒåŒæ—¶ä¹Ÿæ”¯æŒè¿œç¨‹å¯åŠ¨è°ƒè¯•\n.ignore.ignoreæ˜¯IDEAçš„ä¸€æ¬¾ä¸“ç”¨å¿½ç•¥æ–‡ä»¶çš„æ’ä»¶\ngoogle-java-formatgoogle-java-formatæ’ä»¶å¯ä»¥å¸®åŠ©æˆ‘ä»¬ä¸é€šè¿‡å¯¹åº”çš„å¿«æ·é”®å°±å¯ä»¥å®ç°ç‰¹å®šæ–¹å¼ä¸‹è‡ªåŠ¨æ ¼å¼åŒ–ä»£ç \nLeetcode EditorLeetCodeæ’ä»¶ï¼Œå¯ä»¥åœ¨IDEAä¸­åœ¨çº¿åˆ·é¢˜ã€‚ä¸Šç­æ‘¸é±¼å±å®æ–¹ä¾¿ï¼Œè¡¨é¢ä¸Šæˆ‘åœ¨å¹²æ´»ï¼Œå®é™…ä¸Šæˆ‘åœ¨åˆ·ç®—æ³•é¢˜\nJson ParseråŒå€¦äº†æ‰“å¼€æµè§ˆå™¨æ ¼å¼åŒ–å’ŒéªŒè¯JSON?ä¸ºä»€ä¹ˆä¸å®‰è£…JSONè§£æå™¨å¹¶åœ¨IDEä¸­ä½¿ç”¨ç¦»çº¿æ”¯æŒå‘¢?JSONè§£æå™¨æ˜¯ä¸€ä¸ªç”¨äºéªŒè¯å’Œæ ¼å¼åŒ–JSONå­—ç¬¦ä¸²çš„è½»é‡çº§æ’ä»¶\n","tags":["idea","æ’ä»¶"]},{"title":"IDEAå†…å­˜è°ƒä¼˜","url":"/2022/05/06/0.2.0IDEA%E5%86%85%E5%AD%98%E8%B0%83%E4%BC%98/","content":"idea2020æ— æ³•å¯åŠ¨æŠ¥é”™åˆå§‹å †å€¼å¤§äºæœ€å¤§å †å€¼_å¯’çƒŸé›¾æŸ³çš„åšå®¢-CSDNåšå®¢\nè°ƒæ•´å†…å­˜çš„æ—¶å€™ä¸€å®šXms2048mä¸èƒ½å¤§äºXmx4096mã€å¦åˆ™ideaå¯åŠ¨ä¸èµ·æ¥ã€‘\nxmxå»ºè®®è®¾ç½®ä¸ºï¼ˆæ€»å†…å­˜çš„3/4 Ã· ä½ è¦å¼€çš„ideaä¸ªæ•°ï¼‰ï¼Œè¿™æ ·æ‰ä¸ä¼šå¡\n-Xms1024m-Xmx8192m-XX:MaxPermSize=2048m-XX:ReservedCodeCacheSize=256m-ea-Dsun.io.useCanonCaches=false-Dsun.awt.keepWorkingSetOnMinimize=true-Djava.net.preferIPv4Stack=true#-Djsse.enableSNIExtension=false-XX:+UseCodeCacheFlushing-XX:+UseConcMarkSweepGC-XX:SoftRefLRUPolicyMSPerMB=50","tags":["jvm"]},{"title":"è®¾è®¡æ¨¡å¼-åˆ›å»ºå‹æ¨¡å¼-åŸå‹æ¨¡å¼","url":"/2022/05/21/0.2.3-%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F-%E5%88%9B%E5%BB%BA%E5%9E%8B%E6%A8%A1%E5%BC%8F-%E5%8E%9F%E5%9E%8B%E6%A8%A1%E5%BC%8F/","content":"ä»‹ç»åŸå‹æ¨¡å¼æ˜¯æŒ‡ï¼Œä¸€ä¸ªæŠ½è±¡ç±» Prototype å…·æœ‰ä¸€ä¸ªclone æ–¹æ³•ï¼Œå…¶å®ç°ç±»ConcretePrototype1ã€ConcretePrototype2 å®ç°å„è‡ªçš„cloneæ–¹æ³•ï¼Œåœ¨ä½¿ç”¨çš„æ—¶å€™ï¼Œè°ƒç”¨Prototypeçš„cloneæ–¹æ³•å¯ä»¥cloneä»»æ„å®ç°ç±»ã€‚å…¶ä½œç”¨å°±æ˜¯å¿«é€Ÿåˆ›å»ºä¸€ä¸ªæ–°çš„å¯¹è±¡\nè§’è‰²\nPrototypeï¼ˆæŠ½è±¡åŸå‹ç±»ï¼‰ï¼šå®ƒæ˜¯å£°æ˜å…‹éš†æ–¹æ³•çš„æ¥å£ï¼Œæ˜¯æ‰€æœ‰å…·ä½“åŸå‹ç±»çš„å…¬å…±çˆ¶ç±»ï¼Œå¯ä»¥æ˜¯æŠ½è±¡ç±»ä¹Ÿå¯ä»¥æ˜¯æ¥å£ï¼Œç”šè‡³è¿˜å¯ä»¥æ˜¯å…·ä½“å®ç°ç±»ã€‚\nConcretePrototypeï¼ˆå…·ä½“åŸå‹ç±»ï¼‰ï¼šå®ƒå®ç°åœ¨æŠ½è±¡åŸå‹ç±»ä¸­å£°æ˜çš„å…‹éš†æ–¹æ³•ï¼Œåœ¨å…‹éš†æ–¹æ³•ä¸­è¿”å›è‡ªå·±çš„ä¸€ä¸ªå…‹éš†å¯¹è±¡ã€‚\nClientï¼ˆå®¢æˆ·ç±»ï¼‰ï¼šè®©ä¸€ä¸ªåŸå‹å¯¹è±¡å…‹éš†è‡ªèº«ä»è€Œåˆ›å»ºä¸€ä¸ªæ–°çš„å¯¹è±¡ï¼Œåœ¨å®¢æˆ·ç±»ä¸­åªéœ€è¦ç›´æ¥å®ä¾‹åŒ–æˆ–é€šè¿‡å·¥å‚æ–¹æ³•ç­‰æ–¹å¼åˆ›å»ºä¸€ä¸ªåŸå‹å¯¹è±¡ï¼Œå†é€šè¿‡è°ƒç”¨è¯¥å¯¹è±¡çš„å…‹éš†æ–¹æ³•å³å¯å¾—åˆ°å¤šä¸ªç›¸åŒçš„å¯¹è±¡ã€‚ç”±äºå®¢æˆ·ç±»é’ˆå¯¹æŠ½è±¡åŸå‹ç±»Prototypeç¼–ç¨‹ï¼Œå› æ­¤ç”¨æˆ·å¯ä»¥æ ¹æ®éœ€è¦é€‰æ‹©å…·ä½“åŸå‹ç±»ï¼Œç³»ç»Ÿå…·æœ‰è¾ƒå¥½çš„å¯æ‰©å±•æ€§ï¼Œå¢åŠ æˆ–æ›´æ¢å…·ä½“åŸå‹ç±»éƒ½å¾ˆæ–¹ä¾¿ã€‚\nä½•æ—¶ä½¿ç”¨åŸå‹æ¨¡å¼\néœ€è¦åˆ›å»ºçš„å¯¹è±¡åº”ç‹¬ç«‹äºå…¶ç±»å‹ä¸åˆ›å»ºæ–¹å¼\nè¦å®ä¾‹åŒ–çš„ç±»æ˜¯åœ¨è¿è¡Œæ—¶å†³å®šçš„\nç±»ä¸å®¹æ˜“åˆ›å»ºï¼Œæ¯”å¦‚æ¯ä¸ªç»„ä»¶å¯æŠŠå…¶ä»–ç»„ä»¶ä½œä¸ºå­èŠ‚ç‚¹çš„ç»„åˆå¯¹è±¡ã€‚å¤åˆ¶å·²æœ‰çš„ç»„åˆå¯¹è±¡å¹¶å¯¹å‰¯æœ¬è¿›è¡Œä¿®æ”¹ä¼šæ›´åŠ å®¹æ˜“\nä»åŠŸèƒ½çš„è§’åº¦æ¥è®²ï¼Œä¸ç®¡ä»€ä¹ˆå¯¹è±¡ï¼Œåªè¦å¤åˆ¶è‡ªèº«æ¯”æ‰‹å·¥å®ä¾‹åŒ–è¦å¥½ï¼Œéƒ½å¯ä»¥æ˜¯åŸå‹å¯¹è±¡\nä¸åŒç±»çš„å®ä¾‹é—´çš„å·®å¼‚ä»…æ˜¯çŠ¶æ€çš„è‹¥å¹²ç»„åˆã€‚å› æ­¤å¤åˆ¶ç›¸åº”æ•°é‡çš„åŸå‹æ¯”æ‰‹å·¥å®ä¾‹åŒ–æ›´åŠ æ–¹ä¾¿\néœ€è¦ä½¿ç”¨ç»„åˆ(æ ‘å‹)å¯¹è±¡ä½œä¸ºå…¶ä»–ä¸œè¥¿çš„åŸºç¡€ã€‚ä¾‹å¦‚ï¼Œä½¿ç”¨ç»„åˆå¯¹è±¡ä½œä¸ºç»„ä»¶æ¥æ„å»ºå¦ä¸€ä¸ªç»„åˆå¯¹è±¡\n\nåŸå‹æ¨¡å¼åŸç†ä¸€ä¸ªåŸå‹ç±»ï¼Œåªéœ€è¦å®ç°Cloneableæ¥å£ï¼Œè¦†å†™cloneæ–¹æ³•ï¼Œæ­¤å¤„cloneæ–¹æ³•å¯ä»¥æ”¹æˆä»»æ„çš„åç§°ï¼Œå› ä¸ºCloneableæ¥å£æ˜¯ä¸ªç©ºæ¥å£ï¼Œä½ å¯ä»¥ä»»æ„å®šä¹‰å®ç°ç±»çš„æ–¹æ³•åï¼Œå¦‚cloneAæˆ–è€…cloneBï¼Œå› ä¸ºæ­¤å¤„çš„é‡ç‚¹æ˜¯super.clone()è¿™å¥è¯ï¼Œsuper.clone()è°ƒç”¨çš„æ˜¯Objectçš„clone()æ–¹æ³•ï¼Œè€Œåœ¨Objectç±»ä¸­ï¼Œclone()æ˜¯nativeçš„éœ€è¦æ³¨æ„çš„æ˜¯èƒ½å¤Ÿå®ç°å…‹éš†çš„Javaç±»å¿…é¡»å®ç°ä¸€ä¸ªæ ‡è¯†æ¥å£Cloneableï¼Œè¡¨ç¤ºè¿™ä¸ªJavaç±»æ”¯æŒè¢«å¤åˆ¶ã€‚å¦‚æœä¸€ä¸ªç±»æ²¡æœ‰å®ç°è¿™ä¸ªæ¥å£ä½†æ˜¯è°ƒç”¨äº†clone()æ–¹æ³•ï¼ŒJavaç¼–è¯‘å™¨å°†æŠ›å‡ºä¸€ä¸ªCloneNotSupportedExceptionå¼‚å¸¸ã€‚\nclass ConcretePrototype implements  Cloneable&#123;â€¦â€¦public Prototype  clone()&#123;ã€€ã€€Object object = null;ã€€ã€€try &#123;ã€€ã€€ã€€ã€€ã€€object = super.clone();ã€€ã€€&#125; catch (CloneNotSupportedException exception) &#123;ã€€ã€€ã€€ã€€ã€€System.err.println(&quot;Not support cloneable&quot;);ã€€ã€€&#125;ã€€ã€€return (Prototype )object;&#125;â€¦â€¦&#125;\n\nåœ¨å®¢æˆ·ç«¯åˆ›å»ºåŸå‹å¯¹è±¡å’Œå…‹éš†å¯¹è±¡ä¹Ÿå¾ˆç®€å•ï¼Œå¦‚ä¸‹ä»£ç æ‰€ç¤ºï¼š\nPrototype obj1  = new ConcretePrototype();Prototype obj2  = obj1.clone();\n\nä¸€èˆ¬è€Œè¨€ï¼ŒJavaè¯­è¨€ä¸­çš„clone()æ–¹æ³•éƒ½éœ€è¦æ»¡è¶³ï¼š\n\nå¯¹ä»»ä½•å¯¹è±¡xï¼Œéƒ½æœ‰x.clone() != xï¼Œå³å…‹éš†å¯¹è±¡ä¸åŸå‹å¯¹è±¡ä¸æ˜¯åŒä¸€ä¸ªå¯¹è±¡ï¼›\nå¯¹ä»»ä½•å¯¹è±¡xï¼Œéƒ½æœ‰x.clone().getClass() == x.getClass()ï¼Œå³å…‹éš†å¯¹è±¡ä¸åŸå‹å¯¹è±¡çš„ç±»å‹ä¸€æ ·ï¼›\nå¦‚æœå¯¹è±¡xçš„equals()æ–¹æ³•å®šä¹‰æ°å½“ï¼Œé‚£ä¹ˆx.clone().equals(x)åº”è¯¥æˆç«‹ã€‚ä¸ºäº†è·å–å¯¹è±¡çš„ä¸€ä»½æ‹·è´ï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥åˆ©ç”¨Objectç±»çš„clone()æ–¹æ³•ï¼Œå…·ä½“æ­¥éª¤å¦‚ä¸‹ï¼š\nåœ¨æ´¾ç”Ÿç±»ä¸­è¦†ç›–åŸºç±»çš„clone()æ–¹æ³•ï¼Œå¹¶å£°æ˜ä¸ºpublicï¼›\nåœ¨æ´¾ç”Ÿç±»çš„clone()æ–¹æ³•ä¸­ï¼Œè°ƒç”¨super.clone()ï¼›\næ´¾ç”Ÿç±»éœ€å®ç°Cloneableæ¥å£ã€‚æ­¤æ—¶ï¼ŒObjectç±»ç›¸å½“äºæŠ½è±¡åŸå‹ç±»ï¼Œæ‰€æœ‰å®ç°äº†Cloneableæ¥å£çš„ç±»ç›¸å½“äºå…·ä½“åŸå‹ç±»ã€‚\n\næµ…æ‹·è´(ShallowClone)å’Œæ·±æ‹·è´(DeepClone)ä»‹ç»\næµ…æ‹·è´åœ¨æµ…æ‹·è´ä¸­ï¼Œå¦‚æœåŸå‹å¯¹è±¡çš„æˆå‘˜å˜é‡æ˜¯å€¼ç±»å‹ï¼Œå°†å¤åˆ¶ä¸€ä»½ç»™æ‹·è´å¯¹è±¡ï¼›å¦‚æœåŸå‹å¯¹è±¡çš„æˆå‘˜å˜é‡æ˜¯å¼•ç”¨ç±»å‹ï¼Œåˆ™å°†å¼•ç”¨å¯¹è±¡çš„åœ°å€å¤åˆ¶ä¸€ä»½ç»™æ‹·è´å¯¹è±¡ï¼Œä¹Ÿå°±æ˜¯è¯´åŸå‹å¯¹è±¡å’Œæ‹·è´å¯¹è±¡çš„æˆå‘˜å˜é‡æŒ‡å‘ç›¸åŒçš„å†…å­˜åœ°å€ã€‚ç®€å•æ¥è¯´ï¼Œåœ¨æµ…æ‹·è´ä¸­ï¼Œå½“å¯¹è±¡è¢«å¤åˆ¶æ—¶åªå¤åˆ¶å®ƒæœ¬èº«å’Œå…¶ä¸­åŒ…å«çš„å€¼ç±»å‹çš„æˆå‘˜å˜é‡ï¼Œè€Œå¼•ç”¨ç±»å‹çš„æˆå‘˜å¯¹è±¡å¹¶æ²¡æœ‰å¤åˆ¶\næ·±æ‹·è´åœ¨æ·±æ‹·è´ä¸­ï¼Œæ— è®ºåŸå‹å¯¹è±¡çš„æˆå‘˜å˜é‡æ˜¯å€¼ç±»å‹è¿˜æ˜¯å¼•ç”¨ç±»å‹ï¼Œéƒ½å°†å¤åˆ¶ä¸€ä»½ç»™æ‹·è´å¯¹è±¡ï¼Œæ·±æ‹·è´å°†åŸå‹å¯¹è±¡çš„æ‰€æœ‰å¼•ç”¨å¯¹è±¡ä¹Ÿå¤åˆ¶ä¸€ä»½ç»™æ‹·è´å¯¹è±¡ã€‚ç®€å•æ¥è¯´ï¼Œåœ¨æ·±æ‹·è´ä¸­ï¼Œé™¤äº†å¯¹è±¡æœ¬èº«è¢«å¤åˆ¶å¤–ï¼Œå¯¹è±¡æ‰€åŒ…å«çš„æ‰€æœ‰æˆå‘˜å˜é‡ä¹Ÿå°†å¤åˆ¶\n\næ€»ç»“ç®€å•æ¥è¯´ï¼Œå°±æ˜¯æ·±å¤åˆ¶è¿›è¡Œäº†å®Œå…¨å½»åº•çš„å¤åˆ¶ï¼Œè€Œæµ…å¤åˆ¶ä¸å½»åº•ã€‚cloneæ˜æ˜¾æ˜¯æ·±å¤åˆ¶ï¼Œcloneå‡ºæ¥çš„å¯¹è±¡æ˜¯æ˜¯ä¸èƒ½å»å½±å“åŸå‹å¯¹è±¡çš„\næµ…æ‹·è´public class Message implements Cloneable&#123;    private String name; //å§“å    private ExpenseDetail detail;//æ¶ˆè´¹æ˜ç»†    public Message() &#123;        System.out.println(&quot;æ‰§è¡Œæ„é€ å‡½æ•°Message&quot;);        detail = new ExpenseDetail();    &#125;    public void setMessage(String name, String type,double money) &#123;        this.name = name;        this.detail.setType(type);        this.detail.setMoney(money);    &#125;    @NonNull    @Override    public Message clone() &#123;        Message message = null;        try &#123;            message = (Message) super.clone();        &#125; catch (CloneNotSupportedException e) &#123;            e.printStackTrace();        &#125;        return message;    &#125;    public void sendMessage()&#123;        System.out.println(name +&quot;æ‚¨å¥½ï¼šæ‚¨ä»Šå¤©&quot;+detail.getType()+&quot;æ¶ˆè´¹äº†&quot;+detail.getMoney()+&quot;å…ƒ&quot;);    &#125;&#125;\næ¶ˆè´¹æ˜ç»†\npublic class ExpenseDetail&#123;    private String type;    private double money;    public String getType() &#123;        return type;    &#125;    public void setType(String type) &#123;        this.type = type;    &#125;    public double getMoney() &#123;        return money;    &#125;    public void setMoney(double money) &#123;        this.money = money;    &#125;&#125;\n\npublic class MbClient &#123;    public static void main(String[] args)&#123;        Message message = new Message();        message.setMessage(&quot;å¼ ä¸‰&quot;,&quot;åƒé¥­&quot;,10);        Message message1 = message.clone();        message1.setMessage(&quot;æå››&quot;,&quot;çœ‹ç”µå½±&quot;,50);        Message message2 = message.clone();        message2.setMessage(&quot;ç‹äº”&quot;,&quot;ä¹°ä¹¦&quot;,100);        message.sendMessage();        message1.sendMessage();        message2.sendMessage();    &#125;&#125;ç»“æœæ‰§è¡Œæ„é€ å‡½æ•°Messageå¼ ä¸‰æ‚¨å¥½ï¼šæ‚¨ä»Šå¤©ä¹°ä¹¦æ¶ˆè´¹äº†100.0å…ƒæå››æ‚¨å¥½ï¼šæ‚¨ä»Šå¤©ä¹°ä¹¦æ¶ˆè´¹äº†100.0å…ƒç‹äº”æ‚¨å¥½ï¼šæ‚¨ä»Šå¤©ä¹°ä¹¦æ¶ˆè´¹äº†100.0å…ƒ\n\næˆ‘ä»¬å¯ä»¥çœ‹åˆ°æ‰€æœ‰äººçš„æ¶ˆè´¹æ˜ç»†å±…ç„¶éƒ½ä¸€æ ·ï¼Œè¿™æ˜¯å› ä¸ºObjectç±»æä¾›çš„cloneæ–¹æ³•ï¼Œä¸ä¼šæ‹·è´å¯¹è±¡ä¸­çš„å†…éƒ¨æ•°ç»„å’Œå¼•ç”¨å¯¹è±¡ï¼Œå¯¼è‡´å®ƒä»¬ä»æ—§æŒ‡å‘åŸæ¥å¯¹è±¡çš„å†…éƒ¨å…ƒç´ åœ°å€ï¼Œè¿™ç§æ‹·è´å«åšæµ…æ‹·è´ã€‚\n\nç”±æ­¤è€Œå¯¼è‡´æœ€åä¸€æ¬¡çš„å€¼ä¼šè¦†ç›–å‰ä¸€æ¬¡çš„å€¼ã€‚æ­¤æ—¶çš„message.getDetail = message1.getDetail =message2.getDetail\n\næ·±æ‹·è´æ·±æ‹·è´æ–¹å¼æœ‰ä¸¤ç§:ç»§æ‰¿cloneableæˆ–è€…è¿›è¡ŒSerializable\nç»§æ‰¿cloneableæ¥å£public class Message implements Cloneable&#123;    ...        @NonNull    @Override    public Message clone() &#123;        Message message = null;        try &#123;            message = (Message) super.clone();            message.detail = this.detail.clone();//æ‹·è´æ¶ˆè´¹æ˜ç»†        &#125; catch (CloneNotSupportedException e) &#123;            e.printStackTrace();        &#125;        return message;    &#125;    ...&#125;\npublic class ExpenseDetail implements Cloneable&#123;    private String type;    private double money;    ...    @NonNull    @Override    protected ExpenseDetail clone()&#123;        ExpenseDetail detail = null;        try &#123;            detail = (ExpenseDetail) super.clone();        &#125; catch (CloneNotSupportedException e) &#123;            e.printStackTrace();        &#125;        return detail;    &#125;&#125;\nç»“æœæ‰§è¡Œæ„é€ å‡½æ•°Messageå¼ ä¸‰æ‚¨å¥½ï¼šæ‚¨ä»Šå¤©åƒé¥­æ¶ˆè´¹äº†10.0å…ƒæå››æ‚¨å¥½ï¼šæ‚¨ä»Šå¤©çœ‹ç”µå½±æ¶ˆè´¹äº†50.0å…ƒç‹äº”æ‚¨å¥½ï¼šæ‚¨ä»Šå¤©ä¹°ä¹¦æ¶ˆè´¹äº†100.0å…ƒ\n\næ­¤æ—¶çš„message.getDetail != message1.getDetail !=message2.getDetail\nåºåˆ—åŒ–å®ç°import  java.io.*;//é™„ä»¶ç±»class  Attachment implements Serializable&#123;       private  String name; //é™„ä»¶å       public  void setName(String name)       &#123;              this.name  = name;       &#125;       public  String getName()       &#123;              return  this.name;       &#125;     public void download()     &#123;            System.out.println(&quot;ä¸‹è½½é™„ä»¶ï¼Œæ–‡ä»¶åä¸º&quot; + name);     &#125;&#125;\nimport  java.io.*;//å·¥ä½œå‘¨æŠ¥ç±»class  WeeklyLog implements Serializable&#123;       private  Attachment attachment;       private  String name;       private  String date;       private  String content;       public  void setAttachment(Attachment attachment) &#123;              this.attachment  = attachment;       &#125;       public  void setName(String name) &#123;              this.name  = name;       &#125;       public  void setDate(String date) &#123;              this.date  = date;       &#125;       public  void setContent(String content) &#123;              this.content  = content;       &#125;       public  Attachment getAttachment()&#123;              return  (this.attachment);       &#125;       public  String getName() &#123;              return  (this.name);       &#125;       public  String getDate() &#123;              return  (this.date);       &#125;       public  String getContent() &#123;              return  (this.content);       &#125;   //ä½¿ç”¨åºåˆ—åŒ–æŠ€æœ¯å®ç°æ·±å…‹éš†       public WeeklyLog deepClone() throws  IOException, ClassNotFoundException, OptionalDataException       &#123;              //å°†å¯¹è±¡å†™å…¥æµä¸­              ByteArrayOutputStream bao=new  ByteArrayOutputStream();              ObjectOutputStream oos=new  ObjectOutputStream(bao);              oos.writeObject(this);              //å°†å¯¹è±¡ä»æµä¸­å–å‡º              ByteArrayInputStream bis=new  ByteArrayInputStream(bao.toByteArray());              ObjectInputStream ois=new  ObjectInputStream(bis);              return  (WeeklyLog)ois.readObject();       &#125;&#125;\nå·¥ä½œå‘¨æŠ¥ç±»WeeklyLogä¸å†ä½¿ç”¨Javaè‡ªå¸¦çš„å…‹éš†æœºåˆ¶ï¼Œè€Œæ˜¯é€šè¿‡åºåˆ—åŒ–æ¥ä»å¤´å®ç°å¯¹è±¡çš„æ·±å…‹éš†ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦é‡æ–°ç¼–å†™clone()æ–¹æ³•\nclass Client&#123;       public  static void main(String args[])       &#123;              WeeklyLog  log_previous, log_new = null;              log_previous  = new WeeklyLog(); //åˆ›å»ºåŸå‹å¯¹è±¡              Attachment  attachment = new Attachment(); //åˆ›å»ºé™„ä»¶å¯¹è±¡              log_previous.setAttachment(attachment);  //å°†é™„ä»¶æ·»åŠ åˆ°å‘¨æŠ¥ä¸­              try              &#123;                     log_new =  log_previous.deepClone(); //è°ƒç”¨æ·±å…‹éš†æ–¹æ³•åˆ›å»ºå…‹éš†å¯¹è±¡                                &#125;              catch(Exception e)              &#123;                     System.err.println(&quot;å…‹éš†å¤±è´¥ï¼&quot;);              &#125;              //æ¯”è¾ƒå‘¨æŠ¥              System.out.println(&quot;å‘¨æŠ¥æ˜¯å¦ç›¸åŒï¼Ÿ &quot; + (log_previous ==  log_new));              //æ¯”è¾ƒé™„ä»¶              System.out.println(&quot;é™„ä»¶æ˜¯å¦ç›¸åŒï¼Ÿ &quot; +  (log_previous.getAttachment() == log_new.getAttachment()));       &#125;&#125;\nå‘¨æŠ¥æ˜¯å¦ç›¸åŒï¼Ÿ  falseé™„ä»¶æ˜¯å¦ç›¸åŒï¼Ÿ  false\næ­¤æƒ…å†µä¸‹ï¼šä¸è®ºæ˜¯åŸºæœ¬æ•°æ®ç±»å‹è¿˜æœ‰å¼•ç”¨ç±»å‹ï¼Œéƒ½æ˜¯é‡æ–°åˆ›å»ºçš„\nä¼˜ç‚¹\nåŸå‹æ¨¡å¼æ˜¯åœ¨å†…å­˜ä¸­äºŒè¿›åˆ¶æµçš„æ‹·è´ï¼Œè¦æ¯”newä¸€ä¸ªå¯¹è±¡çš„æ€§èƒ½è¦å¥½ï¼Œç‰¹åˆ«æ˜¯éœ€è¦ç”Ÿäº§å¤§é‡å¯¹è±¡æ—¶\n\n(1) å½“åˆ›å»ºæ–°çš„å¯¹è±¡å®ä¾‹è¾ƒä¸ºå¤æ‚æ—¶ï¼Œä½¿ç”¨åŸå‹æ¨¡å¼å¯ä»¥ç®€åŒ–å¯¹è±¡çš„åˆ›å»ºè¿‡ç¨‹ï¼Œé€šè¿‡å¤åˆ¶ä¸€ä¸ªå·²æœ‰å®ä¾‹å¯ä»¥æé«˜æ–°å®ä¾‹çš„åˆ›å»ºæ•ˆç‡ã€‚(2) æ‰©å±•æ€§è¾ƒå¥½ï¼Œç”±äºåœ¨åŸå‹æ¨¡å¼ä¸­æä¾›äº†æŠ½è±¡åŸå‹ç±»ï¼Œåœ¨å®¢æˆ·ç«¯å¯ä»¥é’ˆå¯¹æŠ½è±¡åŸå‹ç±»è¿›è¡Œç¼–ç¨‹ï¼Œè€Œå°†å…·ä½“åŸå‹ç±»å†™åœ¨é…ç½®æ–‡ä»¶ä¸­ï¼Œå¢åŠ æˆ–å‡å°‘äº§å“ç±»å¯¹åŸæœ‰ç³»ç»Ÿéƒ½æ²¡æœ‰ä»»ä½•å½±å“ã€‚(3) åŸå‹æ¨¡å¼æä¾›äº†ç®€åŒ–çš„åˆ›å»ºç»“æ„ï¼Œå·¥å‚æ–¹æ³•æ¨¡å¼å¸¸å¸¸éœ€è¦æœ‰ä¸€ä¸ªä¸äº§å“ç±»ç­‰çº§ç»“æ„ç›¸åŒçš„å·¥å‚ç­‰çº§ç»“æ„ï¼Œè€ŒåŸå‹æ¨¡å¼å°±ä¸éœ€è¦è¿™æ ·ï¼ŒåŸå‹æ¨¡å¼ä¸­äº§å“çš„å¤åˆ¶æ˜¯é€šè¿‡å°è£…åœ¨åŸå‹ç±»ä¸­çš„å…‹éš†æ–¹æ³•å®ç°çš„ï¼Œæ— é¡»ä¸“é—¨çš„å·¥å‚ç±»æ¥åˆ›å»ºäº§å“ã€‚(4) å¯ä»¥ä½¿ç”¨æ·±å…‹éš†çš„æ–¹å¼ä¿å­˜å¯¹è±¡çš„çŠ¶æ€ï¼Œä½¿ç”¨åŸå‹æ¨¡å¼å°†å¯¹è±¡å¤åˆ¶ä¸€ä»½å¹¶å°†å…¶çŠ¶æ€ä¿å­˜èµ·æ¥ï¼Œä»¥ä¾¿åœ¨éœ€è¦çš„æ—¶å€™ä½¿ç”¨ï¼ˆå¦‚æ¢å¤åˆ°æŸä¸€å†å²çŠ¶æ€ï¼‰ï¼Œå¯è¾…åŠ©å®ç°æ’¤é”€æ“ä½œã€‚\nç¼ºç‚¹\nç›´æ¥åœ¨å†…å­˜ä¸­æ‹·è´ï¼Œæ„é€ å‡½æ•°æ˜¯ä¸ä¼šæ‰§è¡Œçš„ï¼Œè¿™æ ·å°±å‡å°‘äº†çº¦æŸï¼Œæ—¢æ˜¯ä¼˜ç‚¹ä¹Ÿæ˜¯ç¼ºç‚¹ï¼Œåœ¨å®é™…å¼€å‘å½“ä¸­åº”æ³¨æ„è¿™ä¸ªé—®é¢˜\n\n(1) éœ€è¦ä¸ºæ¯ä¸€ä¸ªç±»é…å¤‡ä¸€ä¸ªå…‹éš†æ–¹æ³•ï¼Œè€Œä¸”è¯¥å…‹éš†æ–¹æ³•ä½äºä¸€ä¸ªç±»çš„å†…éƒ¨ï¼Œå½“å¯¹å·²æœ‰çš„ç±»è¿›è¡Œæ”¹é€ æ—¶ï¼Œéœ€è¦ä¿®æ”¹æºä»£ç ï¼Œè¿èƒŒäº†â€œå¼€é—­åŸåˆ™â€ã€‚(2) åœ¨å®ç°æ·±å…‹éš†æ—¶éœ€è¦ç¼–å†™è¾ƒä¸ºå¤æ‚çš„ä»£ç ï¼Œè€Œä¸”å½“å¯¹è±¡ä¹‹é—´å­˜åœ¨å¤šé‡çš„åµŒå¥—å¼•ç”¨æ—¶ï¼Œä¸ºäº†å®ç°æ·±å…‹éš†ï¼Œæ¯ä¸€å±‚å¯¹è±¡å¯¹åº”çš„ç±»éƒ½å¿…é¡»æ”¯æŒæ·±å…‹éš†ï¼Œå®ç°èµ·æ¥å¯èƒ½ä¼šæ¯”è¾ƒéº»çƒ¦\né€‚ç”¨åœºæ™¯(1) åˆ›å»ºæ–°å¯¹è±¡æˆæœ¬è¾ƒå¤§ï¼ˆå¦‚åˆå§‹åŒ–éœ€è¦å ç”¨è¾ƒé•¿çš„æ—¶é—´ï¼Œå ç”¨å¤ªå¤šçš„CPUèµ„æºæˆ–ç½‘ç»œèµ„æºï¼‰ï¼Œæ–°çš„å¯¹è±¡å¯ä»¥é€šè¿‡åŸå‹æ¨¡å¼å¯¹å·²æœ‰å¯¹è±¡è¿›è¡Œå¤åˆ¶æ¥è·å¾—ï¼Œå¦‚æœæ˜¯ç›¸ä¼¼å¯¹è±¡ï¼Œåˆ™å¯ä»¥å¯¹å…¶æˆå‘˜å˜é‡ç¨ä½œä¿®æ”¹ã€‚(2) å¦‚æœç³»ç»Ÿè¦ä¿å­˜å¯¹è±¡çš„çŠ¶æ€ï¼Œè€Œå¯¹è±¡çš„çŠ¶æ€å˜åŒ–å¾ˆå°ï¼Œæˆ–è€…å¯¹è±¡æœ¬èº«å ç”¨å†…å­˜è¾ƒå°‘æ—¶ï¼Œå¯ä»¥ä½¿ç”¨åŸå‹æ¨¡å¼é…åˆå¤‡å¿˜å½•æ¨¡å¼æ¥å®ç°ã€‚(3) éœ€è¦é¿å…ä½¿ç”¨åˆ†å±‚æ¬¡çš„å·¥å‚ç±»æ¥åˆ›å»ºåˆ†å±‚æ¬¡çš„å¯¹è±¡ï¼Œå¹¶ä¸”ç±»çš„å®ä¾‹å¯¹è±¡åªæœ‰ä¸€ä¸ªæˆ–å¾ˆå°‘çš„å‡ ä¸ªç»„åˆçŠ¶æ€ï¼Œé€šè¿‡å¤åˆ¶åŸå‹å¯¹è±¡å¾—åˆ°æ–°å®ä¾‹å¯èƒ½æ¯”ä½¿ç”¨æ„é€ å‡½æ•°åˆ›å»ºä¸€ä¸ªæ–°å®ä¾‹æ›´åŠ æ–¹ä¾¿\né¢è¯•ç‚¹\nå…‹éš†æ˜¯å¦è°ƒç”¨æ„é€ å™¨æ–¹æ³•ï¼Ÿä¸ä¼šï¼Œcloneæ–¹æ³•ç›´æ¥å¤åˆ¶å†…å­˜ä¸­çš„äºŒè¿›åˆ¶ï¼Œæ•ˆç‡é«˜\nå…‹éš†å‡ºçš„å¯¹è±¡å’Œä¹‹å‰çš„æ˜¯å¦ä¸€è‡´ï¼Ÿä¸ä¸€è‡´ï¼Œä½†æ˜¯æµ…æ‹·è´ä¸‹å¼•ç”¨ç±»å‹å¯¹è±¡æ˜¯ä¸€è‡´çš„ï¼ˆå› ä¸ºæŒ‡å‘åŒä¸€ä»½åœ°å€ï¼‰ï¼Œæ·±æ‹·è´ä¸‹ä¸ä¸€è‡´\næ”¹å˜å…‹éš†å¯¹è±¡çš„å€¼ï¼ŒåŸå¯¹è±¡æ˜¯å¦ä¼šå˜ï¼ŸåŸºæœ¬ç±»å‹ä¸å˜ï¼Œå¼•ç”¨ç±»å‹éšä¹‹æ”¹å˜\n\nå‚è€ƒæ–‡çŒ®\nåŸå‹æ¨¡å¼ | èœé¸Ÿæ•™ç¨‹ (runoob.com)\nåŸå‹æ¨¡å¼-Prototype Pattern - å¯¹è±¡çš„å…‹éš†â€”â€”åŸå‹æ¨¡å¼ï¼ˆä¸€ï¼‰ - ã€Šè®¾è®¡æ¨¡å¼ Javaç‰ˆæœ¬ã€‹ - ä¹¦æ ˆç½‘ Â· BookStack\nè®¾è®¡æ¨¡å¼ä¹‹ä»€ä¹ˆæ˜¯åŸå‹æ¨¡å¼ - çŸ¥ä¹ (zhihu.com)\nè®¾è®¡æ¨¡å¼ï¼šåŸå‹æ¨¡å¼ - æ˜é‡‘ (juejin.cn)\nè®¾è®¡æ¨¡å¼-åŸå‹æ¨¡å¼ - æ˜é‡‘ (juejin.cn)\nè®¾è®¡æ¨¡å¼å®æˆ˜ - åŸå‹æ¨¡å¼_æŠ€æœ¯äº¤æµ_ç‰›å®¢ç½‘ (nowcoder.com)\nçœ‹å®Œå°±æ˜ç™½çš„åŸå‹æ¨¡å¼ - çŸ¥ä¹ (zhihu.com)\n23 ç§è®¾è®¡æ¨¡å¼è¯¦è§£ï¼ˆå…¨23ç§ï¼‰_é¬¼ç­ä¹‹åˆƒçš„åšå®¢-CSDNåšå®¢_è®¾è®¡æ¨¡å¼\n23ç§è®¾è®¡æ¨¡å¼å…¨è§£æ - codeTao - åšå®¢å›­ (cnblogs.com)\n\n","tags":["è®¾è®¡æ¨¡å¼","åˆ›å»ºå‹æ¨¡å¼"]},{"title":"AOPè§£å†³å†…éƒ¨æ–¹æ³•è°ƒç”¨ä¸ç”Ÿæ•ˆé—®é¢˜","url":"/2022/05/28/0.2.4-AOP%E8%A7%A3%E5%86%B3%E5%86%85%E9%83%A8%E6%96%B9%E6%B3%95%E8%B0%83%E7%94%A8%E4%B8%8D%E7%94%9F%E6%95%88%E9%97%AE%E9%A2%98/","content":"\næè¿°ï¼šåœ¨ä½¿ç”¨AOPåˆ‡é¢çš„æ—¶å€™Controllerå±‚å¯ä»¥æ­£å¸¸åˆ‡å…¥è¿›å»ï¼Œä½†æ˜¯Serviceå±‚å†…éƒ¨æ–¹æ³•è°ƒç”¨åˆ‡å…¥ä¸è¿›å»\n\nå¤§è‡´æƒ…å†µå°±ç®—æ‰“æ³¨è§£æ”¾methodBä¸Šä¹Ÿä¸ä¼šè¿›åˆ‡é¢ï¼ŒAopåªæ”¯æŒå¤–éƒ¨è°ƒç”¨\nimport org.springframework.stereotype.Service;/** * ç›®æ ‡å¯¹è±¡ç±» * @author Gufung */@Servicepublic class TestAopService &#123;    public void methodA() &#123;        System.out.println(&quot;method A run&quot;);        //å†…éƒ¨è°ƒç”¨æ–¹æ³•Bæ—¶AOPçš„å¢å¼ºå¤„ç†æ–¹æ³•ä¸ä¼šæ‰§è¡Œ        methodB();    &#125;        public void methodB() &#123;        System.out.println(&quot;method B run&quot;);    &#125;&#125;\n\nè§£å†³æ–¹å¼1.é…ç½®spring-context.xml&lt;!-- é€šè¿‡@Aspectæ³¨è§£å®ç°AOP --&gt;&lt;!-- proxy-target-class=&quot;true&quot;è¡¨ç¤ºä½¿ç”¨CGlibåŠ¨æ€ä»£ç† --&gt;&lt;!-- expose-proxy=&quot;true&quot;æš´éœ²ä»£ç†å¯¹è±¡ --&gt;&lt;aop:aspectj-autoproxy proxy-target-class=&quot;true&quot; expose-proxy=&quot;true&quot;/&gt;\n\n2.ä½¿ç”¨AopContext.currentProxy()è·å–ä»£ç†å¯¹è±¡æ–¹æ³•ï¼Œå¹¶ä¸”æ‰§è¡Œimport org.springframework.aop.framework.AopContext;import org.springframework.stereotype.Service;/** * ç›®æ ‡å¯¹è±¡ç±» * @author Gufung * */@Servicepublic class TestAopService &#123;    public void methodA() &#123;        System.out.println(&quot;method A run&quot;);        //methodB();        //ä»springä¸Šä¸‹æ–‡è·å–ä»£ç†å¯¹è±¡æ‰§è¡Œæ–¹æ³•        ((TestAopService) AopContext.currentProxy()).methodB();    &#125;        public void methodB() &#123;        System.out.println(&quot;method B run&quot;);    &#125;&#125;\n\næ³¨æ„ç‚¹methodBä¸€å®šè¦å£°æ˜ä¸ºpublic å¦åˆ™è¿›ä¸å»åˆ‡é¢ï¼ï¼ï¼\næ³¨è§£å®ç°æ–¹æ³•è®¡æ—¶1.è‡ªå®šä¹‰æ³¨è§£/** * è€—æ—¶ç»Ÿè®¡ * @author Foam */@Retention(RetentionPolicy.RUNTIME)@Target(&#123;ElementType.TYPE, ElementType.METHOD&#125;)public @interface TimeComsumingStatics &#123;    String methodName();&#125;\n\n2.aop@Aspect@Component@EnableAspectJAutoProxy(proxyTargetClass = true)public class TimeComsumingAOP &#123;    private static final Logger log = LoggerFactory.getLogger(TimeComsumingAOP.class);    @Value(&quot;$&#123;timeCusming:false&#125;&quot;)    public String openButton;    /**     * åŸºäºæ³¨è§£å®šä¹‰åˆ‡å…¥ç‚¹     * å¯¹äºæ³¨è§£äº† @TimeComsumingStaticsçš„æ–¹æ³•è¿›è¡Œæ‹¦æˆª     * è¡¨ç¤ºæ ‡æ³¨äº†ç‰¹å®šæ³¨è§£çš„ç›®æ ‡æ–¹æ³•é“¾æ¥ç‚¹ã€‚å¦‚@annotation(com.dw.study.TestAnnotation)è¡¨ç¤ºä»»ä½•æ ‡æ³¨äº†@TestAnnotationæ³¨è§£çš„ç›®æ ‡ç±»æ–¹æ³•ã€‚     **/    @Pointcut(&quot;@annotation(com.service.zl.vo.TimeComsumingStatics)&quot;)    public void aspect() &#123;    &#125;    /**     * å®šæ—¶ä»»åŠ¡è®°å½•æ‰§è¡Œæ—¥å¿—     * @return     */    @Around(value = &quot;aspect() &amp;&amp; @annotation(timeComsumingStatics)&quot;)    public Object before(ProceedingJoinPoint proceedingJoinPoint,TimeComsumingStatics timeComsumingStatics) throws Throwable &#123;        if(&quot;true&quot;.equals(openButton))&#123;            long actStartTime = System.currentTimeMillis();            Object proceed = proceedingJoinPoint.proceed();            long actEndTime = System.currentTimeMillis();            String timecusming = (actEndTime - actStartTime)  + &quot;æ¯«ç§’&quot;;            log.info(timeComsumingStatics.methodName() + &quot;è€—æ—¶ï¼š&quot; + timecusming);            return proceed;        &#125;else &#123;            return proceedingJoinPoint.proceed();        &#125;    &#125;&#125;\n\n3.application.propertieså½“timeCusmingä¸ºtrueæ—¶å¼€å¯æ¥å£è€—æ—¶ç»Ÿè®¡ï¼Œfalseåä¹‹\ntimeCusming=true\n\n4.æ³¨è§£ä½¿ç”¨import org.springframework.aop.framework.AopContext;import org.springframework.stereotype.Service;/** * ç›®æ ‡å¯¹è±¡ç±» * @author Gufung * */@Servicepublic class TestAopService &#123;    public void methodA() &#123;        System.out.println(&quot;method A run&quot;);        //methodB();        //ä»springä¸Šä¸‹æ–‡è·å–ä»£ç†å¯¹è±¡æ‰§è¡Œæ–¹æ³•        ((TestAopService) AopContext.currentProxy()).methodB();    &#125;        @TimeComsumingStatics(methodName = &quot;è°ƒç”¨methodB&quot;)    public void methodB() &#123;        System.out.println(&quot;method B run&quot;);    &#125;&#125;\n\n5.ç»“æœè°ƒç”¨methodBè€—æ—¶ï¼š17æ¯«ç§’\n\nå‚è€ƒæ–‡çŒ®\nAOPå†…éƒ¨è°ƒç”¨å¤±æ•ˆ-è§£å†³æ–¹æ³•_å’•äº†ä¸ªå’•çš„åšå®¢-CSDNåšå®¢_aop å†…éƒ¨è°ƒç”¨\næ³¨æ„ï¼šjdk1.8çš„defaultæ‰èƒ½ä½¿ç”¨æ¥å£æ–¹å¼\n\nJava 8 interface defaultæ–¹æ³•_Code_My_Lifeçš„åšå®¢-CSDNåšå®¢_interfaceçš„defaultæ–¹æ³•\n\nspringâ€“aopå†…éƒ¨è°ƒç”¨å¤±æ•ˆé—®é¢˜åˆ†æ - 11014p - åšå®¢å›­\n\n\n","tags":["è‡ªå®šä¹‰æ³¨è§£","AOP"]},{"title":"IDEAè§£å†³vueé¡¹ç›®å¡æ­»","url":"/2022/06/02/0.2.7-IDEA%E8%A7%A3%E5%86%B3vue%E9%A1%B9%E7%9B%AE%E5%8D%A1%E6%AD%BB/","content":"IDEAè§£å†³vueé¡¹ç›®å¡æ­»é—®é¢˜åŸå› åœ¨åŠ è½½vueé¡¹ç›®çš„æ—¶å€™ï¼ŒæŠŠnode_modulesçš„åŒ…ä¸€èµ·è¿›è¡Œäº†åŠ è½½\nideaæ˜¯åŸºäºindexæ¥å®ç°å¿«é€ŸåŠ è½½é¡¹ç›®é…ç½®çš„,æ•…æ‰€æœ‰åœ¨ideaæ‰“å¼€ç›®å½•ä¸‹çš„æ–‡ä»¶éƒ½ä¼šè¢«ç´¢å¼•,åŒ…æ‹¬vueé¡¹ç›®è¿è¡Œæ—¶äº§ç”Ÿçš„node_modulesæ–‡ä»¶å¤¹é‡Œçš„jsç­‰æ–‡ä»¶\nè§£å†³æ–¹å¼\n\nåœ¨Ignored Files and Foldersä¸­åŠ å…¥node_moduleså†é‡å¯ä¸€ä¸‹ideaå°±å¥½äº†\n","tags":["é—®é¢˜è§£æ"]},{"title":"å…³äº@Autowiredæ³¨è§£å¤±æ•ˆé—®é¢˜","url":"/2022/06/02/0.2.6-%E5%85%B3%E4%BA%8E-Autowired%E6%B3%A8%E8%A7%A3%E5%A4%B1%E6%95%88%E9%97%AE%E9%A2%98/","content":"å…³äº@Autowiredæ³¨è§£æ‰«æä¸åˆ°expected at least 1 bean which qualifies as autowire candidateéœ€æ±‚ï¼šåœ¨æ—§çš„SSMé¡¹ç›®ä¸­ï¼Œç»å¸¸ä¼šå‡ºç°æ‰¾ä¸åˆ°Beançš„æƒ…å†µï¼Œç„¶åä¼šæŠ¥çº¢è‰²ä¸‹åˆ’çº¿è§£å†³æ–¹å¼ï¼šæ£€æŸ¥é…ç½®ï¼Œæ£€æŸ¥æ³¨è§£\n@Autowiredprivate CommonService commonservice;\n\n1.æ£€æŸ¥é…ç½®æ–‡ä»¶æ£€æŸ¥springé…ç½®æ–‡ä»¶æ˜¯å¦æœ‰å»æ‰«æåŒ…ï¼ˆå¦‚æœå°‘äº†è¿™ä¸€æ­¥å°±æŠ¥é”™æ‰¾ä¸åˆ°Beanï¼‰\n&lt;!-- è‡ªåŠ¨æ‰«æ --&gt;&lt;context:component-scan base-package=&quot;com.foam&quot;/&gt;\n\n2.æ˜¯å¦æœ‰æ³¨è§£æ¯”å¦‚å¦‚serviceï¼Œrepositoryï¼Œcomponentï¼Œcontrollerï¼ŒMapperç­‰ã€‚\n@Repositorypublic interface CompanyMapper&#123;â€¦â€¦&#125;@Servicepublic class Service&#123;â€¦â€¦&#125;\n\n3.æ˜¯å¦æœ‰é…ç½®ç›‘å¬å™¨&lt;!-- ä¸Šä¸‹æ–‡é…ç½®æ–‡ä»¶ --&gt;&lt;context-param&gt;    &lt;param-name&gt;contextConfigLocation&lt;/param-name&gt;    &lt;param-value&gt;classpath:config/spring/spring-*.xml&lt;/param-value&gt;&lt;/context-param&gt; &lt;!-- ç›‘å¬å™¨ --&gt;&lt;listener&gt;    &lt;listener-class&gt;org.springframework.web.context.ContextLoaderListener&lt;/listener-class&gt;&lt;/listener&gt;\n\nå‚è€ƒæ–‡ç« \nspringmvcæµç¨‹åˆ†æï¼Œè¯»å–web.xmlé…ç½®è¢«æ‰«æbean - ä»£ç å…ˆé”‹\n\nexpected at least 1 bean which qualifies as autowire candidate(Spring Bean æ— æ³•æ³¨å…¥)_ç†ŠçŒ«åŒå­¦å‘€çš„åšå®¢-CSDNåšå®¢\n\nSpringMVCè‡ªåŠ¨æ‰«æ@Controlleræ³¨è§£çš„bean\n\nå…³äº@Autowiredçš„è¿™äº›æ–°å§¿åŠ¿ï¼Œä½ å­¦ä¼šäº†ï¼Ÿ\n\n\n","tags":["é—®é¢˜è§£æ"]},{"title":"åˆ›å»ºå‹æ¨¡å¼-å·¥å‚æ¨¡å¼","url":"/2022/07/30/0.2.9-%E5%88%9B%E5%BB%BA%E5%9E%8B%E6%A8%A1%E5%BC%8F-%E5%B7%A5%E5%8E%82%E6%A8%A1%E5%BC%8F/","content":"\nå‰è¨€å·¥å‚æ¨¡å¼æ˜¯æœ€å¸¸ç”¨çš„åˆ›å»ºå‹æ¨¡å¼ï¼Œåˆ†ä¸ºä¸‰ç§ï¼šç®€å•å·¥å‚æ¨¡å¼ï¼Œå·¥å‚æ–¹æ³•æ¨¡å¼å’ŒæŠ½è±¡å·¥å‚æ¨¡å¼\næºç åœºæ™¯ï¼ˆåç»­è¡¥å……ï¼‰\nçº¿ç¨‹æ± ï¼šThreadFactoryåœ¨çº¿ç¨‹æ± æ„å»º Worker çš„æ—¶å€™ä¼šé€šè¿‡è°ƒç”¨ä¼ å…¥çº¿ç¨‹å·¥å‚å¯¹è±¡çš„ newThread() æ–¹æ³•åˆ›å»ºWorker æŒæœ‰çš„çº¿ç¨‹\næ—¥å¿—ï¼šLoggerFactory\nSpringï¼šBeanFactory\nMyBatisï¼šSqlSessionFactory\nç®€å•å·¥å‚æ¨¡å¼ç®€å•å·¥å‚æ¨¡å¼å¹¶ä¸å±äºGoF 23ä¸ªç»å…¸è®¾è®¡æ¨¡å¼ï¼Œä½†é€šå¸¸å°†å®ƒä½œä¸ºå­¦ä¹ å…¶ä»–å·¥å‚æ¨¡å¼çš„åŸºç¡€\nè§’è‰²\nFactory å·¥å‚è§’è‰²\nå·¥å‚è§’è‰²å³å·¥å‚ç±»ï¼Œå®ƒæ˜¯ç®€å•å·¥å‚æ¨¡å¼çš„æ ¸å¿ƒï¼Œè´Ÿè´£å®ç°åˆ›å»ºæ‰€æœ‰äº§å“å®ä¾‹çš„å†…éƒ¨é€»è¾‘ï¼›å·¥å‚ç±»å¯ä»¥è¢«å¤–ç•Œç›´æ¥è°ƒç”¨ï¼Œåˆ›å»ºæ‰€éœ€çš„äº§å“å¯¹è±¡ï¼›åœ¨å·¥å‚ç±»ä¸­æä¾›äº†é™æ€çš„å·¥å‚æ–¹æ³•factoryMethod()ï¼Œå®ƒçš„è¿”å›ç±»å‹ä¸ºæŠ½è±¡äº§å“ç±»å‹Product\n\nclass ChartFactory &#123;      //é™æ€å·¥å‚æ–¹æ³•      public static Chart getChart(String type) &#123;          Chart chart = null;          if (type.equalsIgnoreCase(&quot;histogram&quot;)) &#123;              chart = new HistogramChart();              System.out.println(&quot;åˆå§‹åŒ–è®¾ç½®æŸ±çŠ¶å›¾ï¼&quot;);          &#125;          else if (type.equalsIgnoreCase(&quot;pie&quot;)) &#123;              chart = new PieChart();              System.out.println(&quot;åˆå§‹åŒ–è®¾ç½®é¥¼çŠ¶å›¾ï¼&quot;);          &#125;        return chart;      &#125;  &#125;\n\nProduct æŠ½è±¡äº§å“è§’è‰²\nå®ƒæ˜¯å·¥å‚ç±»æ‰€åˆ›å»ºçš„æ‰€æœ‰å¯¹è±¡çš„çˆ¶ç±»ï¼Œå°è£…äº†å„ç§äº§å“å¯¹è±¡çš„å…¬æœ‰æ–¹æ³•ï¼›å®ƒçš„å¼•å…¥å°†æé«˜ç³»ç»Ÿçš„çµæ´»æ€§ï¼Œä½¿å¾—åœ¨å·¥å‚ç±»ä¸­åªéœ€å®šä¹‰ä¸€ä¸ªé€šç”¨çš„å·¥å‚æ–¹æ³•ï¼Œå› ä¸ºæ‰€æœ‰åˆ›å»ºçš„å…·ä½“äº§å“å¯¹è±¡éƒ½æ˜¯å…¶å­ç±»å¯¹è±¡\n\ninterface Chart &#123;      public void display();  &#125;  \n\nConcreteProduct å…·ä½“äº§å“è§’è‰²\nå®ƒæ˜¯ç®€å•å·¥å‚æ¨¡å¼çš„åˆ›å»ºç›®æ ‡ï¼Œæ‰€æœ‰è¢«åˆ›å»ºçš„å¯¹è±¡éƒ½å……å½“è¿™ä¸ªè§’è‰²çš„æŸä¸ªå…·ä½“ç±»çš„å®ä¾‹ï¼›æ¯ä¸€ä¸ªå…·ä½“äº§å“è§’è‰²éƒ½ç»§æ‰¿äº†æŠ½è±¡äº§å“è§’è‰²ï¼Œéœ€è¦å®ç°åœ¨æŠ½è±¡äº§å“ä¸­å£°æ˜çš„æŠ½è±¡æ–¹æ³•\n\nclass HistogramChart implements Chart &#123;      public HistogramChart() &#123;          System.out.println(&quot;åˆ›å»ºæŸ±çŠ¶å›¾ï¼&quot;);      &#125;      public void display() &#123;          System.out.println(&quot;æ˜¾ç¤ºæŸ±çŠ¶å›¾ï¼&quot;);      &#125;  &#125;  \nclass PieChart implements Chart &#123;      public PieChart() &#123;          System.out.println(&quot;åˆ›å»ºé¥¼çŠ¶å›¾ï¼&quot;);      &#125;      public void display() &#123;          System.out.println(&quot;æ˜¾ç¤ºé¥¼çŠ¶å›¾ï¼&quot;);      &#125;  &#125; \n\næµ‹è¯•class Client &#123;      public static void main(String args[]) &#123;          Chart chart;          chart = ChartFactory.getChart(&quot;histogram&quot;); //é€šè¿‡é™æ€å·¥å‚æ–¹æ³•åˆ›å»ºäº§å“          chart.display();      &#125;  &#125;åˆ›å»ºæŸ±çŠ¶å›¾ï¼åˆå§‹åŒ–è®¾ç½®æŸ±çŠ¶å›¾ï¼æ˜¾ç¤ºæŸ±çŠ¶å›¾ï¼è‹¥éœ€è¦é¥¼çŠ¶å›¾åˆ™æ”¹ä¸ºchart = ChartFactory.getChart(&quot;pie&quot;);\n\nä¼˜ç‚¹\nå¢åŠ å›ºå®šç±»å‹äº§å“çš„ä¸åŒå…·ä½“å·¥å‚æ¯”è¾ƒæ–¹ä¾¿\n\nå®ç°äº†å¯¹è±¡åˆ›å»ºå’Œä½¿ç”¨çš„åˆ†ç¦»ï¼Œä½¿ç”¨è€…ä¸å¿…å…³å¿ƒç±»å¯¹è±¡å¦‚ä½•åˆ›å»ºï¼Œæ˜ç¡®äº†èŒè´£\n\nåœ¨éœ€è¦å¤šä¸ªç›¸å…³äº§å“çš„æ—¶å€™ï¼Œä»ç„¶åªéœ€è¦ä¸€ä¸ªå·¥å‚å¯¹è±¡\nç¼ºç‚¹\nç”±äºå·¥å‚ç±»é›†ä¸­äº†æ‰€æœ‰äº§å“çš„åˆ›å»ºé€»è¾‘ï¼ŒèŒè´£è¿‡é‡ï¼Œä¸€æ—¦ä¸èƒ½æ­£å¸¸å·¥ä½œï¼Œæ•´ä¸ªç³»ç»Ÿéƒ½è¦å—åˆ°å½±å“\n\nä¼šå¢åŠ ç³»ç»Ÿä¸­ç±»çš„ä¸ªæ•°ï¼Œå¢åŠ äº†ç³»ç»Ÿçš„å¤æ‚åº¦å’Œç†è§£éš¾åº¦\n\nè¦æ–°å¢äº§å“ç±»çš„æ—¶å€™ï¼Œå°±è¦ä¿®æ”¹å·¥å‚ç±»çš„ä»£ç ï¼Œè¿åäº†å¼€æ”¾å°é—­åŸåˆ™\n\nç®€å•å·¥å‚æ¨¡å¼ç”±äºä½¿ç”¨äº†é™æ€å·¥å‚æ–¹æ³•ï¼Œé€ æˆå·¥å‚è§’è‰²æ— æ³•å½¢æˆåŸºäºç»§æ‰¿çš„ç­‰çº§ç»“æ„\né€‚ç”¨åœºæ™¯\nå·¥å‚ç±»è´Ÿè´£åˆ›å»ºçš„å¯¹è±¡æ¯”è¾ƒå°‘ï¼Œç”±äºåˆ›å»ºçš„å¯¹è±¡è¾ƒå°‘ï¼Œä¸ä¼šé€ æˆå·¥å‚æ–¹æ³•ä¸­çš„ä¸šåŠ¡é€»è¾‘å¤ªè¿‡å¤æ‚\n\nå®¢æˆ·ç«¯åªçŸ¥é“ä¼ å…¥å·¥å‚ç±»çš„å‚æ•°ï¼Œå¯¹äºå¦‚ä½•åˆ›å»ºå¯¹è±¡å¹¶ä¸å…³å¿ƒ\nå·¥å‚æ–¹æ³•æ¨¡å¼ç®€å•å·¥å‚æ¨¡å¼è™½ç„¶ç®€å•ï¼Œä½†å­˜åœ¨ä¸€ä¸ªå¾ˆä¸¥é‡çš„é—®é¢˜å½“ç³»ç»Ÿä¸­éœ€è¦å¼•å…¥æ–°äº§å“æ—¶ï¼Œç”±äºé™æ€å·¥å‚æ–¹æ³•é€šè¿‡æ‰€ä¼ å…¥å‚æ•°çš„ä¸åŒæ¥åˆ›å»ºä¸åŒçš„äº§å“è¿™å¿…å®šè¦ä¿®æ”¹å·¥å‚ç±»çš„æºä»£ç ï¼Œå°†è¿èƒŒâ€œå¼€é—­åŸåˆ™â€ï¼Œå¦‚ä½•å®ç°å¢åŠ æ–°äº§å“è€Œä¸å½±å“å·²æœ‰ä»£ç ï¼Ÿå·¥å‚æ–¹æ³•æ¨¡å¼åº”è¿è€Œç”Ÿã€‚\nè§’è‰²\nProduct æŠ½è±¡äº§å“\nå®ƒæ˜¯å®šä¹‰äº§å“çš„æ¥å£ï¼Œæ˜¯å·¥å‚æ–¹æ³•æ¨¡å¼æ‰€åˆ›å»ºå¯¹è±¡çš„è¶…ç±»å‹ï¼Œä¹Ÿå°±æ˜¯äº§å“å¯¹è±¡çš„å…¬å…±çˆ¶ç±»\n\n\n\ninterface Logger &#123;      public void writeLog();  &#125;  \n\nConcreteProduct å…·ä½“äº§å“\nå®ƒå®ç°äº†æŠ½è±¡äº§å“æ¥å£ï¼ŒæŸç§ç±»å‹çš„å…·ä½“äº§å“ç”±ä¸“é—¨çš„å…·ä½“å·¥å‚åˆ›å»ºï¼Œå…·ä½“å·¥å‚å’Œå…·ä½“äº§å“ä¹‹é—´ä¸€ä¸€å¯¹åº”\n\nclass DatabaseLogger implements Logger &#123;      public void writeLog() &#123;          System.out.println(&quot;æ•°æ®åº“æ—¥å¿—è®°å½•ã€‚&quot;);      &#125;  &#125;  \nclass FileLogger implements Logger &#123;      public void writeLog() &#123;          System.out.println(&quot;æ–‡ä»¶æ—¥å¿—è®°å½•ã€‚&quot;);      &#125;  &#125;\n\nFactory æŠ½è±¡å·¥å‚\nåœ¨æŠ½è±¡å·¥å‚ç±»ä¸­ï¼Œå£°æ˜äº†å·¥å‚æ–¹æ³•(Factory Method)ï¼Œç”¨äºè¿”å›ä¸€ä¸ªäº§å“ã€‚æŠ½è±¡å·¥å‚æ˜¯å·¥å‚æ–¹æ³•æ¨¡å¼çš„æ ¸å¿ƒï¼Œæ‰€æœ‰åˆ›å»ºå¯¹è±¡çš„å·¥å‚ç±»éƒ½å¿…é¡»å®ç°è¯¥æ¥å£\n\ninterface LoggerFactory &#123;      public Logger createLogger();  &#125;  \n\nConcreteFactory å…·ä½“å·¥å‚\nå®ƒæ˜¯æŠ½è±¡å·¥å‚ç±»çš„å­ç±»ï¼Œå®ç°äº†æŠ½è±¡å·¥å‚ä¸­å®šä¹‰çš„å·¥å‚æ–¹æ³•ï¼Œå¹¶å¯ç”±å®¢æˆ·ç«¯è°ƒç”¨ï¼Œè¿”å›ä¸€ä¸ªå…·ä½“äº§å“ç±»çš„å®ä¾‹\n\nclass DatabaseLoggerFactory implements LoggerFactory &#123;      public Logger createLogger() &#123;              //è¿æ¥æ•°æ®åº“ï¼Œä»£ç çœç•¥              //åˆ›å»ºæ•°æ®åº“æ—¥å¿—è®°å½•å™¨å¯¹è±¡              Logger logger = new DatabaseLogger();               //åˆå§‹åŒ–æ•°æ®åº“æ—¥å¿—è®°å½•å™¨ï¼Œä»£ç çœç•¥              return logger;      &#125;     &#125; \nclass FileLoggerFactory implements LoggerFactory &#123;      public Logger createLogger() &#123;              //åˆ›å»ºæ–‡ä»¶æ—¥å¿—è®°å½•å™¨å¯¹è±¡              Logger logger = new FileLogger();               //åˆ›å»ºæ–‡ä»¶ï¼Œä»£ç çœç•¥              return logger;      &#125;     &#125;\n\næµ‹è¯•class Client &#123;      public static void main(String args[]) &#123;          LoggerFactory factory;          Logger logger;          factory = new FileLoggerFactory();        logger = factory.createLogger();          logger.writeLog();      &#125;  &#125;\n\nä¼˜ç‚¹\nåœ¨å·¥å‚æ–¹æ³•æ¨¡å¼ä¸­ï¼Œå·¥å‚æ–¹æ³•ç”¨æ¥åˆ›å»ºå®¢æˆ·æ‰€éœ€è¦çš„äº§å“ï¼ŒåŒæ—¶è¿˜å‘å®¢æˆ·éšè—äº†å“ªç§å…·ä½“äº§å“ç±»å°†è¢«å®ä¾‹åŒ–è¿™ä¸€ç»†èŠ‚ï¼Œç”¨æˆ·åªéœ€è¦å…³å¿ƒæ‰€éœ€äº§å“å¯¹åº”çš„å·¥å‚ï¼Œæ— é¡»å…³å¿ƒåˆ›å»ºç»†èŠ‚ï¼Œç”šè‡³æ— é¡»çŸ¥é“å…·ä½“äº§å“ç±»çš„ç±»å\n\nåŸºäºå·¥å‚è§’è‰²å’Œäº§å“è§’è‰²çš„å¤šæ€æ€§è®¾è®¡æ˜¯å·¥å‚æ–¹æ³•æ¨¡å¼çš„å…³é”®ã€‚å®ƒèƒ½å¤Ÿè®©å·¥å‚å¯ä»¥è‡ªä¸»ç¡®å®šåˆ›å»ºä½•ç§äº§å“å¯¹è±¡ï¼Œè€Œå¦‚ä½•åˆ›å»ºè¿™ä¸ªå¯¹è±¡çš„ç»†èŠ‚åˆ™å®Œå…¨å°è£…åœ¨å…·ä½“å·¥å‚å†…éƒ¨ã€‚å·¥å‚æ–¹æ³•æ¨¡å¼ä¹‹æ‰€ä»¥åˆè¢«ç§°ä¸ºå¤šæ€å·¥å‚æ¨¡å¼ï¼Œå°±æ­£æ˜¯å› ä¸ºæ‰€æœ‰çš„å…·ä½“å·¥å‚ç±»éƒ½å…·æœ‰åŒä¸€æŠ½è±¡çˆ¶ç±»\n\nä½¿ç”¨å·¥å‚æ–¹æ³•æ¨¡å¼çš„å¦ä¸€ä¸ªä¼˜ç‚¹æ˜¯åœ¨ç³»ç»Ÿä¸­åŠ å…¥æ–°äº§å“æ—¶ï¼Œæ— é¡»ä¿®æ”¹æŠ½è±¡å·¥å‚å’ŒæŠ½è±¡äº§å“æä¾›çš„æ¥å£ï¼Œæ— é¡»ä¿®æ”¹å®¢æˆ·ç«¯ï¼Œä¹Ÿæ— é¡»ä¿®æ”¹å…¶ä»–çš„å…·ä½“å·¥å‚å’Œå…·ä½“äº§å“ï¼Œè€Œåªè¦æ·»åŠ ä¸€ä¸ªå…·ä½“å·¥å‚å’Œå…·ä½“äº§å“å°±å¯ä»¥äº†ï¼Œè¿™æ ·ï¼Œç³»ç»Ÿçš„å¯æ‰©å±•æ€§ä¹Ÿå°±å˜å¾—éå¸¸å¥½ï¼Œå®Œå…¨ç¬¦åˆâ€œå¼€é—­åŸåˆ™â€\nç¼ºç‚¹\nåœ¨æ·»åŠ æ–°äº§å“æ—¶ï¼Œéœ€è¦ç¼–å†™æ–°çš„å…·ä½“äº§å“ç±»ï¼Œè€Œä¸”è¿˜è¦æä¾›ä¸ä¹‹å¯¹åº”çš„å…·ä½“å·¥å‚ç±»ï¼Œç³»ç»Ÿä¸­ç±»çš„ä¸ªæ•°å°†æˆå¯¹å¢åŠ ï¼Œåœ¨ä¸€å®šç¨‹åº¦ä¸Šå¢åŠ äº†ç³»ç»Ÿçš„å¤æ‚åº¦ï¼Œæœ‰æ›´å¤šçš„ç±»éœ€è¦ç¼–è¯‘å’Œè¿è¡Œï¼Œä¼šç»™ç³»ç»Ÿå¸¦æ¥ä¸€äº›é¢å¤–çš„å¼€é”€\n\nç”±äºè€ƒè™‘åˆ°ç³»ç»Ÿçš„å¯æ‰©å±•æ€§ï¼Œéœ€è¦å¼•å…¥æŠ½è±¡å±‚ï¼Œåœ¨å®¢æˆ·ç«¯ä»£ç ä¸­å‡ä½¿ç”¨æŠ½è±¡å±‚è¿›è¡Œå®šä¹‰ï¼Œå¢åŠ äº†ç³»ç»Ÿçš„æŠ½è±¡æ€§å’Œç†è§£éš¾åº¦ï¼Œä¸”åœ¨å®ç°æ—¶å¯èƒ½éœ€è¦ç”¨åˆ°DOMã€åå°„ç­‰æŠ€æœ¯ï¼Œå¢åŠ äº†ç³»ç»Ÿçš„å®ç°éš¾åº¦\né€‚ç”¨åœºæ™¯\nå®¢æˆ·ç«¯ä¸çŸ¥é“å®ƒæ‰€éœ€è¦çš„å¯¹è±¡çš„ç±»ã€‚åœ¨å·¥å‚æ–¹æ³•æ¨¡å¼ä¸­ï¼Œå®¢æˆ·ç«¯ä¸éœ€è¦çŸ¥é“å…·ä½“äº§å“ç±»çš„ç±»åï¼Œåªéœ€è¦çŸ¥é“æ‰€å¯¹åº”çš„å·¥å‚å³å¯ï¼Œå…·ä½“çš„äº§å“å¯¹è±¡ç”±å…·ä½“å·¥å‚ç±»åˆ›å»ºï¼Œå¯å°†å…·ä½“å·¥å‚ç±»çš„ç±»åå­˜å‚¨åœ¨é…ç½®æ–‡ä»¶æˆ–æ•°æ®åº“ä¸­\n\næŠ½è±¡å·¥å‚ç±»é€šè¿‡å…¶å­ç±»æ¥æŒ‡å®šåˆ›å»ºå“ªä¸ªå¯¹è±¡ã€‚åœ¨å·¥å‚æ–¹æ³•æ¨¡å¼ä¸­ï¼Œå¯¹äºæŠ½è±¡å·¥å‚ç±»åªéœ€è¦æä¾›ä¸€ä¸ªåˆ›å»ºäº§å“çš„æ¥å£ï¼Œè€Œç”±å…¶å­ç±»æ¥ç¡®å®šå…·ä½“è¦åˆ›å»ºçš„å¯¹è±¡ï¼Œåˆ©ç”¨é¢å‘å¯¹è±¡çš„å¤šæ€æ€§å’Œé‡Œæ°ä»£æ¢åŸåˆ™ï¼Œåœ¨ç¨‹åºè¿è¡Œæ—¶ï¼Œå­ç±»å¯¹è±¡å°†è¦†ç›–çˆ¶ç±»å¯¹è±¡ï¼Œä»è€Œä½¿å¾—ç³»ç»Ÿæ›´å®¹æ˜“æ‰©å±•ã€\næŠ½è±¡å·¥å‚æ¨¡å¼å·¥å‚æ–¹æ³•æ¨¡å¼é€šè¿‡å¼•å…¥å·¥å‚ç­‰çº§ç»“æ„ï¼Œè§£å†³äº†ç®€å•å·¥å‚æ¨¡å¼ä¸­å·¥å‚ç±»èŒè´£å¤ªé‡çš„é—®é¢˜ï¼Œä½†ç”±äºå·¥å‚æ–¹æ³•æ¨¡å¼ä¸­çš„æ¯ä¸ªå·¥å‚åªç”Ÿäº§ä¸€ç±»äº§å“ï¼Œå¯èƒ½ä¼šå¯¼è‡´ç³»ç»Ÿä¸­å­˜åœ¨å¤§é‡çš„å·¥å‚ç±»ï¼ŒåŠ¿å¿…ä¼šå¢åŠ ç³»ç»Ÿçš„å¼€é”€ã€‚æ­¤æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥è€ƒè™‘å°†ä¸€äº›ç›¸å…³çš„äº§å“ç»„æˆä¸€ä¸ªâ€œäº§å“æ—â€ï¼Œç”±åŒä¸€ä¸ªå·¥å‚æ¥ç»Ÿä¸€ç”Ÿäº§ï¼Œè¿™å°±æ˜¯æˆ‘ä»¬æœ¬æ–‡å°†è¦å­¦ä¹ çš„æŠ½è±¡å·¥å‚æ¨¡å¼çš„åŸºæœ¬æ€æƒ³\nè§’è‰²\nAbstractFactory æŠ½è±¡å·¥å‚\nå®ƒå£°æ˜äº†ä¸€ç»„ç”¨äºåˆ›å»ºä¸€æ—äº§å“çš„æ–¹æ³•ï¼Œæ¯ä¸€ä¸ªæ–¹æ³•å¯¹åº”ä¸€ç§äº§å“\n\n\n\ninterface SkinFactory &#123;      public Button createButton();      public TextField createTextField();  &#125;  \n\nConcreteFactory å…·ä½“å·¥å‚\nå®ƒå®ç°äº†åœ¨æŠ½è±¡å·¥å‚ä¸­å£°æ˜çš„åˆ›å»ºäº§å“çš„æ–¹æ³•ï¼Œç”Ÿæˆä¸€ç»„å…·ä½“äº§å“ï¼Œè¿™äº›äº§å“æ„æˆäº†ä¸€ä¸ªäº§å“æ—ï¼Œæ¯ä¸€ä¸ªäº§å“éƒ½ä½äºæŸä¸ªäº§å“ç­‰çº§ç»“æ„ä¸­\n\nclass SpringSkinFactory implements SkinFactory &#123;      public Button createButton() &#123;          return new SpringButton();      &#125;      public TextField createTextField() &#123;          return new SpringTextField();      &#125;  &#125;  \nclass SummerSkinFactory implements SkinFactory &#123;      public Button createButton() &#123;          return new SummerButton();      &#125;      public TextField createTextField() &#123;          return new SummerTextField();      &#125;  &#125;\n\nAbstractProduct æŠ½è±¡äº§å“\nå®ƒä¸ºæ¯ç§äº§å“å£°æ˜æ¥å£ï¼Œåœ¨æŠ½è±¡äº§å“ä¸­å£°æ˜äº†äº§å“æ‰€å…·æœ‰çš„ä¸šåŠ¡æ–¹æ³•\n\ninterface Button &#123;      public void display();  &#125;  \ninterface TextField &#123;      public void display();  &#125;  \n\nConcreteProduct å…·ä½“äº§å“\nå®ƒå®šä¹‰å…·ä½“å·¥å‚ç”Ÿäº§çš„å…·ä½“äº§å“å¯¹è±¡ï¼Œå®ç°æŠ½è±¡äº§å“æ¥å£ä¸­å£°æ˜çš„ä¸šåŠ¡æ–¹æ³•\n\nclass SpringButton implements Button &#123;      public void display() &#123;          System.out.println(&quot;æ˜¾ç¤ºæµ…ç»¿è‰²æŒ‰é’®ã€‚&quot;);      &#125;  &#125; \nclass SummerButton implements Button &#123;      public void display() &#123;          System.out.println(&quot;æ˜¾ç¤ºæµ…è“è‰²æŒ‰é’®ã€‚&quot;);      &#125;     &#125;  \nclass SpringTextField implements TextField &#123;      public void display() &#123;          System.out.println(&quot;æ˜¾ç¤ºç»¿è‰²è¾¹æ¡†æ–‡æœ¬æ¡†ã€‚&quot;);      &#125;  &#125; \nclass SummerTextField implements TextField &#123;      public void display() &#123;          System.out.println(&quot;æ˜¾ç¤ºè“è‰²è¾¹æ¡†æ–‡æœ¬æ¡†ã€‚&quot;);      &#125;     &#125; \n\næµ‹è¯•class Client &#123;      public static void main(String args[]) &#123;          //ä½¿ç”¨æŠ½è±¡å±‚å®šä¹‰          SkinFactory factory;          Button bt;          TextField tf;          factory = new SpringSkinFactory();          bt = factory.createButton();          tf = factory.createTextField();          bt.display();          tf.display();      &#125;  &#125;\n\nä¼˜ç‚¹\næŠ½è±¡å·¥å‚æ¨¡å¼éš”ç¦»äº†å…·ä½“ç±»çš„ç”Ÿæˆï¼Œä½¿å¾—å®¢æˆ·å¹¶ä¸éœ€è¦çŸ¥é“ä»€ä¹ˆè¢«åˆ›å»ºã€‚ç”±äºè¿™ç§éš”ç¦»ï¼Œæ›´æ¢ä¸€ä¸ªå…·ä½“å·¥å‚å°±å˜å¾—ç›¸å¯¹å®¹æ˜“ï¼Œæ‰€æœ‰çš„å…·ä½“å·¥å‚éƒ½å®ç°äº†æŠ½è±¡å·¥å‚ä¸­å®šä¹‰çš„é‚£äº›å…¬å…±æ¥å£ï¼Œå› æ­¤åªéœ€æ”¹å˜å…·ä½“å·¥å‚çš„å®ä¾‹ï¼Œå°±å¯ä»¥åœ¨æŸç§ç¨‹åº¦ä¸Šæ”¹å˜æ•´ä¸ªè½¯ä»¶ç³»ç»Ÿçš„è¡Œä¸º\n\nå½“ä¸€ä¸ªäº§å“æ—ä¸­çš„å¤šä¸ªå¯¹è±¡è¢«è®¾è®¡æˆä¸€èµ·å·¥ä½œæ—¶ï¼Œå®ƒèƒ½å¤Ÿä¿è¯å®¢æˆ·ç«¯å§‹ç»ˆåªä½¿ç”¨åŒä¸€ä¸ªäº§å“æ—ä¸­çš„å¯¹è±¡\n\nå¢åŠ æ–°çš„äº§å“æ—å¾ˆæ–¹ä¾¿ï¼Œæ— é¡»ä¿®æ”¹å·²æœ‰ç³»ç»Ÿï¼Œç¬¦åˆâ€œå¼€é—­åŸåˆ™â€\nç¼ºç‚¹\nå¢åŠ æ–°çš„äº§å“ç­‰çº§ç»“æ„éº»çƒ¦ï¼Œéœ€è¦å¯¹åŸæœ‰ç³»ç»Ÿè¿›è¡Œè¾ƒå¤§çš„ä¿®æ”¹ï¼Œç”šè‡³éœ€è¦ä¿®æ”¹æŠ½è±¡å±‚ä»£ç ï¼Œè¿™æ˜¾ç„¶ä¼šå¸¦æ¥è¾ƒå¤§çš„ä¸ä¾¿ï¼Œè¿èƒŒäº†â€œå¼€é—­åŸåˆ™â€\né€‚ç”¨åœºæ™¯\nä¸€ä¸ªç³»ç»Ÿä¸åº”å½“ä¾èµ–äºäº§å“ç±»å®ä¾‹å¦‚ä½•è¢«åˆ›å»ºã€ç»„åˆå’Œè¡¨è¾¾çš„ç»†èŠ‚ï¼Œè¿™å¯¹äºæ‰€æœ‰ç±»å‹çš„å·¥å‚æ¨¡å¼éƒ½æ˜¯å¾ˆé‡è¦çš„ï¼Œç”¨æˆ·æ— é¡»å…³å¿ƒå¯¹è±¡çš„åˆ›å»ºè¿‡ç¨‹ï¼Œå°†å¯¹è±¡çš„åˆ›å»ºå’Œä½¿ç”¨è§£è€¦\n\nç³»ç»Ÿä¸­æœ‰å¤šäºä¸€ä¸ªçš„äº§å“æ—ï¼Œè€Œæ¯æ¬¡åªä½¿ç”¨å…¶ä¸­æŸä¸€äº§å“æ—ã€‚å¯ä»¥é€šè¿‡é…ç½®æ–‡ä»¶ç­‰æ–¹å¼æ¥ä½¿å¾—ç”¨æˆ·å¯ä»¥åŠ¨æ€æ”¹å˜äº§å“æ—ï¼Œä¹Ÿå¯ä»¥å¾ˆæ–¹ä¾¿åœ°å¢åŠ æ–°çš„äº§å“æ—\n\nå±äºåŒä¸€ä¸ªäº§å“æ—çš„äº§å“å°†åœ¨ä¸€èµ·ä½¿ç”¨ï¼Œè¿™ä¸€çº¦æŸå¿…é¡»åœ¨ç³»ç»Ÿçš„è®¾è®¡ä¸­ä½“ç°å‡ºæ¥ã€‚åŒä¸€ä¸ªäº§å“æ—ä¸­çš„äº§å“å¯ä»¥æ˜¯æ²¡æœ‰ä»»ä½•å…³ç³»çš„å¯¹è±¡ï¼Œä½†æ˜¯å®ƒä»¬éƒ½å…·æœ‰ä¸€äº›å…±åŒçš„çº¦æŸï¼Œå¦‚åŒä¸€æ“ä½œç³»ç»Ÿä¸‹çš„æŒ‰é’®å’Œæ–‡æœ¬æ¡†ï¼ŒæŒ‰é’®ä¸æ–‡æœ¬æ¡†ä¹‹é—´æ²¡æœ‰ç›´æ¥å…³ç³»ï¼Œä½†å®ƒä»¬éƒ½æ˜¯å±äºæŸä¸€æ“ä½œç³»ç»Ÿçš„ï¼Œæ­¤æ—¶å…·æœ‰ä¸€ä¸ªå…±åŒçš„çº¦æŸæ¡ä»¶ï¼šæ“ä½œç³»ç»Ÿçš„ç±»å‹\n\näº§å“ç­‰çº§ç»“æ„ç¨³å®šï¼Œè®¾è®¡å®Œæˆä¹‹åï¼Œä¸ä¼šå‘ç³»ç»Ÿä¸­å¢åŠ æ–°çš„äº§å“ç­‰çº§ç»“æ„æˆ–è€…åˆ é™¤å·²æœ‰çš„äº§å“ç­‰çº§ç»“æ„\n\n\n","tags":["è®¾è®¡æ¨¡å¼","åˆ›å»ºå‹æ¨¡å¼"]},{"title":"macå®‰è£…è½¯ä»¶","url":"/2022/07/28/0.2.8-mac%E5%AE%89%E8%A3%85%E8%BD%AF%E4%BB%B6/","content":"\nJDKhttps://www.cnblogs.com/imzhizi/p/macos-jdk-installation-homebrew.html\n# æœ€æ–°ç‰ˆ Oracle JDKbrew cask install oracle-jdk# Oracle JDK11ã€Oracle JDK8 éœ€è¦æ‰‹åŠ¨ä¸‹è½½# https://www.oracle.com/hk/java/technologies/javase-downloads.html# æœ€æ–°ç‰ˆ Oracle OpenJDKbrew cask install java# Oracle OpenJDK11brew cask install java11# ä½¿ç”¨è¯¥å‘½ä»¤åˆ™å®‰è£…ç”± Oracle æä¾›çš„æœ€æ–°ç‰ˆçš„ OpenJDKbrew cask install java# ä½¿ç”¨è¯¥å‘½ä»¤åˆ™å®‰è£…ç”± Oracle æä¾›çš„ OpenJDK11brew cask install java11# OpenJDK åœ¨ Oracle ä¸å†ç»´æŠ¤åä¼šè½¬äº¤ç»™ RedHat ç»´æŠ¤brew cask install openjdk@11# AdoptOpenJDK brew cask install AdoptOpenJDK/openjdk/adoptopenjdk8brew cask install AdoptOpenJDK/openjdk/adoptopenjdk9brew cask install AdoptOpenJDK/openjdk/adoptopenjdk10brew cask install AdoptOpenJDK/openjdk/adoptopenjdk11brew cask install AdoptOpenJDK/openjdk/adoptopenjdk12brew cask install AdoptOpenJDK/openjdk/adoptopenjdk# Azul Zulu æä¾›äº† JDK 7# Azul Zulu ä¹Ÿæä¾›å…¶ä»–ç‰ˆæœ¬çš„ JDK åƒ zulu8ã€zulu11 ç­‰brew cask install homebrew/cask-versions/zulu7brew cask install homebrew/cask-versions/zulu8brew cask install homebrew/cask-versions/zulu11brew cask install homebrew/cask-versions/zulu# Apple æä¾›çš„ JDK6brew cask install homebrew/cask-versions/java6\n\nMavenbrew install maven\n\nNodebrew install node\n\nMySQLbrew install mysql\n\nè®¾ç½®å¯†ç mysql_secure_installation\n\nå¯åŠ¨mysqlbrew service start mysql\n\nRedisbrew install redis// æŒ‡å®šç‰ˆæœ¬brew install redis@3.2\n\nå¯åŠ¨å‘½ä»¤// ä½¿ç”¨brewå¸®åŠ©æˆ‘ä»¬å¯åŠ¨è½¯ä»¶brew services start redis\n\nå…³é—­å‘½ä»¤brew services stop redis\n\næŸ¥çœ‹æœåŠ¡è¿›ç¨‹ps axu | grep redis\n\nHomebrewç”¨æ¥è£…å…¶ä»–ä¸œè¥¿å¾ˆæ–¹ä¾¿â€œmacOSç¼ºå¤±çš„è½¯ä»¶åŒ…çš„ç®¡ç†å™¨â€\n/bin/zsh -c &quot;$(curl -fsSL https://gitee.com/cunkai/HomebrewCN/raw/master/Homebrew.sh)&quot;\n\nä¸€äº›æ“ä½œå‘½ä»¤brew search ** //æŸ¥æ‰¾æŸä¸ªè½¯ä»¶åŒ…brew list //åˆ—å‡ºå·²ç»å®‰è£…çš„è½¯ä»¶çš„åŒ…brew install ** //å®‰è£…æŸä¸ªè½¯ä»¶åŒ…,é»˜è®¤å®‰è£…çš„æ˜¯ç¨³å®šç‰ˆæœ¬brew uninstall **//å¸è½½æŸä¸ªè½¯ä»¶çš„åŒ…brew upgrade ** //æ›´æ–°æŸä¸ªè½¯ä»¶åŒ…brew info ** //æŸ¥çœ‹æŒ‡å®šè½¯ä»¶åŒ…çš„è¯´æ˜brew cache clean //æ¸…ç†ç¼“å­˜\n\nMacåº”ç”¨ç¨‹åºæ— æ³•æ‰“å¼€æˆ–æ–‡ä»¶æŸåçš„å¤„ç†æ–¹æ³•// æ–¹æ³•11. æ‰“å¼€ç³»ç»Ÿåå¥½è®¾ç½®ç•Œé¢ï¼Œè¿›å…¥å®‰å…¨æ€§ä¸éšç§2. ç‚¹æŒ‰å·¦ä¸‹è§’çš„é”å¤´å›¾æ ‡ï¼Œè§£é”æ›´æ”¹æƒé™3. å°†å…è®¸ä»ä»¥ä¸‹ä½ç½®ä¸‹è½½çš„åº”ç”¨ï¼Œæ›´æ”¹ä¸º â€œ ä»»ä½•æ¥æº â€ ï¼Œç„¶åå†æ‰“å¼€åº”ç”¨å³å¯// æ–¹æ³•2sudo xattr -d com.apple.quarantine /Applications/xxxx.app// æ–¹æ³•3sudo codesign --force --deep --sign - æ–‡ä»¶ä½ç½®ï¼ˆç›´æ¥å°†åº”ç”¨æ‹–è¿›å»å³å¯ï¼‰\n","tags":["è½¯ä»¶å®‰è£…"]},{"title":"mavenæ•°æ®æº","url":"/2022/08/17/0.3.1-maven%E6%95%B0%E6%8D%AE%E6%BA%90/","content":"&lt;mirror&gt;\t&lt;id&gt;aliyun-public&lt;/id&gt;\t&lt;mirrorOf&gt;*&lt;/mirrorOf&gt;\t&lt;name&gt;aliyun public&lt;/name&gt;\t&lt;url&gt;https://maven.aliyun.com/repository/public&lt;/url&gt;&lt;/mirror&gt;&lt;mirror&gt;\t&lt;id&gt;aliyun-central&lt;/id&gt;\t&lt;mirrorOf&gt;*&lt;/mirrorOf&gt;\t&lt;name&gt;aliyun central&lt;/name&gt;\t&lt;url&gt;https://maven.aliyun.com/repository/central&lt;/url&gt;&lt;/mirror&gt;&lt;mirror&gt;\t&lt;id&gt;aliyun-spring&lt;/id&gt;\t&lt;mirrorOf&gt;*&lt;/mirrorOf&gt;\t&lt;name&gt;aliyun spring&lt;/name&gt;\t&lt;url&gt;https://maven.aliyun.com/repository/spring&lt;/url&gt;&lt;/mirror&gt;&lt;mirror&gt;\t&lt;id&gt;aliyun-spring-plugin&lt;/id&gt;\t&lt;mirrorOf&gt;*&lt;/mirrorOf&gt;\t&lt;name&gt;aliyun spring-plugin&lt;/name&gt;\t&lt;url&gt;https://maven.aliyun.com/repository/spring-plugin&lt;/url&gt;&lt;/mirror&gt;&lt;mirror&gt;\t&lt;id&gt;aliyun-apache-snapshots&lt;/id&gt;\t&lt;mirrorOf&gt;*&lt;/mirrorOf&gt;\t&lt;name&gt;aliyun apache-snapshots&lt;/name&gt;\t&lt;url&gt;https://maven.aliyun.com/repository/apache-snapshots&lt;/url&gt;&lt;/mirror&gt;&lt;mirror&gt;\t&lt;id&gt;aliyun-google&lt;/id&gt;\t&lt;mirrorOf&gt;*&lt;/mirrorOf&gt;\t&lt;name&gt;aliyun google&lt;/name&gt;\t&lt;url&gt;https://maven.aliyun.com/repository/google&lt;/url&gt;&lt;/mirror&gt;&lt;mirror&gt;\t&lt;id&gt;aliyun-gradle-plugin&lt;/id&gt;\t&lt;mirrorOf&gt;*&lt;/mirrorOf&gt;\t&lt;name&gt;aliyun gradle-plugin&lt;/name&gt;\t&lt;url&gt;https://maven.aliyun.com/repository/gradle-plugin&lt;/url&gt;&lt;/mirror&gt;&lt;mirror&gt;\t&lt;id&gt;aliyun-jcenter&lt;/id&gt;\t&lt;mirrorOf&gt;*&lt;/mirrorOf&gt;\t&lt;name&gt;aliyun jcenter&lt;/name&gt;\t&lt;url&gt;https://maven.aliyun.com/repository/jcenter&lt;/url&gt;&lt;/mirror&gt;&lt;mirror&gt;\t&lt;id&gt;aliyun-releases&lt;/id&gt;\t&lt;mirrorOf&gt;*&lt;/mirrorOf&gt;\t&lt;name&gt;aliyun releases&lt;/name&gt;\t&lt;url&gt;https://maven.aliyun.com/repository/releases&lt;/url&gt;&lt;/mirror&gt;&lt;mirror&gt;\t&lt;id&gt;aliyun-snapshots&lt;/id&gt;\t&lt;mirrorOf&gt;*&lt;/mirrorOf&gt;\t&lt;name&gt;aliyun snapshots&lt;/name&gt;\t&lt;url&gt;https://maven.aliyun.com/repository/snapshots&lt;/url&gt;&lt;/mirror&gt;&lt;mirror&gt;\t&lt;id&gt;aliyun-grails-core&lt;/id&gt;\t&lt;mirrorOf&gt;*&lt;/mirrorOf&gt;\t&lt;name&gt;aliyun grails-core&lt;/name&gt;\t&lt;url&gt;https://maven.aliyun.com/repository/grails-core&lt;/url&gt;&lt;/mirror&gt;&lt;mirror&gt;\t&lt;id&gt;aliyun-mapr-public&lt;/id&gt;\t&lt;mirrorOf&gt;*&lt;/mirrorOf&gt;\t&lt;name&gt;aliyun mapr-public&lt;/name&gt;\t&lt;url&gt;https://maven.aliyun.com/repository/mapr-public&lt;/url&gt;&lt;/mirror&gt;&lt;mirror&gt;\t&lt;id&gt;aliyun-mapr-publicss&lt;/id&gt;\t&lt;mirrorOf&gt;*&lt;/mirrorOf&gt;\t&lt;name&gt;aliyun mapr-publicss&lt;/name&gt;\t&lt;url&gt;https://mvnrepository.com/artifact&lt;/url&gt;&lt;/mirror&gt;\n","tags":["maven"]},{"title":"å¯¹è±¡è½¬MAPå·¥å…·ç±»","url":"/2022/10/16/0.3.4-%E5%AF%B9%E8%B1%A1%E8%BD%ACMAP%E5%B7%A5%E5%85%B7%E7%B1%BB/","content":"package com.service.zxing.util;import java.lang.reflect.Field;import java.lang.reflect.Modifier;import java.util.HashMap;import java.util.Map;public class BeanMapUtilByReflect &#123;    /**     * å¯¹è±¡è½¬Map     * @param object     * @return     * @throws IllegalAccessException     */    public static Map beanToMap(Object object) throws IllegalAccessException &#123;        Map&lt;String, Object&gt; map = new HashMap&lt;String, Object&gt;();        Field[] fields = object.getClass().getDeclaredFields();        for (Field field : fields) &#123;            field.setAccessible(true);            map.put(field.getName(), field.get(object));        &#125;        return map;    &#125;    /**     * mapè½¬å¯¹è±¡     * @param map     * @param beanClass     * @param &lt;T&gt;     * @return     * @throws Exception     */    public static &lt;T&gt; T mapToBean(Map map, Class&lt;T&gt; beanClass) throws Exception &#123;        T object = beanClass.newInstance();        Field[] fields = object.getClass().getDeclaredFields();        for (Field field : fields) &#123;            int mod = field.getModifiers();            if (Modifier.isStatic(mod) || Modifier.isFinal(mod)) &#123;                continue;            &#125;            field.setAccessible(true);            if (map.containsKey(field.getName())) &#123;                field.set(object, map.get(field.getName()));            &#125;        &#125;        return object;    &#125;&#125;","tags":["å·¥å…·ç±»"]},{"title":"IDEAè‡ªå®šä¹‰æ³¨é‡Šæ¨¡ç‰ˆ","url":"/2022/10/16/0.3.5-IDEA%E8%87%AA%E5%AE%9A%E4%B9%89%E6%B3%A8%E9%87%8A%E6%A8%A1%E7%89%88/","content":"1.é…ç½®æ¨¡æ¿ç»„\n2.å¡«å†™å‚æ•°\n** * TODO * @Author:Foam * @Date:$date$ $time$$param$ * @return $return$  **/\n3.è®¾ç½®è¡¨è¾¾å¼\nparamè¡¨è¾¾å¼groovyScript(&quot;def result=&#x27;&#x27;;def params=\\&quot;$&#123;_1&#125;\\&quot;.replaceAll(&#x27;[\\\\\\\\[|\\\\\\\\]|\\\\\\\\s]&#x27;, &#x27;&#x27;).split(&#x27;,&#x27;).toList();for(i = 0; i &lt; params.size();i++) &#123;result+=&#x27; * @param &#x27; + params[i] + ((i &lt; params.size() - 1) ? &#x27;\\\\n&#x27;:&#x27;&#x27;)&#125;; return result&quot;, methodParameters())\nreturnè¡¨è¾¾å¼groovyScript(&quot;def result=&#x27;&#x27;;def params=\\&quot;$&#123;_1&#125;\\&quot;.replaceAll(&#x27;[\\\\\\\\[|\\\\\\\\]|\\\\\\\\s]&#x27;, &#x27;&#x27;).split(&#x27;&lt;&#x27;).toList();for(i = 0; i &lt; params.size();i++) &#123;if(i!=0)&#123;result+=&#x27;&lt;&#x27;;&#125;;def p1=params[i].split(&#x27;,&#x27;).toList();for(i2 = 0; i2 &lt; p1.size(); i2++) &#123; def p2=p1[i2].split(&#x27;\\\\\\\\.&#x27;).toList(); result+=p2[p2.size()-1]; if(i2!=p1.size()-1)&#123;result+=&#x27;,&#x27;&#125; &#125; ;&#125;; return result&quot;, methodReturnType())\n4.è®¾ç½®è§¦å‘æ–¹å¼\n5.è®¾ç½®åº”ç”¨èŒƒå›´\n","tags":["idea"]},{"title":"é©¼å³°å‘½åè½¬æ¢å·¥å…·ç±»","url":"/2022/12/17/0.3.6-%E9%A9%BC%E5%B3%B0%E5%91%BD%E5%90%8D%E8%BD%AC%E6%8D%A2%E5%B7%A5%E5%85%B7%E7%B1%BB/","content":"package com.tiantai.policys.commons.utils.common;import com.alibaba.fastjson.JSONArray;import com.alibaba.fastjson.JSONObject; import java.util.*; /** * @Description JOSNObject é©¼å³°è½¬æ¢å·¥å…· * @Author WangKun * @Date 2021/9/17 15:12 * @Version */public class JSONObjectUtil &#123;      /**     * @param json     * @Description é©¼å³°å‘½åè½¬æ¢     * @Throws     * @Return com.alibaba.fastjson.JSONObject     * @Date 2021-09-17 17:04:31     * @Author WangKun     **/    public static JSONObject humpConvertJSONObject(JSONObject json) &#123;        if (null == json) &#123;            return null;        &#125;        Set&lt;String&gt; keys = json.keySet();        String[] array = keys.toArray(new String[0]);        for (String key : array) &#123;            Object value = json.get(key);            String[] keyArray = key.toLowerCase().split(&quot;_&quot;);            if (isUpperCase(key) &amp;&amp; !key.contains(&quot;_&quot;)) &#123;                json.remove(key);                json.put(key.toLowerCase(), value);                continue;            &#125;            if (keyArray.length &gt; 1) &#123;                StringBuilder sb = new StringBuilder();                for (int i = 0; i &lt; keyArray.length; i++) &#123;                    String ks = keyArray[i];                    if (!&quot;&quot;.equals(ks)) &#123;                        if (i == 0) &#123;                            sb.append(ks);                        &#125; else &#123;                            int c = ks.charAt(0);                            if (c &gt;= 97 &amp;&amp; c &lt;= 122) &#123;                                int v = c - 32;                                sb.append((char) v);                                if (ks.length() &gt; 1) &#123;                                    sb.append(ks.substring(1));                                &#125;                            &#125; else &#123;                                sb.append(ks);                            &#125;                        &#125;                    &#125;                &#125;                json.remove(key);                json.put(sb.toString(), value);            &#125;        &#125;        return json;    &#125;     /**     * @param objectList     * @Description é©¼å³°è½¬æ¢     * @Throws     * @Return java.util.List&lt;com.alibaba.fastjson.JSONObject&gt;     * @Date 2021-09-17 17:09:15     * @Author WangKun     **/    public static List&lt;JSONObject&gt; humpConvertListObject(List&lt;JSONObject&gt; objectList) &#123;        if (null == objectList || objectList.size() &lt;= 0) &#123;            return null;        &#125;        List&lt;JSONObject&gt; data = new ArrayList&lt;&gt;();        for (JSONObject object : objectList) &#123;            data.add(humpConvertJSONObject(object));        &#125;        return data;    &#125;     /**     * @param array     * @Description é©¼å³°è½¬æ¢     * @Throws     * @Return java.util.List&lt;com.alibaba.fastjson.JSONObject&gt;     * @Date 2021-09-17 17:13:22     * @Author WangKun     **/    public static List&lt;JSONObject&gt; humpConvertJSONArray(JSONArray array) &#123;        if (null == array || array.size() &lt;= 0) &#123;            return null;        &#125;        List&lt;JSONObject&gt; data = new ArrayList&lt;&gt;();        for (int i = 0; i &lt; array.size(); i++) &#123;            data.add(humpConvertJSONObject(array.getJSONObject(i)));        &#125;        return data;    &#125;     /**     * @param str     * @Description åˆ¤æ–­å­—ç¬¦ä¸²å­—æ¯æ˜¯å¦ä¸ºå¤§å†™     * @Throws     * @Return boolean     * @Date 2021-09-17 17:03:50     * @Author WangKun     **/    public static boolean isUpperCase(String str) &#123;        for (int i = 0; i &lt; str.length(); i++) &#123;            char c = str.charAt(i);            if (c &gt;= 97 &amp;&amp; c &lt;= 122) &#123;                return false;            &#125;        &#125;        return true;    &#125;      public static void main(String[] args) &#123;        JSONObject jsonObject = new JSONObject();        jsonObject.put(&quot;QWE_QWE1&quot;,&quot;1&quot;);        jsonObject.put(&quot;qwe_qwe2&quot;,&quot;2&quot;);        jsonObject.put(&quot;qwe_Qwe3&quot;,&quot;3&quot;);        jsonObject.put(&quot;QWEQWE4&quot;,&quot;4&quot;);        jsonObject.put(&quot;qweqwe5&quot;,&quot;5&quot;);        jsonObject.put(&quot;qweQwe6&quot;,&quot;6&quot;);        System.out.println(humpConvertJSONObject(jsonObject));     &#125; &#125;","tags":["å·¥å…·ç±»"]},{"title":"JVMçš„ç»„æˆ","url":"/2022/10/14/0.3.3-JVM%E7%9A%84%E7%BB%84%E6%88%90/","content":"Java Virtual Machineè™šæ‹Ÿæœºæ˜¯ä¸€ç§æŠ½è±¡åŒ–çš„è®¡ç®—æœºï¼Œé€šè¿‡åœ¨å®é™…çš„è®¡ç®—æœºä¸Šä»¿çœŸæ¨¡æ‹Ÿå„ç§è®¡ç®—æœºåŠŸèƒ½æ¥å®ç°ï¼Œjavaè™šæ‹Ÿæœºæœ‰è‡ªå·±å®Œå–„çš„ç¡¬ä»¶æ¶æ„ï¼Œå¦‚å¤„ç†å™¨ï¼Œå †æ ˆï¼Œå¯„å­˜å™¨ç­‰ï¼Œè¿˜å…·æœ‰ç›¸åº”çš„æŒ‡ä»¤ç³»ç»Ÿ\nä¸€æ¬¡ç¼–è¯‘ï¼Œåˆ°å¤„è¿è¡ŒJavaè¯­è¨€ä½¿ç”¨Javaè™šæ‹Ÿæœºå±è”½äº†ä¸å…·ä½“å¹³å°ç›¸å…³çš„ä¿¡æ¯ï¼Œä½¿å¾—Javaè¯­è¨€ç¼–è¯‘ç¨‹åºåªéœ€ç”Ÿæˆåœ¨Javaè™šæ‹Ÿæœºä¸Šè¿è¡Œçš„ç›®æ ‡ä»£ç ï¼ˆå­—èŠ‚ç ï¼‰ï¼Œå°±å¯ä»¥åœ¨å¤šç§å¹³å°ä¸Šä¸åŠ ä¿®æ”¹åœ°è¿è¡Œ\nå¼€ç¯‡ç¨‹åºåœ¨æ‰§è¡Œä¹‹å‰ï¼Œå…ˆè¦æŠŠJavaä»£ç ç¼–è¯‘æˆå­—èŠ‚ç ï¼ˆ.classæ–‡ä»¶ï¼‰ï¼ŒJVMé¦–å…ˆéœ€è¦æŠŠå­—èŠ‚ç é€šè¿‡ç±»åŠ è½½å™¨æŠŠæ–‡ä»¶åŠ è½½åˆ°å†…å­˜ä¸­çš„è¿è¡Œæ—¶æ•°æ®åŒºä¸­ã€‚å› ä¸ºå­—èŠ‚ç æ–‡ä»¶æ˜¯JVMçš„ä¸€å¥—æŒ‡ä»¤é›†è§„èŒƒï¼Œå¹¶ä¸èƒ½ç›´æ¥äº¤ç»™åº•å±‚æ“ä½œç³»ç»Ÿå»æ‰§è¡Œï¼Œå› æ­¤éœ€è¦æ‰§è¡Œå¼•æ“å°†å­—èŠ‚ç ç¿»è¯‘æˆåº•å±‚ç³»ç»ŸæŒ‡ä»¤å†äº¤ç”±CPUå»æ‰§è¡Œï¼Œè€Œè¿™ä¸ªè¿‡ç¨‹ä¸­éœ€è¦è°ƒç”¨æœ¬åœ°åº“æ¥å£æ¥å®ç°æ•´ä¸ªç¨‹åºçš„åŠŸèƒ½ã€‚æˆ‘ä»¬é€šå¸¸æ‰€è¯´çš„JVMç»„æˆæŒ‡çš„æ˜¯è¿è¡Œæ—¶æ•°æ®åŒºï¼Œå› ä¸ºé€šå¸¸éœ€è¦ç¨‹åºå‘˜è°ƒè¯•åˆ†æçš„åŒºåŸŸå°±æ˜¯è¿è¡Œæ—¶æ•°æ®åŒºï¼Œæˆ–è€…æ›´å…·ä½“åœ°è¯´æ˜¯è¿è¡Œæ—¶æ•°æ®åŒºé‡Œé¢çš„å †ï¼ˆHeapï¼‰æ¨¡å—ã€‚\nå®Œæ•´æ„æˆ\nåŸºæœ¬æ„æˆ\nç±»åŠ è½½å™¨-ClassLoaderClassLoader è´Ÿè´£åŠ è½½å­—èŠ‚ç æ–‡ä»¶å³ class æ–‡ä»¶class æ–‡ä»¶åœ¨æ–‡ä»¶å¼€å¤´æœ‰ç‰¹å®šçš„æ–‡ä»¶æ ‡ç¤º\n\né­”æ•°ï¼š0X CA FE BA BEï¼ˆï¼‰å¦‚æœä¸€ä¸ªæ–‡ä»¶ä¸æ˜¯ä»¥0xCAFEBABE å¼€å¤´çš„ï¼Œé‚£å®ƒè‚¯å®šä¸æ˜¯java classæ–‡ä»¶\n\nClassLoader åªè´Ÿè´£class æ–‡ä»¶çš„åŠ è½½ï¼Œè‡³äºå®ƒæ˜¯å¦å¯ä»¥è¿è¡Œï¼Œåˆ™ç”± Execution Engine å†³å®šã€‚\næ‰§è¡Œå¼•æ“-Execution Engineæ‰§è¡Œå¼•æ“ï¼Œä¹Ÿå« Interpreterã€‚Class æ–‡ä»¶è¢«åŠ è½½åï¼Œä¼šæŠŠæŒ‡ä»¤å’Œæ•°æ®ä¿¡æ¯æ”¾å…¥å†…å­˜ä¸­ï¼ŒExecution Engine åˆ™è´Ÿè´£æŠŠè¿™äº›å‘½ä»¤è§£é‡Šç»™æ“ä½œç³»ç»Ÿï¼Œå³å°† JVM æŒ‡ä»¤é›†ç¿»è¯‘ä¸ºæ“ä½œç³»ç»ŸæŒ‡ä»¤é›†ã€‚\næœ¬åœ°æ¥å£-Native Interfaceæœ¬åœ°æ¥å£çš„ä½œç”¨æ˜¯èåˆä¸åŒçš„ç¼–ç¨‹è¯­è¨€ä¸ºJava æ‰€ç”¨ï¼Œåˆè¡·æ˜¯èåˆC/C++ ç¨‹åºå®ƒçš„ä½œç”¨æ˜¯è°ƒç”¨ä¸åŒè¯­è¨€çš„æ¥å£ç»™ JAVA ç”¨ï¼ˆç°åœ¨ä¸»è¦æ˜¯ä¸€äº›ç¡¬ä»¶äº¤äº’ï¼‰ï¼Œå®ƒä¼šåœ¨ Native Method Stack ä¸­è®°å½•å¯¹åº”çš„æœ¬åœ°æ–¹æ³•ï¼Œç„¶åè°ƒç”¨è¯¥æ–¹æ³•æ—¶å°±é€šè¿‡ Execution Engine åŠ è½½å¯¹åº”çš„æœ¬åœ° libï¼ˆæœ¬åœ°æ–¹æ³•åº“-native libraiesï¼‰åŸæœ¬å¤šç”¨äºä¸€äº›ä¸“ä¸šé¢†åŸŸï¼Œå¦‚JAVAé©±åŠ¨ï¼Œåœ°å›¾åˆ¶ä½œå¼•æ“ç­‰ï¼Œç°åœ¨å…³äºè¿™ç§æœ¬åœ°æ–¹æ³•æ¥å£çš„è°ƒç”¨å·²ç»è¢«ç±»ä¼¼äºSocketé€šä¿¡ï¼ŒWebServiceç­‰æ–¹å¼å–ä»£ã€‚\nè¿è¡Œæ—¶æ•°æ®åŒº-Runtime Data AreaRuntime Data Area æ˜¯å­˜æ”¾æ•°æ®çš„ï¼Œåˆ†ä¸ºäº”éƒ¨åˆ†ï¼šStackï¼ˆè™šæ‹Ÿæœºæ ˆï¼‰ï¼ŒHeapï¼ˆå †ï¼‰ï¼ŒMethod Areaï¼ˆæ–¹æ³•åŒºï¼‰ï¼ŒPC Registerï¼ˆç¨‹åºè®¡æ•°å™¨ï¼‰ï¼ŒNative Method Stackï¼ˆæœ¬åœ°æ–¹æ³•æ ˆï¼‰å‡ ä¹æ‰€æœ‰çš„å…³äº Java å†…å­˜æ–¹é¢çš„é—®é¢˜ï¼Œéƒ½æ˜¯é›†ä¸­åœ¨è¿™å—\nçº¿ç¨‹ç§æœ‰çš„å†…å­˜åŒºåŸŸ\nç¨‹åºè®¡æ•°å™¨ï¼ˆProgram Counter Registerï¼‰å®ƒæ˜¯ä¸€å—è¾ƒå°çš„å†…å­˜ç©ºé—´ï¼ˆå¯èƒ½ä½äºcpuçš„å¯„å­˜å™¨ï¼Œæœ‰å¾…ç¡®è®¤ï¼‰ï¼Œå¯ä»¥çœ‹åšæ˜¯å½“å‰å­—èŠ‚ç æŒ‡ä»¤æ‰§è¡Œçš„è¡Œå·æŒ‡ç¤ºå™¨ï¼Œè®°å½•äº†å½“å‰æ­£åœ¨æ‰§è¡Œçš„è™šæ‹Ÿæœºå­—èŠ‚ç æŒ‡ä»¤åœ°å€ï¼Œæ¯æ¡çº¿ç¨‹éƒ½è¦æœ‰ä¸€ä¸ªç‹¬ç«‹çš„ç¨‹åºè®¡æ•°å™¨ï¼Œè¿™ç±»å†…å­˜ä¹Ÿç§°ä¸ºâ€œçº¿ç¨‹ç§æœ‰â€çš„å†…å­˜ã€‚è™šæ‹Ÿæœºçš„æ¦‚å¿µæ¨¡å‹é‡Œï¼Œå­—èŠ‚ç è§£æå™¨çš„å·¥ä½œæ˜¯é€šè¿‡æ”¹å˜è¿™ä¸ªè®¡æ•°å™¨çš„å€¼æ¥é€‰å–ä¸‹ä¸€æ¡éœ€è¦æ‰§è¡Œçš„å­—èŠ‚ç æŒ‡ä»¤ï¼Œæ¯”å¦‚åˆ†æ”¯ã€å¾ªç¯ã€è·³è½¬ã€å¼‚å¸¸å¤„ç†ã€çº¿ç¨‹æ¢å¤ç­‰åŸºç¡€åŠŸèƒ½éƒ½éœ€è¦ä¾èµ–è¿™ä¸ªè®¡æ•°å™¨æ¥å®Œæˆã€‚ç”±äºJVMçš„å¤šçº¿ç¨‹æ˜¯é€šè¿‡çº¿ç¨‹è½®æµåˆ‡æ¢å¹¶åˆ†é…å¤„ç†å™¨æ‰§è¡Œæ—¶é—´çš„æ–¹å¼æ¥å®ç°çš„ï¼Œä¹Ÿå°±æ˜¯è¯´åœ¨ä»»ä½•æ—¶åˆ»ï¼Œä¸€ä¸ªå¤„ç†å™¨ï¼ˆæˆ–è€…è¯´ä¸€ä¸ªå†…æ ¸ï¼‰éƒ½åªä¼šæ‰§è¡Œä¸€æ¡çº¿ç¨‹ä¸­çš„æŒ‡ä»¤ã€‚æ¯ä¸ªçº¿ç¨‹éƒ½æœ‰å„è‡ªç‹¬ç«‹çš„ç¨‹åºè®¡æ•°å™¨ï¼Œæ³¨æ„å¦‚æœæ­£åœ¨æ‰§è¡Œçš„æ˜¯ Nativeæ–¹æ³•ï¼Œåˆ™ç¨‹åºè®¡æ•°å™¨ä¸ºç©ºï¼ˆUndifinedï¼‰ï¼Œå¹¶ä¸” JVM è§„èŒƒä¸­å¹¶æ²¡æœ‰å¯¹ç¨‹åºè®¡æ•°å™¨å®šä¹‰ OutOfMemoryError å¼‚å¸¸ã€‚\nè™šæ‹Ÿæœºæ ˆï¼ˆVM Stackï¼‰è™šæ‹Ÿæœºæ ˆä¹Ÿæ˜¯çº¿ç¨‹ç§æœ‰çš„ï¼Œå®ƒæè¿°çš„æ˜¯Javaæ–¹æ³•æ‰§è¡Œçš„å†…å­˜æ¨¡å‹ï¼šæ¯ä¸ªæ–¹æ³•åœ¨æ‰§è¡Œçš„åŒæ—¶éƒ½ä¼šåˆ›å»ºä¸€ä¸ªæ ˆå¸§ï¼ˆStack Frameï¼‰ï¼Œç”¨äºå­˜å‚¨å±€éƒ¨å˜é‡è¡¨ã€æ“ä½œæ•°æ ˆã€åŠ¨æ€é“¾æ¥ã€æ–¹æ³•å‡ºå£ç­‰ä¿¡æ¯ï¼Œæ¯ä¸€ä¸ªæ–¹æ³•ä»è°ƒç”¨ç›´è‡³å®Œæˆçš„è¿‡ç¨‹ï¼Œå°±å¯¹åº”ç€ä¸€ä¸ªæ ˆå¸§åœ¨è™šæ‹Ÿæœºæ ˆä¸­å…¥æ ˆå’Œå‡ºæ ˆçš„è¿‡ç¨‹ã€‚è™šæ‹Ÿæœºæ ˆå¸§ä¸­ï¼Œå±€éƒ¨å˜é‡è¡¨æ˜¯æ¯”è¾ƒä¸ºäººæ‰€ç†ŸçŸ¥çš„ï¼Œä¹Ÿå°±æ˜¯å¹³å¸¸æ‰€è¯´çš„â€œæ ˆâ€ï¼Œå±€éƒ¨å˜é‡è¡¨æ‰€éœ€çš„å†…å­˜ç©ºé—´åœ¨ç¼–è¯‘æœŸé—´åˆ†é…å®Œæˆï¼Œå½“è¿›å…¥ä¸€ä¸ªæ–¹æ³•æ—¶ï¼Œè¿™ä¸ªæ–¹æ³•éœ€è¦åœ¨æ ˆå¸§ä¸­åˆ†é…å¤šå¤§çš„å±€éƒ¨å˜é‡ç©ºé—´æ˜¯å®Œå…¨ç¡®å®šçš„ï¼Œåœ¨æ–¹æ³•è¿è¡ŒæœŸé—´ä¸ä¼šæ”¹å˜å±€éƒ¨å˜é‡è¡¨çš„å¤§å°ã€‚ç”Ÿå‘½å‘¨æœŸä¸çº¿ç¨‹ç›¸åŒï¼Œä¸å­˜åœ¨åƒåœ¾å›æ”¶ï¼Œçº¿ç¨‹ç»“æŸï¼Œå†…å­˜é‡Šæ”¾è™šæ‹Ÿæœºæ ˆæœ‰ä¸¤ç§å¼‚å¸¸æƒ…å†µï¼š\n\nStackOverflowErrorï¼šçº¿ç¨‹è¯·æ±‚çš„æ ˆæ·±åº¦å¤§äºè™šæ‹Ÿæœºæ‰€å…è®¸çš„æ·±åº¦ï¼Œç‰¹åˆ«æ˜¯æ–¹æ³•çš„é€’å½’è°ƒç”¨æ—¶ï¼ˆæœ‰ç©ºç¨‹åºæ¨¡æ‹Ÿä¸€ä¸‹ï¼‰\nOutOfMemoryErrorï¼šè™šæ‹Ÿæœºæ ˆæ— æ³•æ»¡è¶³çº¿ç¨‹æ‰€ç”³è¯·çš„ç©ºé—´éœ€æ±‚ï¼Œå³ä½¿ç»è¿‡åŠ¨æ€æ‰©å±•ä»ç„¶æ— æ³•æ»¡è¶³æ—¶æŠ›å‡ºï¼ˆæœ‰ç©ºç¨‹åºæ¨¡æ‹Ÿä¸€ä¸‹ï¼‰\n\n\næœ¬åœ°æ–¹æ³•æ ˆï¼ˆNative Method Stackï¼‰æœ¬åœ°æ–¹æ³•æ ˆä¸è™šæ‹Ÿæœºæ ˆç›¸ä¼¼ï¼ŒåŒºåˆ«æ˜¯è™šæ‹Ÿæœºæ ˆä¸ºæ‰§è¡Œ Java æ–¹æ³•æœåŠ¡ï¼Œè€Œæœ¬åœ°æ–¹æ³•æ ˆåˆ™ä¸º Native æ–¹æ³•æœåŠ¡ï¼Œæœ‰äº›è™šæ‹Ÿæœºå°†è¿™ä¸¤ä¸ªåŒºåŸŸåˆäºŒä¸ºä¸€ã€‚\n\nåœ¨Execution Engineæ‰§è¡Œå¼•æ“æ‰§è¡Œæ—¶ï¼Œé€šè¿‡Native Interface æœ¬åœ°æ¥å£è°ƒç”¨å·²ç™»è®°çš„native library\næœ¬åœ°æ–¹æ³•æ ˆä¸­æŠ›å‡ºå¼‚å¸¸çš„æƒ…å†µä¸è™šæ‹Ÿæœºæ ˆç›¸åŒï¼Œæœ¬åœ°æ–¹æ³•æ ˆä¹Ÿä¼šåœ¨æ ˆæ·±åº¦æº¢å‡ºæˆ–è€…æ ˆæ‰©å±•å¤±è´¥æ—¶åˆ†åˆ«æŠ›å‡ºStackOverflowErrorå’ŒOutOfMemoryErrorå¼‚å¸¸\n\nä½¿ç”¨åœºæ™¯ï¼šä¸ä¸€äº›åº•å±‚ç³»ç»Ÿå¦‚æ“ä½œç³»ç»Ÿæˆ–æŸäº›ç¡¬ä»¶äº¤æ¢ä¿¡æ¯ï¼Œå¦‚æ‰“å°æœº\nçº¿ç¨‹å…±äº«çš„å†…å­˜åŒºåŸŸ\nå †ï¼ˆHeapï¼‰å¯¹äºjavaåº”ç”¨ç¨‹åºæ¥è®²ï¼Œå †æ˜¯jvmæ‰€ç®¡ç†çš„å†…å­˜ä¸­æœ€å¤§çš„ä¸€å—ã€‚æ˜¯è¢«æ‰€æœ‰çº¿ç¨‹å…±äº«çš„ä¸€å—åŒºåŸŸï¼Œå¹¶åœ¨è™šæ‹Ÿæœºå¯åŠ¨æ—¶åˆ›å»ºã€‚æ­¤åŒºåŸŸçš„å”¯ä¸€ç›®çš„å°±æ˜¯å­˜æ”¾å¯¹è±¡å®ä¾‹ï¼Œjavaç¨‹åºé‡Œâ€œå‡ ä¹â€æ‰€æœ‰çš„å¯¹è±¡å®ä¾‹éƒ½ä¼šåœ¨è¿™é‡Œåˆ›å»ºå¹¶åˆ†é…å†…å­˜ã€‚\n\næ‰€æœ‰çš„å¯¹è±¡å®ä¾‹ä»¥åŠæ•°ç»„éƒ½åº”å½“åœ¨å †ä¸Šåˆ†é…\n\nå †ä¹Ÿæ˜¯åƒåœ¾æ”¶é›†å™¨æ‰€ç®¡ç†çš„ä¸»è¦åŒºåŸŸï¼Œå› æ­¤å¾ˆå¤šæ—¶å€™ä¹Ÿè¢«ç§°ä½œGCå †ã€‚\nä»å†…å­˜å›æ”¶çš„è§’åº¦æ¥çœ‹ç”±äºç°åœ¨æ”¶é›†å™¨åŸºæœ¬éƒ½é‡‡ç”¨åˆ†ä»£æ”¶é›†ç®—æ³•ï¼Œå› æ­¤å †è¿˜å¯ä»¥è¢«ç»†åˆ†ä¸ºï¼šæ–°ç”Ÿä»£å’Œè€å¹´ä»£ã€‚å†ç»§ç»­ç»†åˆ†å¯ä»¥åˆ†ä¸ºï¼šEdenç©ºé—´ã€From Survivorç©ºé—´ï¼ˆs0ï¼‰ã€To Survivorç©ºé—´(s1)ç­‰\nä»å†…å­˜åˆ†é…çš„è§’åº¦æ¥çœ‹çº¿ç¨‹å…±äº«çš„å †ä¸­è¿˜å¯ä»¥åˆ’åˆ†å‡ºå¤šä¸ªçº¿ç¨‹ç§æœ‰çš„åˆ†é…ç¼“å†²åŒºï¼ˆThread Local Allocation Bufferï¼ŒTLABï¼‰å †å¯ä»¥æ˜¯ç‰©ç†ä¸Šä¸è¿ç»­çš„ç©ºé—´ï¼Œåªè¦é€»è¾‘ä¸Šæ˜¯è¿ç»­çš„å³å¯ï¼Œ-Xmxå’Œ-Xmså‚æ•°å¯ä»¥æ§åˆ¶å †çš„æœ€å¤§å’Œæœ€å°å€¼\n\nå †çš„ç©ºé—´å¤§å°ä¸æ»¡è¶³æ—¶å°†æŠ›å‡ºOutOfMemoryErrorå¼‚å¸¸æ–¹æ³•åŒºï¼ˆMethod Areaï¼‰ç”¨äºå­˜å‚¨å·²è¢«è™šæ‹ŸæœºåŠ è½½çš„ç±»ä¿¡æ¯ã€å¸¸é‡ã€é™æ€å˜é‡ã€JITç¼–è¯‘åçš„ä»£ç ç­‰æ•°æ®ã€‚Javaè™šæ‹Ÿæœºè§„èŒƒå°†æ–¹æ³•åŒºæè¿°ä¸ºå †çš„ä¸€ä¸ªé€»è¾‘éƒ¨åˆ†ï¼Œä½†æ˜¯å®ƒå´æœ‰ä¸€ä¸ªåˆ«åå«åšNon-Heapï¼ˆéå †ï¼‰,ç›®çš„åº”è¯¥æ˜¯ä¸javaå †åŒºåˆ†å¼€æ¥ã€‚è¯¯åŒºï¼šæ–¹æ³•åŒºä¸ç­‰äºæ°¸ä¹…ä»£\nå¾ˆå¤šäººåŸå› æŠŠæ–¹æ³•åŒºç§°ä½œâ€œæ°¸ä¹…ä»£â€ï¼ˆPermanent Generationï¼‰ï¼Œæœ¬è´¨ä¸Šä¸¤è€…å¹¶ä¸ç­‰ä»·ï¼Œåªæ˜¯HotSpotè™šæ‹Ÿæœºåƒåœ¾å›æ”¶å™¨å›¢é˜ŸæŠŠGCåˆ†ä»£æ”¶é›†æ‰©å±•åˆ°äº†æ–¹æ³•åŒºï¼Œæˆ–è€…è¯´æ˜¯ç”¨æ¥æ°¸ä¹…ä»£æ¥å®ç°æ–¹æ³•åŒºè€Œå·²ï¼Œè¿™æ ·èƒ½çœå»ä¸“é—¨ä¸ºæ–¹æ³•åŒºç¼–å†™å†…å­˜ç®¡ç†çš„ä»£ç ï¼Œä½†æ˜¯åœ¨Jdk8ä¹Ÿç§»é™¤äº†â€œæ°¸ä¹…ä»£â€ï¼Œä½¿ç”¨Native Memoryæ¥å®ç°æ–¹æ³•åŒº\n\n\n\nåœ¨æ–¹æ³•åŒºä¸­æœ‰ä¸€éƒ¨åˆ†åŒºåŸŸç”¨æ¥å­˜å‚¨ç¼–è¯‘æœŸäº§ç”Ÿçš„å„ç§å­—é¢é‡å’Œç¬¦å·å¼•ç”¨ï¼Œè¿™éƒ¨åˆ†å†…å®¹å°†åœ¨ç±»åŠ è½½åè¿›å…¥æ–¹æ³•åŒºçš„è¿è¡Œæ—¶å¸¸é‡æ± ä¸­å­˜æ”¾ã€‚è¿™é‡Œéœ€è¦è¯´æ˜ä¸€ç‚¹ï¼Œå¸¸é‡å¹¶ä¸æ˜¯åªèƒ½åœ¨ç¼–è¯‘æœŸäº§ç”Ÿï¼Œè¿è¡ŒæœŸé—´ä¹Ÿä¼šäº§ç”Ÿæ–°çš„å¸¸é‡å¹¶è¢«å‘åœ¨å¸¸é‡æ± ä¸­ï¼Œå¦‚ String ç±»çš„ intern() æ–¹æ³•ã€‚æ–¹æ³•åŒºåŒæ ·ä¼šæŠ›å‡ºOutOfMemoryErrorå¼‚å¸¸\nç›´æ¥å†…å­˜æ³¨æ„ç›´æ¥å†…å­˜ä¸å±äºè™šæ‹Ÿæœºè¿è¡Œæ—¶æ•°æ®åŒºçš„ä¸€éƒ¨åˆ†ï¼Œä¹Ÿä¸æ˜¯ JVM è§„èŒƒä¸­å®šä¹‰çš„å†…å­˜åŒºåŸŸï¼Œå…¶ä¸»è¦ç”¨äº JDK1.4 å¼•å…¥çš„åŸºäºé€šé“(Channel)å’Œç¼“å†²åŒº(Buffer)çš„ NIO ç±»ï¼Œå¯ä»¥é¿å…åœ¨ Native å †å’Œ Java å †ä¹‹é—´æ¥å›å¤åˆ¶æ•°æ®ä»è€Œæé«˜æ€§èƒ½ã€‚è¯¥éƒ¨åˆ†å†…å­˜åˆ†é…ä¸å— Java å †å†…å­˜å¤§å°çš„é™åˆ¶ï¼Œä½†æ˜¯è‚¯å®šä¹Ÿå—é™äºæœºå™¨ç¡¬ä»¶å†…å­˜çš„é™åˆ¶ï¼Œåœ¨è®¾ç½®è™šæ‹Ÿæœºå‚æ•°çš„æ—¶å€™ï¼Œä¸èƒ½å¿½ç•¥ç›´æ¥å†…å­˜ï¼ŒæŠŠå®é™…å†…å­˜è®¾ç½®ä¸º-Xmxï¼Œä½¿å¾—å†…å­˜åŒºåŸŸçš„æ€»å’Œå¤§äºç‰©ç†å†…å­˜çš„é™åˆ¶ï¼Œä»è€Œå¯¼è‡´åŠ¨æ€æ‰©å±•æ—¶å‡ºç°OutOfMemoryErrorå¼‚å¸¸ã€‚\næ ˆå¸§æ„æˆï¼ˆStack Frameï¼‰\nä¸€ä¸ªæ ˆå¸§éœ€è¦åˆ†é…å¤šå°‘å†…å­˜ï¼Œä¸ä¼šå—åˆ°ç¨‹åºè¿è¡ŒæœŸå˜é‡æ•°æ®çš„å½±å“ï¼Œè€Œä»…ä»…å–å†³äºå…·ä½“çš„è™šæ‹Ÿæœºå®ç°\n\næ¯ä¸€ä¸ªæ ˆå¸§éƒ½åŒ…æ‹¬äº†å±€éƒ¨å˜é‡è¡¨ã€æ“ä½œæ•°æ ˆã€åŠ¨æ€è¿æ¥ã€æ–¹æ³•è¿”å›åœ°å€å’Œä¸€äº›é¢å¤–çš„é™„åŠ ä¿¡æ¯ï¼Œæ–¹æ³•ä»è°ƒç”¨å¼€å§‹åˆ°æ‰§è¡Œå®Œæˆï¼Œå°±å¯¹åº”ç€ä¸€ä¸ªæ ˆå¸§åœ¨è™šæ‹Ÿæœºæ ˆé‡Œé¢ä»å…¥æ ˆåˆ°å‡ºæ ˆçš„è¿‡ç¨‹åœ¨ç¼–è¯‘ç¨‹åºä»£ç çš„æ—¶å€™ï¼Œæ ˆå¸§ä¸­éœ€è¦å¤šå¤§çš„å±€éƒ¨å˜é‡è¡¨ï¼Œå¤šæ·±çš„æ“ä½œæ•°æ ˆéƒ½å·²ç»å®Œå…¨ç¡®å®šäº†ï¼Œå¹¶ä¸”å†™å…¥åˆ°æ–¹æ³•è¡¨çš„Codeå±æ€§ä¸­äº†ï¼Œå› æ­¤ä¸€ä¸ªæ ˆå¸§éœ€è¦åˆ†é…å¤šå°‘å†…å­˜ï¼Œä¸ä¼šå—åˆ°ç¨‹åºè¿è¡ŒæœŸå˜é‡æ•°æ®çš„å½±å“ï¼Œè€Œä»…ä»…å–å†³äºå…·ä½“è™šæ‹Ÿæœºçš„å®ç°ã€‚å½“å‰æ ˆå¸§ä¸€ä¸ªçº¿ç¨‹ä¸­çš„æ–¹æ³•è°ƒç”¨é“¾å¯èƒ½ä¼šå¾ˆé•¿ï¼Œå¾ˆå¤šæ–¹æ³•éƒ½åŒæ—¶å¤„äºæ‰§è¡ŒçŠ¶æ€ã€‚å¯¹äºæ‰§è¡Œå¼•æ“æ¥è¯´ï¼Œåœ¨æ´»åŠ¨çº¿ç¨‹ä¸­ï¼Œåªæœ‰ä½äºæ ˆé¡¶çš„æ ˆå¸§æ‰æ˜¯æœ€æœ‰æ•ˆçš„,ç§°ä¸ºå½“å‰æ ˆå¸§(Current Stack Frame),ä¸è¿™ä¸ªæ ˆå¸§ç›¸å…³è”çš„æ–¹æ³•ç§°ä¸ºå½“å‰æ–¹æ³•ã€‚æ‰§è¡Œå¼•æ“è¿è¡Œçš„æ‰€æœ‰çš„å­—èŠ‚ç æŒ‡ä»¤éƒ½åªé’ˆå¯¹å½“å‰æ ˆå¸§è¿›è¡Œæ“ä½œ\nå±€éƒ¨å˜é‡è¡¨ï¼ˆLocal Variable Tableï¼‰å±€éƒ¨å˜é‡è¡¨(Local Variable Table)æ˜¯ä¸€ç»„å˜é‡å€¼å­˜è´®ç©ºé—´ï¼Œç”¨äºå­˜æ”¾æ–¹æ³•å‚æ•°å’Œæ–¹æ³•å†…å®šä¹‰çš„å±€éƒ¨å˜é‡åœ¨Javaç¨‹åºç¼–è¯‘ä¸ºClassæ–‡ä»¶æ—¶å€™ï¼Œå°±åœ¨æ–¹æ³•çš„Codeå±æ€§çš„max_localsæ•°æ®é¡¹ä¸­ç¡®å®šäº†è¯¥æ–¹æ³•æ‰€éœ€è¦åˆ†é…çš„å±€éƒ¨å˜é‡è¡¨çš„æœ€å¤§å®¹é‡å±€éƒ¨å˜é‡è¡¨çš„å®¹é‡ä»¥å˜é‡æ§½ä¸ºæœ€å°å•ä½\nå˜é‡æ§½ï¼ˆVariable Slotï¼‰æ¯ä¸ªå˜é‡æ§½éƒ½å¯ä»¥å­˜å‚¨32ä½é•¿åº¦çš„å†…å­˜ç©ºé—´ï¼Œä¾‹å¦‚booleanã€byteã€charã€shortã€intã€floatã€referenceå’ŒreturnAddresså¯¹äº64ä½é•¿åº¦çš„æ•°æ®ç±»å‹ï¼ˆlongï¼Œdoubleï¼‰ï¼Œè™šæ‹Ÿæœºä¼šä»¥é«˜ä½å¯¹é½æ–¹å¼ä¸ºå…¶åˆ†é…ä¸¤ä¸ªè¿ç»­çš„Slotç©ºé—´ï¼Œä¹Ÿå°±æ˜¯ç›¸å½“äºæŠŠä¸€æ¬¡longå’Œdoubleæ•°æ®ç±»å‹è¯»å†™åˆ†å‰²æˆä¸ºä¸¤æ¬¡32ä½è¯»å†™ã€‚ä¸ºäº†èŠ‚çœæ ˆå¸§ç©ºé—´ï¼Œå±€éƒ¨å˜é‡è¡¨ä¸­çš„Slotæ˜¯å¯ä»¥é‡ç”¨çš„ï¼Œæ–¹æ³•ä½“ä¸­å®šä¹‰çš„å˜é‡ï¼Œå…¶ä½œç”¨åŸŸå¹¶ä¸ä¸€å®šä¼šè¦†ç›–æ•´ä¸ªæ–¹æ³•ä½“ï¼Œå¦‚æœå½“å‰å­—èŠ‚ç PCè®¡æ•°å™¨çš„å€¼å·²ç»è¶…è¿‡äº†æŸä¸ªå˜é‡çš„ä½œç”¨åŸŸï¼Œé‚£ä¹ˆè¿™ä¸ªå˜é‡å¯¹åº”çš„Slotå°±å¯ä»¥äº¤ç»™å…¶ä»–å˜é‡ä½¿ç”¨ã€‚è¿™ç§æœºåˆ¶æœ‰æ—¶å€™ä¼šå½±å“åƒåœ¾å›æ”¶è¡Œä¸ºï¼ˆå¦‚å¤§æ–¹æ³•å ç”¨è¾ƒå¤šçš„Slotï¼Œæ‰§è¡Œå®Œè¯¥æ–¹æ³•çš„ä½œç”¨åŸŸåæ²¡æœ‰å¯¹Slotèµ‹å€¼æˆ–è€…æ¸…ç©ºè®¾ç½®nullå€¼ï¼Œåƒåœ¾å›æ”¶å™¨ä¾¿ä¸èƒ½åŠæ—¶çš„å›æ”¶è¯¥å†…å­˜ï¼‰å¦‚æœæ‰§è¡Œçš„æ˜¯å®ä¾‹æ–¹æ³•ï¼Œé‚£å±€éƒ¨å˜é‡è¡¨ä¸­ç¬¬ 0 ä½ç´¢å¼•çš„ Slot é»˜è®¤æ˜¯ç”¨äºä¼ é€’æ–¹æ³•æ‰€å±å¯¹è±¡å®ä¾‹çš„å¼•ç”¨ï¼ˆåœ¨æ–¹æ³•ä¸­å¯ä»¥é€šè¿‡å…³é”®å­— this æ¥è®¿é—®åˆ°è¿™ä¸ªéšå«çš„å‚æ•°ï¼‰jvmä¸ä¼šç»™å±€éƒ¨å˜é‡èµ‹åˆå§‹å€¼ï¼Œåªç»™å…¨å±€å˜é‡èµ‹åˆå§‹å€¼ã€‚\næ“ä½œæ•°æ ˆï¼ˆOperand Stackï¼‰æ“ä½œæ•°æ ˆï¼ˆOperand Stackï¼‰ä¹Ÿå¸¸ç§°ä¸ºæ“ä½œæ ˆï¼Œæ˜¯ä¸€ä¸ªåå…¥å…ˆå‡ºæ ˆã€‚åœ¨Class æ–‡ä»¶çš„Code å±æ€§çš„ max_stacks æŒ‡å®šäº†æ‰§è¡Œè¿‡ç¨‹ä¸­æœ€å¤§çš„æ ˆæ·±åº¦ã€‚Java è™šæ‹Ÿæœºçš„è§£é‡Šæ‰§è¡Œå¼•æ“ç§°ä¸ºâ€åŸºäºæ ˆçš„æ‰§è¡Œå¼•æ“â€œï¼Œè¿™é‡Œçš„æ ˆå°±æ˜¯æŒ‡æ“ä½œæ•°æ ˆã€‚\n\nå½“ä¸€ä¸ªæ–¹æ³•åˆšåˆšå¼€å§‹æ‰§è¡Œçš„æ—¶å€™ï¼Œè¿™ä¸ªæ–¹æ³•çš„æ“ä½œæ•°æ ˆæ˜¯ç©ºçš„ï¼Œåœ¨æ–¹æ³•æ‰§è¡Œçš„è¿‡ç¨‹ä¸­ï¼Œä¼šæœ‰å„ç§å­—èŠ‚ç æŒ‡ä»¤å¾€æ“ä½œæ•°æ ˆä¸­å†™å…¥å’Œæå–å†…å®¹ï¼Œä¹Ÿå°±æ˜¯å‡ºæ ˆ / å…¥æ ˆæ“ä½œã€‚ä¾‹å¦‚ï¼Œåœ¨åšç®—æœ¯è¿ç®—çš„æ—¶å€™æ˜¯é€šè¿‡æ“ä½œæ•°æ ˆæ¥è¿›è¡Œçš„ï¼Œåˆæˆ–è€…åœ¨è°ƒç”¨å…¶å®ƒæ–¹æ³•çš„æ—¶å€™æ˜¯é€šè¿‡æ“ä½œæ•°æ ˆæ¥è¿›è¡Œå‚æ•°ä¼ é€’çš„\n\n\njvmå¯¹æ“ä½œæ•°æ ˆçš„ä¼˜åŒ–åœ¨æ¦‚å¿µæ¨¡å‹ä¸­ï¼Œä¸¤ä¸ªæ ˆå¸§æ˜¯ç›¸äº’ç‹¬ç«‹çš„ã€‚ä½†æ˜¯å¤§å¤šæ•°è™šæ‹Ÿæœºçš„å®ç°éƒ½ä¼šè¿›è¡Œä¼˜åŒ–ï¼Œä»¤ä¸¤ä¸ªæ ˆå¸§å‡ºç°ä¸€éƒ¨åˆ†é‡å ã€‚ä»¤ä¸‹é¢çš„éƒ¨åˆ†æ“ä½œæ•°æ ˆä¸ä¸Šé¢çš„å±€éƒ¨å˜é‡è¡¨é‡å åœ¨ä¸€å—ï¼Œè¿™æ ·åœ¨æ–¹æ³•è°ƒç”¨çš„æ—¶å€™å¯ä»¥å…±ç”¨ä¸€éƒ¨åˆ†æ•°æ®ï¼Œæ— éœ€è¿›è¡Œé¢å¤–çš„å‚æ•°å¤åˆ¶ä¼ é€’æ“ä½œæ ˆè°ƒç”¨å…¶å®ƒæœ‰è¿”å›ç»“æœçš„æ–¹æ³•æ—¶ï¼Œä¼šæŠŠç»“æœ push åˆ°æ ˆä¸Šï¼ˆé€šè¿‡æ“ä½œæ•°æ ˆæ¥è¿›è¡Œå‚æ•°ä¼ é€’ï¼‰\nåŠ¨æ€é“¾æ¥ï¼ˆDynamic Linkingï¼‰æ¯ä¸ªæ ˆå¸§éƒ½åŒ…å«ä¸€ä¸ªæ‰§è¡Œè¿è¡Œæ—¶å¸¸é‡æ± ä¸­è¯¥æ ˆå¸§æ‰€å±æ–¹æ³•çš„å¼•ç”¨ï¼ŒæŒæœ‰è¿™ä¸ªå¼•ç”¨æ˜¯ä¸ºäº†æ”¯æŒæ–¹æ³•è°ƒç”¨è¿‡ç¨‹ä¸­çš„åŠ¨æ€è¿æ¥ï¼ˆDynamic Linkingï¼‰Class æ–‡ä»¶ä¸­å­˜æ”¾äº†å¤§é‡çš„ç¬¦å·å¼•ç”¨ï¼Œå­—èŠ‚ç ä¸­çš„æ–¹æ³•è°ƒç”¨æŒ‡ä»¤å°±æ˜¯ä»¥å¸¸é‡æ± ä¸­æŒ‡å‘æ–¹æ³•çš„ç¬¦å·å¼•ç”¨ä½œä¸ºå‚æ•°ã€‚è¿™äº›ç¬¦å·å¼•ç”¨ä¸€éƒ¨åˆ†ä¼šåœ¨ç±»åŠ è½½é˜¶æ®µæˆ–ç¬¬ä¸€æ¬¡ä½¿ç”¨æ—¶è½¬åŒ–ä¸ºç›´æ¥å¼•ç”¨ï¼Œè¿™ç§è½¬åŒ–ç§°ä¸ºé™æ€è§£æã€‚å¦ä¸€éƒ¨åˆ†å°†åœ¨æ¯ä¸€æ¬¡è¿è¡ŒæœŸé—´è½¬åŒ–ä¸ºç›´æ¥å¼•ç”¨ï¼Œè¿™éƒ¨åˆ†ç§°ä¸ºåŠ¨æ€è¿æ¥ã€‚\nè¿”å›åœ°å€ï¼ˆReturn Addressï¼‰å½“ä¸€ä¸ªæ–¹æ³•å¼€å§‹æ‰§è¡Œä»¥åï¼Œåªæœ‰ä¸¤ç§æ–¹æ³•å¯ä»¥é€€å‡ºå½“å‰æ–¹æ³•ï¼š\n\nå½“æ‰§è¡Œé‡åˆ°è¿”å›æŒ‡ä»¤ï¼Œä¼šå°†è¿”å›å€¼ä¼ é€’ç»™ä¸Šå±‚çš„æ–¹æ³•è°ƒç”¨è€…ï¼Œè¿™ç§é€€å‡ºçš„æ–¹å¼ç§°ä¸ºæ­£å¸¸å®Œæˆå‡ºå£ï¼ˆNormal Method Invocation Completionï¼‰ï¼Œä¸€èˆ¬æ¥è¯´ï¼Œè°ƒç”¨è€…çš„PCè®¡æ•°å™¨å¯ä»¥ä½œä¸ºè¿”å›åœ°å€ã€‚\nå½“æ‰§è¡Œé‡åˆ°å¼‚å¸¸ï¼Œå¹¶ä¸”å½“å‰æ–¹æ³•ä½“å†…æ²¡æœ‰å¾—åˆ°å¤„ç†ï¼Œå°±ä¼šå¯¼è‡´æ–¹æ³•é€€å‡ºï¼Œæ­¤æ—¶æ˜¯æ²¡æœ‰è¿”å›å€¼çš„ï¼Œç§°ä¸ºå¼‚å¸¸å®Œæˆå‡ºå£ï¼ˆAbrupt Method Invocation Completionï¼‰ï¼Œè¿”å›åœ°å€è¦é€šè¿‡å¼‚å¸¸å¤„ç†å™¨è¡¨æ¥ç¡®å®šã€‚\n\nå½“æ–¹æ³•è¿”å›æ—¶ï¼Œå¯èƒ½è¿›è¡Œ3ä¸ªæ“ä½œï¼š\n\næ¢å¤ä¸Šå±‚æ–¹æ³•çš„å±€éƒ¨å˜é‡è¡¨å’Œæ“ä½œæ•°æ ˆ\næŠŠè¿”å›å€¼å‹å…¥è°ƒç”¨è€…è°ƒç”¨è€…æ ˆå¸§çš„æ“ä½œæ•°æ ˆ\nè°ƒæ•´ PC è®¡æ•°å™¨çš„å€¼ä»¥æŒ‡å‘æ–¹æ³•è°ƒç”¨æŒ‡ä»¤åé¢çš„ä¸€æ¡æŒ‡ä»¤é™„åŠ ä¿¡æ¯ï¼ˆAdditional informationï¼‰è™šæ‹Ÿæœºè§„èŒƒå…è®¸å…·ä½“çš„è™šæ‹Ÿæœºå®ç°å¢åŠ ä¸€äº›è§„èŒƒé‡Œæ²¡æœ‰æè¿°çš„ä¿¡æ¯åˆ°æ ˆå¸§ä¹‹ä¸­ï¼Œä¾‹å¦‚ä¸è°ƒè¯•ç›¸å…³çš„ä¿¡æ¯ï¼Œè¿™éƒ¨åˆ†ä¿¡æ¯å®Œå…¨å–å†³äºå…·ä½“çš„è™šæ‹Ÿæœºå®ç°ã€‚åœ¨å®é™…å¼€å‘ä¸­ï¼Œä¸€èˆ¬ä¼šæŠŠåŠ¨æ€è¿æ¥ã€æ–¹æ³•è¿”å›åœ°å€ä¸å…¶ä»–é™„åŠ ä¿¡æ¯å…¨éƒ¨å½’ä¸ºä¸€ç±»ï¼Œç§°ä¸ºæ ˆå¸§ä¿¡æ¯ã€‚å¸§æ•°æ®åŒºï¼ˆFrame Dataï¼‰å¸§æ•°æ®åŒºçš„å¤§å°ä¾èµ–äº JVM çš„å…·ä½“å®ç°è¿™éƒ¨åˆ†çš„ä½œç”¨ä¸»è¦æœ‰ä¸‰éƒ¨åˆ†ï¼š\n\n\nå¸¸é‡æ± ä¸­æ•°æ®çš„è§£æ\næ–¹æ³•è¿è¡Œå®Œåå¤„ç†æ–¹æ³•è¿”å›ï¼Œæ¢å¤è°ƒç”¨æ–¹ç°åœº\næ–¹æ³•è¿è¡Œè¿‡ç¨‹ä¸­æŠ›å‡ºå¼‚å¸¸æ—¶çš„å¼‚å¸¸å¤„ç†ï¼Œå­˜å‚¨æœ‰ä¸€ä¸ªå¼‚å¸¸è¡¨ï¼Œå½“å‡ºç°å¼‚å¸¸æ—¶è™šæ‹ŸæœºæŸ¥æ‰¾ç›¸åº”çš„å¼‚å¸¸è¡¨çœ‹æ˜¯å¦æœ‰ç›¸åº”çš„Catchè¯­å¥ï¼Œå‡è®¾æ²¡æœ‰å°±æŠ›å‡ºå¼‚å¸¸ç»ˆæ­¢è¿™ç§æ–¹æ³•è°ƒå‚è€ƒhttps://java.jverson.com/jvm/jvm-components.htmlhttps://baijiahao.baidu.com/s?id=1720844278862268813&amp;wfr=spider&amp;for=pchttps://blog.csdn.net/wendyyanan/article/details/104261162https://www.cnblogs.com/jhxxb/p/11001238.htmlhttps://juejin.cn/post/6844903655796113421\n\n","tags":["jvm"]},{"title":"openFeignå¼•å…¥å¤±è´¥","url":"/2022/08/22/0.3.2-openFeign%E5%BC%95%E5%85%A5%E5%A4%B1%E8%B4%A5/","content":"æœ€è¿‘ç”¨nacosé›†æˆopenFeignçš„æ—¶å€™ï¼Œé‡åˆ°ä¸€ç›´å¼•å…¥ä¸äº†ä¾èµ–\n&lt;!-- æ·»åŠ  openfeign æ¡†æ¶ä¾èµ– --&gt;&lt;dependency&gt;\t&lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;\t&lt;artifactId&gt;spring-cloud-starter-openfeign&lt;/artifactId&gt;&lt;/dependency&gt;\nä¸€å¼€å§‹ä»¥ä¸ºæ˜¯mavenæºçš„é—®é¢˜ï¼Œæ‰€ä»¥åŠ äº†ç‰¹åˆ«å¤šçš„ä»“åº“éƒ½æ²¡æœ‰è§£å†³ï¼Œåé¢è¯•ç€åŠ ç‰ˆæœ¬å·ï¼Œæ²¡æƒ³åˆ°å°±è§£å†³äº†\n&lt;!-- æ·»åŠ  openfeign æ¡†æ¶ä¾èµ– --&gt;&lt;dependency&gt;\t&lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;\t&lt;artifactId&gt;spring-cloud-starter-openfeign&lt;/artifactId&gt;\t&lt;version&gt;2.1.1.RELEASE&lt;/version&gt;&lt;/dependency&gt;\nè€Œä¸”åœ¨å¯åŠ¨ç±»ä¸­ä¹Ÿå¯ä½¿ç”¨@EnableFeignClientsæ³¨è§£å¦‚æœä¸‹æ¬¡å¼•å…¥ä¾èµ–ï¼Œæ²¡æœ‰æŒ‡å®šç‰ˆæœ¬ï¼Œå¯ä»¥è¯•è¯•æŒ‡å®šä¸€ä¸‹ç‰ˆæœ¬ï¼Œæœ€æ–°çš„ä¸è¡Œå°±ç”¨ç¨³å®šç‰ˆæœ¬\n","tags":["ä¸­é—´ä»¶","openFeign"]},{"title":"ArrayListå’ŒLinkedListåŒºåˆ«","url":"/2023/02/06/0.3.7-ArrayList%E5%92%8CLinkedList%E5%8C%BA%E5%88%AB/","content":"è¿™æ˜¯ä¸€é“æ¯”è¾ƒç»å…¸çš„é¢è¯•é¢˜\nä¸»è¦ä¸åŒç‚¹ï¼š\næ•°æ®ç»“æ„ä¸åŒ\n\næ•ˆç‡ä¸åŒ\n\nç©ºé—´çµæ´»æ€§å’Œå ç”¨å†…å­˜ä¸åŒ\næ³¨æ„ç‚¹ï¼š\nåœ¨æ–°å»ºArrayListçš„æ—¶å€™æœ€å¥½æŒ‡å®šåˆå§‹åŒ–å¤§å°ï¼Œé˜²æ­¢é¢‘ç¹æ‰©å®¹å½±å“æ•ˆç‡\n\nåœ¨jdk1.7ä¸­ArrayListé»˜è®¤åˆå§‹åŒ–å¤§å°ä¸º10ï¼Œæ¯æ¬¡æ‰©å®¹0.5(1.5å€)ã€é¥¿æ±‰å¼ã€‘\n\nåœ¨jdk1.8ä¸­ArrayListé»˜è®¤ä¸ºç©ºæ•°ç»„ï¼Œç¬¬ä¸€æ¬¡addçš„æ—¶å€™ä¼šè®¾ç½®ä¸º10ï¼Œå¦‚æœæ»¡äº†å†è‡ªåŠ¨æ‰©å®¹ã€æ‡’æ±‰å¼ã€‘\n\n\n\n1.LinkedListå®ç°äº†Dequeæ¥å£ï¼Œå¯ä»¥ä½œä¸ºåŒç«¯é˜Ÿåˆ—ä½¿ç”¨\n2.å› ä¸ºæ•°æ®ç»“æ„ä¸åŒï¼ŒArrayListæ˜¯æ•°ç»„ç»“æ„ï¼ŒLinkedListæ˜¯åŒå‘é“¾è¡¨ç»“æ„\nArrayListæŒ‡å®šä¸‹æ ‡æŸ¥è¯¢çš„æ—¶å€™æœ‰ä¼˜åŠ¿ï¼Œå› ä¸ºæ•°ç»„æ˜¯æå‰åˆ†é…å¥½å†…å­˜ç©ºé—´çš„\n\nLinkedListæŒ‡å®šä¸‹æ ‡ï¼ˆgetï¼‰æŸ¥è¯¢æ—¶å€™éœ€è¦å»éå†è¿™ä¸ªé“¾è¡¨ï¼Œæ‰èƒ½æ‰¾åˆ°æŒ‡å®šä¸‹æ ‡ä½ç½®\n\nå½“Linkedlistè·å–ç¬¬ä¸€ä¸ªå…ƒç´ ï¼ˆgetFirstï¼‰å’Œæœ€åä¸€ä¸ªå…ƒç´ ï¼ˆgetLastï¼‰çš„é€Ÿåº¦ä¹Ÿæ˜¯éå¸¸å¿«çš„\nåŸå› ï¼šåœ¨LinkedListä¸­æœ‰ä¸¤ä¸ªå±æ€§ï¼Œfirstå’Œlastå®ƒä¿©ä¼šä¸€ç›´æŒç»­è®°å½•ç€ç¬¬ä¸€ä¸ªå…ƒç´ å’Œæœ€åä¸€ä¸ªå…ƒç´ çš„ä½ç½®ï¼ˆä¸ä¼šæ¶‰åŠåˆ°éå†æ“ä½œï¼‰3.ç”±äºåº•å±‚æ•°æ®ç»“æ„ä¸åŒï¼ŒArrayListæ›´é€‚åˆéšæœºæŸ¥æ‰¾,LinkedListæ›´é€‚åˆåˆ é™¤å’Œæ·»åŠ \n\n\n\n\nå½“éšæœºè®¿é—®Listï¼ˆgetå’Œsetæ“ä½œï¼‰æ—¶ï¼ŒArrayListæ¯”LinkedListçš„æ•ˆç‡æ›´é«˜ï¼Œå› ä¸ºLinkedListæ˜¯çº¿æ€§çš„æ•°æ®å­˜å‚¨æ–¹å¼ï¼Œæ‰€ä»¥éœ€è¦ç§»åŠ¨æŒ‡é’ˆä»å‰å¾€åä¾æ¬¡æŸ¥æ‰¾ã€‚ArrayListå¯¹äºæ•°æ®æŸ¥è¯¢éå¸¸å¿«ï¼Œä½†æ˜¯æ’å…¥ä¸åˆ é™¤å…ƒç´ æ¯”è¾ƒæ…¢\n\nå½“å¯¹æ•°æ®è¿›è¡Œå¢åŠ å’Œåˆ é™¤çš„æ“ä½œ(addå’Œremoveæ“ä½œ)æ—¶ï¼ŒLinkedListæ˜¯æ°å¥½ç›¸åçš„ï¼Œå®ƒçš„æŸ¥è¯¢é€Ÿåº¦éå¸¸æ…¢ï¼Œä½†æ˜¯æ’å…¥ä¸åˆ é™¤å…ƒç´ çš„é€Ÿåº¦éå¸¸å¿«ã€‚\n\nArrayListè¿›è¡Œæ–°å¢Addæ“ä½œçš„æ—¶å€™ï¼Œä¼šæŠŠå½“å‰å¾…æ’å…¥å…ƒç´ æ·»åŠ åˆ°æœ€åçš„ä¸€ä¸ªä½ç½®\n\n\n\n\nå¦‚æœä¸éœ€è¦è¿›è¡Œæ‰©å®¹æ˜¯éå¸¸å¿«é€Ÿçš„ï¼Œå¦‚æœéœ€è¦æ‰©å®¹ä¼šæœ‰æ‰©å®¹æˆæœ¬\n\n\n\nå¦‚æœæ•°ç»„æŒ‡å®šçš„ä½ç½®æœ‰å…ƒç´ äº†ï¼Œåˆ™ä¼šæŠŠæŒ‡å®šå…ƒç´ åçš„å…ƒç´ æŒ¨ä¸ªå¾€åç§»åŠ¨ï¼Œä¼šå¯¼è‡´æ•ˆç‡ä½\narraylist.add(1,1);\nLinkedListè¿›è¡Œæ–°å¢Addæ“ä½œçš„æ—¶å€™ï¼Œåªéœ€è¦éå†æ‰¾åˆ°å¯¹åº”ä¸‹æ ‡ï¼Œç„¶åæ›¿æ¢å¯¹åº”å…ƒç´ çš„nextå’Œprevçš„æ“ä½œ\n\n\n\n\nLinkedListæ²¡æœ‰æ‰©å®¹æ“ä½œï¼Œå› ä¸ºæ˜¯é“¾è¡¨ç»“æ„ï¼Œåªéœ€è¦æŒ‡å®šä¸‹ä¸€ä¸ªèŠ‚ç‚¹\n\n","tags":["åŸºç¡€"]},{"title":"å®æ—¶é—®é¢˜è§£å†³","url":"/2022/05/28/0.2.5-%E5%AE%9E%E6%97%B6%E9%97%AE%E9%A2%98%E8%A7%A3%E5%86%B3/","content":"å®æˆ˜bugè§£å†³1.mybatispluså¯¼è‡´urlæ— æ³•è®¿é—®åŸå› ï¼šå› ä¸ºåœ¨applicationé…ç½®äº†componentScanå»æ‰«æäº†mybatisplusçš„mapperï¼Œå¯¼è‡´å…¶ä»–çš„æœªæ‰«æåˆ°è§£å†³æ–¹å¼ï¼šåœ¨è‡ªåŠ¨ç”Ÿæˆçš„mapperä¸ŠåŠ ä¸Š@mapperæ³¨è§£å»è¿›è¡Œç»„ä»¶æ‰«æ\n2.druidå¤šæ•°æ®æºåˆ‡æ¢ä¸æˆåŠŸï¼ŒæŠ¥é”™æ‰¾ä¸åˆ°æ•°æ®åº“åŸå› ï¼šbootè‡ªå¸¦çš„æ•°æ®åº“é…ç½®ä¼šå»æ‰«æé»˜è®¤æ•°æ®æºï¼Œè€Œdruidçš„è·¯å¾„ä¸ä¸€æ ·è§£å†³æ–¹å¼ï¼šç¼–å†™ä¸€ä¸ªé»˜è®¤çš„æ•°æ®æº\n3.mybatisplusç”Ÿæˆä¸äº†ä»£ç åŸå› ï¼šfreemarkeræ¨¡æ¿å¼•æ“ä¸å¯ç”¨è§£å†³æ–¹å¼ï¼šåˆ‡æ¢ä¸ºvelocityçš„æ¨¡æ¿å¼•æ“\n4.JobThread Exception:java.lang.reflect.InvocationTargetExceptionåŸå› ï¼šè¿™ä¸ªæ˜¯xxljobå®šæ—¶æ³¨è§£å¯¼è‡´çš„ï¼Œå’Œredisçš„ç¼“å­˜æ³¨è§£å†²çªäº†è§£å†³æ–¹å¼ï¼šæŠŠredisçš„@cacheableæ³¨è§£å»é™¤æ‰å°±è¡Œäº†\n5.é©±åŠ¨ç¨‹åºæ— æ³•é€šè¿‡ä½¿ç”¨å®‰å…¨å¥—æ¥å­—å±‚(SSL)åŠ å¯†ä¸ SQL Server å»ºç«‹å®‰å…¨è¿æ¥ã€‚åŸå› ï¼šsqlserveråœ¨1.8ä¹‹å‰çš„ç‰ˆæœ¬å®‰å…¨éªŒè¯ä¸ä¸€æ ·è§£å†³æ–¹æ³•ï¼šæŠŠC:\\Program Files\\Java\\jdk1.8.0_301\\jre\\lib\\securityä¸‹çš„java.securityçš„3DES_EDE_CBC  TLSv1, TLSv1.1æ³¨é‡Šæ‰ï¼Œç½‘ä¸Šå†™çš„åªæ³¨é‡Š3DES_EDE_CBCä¸å®Œå…¨å‚è€ƒï¼šhttps://blog.csdn.net/weixin_47180824/article/details/116236919\n6.mybatisplusç”Ÿæˆsqlserveræ–‡ä»¶å¤±è´¥ï¼ŒSQLServerException: åˆ—å â€˜TABLE_NAMEâ€™ æ— æ•ˆã€‚åŸå› ï¼šmybatisplusç‰ˆæœ¬è¿‡é«˜è§£å†³æ–¹æ³•ï¼šæŠŠmybatisplusä»3.3.1é™ä¸º3.2.0\n7.Invalid bound statement (not found)åŸå› ï¼šmybatis-plus.mapper-locations= classpath*:mapper/**/*.xmlåœ¨é…ç½®æ—¶å¤šæ‰“äº†ä¸€ä¸ªç©ºæ ¼ï¼Œåº”è¯¥è¦è´´ç€æ‰“æ³¨æ„ï¼šè¿™ç§åœ¨xmlç»å¸¸ä¼šå‡ºç°è¿™ç§é—®é¢˜å¯¼è‡´é…ç½®ä¸ç”Ÿæ•ˆ\n8.druidä¸­ä¸åŒæ•°æ®æºä¹‹é—´çš„äº¤äº’åŸå› ï¼šDataSourceæ‰“åœ¨controllerå±‚ï¼Œå¦‚æœéƒ½æ˜¯åœ¨è¿™ä¸ªæ–¹æ³•ä¸­æ‰§è¡Œï¼Œåˆ™å…¨éƒ½ä¼šè¿æ¥åˆ°ä¸€ä¸ªæ•°æ®æºä¸­ï¼Œå¦‚æœéœ€è¦å¤šæ•°æ®äº¤äº’ï¼Œåˆ™éœ€è¦ç»™å„è‡ªçš„serverå±‚æ‰“ä¸Šè¯¥ä½¿ç”¨çš„æ•°æ®æºè§£å†³æ–¹æ³•ï¼šæŠŠDataSourceçš„æ³¨è§£æ‰“åœ¨serverå±‚\n9.mybatisplusåˆ†é¡µä¸èµ·ä½œç”¨ï¼ŒæŸ¥è¯¢å…¨æ•°æ®åŸå› ï¼šmpåœ¨å®˜æ–¹æ–‡æ¡£æœ‰è¯´æ˜ï¼Œé»˜è®¤çš„åˆ†é¡µæœ€å¤§é™åˆ¶æ˜¯500æ¡æ¯é¡µè§£å†³åŠæ³•ï¼šåœ¨mybatisplusé…ç½®æ–‡ä»¶æŠŠpaginationInterceptor.setLimit(-1);è®¾ç½®-1ï¼Œå¦‚æœä¸è®¾ç½®é»˜è®¤æ˜¯500ä¸Šé™\n10.å¤šçº¿ç¨‹åœ¨è·‘åŠ¨æ—¶ä¼šå…ˆæŠŠçº¿ç¨‹åŠ å…¥çº¿ç¨‹æ± ï¼Œç„¶åæ‰§è¡Œï¼Œredisé˜Ÿåˆ—ä¼šæœ‰å†²çªè§£å†³åŠæ³•ï¼šä½¿ç”¨é˜»å¡é˜Ÿåˆ—arrayBlockQueueåç»­è§£å†³æ–¹æ³•ï¼šç»™çº¿ç¨‹æ± è‡ªå®šä¹‰ä¼˜åŒ–å¦‚ä¸‹ï¼Œå‰é¢ä½¿ç”¨è‡ªå¸¦çš„ä¸‰å¤§æ–¹æ³•éƒ½ä¸å¥½ç”¨\n ExecutorService threadPool= new ThreadPoolExecutor(4,4, 10L, TimeUnit.MILLISECONDS,                new LinkedBlockingDeque&lt;&gt;(100),                Executors.defaultThreadFactory(),                new ThreadPoolExecutor.CallerRunsPolicy());\n11.mysqlæ’å…¥é‡æ¯æ¬¡åªæœ‰5kå·¦å³ï¼Œæ’å…¥æ—¶é—´è¿‡é•¿åŸå› ï¼šmysqlé™åˆ¶æ’å…¥4Mè§£å†³æ–¹æ¡ˆï¼šæå‡æ¯æ¡sqlå†…å­˜ä¸º256M\nselect @@max_allowed_packet;SET GLOBAL max_allowed_packet=268435456;\n12.INSERT command deniedåŸå› ï¼š1.æ•°æ®åº“æ²¡æœ‰æƒé™ï¼Œ2.ä½ çš„sqlæŒ‡å®šé”™äº†åº“åï¼Œmybatisplusè‡ªåŠ¨ç”Ÿæˆä¼šå¸¦åº“å\n13.Java HotSpot(TM) 64-Bit Server VM warning: INFO: os::commit_memory(0x000001fd7819d000, 2195456, 0) failed; error=â€™Ò³   Ä¼ Ì«Ğ¡   Ş·   É²     â€˜ (DOS error/errno=1455)è§£å†³æ€è·¯ï¼šå¢åŠ äº†ideaçš„jvmå†…å­˜\n14.æ—¥æœŸæ ¼å¼ä¸æ­£ç¡®å¯¼è‡´æ¯æ¬¡ä¼šæŸ¥è¯¢é‡å¤æ•°æ®ï¼Œæ²¡æœ‰åé¢çš„2702021-11-02 08:21:25.270åŸå› ï¼šåé¢çš„270æ˜¯æ¯«ç§’è§£å†³æ–¹æ¡ˆï¼šæŠŠåŸæ¥çš„yyyy-MM-dd HH:mm:ssæ”¹ä¸ºyyyy-MM-dd HH:mm:ss.SSSåˆ‡è®°ï¼šsä¸€å®šè¦å¤§å†™ï¼Œå¤§å†™æŸ¥è¯¢çš„æ˜¯å¾®ç§’ï¼Œå°å†™æŸ¥è¯¢çš„æ˜¯æ¯«ç§’\n15.xxljobæ²¡æœ‰æ—¥å¿—åŸå› ï¼šxxljobæœ‰è‡ªå¸¦çš„æ‰“å°æ—¥å¿—ï¼Œä½¿ç”¨åŸæ¥çš„loggerä¸ç®¡ç”¨è§£å†³æ–¹æ¡ˆï¼šä½¿ç”¨xxljobè‡ªå¸¦çš„æ—¥å¿—æ–¹æ³•XxlJobHelper.log\n16.Data truncation: Incorrect datetime valueåŸå› ï¼šå› ä¸ºå­˜å…¥redisçš„æ•°æ®ä¸ºjsonæ ¼å¼ï¼Œæœ€åè§£æå‡ºæ¥çš„æ•°æ®ä¸ºStringç±»å‹ï¼Œè€Œæ•°æ®åº“å­˜å‚¨éœ€è¦Dateç±»å‹è§£å†³æ–¹æ³•ï¼šæŠŠå­˜å‚¨çš„æ•°æ®åºåˆ—åŒ–ï¼Œç„¶åå–å‡ºçš„æ—¶å€™ååºåˆ—åŒ–ï¼Œè¿™æ ·å¯ä»¥ä¿è¯æ•°æ®çš„æ ¼å¼\n17.MISCONF Redis is configured to save RDB snapshotsåŸå› ï¼šrediså­˜æ»¡äº†ï¼Œå¼ºåˆ¶æŠŠrediså¿«ç…§å…³é—­äº†å¯¼è‡´ä¸èƒ½æŒä¹…åŒ–è§£å†³æ–¹æ³•ï¼šæ§åˆ¶å°è¾“å…¥config set stop-writes-on-bgsave-error no\n18.sql injection violation, multi-statement not allowåŸå› ï¼šmysqlçš„æ‰¹é‡æ›´æ–°æ˜¯è¦æˆ‘ä»¬ä¸»åŠ¨å»è®¾ç½®çš„è§£å†³æ–¹æ³•ï¼šåœ¨mysqlè¿æ¥urlåé¢åŠ ä¸Š&amp;allowMultiQueries=true\n19.insert into select fromä¼šå¯¼è‡´é”è¡¨è§£å†³æ–¹æ³•ï¼šæ”¹ä¸ºå…ˆåˆ é™¤å†æœç´¢æ’å…¥ï¼Œå¦‚æœæ˜¯å°æ•°æ®é‡æ’å…¥å¯ä»¥å¿½ç•¥è¿™ä¸ªé—®é¢˜ï¼Œä½†æ˜¯å¦‚æœæ¶‰åŠåˆ°é‡‘é¢ç±»å‹ï¼Œèƒ½ä¸ç”¨å°±ä¸ç”¨ï¼Œå¾ˆå®¹æ˜“é€ æˆç”Ÿäº§é—®é¢˜\n20.No tests found matching Method test2(io.renren.DynamicDataSourceTest) from org.junit.internal.requests.ClassRequest@7e6ef134è§£å†³æ–¹æ³•ï¼šæ²¡åŠ @Testæ³¨è§£\n21.Elementuiçš„el-paginationåˆ†é¡µä¸æ›´æ–°é—®é¢˜è§£å†³æ–¹æ³•ï¼š:current-page.sync=â€pageIndexâ€ ä½¿ç”¨å¼‚æ­¥åæ§½ï¼šç½‘ä¸Šçš„æ–¹æ³•ä½¿ç”¨ifé‡æ–°åŠ è½½æ˜¯ä¸ç®¡ç”¨çš„ï¼Œæ¯æ¬¡éƒ½ä¼šå»é»˜è®¤åˆ·æ–°ç¬¬ä¸€é¡µï¼Œè¿™ä¸ªæ˜¯å¤§å‘\n22.mybatisplusæ—¶é—´æŸ¥è¯¢å½“å¤©æ—¥æœŸé—®é¢˜åŸå› ï¼šå› ä¸ºæ•°æ®æœ‰æ—¶åˆ†ç§’ï¼Œç„¶åmpé‡Œé¢æŸ¥è¯¢çš„åˆæ˜¯ç²¾ç¡®çš„è§£å†³æ–¹æ³•ï¼š1.æ”¹ä¸ºèŒƒå›´æŸ¥è¯¢ï¼ŒæŸ¥è¯¢ä»Šå¤©åˆ°æ˜å¤©çš„æ—¶é—´\n2.å†™xmlæ–‡ä»¶ä½¿ç”¨formateæ ¼å¼åŒ–å½“å¤©æ—¶é—´\n","tags":["é—®é¢˜è§£æ"]},{"title":"å®ä½“ç±»è®¾è®¡","url":"/2023/02/26/0.3.9-%E5%AE%9E%E4%BD%93%E7%B1%BB%E8%AE%BE%E8%AE%A1/","content":"DDDé¢†åŸŸé©±åŠ¨è®¾è®¡ï¼ˆDomain-driven designï¼‰ä»‹ç»é¢†åŸŸé©±åŠ¨è®¾è®¡ï¼šæ˜¯ä¸€ç§é€šè¿‡å°†å®ç°è¿æ¥åˆ°æŒç»­è¿›åŒ–çš„æ¨¡å‹æ¥æ»¡è¶³å¤æ‚éœ€æ±‚çš„è½¯ä»¶å¼€å‘æ–¹æ³•ï¼ˆä¸€ç§è§£å†³ä¸šåŠ¡å¤æ‚æ€§çš„è®¾è®¡æ€æƒ³ï¼Œä¸æ˜¯ä¸€ç§æ ‡å‡†è§„åˆ™çš„è§£å†³æ–¹æ³•ï¼‰é¢†åŸŸæ¨¡å‹æ˜¯å¯¹ä¸šåŠ¡æ¨¡å‹çš„æŠ½è±¡ï¼ŒDDDæ˜¯æŠŠä¸šåŠ¡æ¨¡å‹ç¿»è¯‘æˆç³»ç»Ÿæ¶æ„è®¾è®¡çš„ä¸€ç§æ–¹å¼\nå¤±è¡€æ¨¡å‹\næ¨¡å‹ä»…ä»…åŒ…å«å¯¹è±¡å±æ€§çš„å®šä¹‰å’Œæ“ä½œå¯¹è±¡çš„getter/setteræ–¹æ³•å…¶å®ƒæ‰€æœ‰çš„ä¸šåŠ¡é€»è¾‘å®Œå…¨ç”±ä¸šåŠ¡é€»è¾‘å±‚å»å®ç°ï¼Œè¿™ç§ç±»å«POJO\n\nä¼˜ç‚¹ï¼šå¯¹è±¡ç»“æ„ç®€å•ç¼ºç‚¹ï¼šä¼šå¯¼è‡´ä¸šåŠ¡é€»è¾‘å±‚è‡ƒè‚¿ï¼Œéš¾äºç†è§£å’Œç»´æŠ¤ï¼Œæ— æ³•è‰¯å¥½çš„æ‰©å±•å¤æ‚ä¸šåŠ¡é€»è¾‘å’Œåœºæ™¯\n@Datapublic class person &#123;    private String name;    private String sex;    private Integer age;&#125;\nè´«è¡€æ¨¡å‹\næ¨¡å‹åŒ…å«äº†å¯¹è±¡å±æ€§çš„å®šä¹‰å’Œæ“ä½œå¯¹è±¡çš„getter/setteræ–¹æ³•å¹¶ä¸”åŒ…å«äº†å¯¹è±¡çš„è¡Œä¸ºã€æ˜¯å®Œæ•´çš„ä¸€ä¸ªå¯¹è±¡ã€‘å±æ€§ï¼šå§“åï¼Œæ€§åˆ«ï¼Œå¹´é¾„ç­‰è¡Œä¸ºï¼šèµ°è·¯ï¼Œåƒé¥­ï¼Œç¡è§‰ç­‰ä¸åŒ…æ‹¬ä¾èµ–æŒä¹…å±‚çš„ä¸šåŠ¡é€»è¾‘ï¼Œè¿™éƒ¨åˆ†æŒä¹…å±‚çš„æ•°æ®è¿˜æ˜¯åœ¨ä¸šåŠ¡é€»è¾‘å±‚å»å®ç°ï¼Œç»„åˆé€»è¾‘ä¹Ÿæ˜¯æœåŠ¡ç±»è´Ÿè´£\n\nä¼˜ç‚¹ï¼šå±‚æ¬¡ç»“æ„æ¸…æ¥šï¼Œåœ¨å°‘é‡ä¸šåŠ¡é€»è¾‘çš„æœåŠ¡ä¸­ï¼Œå®¹æ˜“ç†è§£ï¼Œè°ƒç”¨æ–¹æ— éœ€ç†è§£å†…éƒ¨é€»è¾‘ç¼ºç‚¹ï¼šåœ¨å¤æ‚çš„é€»è¾‘å’Œåœºæ™¯ä¸å¤ªé€‚ç”¨\n@Datapublic class person &#123;    private String name;    private String sex;    private Integer age;    // èµ°è·¯    public void walking()&#123;&#125;    // åƒä¸œè¥¿    public void eating()&#123;&#125;    // ç¡è§‰    public void sleeping()&#123;&#125;    &#125;\nå……è¡€æ¨¡å‹\næ¨¡å‹åŒ…å«äº†å¯¹è±¡å±æ€§çš„å®šä¹‰å’Œæ“ä½œå¯¹è±¡çš„getter/setteræ–¹æ³•å¹¶ä¸”åŒ…å«äº†å¯¹è±¡çš„è¡Œä¸ºï¼Œå¤§å¤šæ•°ç›¸å…³çš„ä¸šåŠ¡é€»è¾‘å’ŒæŒä¹…å±‚ä¸šåŠ¡é€»è¾‘ä¸šåŠ¡é€»è¾‘å±‚ï¼ˆBusiness Logicï¼‰çš„ä¸šåŠ¡é€»è¾‘å‡å°‘ï¼Œä»…ä»…æ˜¯ç®€å•å°è£…å°‘é‡ä¸šåŠ¡ï¼Œäº‹åŠ¡æ§åˆ¶ï¼Œæƒé™æ§åˆ¶ç­‰ç­‰ï¼Œä¸å’ŒæŒä¹…å±‚æ‰“äº¤é“å……è¡€æ¨¡å‹æ˜¯ä¾èµ–æŒä¹…å±‚çš„\n\nä¼˜ç‚¹ï¼šç¬¦åˆOOï¼ˆé¢å‘å¯¹è±¡ï¼‰åŸåˆ™ï¼Œä¸šåŠ¡é€»è¾‘å±‚å¾ˆè–„ï¼Œç¬¦åˆå•ä¸€èŒè´£ï¼Œä¸åƒè´«è¡€æ¨¡å‹é‚£ä¹ˆä¸šåŠ¡é€»è¾‘æ²‰é‡ç¼ºç‚¹ï¼šä¸šåŠ¡é€»è¾‘ä¸å¥½åˆ’åˆ†ï¼Œå“ªäº›ä¸šåŠ¡è¦æ”¾åœ¨é¢†åŸŸå¯¹è±¡ï¼Œå“ªäº›ä¸šåŠ¡è¦æ”¾åœ¨ä¸šåŠ¡é€»è¾‘å±‚éœ€è¦å¼€å‘è‡ªå·±å»åˆ¤æ–­ï¼Œå…¶æ¬¡æ§åˆ¶äº‹åŠ¡çš„æ—¶å€™è¦é‡æ–°åŒ…è£…ä¸€éï¼Œæœ‰ç‚¹å†—ä½™\n@Datapublic class person &#123;    private String name;    private String sex;    private Integer age;    // èµ°è·¯    public void walking(String address)&#123;&#125;    // åƒä¸œè¥¿    public void eating()&#123;&#125;    // ç¡è§‰    public void sleeping()&#123;&#125;\t// ä¸šåŠ¡é€»è¾‘å±‚    private PersonDao personDao;    // æŸ¥çœ‹åœ°å›¾å†èµ°è·¯(é—®è·¯)    public void askingTheWay()&#123;       MapObject mapObject = personDao.getMap();       walking(mapObject.getAddress());    &#125;&#125;\npublic class PersonDao &#123;\tprivate PersonMapping personMapping;\t    // è·å–åœ°å›¾    public MapObject getMap()&#123;\t\tpersonMapping.getMap();\t&#125;&#125;\nèƒ€è¡€æ¨¡å‹\næ¨¡å‹åŒ…å«äº†å¯¹è±¡å±æ€§çš„å®šä¹‰å’Œæ“ä½œå¯¹è±¡çš„getter/setteræ–¹æ³•å¹¶ä¸”åŒ…å«äº†å¯¹è±¡çš„è¡Œä¸ºï¼Œæ‰€æœ‰çš„ä¸šåŠ¡é€»è¾‘ï¼Œä¹ŸåŒ…å«äº†ä¸ç›¸å¹²çš„å…¶å®ƒæ¨¡å—é€»è¾‘ï¼ˆå¦‚æˆæƒï¼Œäº‹åŠ¡ç­‰ï¼‰ç›¸å½“ä¸ç›´æ¥å»æ‰äº†ä¸šåŠ¡é€»è¾‘å±‚ï¼Œåªæœ‰é¢†åŸŸå¯¹è±¡å’ŒæŒä¹…å±‚ï¼Œæ‰€æœ‰çš„é€»è¾‘åœ¨é¢†åŸŸå¯¹è±¡ä¸Šé¢\n\nä¼˜ç‚¹ï¼šç®€åŒ–ä»£ç åˆ†å±‚ä½“ç³»ï¼Œç¬¦åˆé¢å‘å¯¹è±¡è®¾è®¡ç¼ºç‚¹ï¼šå–æ¶ˆäº†ä¸šåŠ¡é€»è¾‘å±‚ï¼Œä¼šå¯¼è‡´é¢†åŸŸå¯¹è±¡å˜å¾—è‡ƒè‚¿ï¼Œè€Œä¸”å®¹æ˜“é€»è¾‘æ··ä¹±ï¼Œå¯¹äºä»£ç çš„ç†è§£å’Œç»´æŠ¤æ€§å˜å·®\n@Datapublic class person &#123;    private String name;    private String sex;    private Integer age;    // èµ°è·¯    public void walking(String address)&#123;&#125;    // åƒä¸œè¥¿    public void eating()&#123;&#125;    // ç¡è§‰    public void sleeping()&#123;&#125;\t// ä¸šåŠ¡é€»è¾‘å±‚    private PersonMapping personMapping;    // æŸ¥çœ‹åœ°å›¾å†èµ°è·¯(é—®è·¯)    public void askingTheWay()&#123;       MapObject mapObject = personMapping.getMap();       walking(mapObject.getAddress());    &#125;&#125;\nå¼€å‘è§„èŒƒPO(Persistent Object)ç­‰åŒäºDO(Data Object)\næŒä¹…å±‚å¯¹è±¡å®ƒæ˜¯ç”±ä¸€ç»„å±æ€§å’Œå±æ€§çš„getå’Œsetæ–¹æ³•ç»„æˆï¼Œæœ€ç®€å•çš„ PO å°±æ˜¯å¯¹åº”æ•°æ®åº“ä¸­æŸä¸ªè¡¨ä¸­çš„ä¸€æ¡è®°å½•ï¼ˆä¹Ÿå°±æ˜¯è¯´ï¼Œæˆ‘ä»¬å¯ä»¥å°†æ•°æ®åº“è¡¨ä¸­çš„ä¸€æ¡è®°å½•ç†è§£ä¸ºä¸€ä¸ªæŒä¹…å±‚å¯¹è±¡ï¼‰ï¼Œå¤šä¸ªè®°å½•å¯ä»¥ç”¨ PO çš„é›†åˆï¼ŒPO ä¸­åº”è¯¥ä¸åŒ…å«ä»»ä½•å¯¹æ•°æ®åº“çš„æ“ä½œã€‚PO çš„å±æ€§æ˜¯è·Ÿæ•°æ®åº“è¡¨çš„å­—æ®µä¸€ä¸€å¯¹åº”çš„ï¼Œæ­¤å¤– PO å¯¹è±¡éœ€è¦å®ç°åºåˆ—åŒ–æ¥å£ã€‚\n\nssmæ¡†æ¶å¼€å‘ä¸­ä¸€èˆ¬å®šä¹‰ä¸ºentityå±‚\nBO(Business Object)\nä¸šåŠ¡å±‚å¯¹è±¡ï¼Œæ˜¯ç®€å•çš„çœŸå®ä¸–ç•Œçš„è½¯ä»¶æŠ½è±¡ï¼Œé€šå¸¸ä½äºä¸­é—´å±‚ã€‚BO çš„ä¸»è¦ä½œç”¨æ˜¯æŠŠä¸šåŠ¡é€»è¾‘å°è£…ä¸ºä¸€ä¸ªå¯¹è±¡ï¼Œè¿™ä¸ªå¯¹è±¡å¯ä»¥åŒ…æ‹¬ä¸€ä¸ªæˆ–å¤šä¸ªå…¶å®ƒçš„å¯¹è±¡ã€‚ä¸¾ä¸€ä¸ªæ±‚èŒç®€å†çš„ä¾‹å­ï¼Œæ¯ä»½ç®€å†éƒ½åŒ…æ‹¬æ•™è‚²ç»å†ã€é¡¹ç›®ç»å†ç­‰ï¼Œæˆ‘ä»¬å¯ä»¥è®©æ•™è‚²ç»å†å’Œé¡¹ç›®ç»å†åˆ†åˆ«å¯¹åº”ä¸€ä¸ª POï¼Œè¿™æ ·åœ¨æˆ‘ä»¬å»ºç«‹å¯¹åº”æ±‚èŒç®€å†çš„ BO å¯¹è±¡å¤„ç†ç®€å†çš„æ—¶å€™ï¼Œè®©æ¯ä¸ª BO éƒ½åŒ…å«è¿™äº› PO å³å¯\n\nç”¨äºä¸šåŠ¡é€»è¾‘ä¼ è¾“å±‚\nVO(Value Object)\nå€¼å¯¹è±¡ï¼Œé€šå¸¸ç”¨äºä¸šåŠ¡å±‚ä¹‹é—´çš„æ•°æ®ä¼ é€’ï¼Œå’Œ PO ä¸€æ ·ä¹Ÿæ˜¯ä»…ä»…åŒ…å«æ•°æ®è€Œå·²ï¼Œä½† VO åº”è¯¥æ˜¯æŠ½è±¡å‡ºçš„ä¸šåŠ¡å¯¹è±¡ï¼Œå¯ä»¥å’Œè¡¨å¯¹åº”ï¼Œä¹Ÿå¯ä»¥ä¸å¯¹åº”ï¼Œè¿™æ ¹æ®ä¸šåŠ¡çš„éœ€è¦ã€‚ å¦‚æœé”…ç¢—ç“¢ç›†åˆ†åˆ«ä¸ºå¯¹åº”çš„ä¸šåŠ¡å¯¹è±¡çš„è¯ï¼Œé‚£ä¹ˆæ•´ä¸ªç¢—æŸœå°±æ˜¯ä¸€ä¸ªå€¼å¯¹è±¡ã€‚æ­¤å¤–ï¼ŒVO ä¹Ÿå¯ä»¥ç§°ä¸ºé¡µé¢å¯¹è±¡ï¼Œå¦‚æœç§°ä¸ºé¡µé¢å¯¹è±¡çš„è¯ï¼Œé‚£ä¹ˆå®ƒæ‰€ä»£è¡¨çš„å°†æ˜¯æ•´ä¸ªé¡µé¢å±•ç¤ºå±‚çš„å¯¹è±¡ï¼Œä¹Ÿå¯ä»¥ç”±éœ€è¦çš„ä¸šåŠ¡å¯¹è±¡è¿›è¡Œç»„è£…è€Œæ¥ã€‚\n\nç”¨äºè¿”å›ç»™å‰ç«¯\nDTO(Data Transfer Object)\næ•°æ®ä¼ è¾“å¯¹è±¡ï¼Œä¸»è¦ç”¨äºè¿œç¨‹è°ƒç”¨ç­‰éœ€è¦å¤§é‡ä¼ è¾“å¯¹è±¡çš„åœ°æ–¹ï¼Œæ¯”å¦‚æˆ‘ä»¬æœ‰ä¸€ä¸ªäº¤æ˜“è®¢å•è¡¨ï¼Œå«æœ‰ 25 ä¸ªå­—æ®µï¼Œé‚£ä¹ˆå…¶å¯¹åº”çš„ PO å°±æœ‰ 25 ä¸ªå±æ€§ï¼Œä½†æˆ‘ä»¬çš„é¡µé¢ä¸Šåªéœ€è¦æ˜¾ç¤º 5 ä¸ªå­—æ®µï¼Œå› æ­¤æ²¡æœ‰å¿…è¦æŠŠæ•´ä¸ª PO å¯¹è±¡ä¼ é€’ç»™å®¢æˆ·ç«¯ï¼Œè¿™æ—¶æˆ‘ä»¬åªéœ€æŠŠä»…æœ‰ 5 ä¸ªå±æ€§çš„ DTO æŠŠç»“æœä¼ é€’ç»™å®¢æˆ·ç«¯å³å¯ï¼Œè€Œä¸”å¦‚æœç”¨è¿™ä¸ªå¯¹è±¡æ¥å¯¹åº”ç•Œé¢çš„æ˜¾ç¤ºå¯¹è±¡ï¼Œé‚£æ­¤æ—¶å®ƒçš„èº«ä»½å°±è½¬ä¸º VOã€‚ä½¿ç”¨ DTO çš„å¥½å¤„æœ‰ä¸¤ä¸ªä¸€æ˜¯èƒ½é¿å…ä¼ é€’è¿‡å¤šçš„æ— ç”¨æ•°æ®ï¼Œæé«˜æ•°æ®çš„ä¼ è¾“é€Ÿåº¦ï¼›äºŒæ˜¯èƒ½éšè—åç«¯çš„è¡¨ç»“æ„ã€‚å¸¸è§çš„ç”¨æ³•æ˜¯ï¼šå°†è¯·æ±‚çš„æ•°æ®æˆ–å±æ€§ç»„è£…æˆä¸€ä¸ª RequestDTOï¼Œå†å°†å“åº”çš„æ•°æ®æˆ–å±æ€§ç»„è£…æˆä¸€ä¸ª ResponseDTO\n\nç”¨äºæ¥æ”¶æ¥è‡ªå®¢æˆ·ç«¯çš„å‚æ•°ï¼Œç”¨äºå°è£…æ•°æ®åº“æŸ¥è¯¢çš„ç»“æœå¯¹è±¡\nTO(Transfer Object)\nä¸åŒçš„åº”ç”¨ç¨‹åºä¹‹é—´ä¼ è¾“çš„å¯¹è±¡\n\n\nå®ä½“ç±»ä¹‹é—´äº’ç›¸è½¬æ¢@Data@Builderpublic class Person &#123;    private String name;    private String sex;    private Integer age;&#125;\n@Data@Builderpublic class Teacher &#123;    private String name;    private String sex;    private Integer ages;    private String classes;    private String course;&#125;\nå°†personè½¬æ¢ä¸ºteacher\næ–¹æ³•1ï¼šå†™ä¸€ä¸ªè½¬æ¢å·¥å…·ç±»ï¼Œä¸åŒå¯¹è±¡ä¹‹é—´è¿›è¡Œèµ‹å€¼\npublic class PersonUtils &#123;    public static Teacher convert(Person person)&#123;        return Teacher.builder()                .name(person.getName())                .ages(person.getAge())                .sex(person.getSex())                .build();    &#125;&#125;\nè°ƒç”¨\n@Slf4jpublic class PersonTest &#123;    @Test    public void convert()&#123;        Person person = Person.builder().name(&quot;å¼ ä¸‰&quot;).sex(&quot;ç”·&quot;).age(30).build();        Teacher teacher2 = PersonUtils.convert(person);        log.info(teacher2.toString());\t\t// 18:05:00.431 [main] INFO com.tiantai.policys.PersonTest - Teacher(name=å¼ ä¸‰, sex=ç”·, ages=30, classes=null, course=null)    &#125;&#125;\næ–¹æ³•2ï¼šä½¿ç”¨mapstruct\n@Mapper(builder = @Builder(disableBuilder = true))public interface PersonToTeacher &#123;    PersonToTeacher INSTANCE = Mappers.getMapper(PersonToTeacher.class);    @Mapping(source = &quot;age&quot;,target = &quot;ages&quot;)    Teacher convert(Person person);&#125;\nè°ƒç”¨\n@Slf4jpublic class PersonTest &#123;    @Test    public void convert()&#123;        Person person = Person.builder().name(&quot;å¼ ä¸‰&quot;).sex(&quot;ç”·&quot;).age(30).build();        Teacher teacher2 = PersonUtils.convert(person);        log.info(teacher2.toString());\t\t// 18:05:00.431 [main] INFO com.tiantai.policys.PersonTest - Teacher(name=å¼ ä¸‰, sex=ç”·, ages=30, classes=null, course=null)    &#125;&#125;\næ¨èä½¿ç”¨mapstructï¼Œåœ¨ä¸åŒçš„PO,BO,DTOç­‰ç­‰ä¹‹é—´è¿›è¡Œè½¬æ¢ï¼Œå¦‚æœå±æ€§åç§°ç›¸è¿‘çš„è¯ï¼Œè½¬æ¢é€Ÿåº¦æ¯”è¾ƒå¿«ï¼Œæ›´é€‚åˆä½¿ç”¨\n\n\n","tags":["å®ä½“ç±»"]},{"title":"Vector","url":"/2023/02/06/0.3.8-Vector/","content":"ä»€ä¹ˆæ˜¯Vectorç±»ä¼¼äºArrayListï¼ŒVectorä¹Ÿæ˜¯ç”±æ•°ç»„ç»„æˆï¼Œé»˜è®¤çš„åˆå§‹åŒ–å¤§å°æ˜¯ã€10ã€‘ä½†æ˜¯Vectoræ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œåœ¨å¤§å¤šæ•°çš„æ–¹æ³•ä¸Šé¢éƒ½å­˜åœ¨synchronizedå…³é”®å­—å¦‚æœéœ€è¦è¿›è¡Œæ‰©å®¹ï¼Œæ¯æ¬¡æ‰©å®¹å¤§å°é»˜è®¤ä¸ºã€2ã€‘ï¼Œæ³¨æ„(capacityIncrement &gt; 0)æ˜¯åŒæ‹¬å·æ¡ä»¶\nVectorå’ŒArrayListçš„åŒºåˆ«1.vectoré»˜è®¤æ„é€ è¿˜æ˜¯é¥¿æ±‰å¼ï¼Œè€ŒarrayListåœ¨1.8åæ”¹ä¸ºäº†æ‡’æ±‰å¼2.Vector æ˜¯å¤šçº¿ç¨‹å®‰å…¨çš„ï¼Œçº¿ç¨‹å®‰å…¨å°±æ˜¯è¯´å¤šçº¿ç¨‹è®¿é—®åŒä¸€ä»£ç ï¼Œä¸ä¼šäº§ç”Ÿä¸ç¡®å®šçš„ç»“æœï¼Œè€Œ ArrayList ä¸æ˜¯ï¼Œè¿™ä¸ªå¯ä»¥ä»æºç ä¸­çœ‹å‡ºï¼ŒVector ç±»ä¸­çš„æ–¹æ³•å¾ˆå¤šæœ‰ synchronized è¿›è¡Œä¿®é¥°ï¼Œè¿™æ ·å°±å¯¼è‡´äº† Vector åœ¨æ•ˆç‡ä¸Šæ— æ³•ä¸ ArrayList ç›¸æ¯”ã€ç¬¬äºŒå¼ å›¾èƒ½ä½“ç°ã€‘3.vectorå¯ä»¥è®¾ç½®å¢é•¿å› å­ã€é»˜è®¤0ã€‘\nä»¥2å€çš„æ–¹å¼æ‰©å®¹ï¼Œå¯¼è‡´ä¸‹ä¸€æ¬¡ç”³è¯·çš„å†…å­˜å¿…ç„¶å¤§äºä¹‹å‰åˆ†é…å†…å­˜çš„æ€»å’Œï¼Œå¯¼è‡´ä¹‹å‰åˆ†é…çš„å†…å­˜ä¸èƒ½å†è¢«ä½¿ç”¨ï¼Œæ‰€ä»¥æœ€å¥½å€å¢é•¿å› å­è®¾ç½®ä¸º(1,2)ä¹‹é—´\n\n\n4.å› ä¸ºè€ƒè™‘åˆ°çº¿ç¨‹å®‰å…¨çš„é—®é¢˜ï¼Œæ•ˆç‡æ¯”è¾ƒä½å¯ä»¥ç”¨ä»€ä¹ˆä»£æ›¿VectorCopyOnWriteArrayList ç›¸å½“äºçº¿ç¨‹å®‰å…¨çš„ArrayListï¼Œå®ƒæ˜¯ä¸ªå¯å˜æ•°ç»„\n\nå®ƒæ˜¯çº¿ç¨‹å®‰å…¨çš„\næ˜¯é€šè¿‡volatileå’Œç›‘è§†å™¨é”Synchrnoizedæ¥å®ç°çš„\n\n\n\n\n\nå®ƒçš„Listé€šå¸¸ä¿æŒå¾ˆå°ï¼Œåªè¯»æ“ä½œå¤§äºå¯å˜æ“ä½œï¼Œéœ€è¦åœ¨éå†çš„æ—¶å€™é˜²æ­¢çº¿ç¨‹é—´å†²çª\nå› ä¸ºéœ€è¦å¤åˆ¶æ•´ä¸ªåŸºç¡€æ•°ç»„ï¼Œæ‰€ä»¥add,set,removeç­‰å¯å˜æ“ä½œå¼€é”€å¤§\nåœ¨â€œæ·»åŠ /ä¿®æ”¹/åˆ é™¤â€æ•°æ®æ—¶ï¼Œéƒ½ä¼šæ–°å»ºä¸€ä¸ªæ•°ç»„ï¼Œå¹¶å°†æ›´æ–°åçš„æ•°æ®æ‹·è´åˆ°æ–°å»ºçš„æ•°ç»„ä¸­ï¼Œæœ€åå†å°†è¯¥æ•°ç»„èµ‹å€¼ç»™â€œvolatileæ•°ç»„â€ã€‚è¿™å°±æ˜¯å®ƒå«åšCopyOnWriteArrayListçš„åŸå› ï¼\n\n\næ”¯æŒhasNextå’Œnext,ä½†æ˜¯ä¸æ”¯æŒå¯å˜removeæ“ä½œ\n\n\n\nä½¿ç”¨è¿­ä»£å™¨è¿›è¡Œéå†çš„é€Ÿåº¦å¾ˆå¿«ï¼Œå¹¶ä¸”ä¸ä¼šä¸å…¶å®ƒçº¿ç¨‹å‘ç”Ÿå†²çªï¼Œä½†æ˜¯åœ¨æ„é€ è¿­ä»£å™¨çš„æ—¶å€™ï¼Œè¿­ä»£å™¨ä¾èµ–äºä¸å˜çš„æ•°ç»„å¿«ç…§\nCOWIteratorä¸æ”¯æŒä¿®æ”¹å…ƒç´ çš„æ“ä½œã€‚ä¾‹å¦‚ï¼Œå¯¹äºremove(),set(),add()ç­‰æ“ä½œï¼ŒCOWIteratoréƒ½ä¼šæŠ›å‡ºå¼‚å¸¸ï¼\n\n\n\n\n","tags":["åŸºç¡€"]},{"title":"æ§åˆ¶xxl-jobä¸‹æ¬¡æ‰§è¡Œæ—¶é—´","url":"/2023/06/06/0.4.1-%E6%8E%A7%E5%88%B6xxl-job%E4%B8%8B%E6%AC%A1%E6%89%A7%E8%A1%8C%E6%97%B6%E9%97%B4/","content":"â€‹\né¡¹ç›®åœºæ™¯ï¼š\nç›®å‰é¡¹ç›®å¼•å…¥äº† xxl-job æ¥è·‘å®šæ—¶ä»»åŠ¡ï¼Œä½†æ˜¯å­˜åœ¨ä¸€ä¸ªé—®é¢˜ï¼Œé¡¹ç›®æ‰§è¡Œç»“æŸçš„æ—¶é—´ä¸å›ºå®šï¼Œæœ‰å³°å€¼ï¼Œåœ¨é«˜å³°æœŸçš„æ—¶å€™ä¼šå‡ºç°é•¿é˜»å¡ä¸€ç›´æ’é˜Ÿç­‰å¾…ï¼Œå¦‚å›¾ï¼š\n\nâ€‹\né—®é¢˜æè¿°éœ€è¦åšä¸€ç§ç­–ç•¥æ¥è§£å†³é•¿é˜»å¡é—®é¢˜ï¼Œç²¾å‡†æ§åˆ¶ä¸‹ä¸€æ¬¡æ‰§è¡Œæ—¶é—´ï¼Œå°½é‡ä¿è¯ä¸ç©ºæ¡£\nåŸå› åˆ†æï¼š1.ä¸Šæ¸¸æ¥å£çš„æ¥å£é™æµæˆ–è€…å³°å€¼å‹åŠ›å¯¼è‡´è¿”å›è¶…æ—¶2.é«˜å³°æœŸæ•°æ®é‡è¾¾åˆ°å³°å€¼å¤„ç†ä¸è¿‡æ¥3.è®¾ç½®çš„æ‰§è¡Œé—´éš”å¤ªçŸ­ï¼Œæ‰§è¡Œä¸è¿‡æ¥\nè§£å†³æ–¹æ¡ˆï¼šæ€è·¯Â  ç¼–å†™ä¸€ä¸ªcronè¡¨è¾¾å¼ï¼Œæ—¶é—´ä¸€åˆ†é’Ÿä¸€æ¬¡ï¼Œç›´æ¥è·å–å½“å‰æ—¶é—´çš„ä¸‹ä¸€æ¬¡æ‰§è¡Œæ—¶é—´ï¼Œå¹¶ä¸”æ›´æ–°åˆ°xxl-jobçš„æ‰§è¡Œæ—¥å¿—é‡Œé¢\næ³¨æ„Â  1.å› ä¸ºè®¾ç½®çš„1åˆ†é’Ÿ59ç§’ï¼Œæ‰€ä»¥åœ¨ç§’çš„ä½ç½®è®¾ç½®äº†59ï¼Œé˜²æ­¢åœ¨59ç§’æ‰§è¡Œå®Œæ›´æ–°è¶…æ—¶ï¼Œå¯¼è‡´å®šæ—¶ä»»åŠ¡æ‰§è¡Œè¿‡æ—¶é—´\nÂ  2.xxlJobInfo.setTriggerStatus(1); è®¾ç½®è¿™ä¸ªï¼Œåªéœ€è¦ç‚¹å‡»ç«‹å³æ‰§è¡Œå°±å¯ä»¥è®©å®ƒè¿è¡Œï¼Œä½†æ˜¯åç»­å¯èƒ½éœ€è¦åŠ ä¸€ä¸ªå¼€å…³æ¥æ§åˆ¶éœ€è¦æ‰§è¡Œçš„ç­–ç•¥æ˜¯ä¸€æ¬¡æˆ–è€…å¤šæ¬¡\nÂ  3.åœ¨xxl_job_infoä¸­schedule_confæ˜¯ç¼–å†™cronè¡¨è¾¾å¼ï¼Œä½†æ˜¯trigger_next_timeæ‰æ˜¯ä¸‹æ¬¡æ‰§è¡Œæ—¶é—´ï¼Œéœ€è¦è½¬ä¸ºæ—¶é—´æˆ³æ›´æ–°\nå®ç°æ–¹æ³•package com.tthk.inland.ticket.core.service.xxlJobInfo.impl; import com.tthk.inland.ticket.core.configurations.druidconfig.DataSource;import com.tthk.inland.ticket.core.entity.xxlJobInfo.XxlJobInfo;import com.tthk.inland.ticket.core.mapper.xxlJobInfo.XxlJobInfoMapper;import com.tthk.inland.ticket.core.service.xxlJobInfo.IXxlJobInfoService;import com.baomidou.mybatisplus.extension.service.impl.ServiceImpl;import com.tthk.inland.ticket.core.utils.cron.CronUtils;import com.xxl.job.core.context.XxlJobHelper;import lombok.extern.slf4j.Slf4j;import org.springframework.stereotype.Service; import java.text.SimpleDateFormat;import java.util.Date; /** * &lt;p&gt; *  æœåŠ¡å®ç°ç±» * &lt;/p&gt; * * @author Foam * @since 2023-05-31 */@Slf4j@Servicepublic class XxlJobInfoServiceImpl extends ServiceImpl&lt;XxlJobInfoMapper, XxlJobInfo&gt; implements IXxlJobInfoService &#123;     @DataSource(&quot;xxlJobs&quot;)    public void updateCronTime()&#123;        try&#123;            // æ›´æ–°ä¸‹ä¸€æ¬¡cronæ—¶é—´            final var nextTime = CronUtils.getExecutionTimeByNum(&quot;59 0/1 * * * ?&quot;, 1).get(0);            final var nextCron = CronUtils.getCronByTimeString(nextTime);            final var xxlJobInfo = new XxlJobInfo();            xxlJobInfo.setId(74);            xxlJobInfo.setScheduleConf(nextCron);            final var simpleDateFormat = new SimpleDateFormat(&quot;yyyy-MM-dd HH:mm:ss&quot;);            final var nextTimestamp = simpleDateFormat.parse(nextTime);            xxlJobInfo.setTriggerNextTime(nextTimestamp.getTime());            xxlJobInfo.setTriggerStatus(1);            this.updateById(xxlJobInfo);            XxlJobHelper.log(&quot;æ›´æ–°ä¸‹ä¸€æ¬¡cronæ—¶é—´&quot;+nextCron);        &#125;catch (Exception e)&#123;            log.error(&quot;cronè§£æå¼‚å¸¸&quot;,e);        &#125;    &#125;&#125;\n\nå·¥å…·ç±»package com.tthk.inland.ticket.core.utils.cron; import org.springframework.scheduling.support.CronSequenceGenerator; import java.text.SimpleDateFormat;import java.time.DateTimeException;import java.time.LocalDateTime;import java.time.format.DateTimeFormatter;import java.util.*; /** * @Description:cronè¡¨è¾¾å¼å·¥å…·ç±» * @date:2022/10/8_15:09 * @author:Foam */public class CronUtils &#123;    /**     * è§£æcronå¯¹åº”æ¬¡æ•°     * @Author Foam     * @Date 2023/1/6     * @param cronStr cron è¡¨è¾¾å¼     * @param num è§£ææœ€è¿‘å‡ æ¬¡æ‰§è¡Œæ—¶é—´     * @return List&lt;String&gt; è¿”å›æ‰§è¡Œæ—¶é—´åˆ—è¡¨     **/    public static List&lt;String&gt; getExecutionTimeByNum(String cronStr, Integer num) &#123;        CronSequenceGenerator cronSequenceGenerator = new CronSequenceGenerator(cronStr, TimeZone.getTimeZone(&quot;Asia/Shanghai&quot;));        List&lt;String&gt; result = new ArrayList&lt;&gt;(num);        Date date = new Date();        for (Integer integer = 0; integer &lt; num; integer++) &#123;            date = cronSequenceGenerator.next(date);            SimpleDateFormat format = new SimpleDateFormat(&quot;yyyy-MM-dd HH:mm:ss&quot;);            String format1 = format.format(date);            result.add(format1);        &#125;        return result;    &#125;     /**     * @Description CN: å­—ç¬¦ä¸²è§£æcronè¡¨è¾¾å¼     * @Description EN:     * @Description KR:     * @Author Foam     * @Date 2023/5/29     **/    public static String getCronByTimeString(String times)&#123;        DateTimeFormatter dateTimeFormatter1 = DateTimeFormatter.ofPattern(&quot;yyyy-MM-dd HH:mm:ss&quot;);        // å®šä¹‰æ—¶é—´        LocalDateTime dateTime = LocalDateTime.parse(times,dateTimeFormatter1);        // ä½¿ç”¨DateTimeFormatteræ ¼å¼åŒ–æ—¶é—´        DateTimeFormatter dateTimeFormatter = DateTimeFormatter.ofPattern(&quot;yyyy MM dd HH mm ss&quot;);        String format = dateTime.format(dateTimeFormatter);         // æ‹†åˆ†å­—ç¬¦ä¸²        String[] dateTimeParts = format.split(&quot; &quot;);         // æ„å»ºcronè¡¨è¾¾å¼        return String.format(&quot;%s %s %s %s %s ? *&quot;,dateTimeParts[5],dateTimeParts[4],dateTimeParts[3],dateTimeParts[2],dateTimeParts[1],dateTimeParts[0]);    &#125;&#125; \n\næ•ˆæœ\nç¼ºç‚¹Â  1.éœ€è¦æŒ‡å®šæ‰§è¡Œå™¨idï¼Œéœ€è¦åŠ å‚æ•°é…ç½®ï¼Œæ¯”è¾ƒéº»çƒ¦[è¯¥é…ç½®æœ€å¥½æ˜¯mysqlæˆ–è€…redisï¼Œä¸è¦é…ç½®åœ¨paramå‚æ•°ä¸­ï¼Œå› ä¸ºåœæ­¢ä¼šå¤šæ‰§è¡Œä¸€æ¬¡]\nÂ  2.ä¸é€‚ç”¨é›†ç¾¤æ¨¡å¼ä¸‹çš„ä»»åŠ¡\nÂ  3.å¼€å¯å’Œå…³é—­éœ€è¦ç”¨æˆ·ç†è§£\nâ€‹\n","tags":["åœºæ™¯"]},{"title":"ç§’æ€æ¶æ„","url":"/2023/02/26/0.4.0-%E7%A7%92%E6%9D%80%E6%9E%B6%E6%9E%84/","content":"ä»€ä¹ˆæ˜¯ç§’æ€ï¼ˆseckillï¼‰seckillæ˜¯ä¸€ä¸ªè€ç”Ÿå¸¸è°ˆçš„åœºæ™¯å®ƒä¸€èˆ¬å‡ºç°åœ¨ç”µå•†ç³»ç»Ÿä¸­ï¼Œåœ¨æŸäº›ç‰¹å®šçš„èŠ‚æ—¥ï¼Œé™å®šç‰¹å®šå•†å“æ•°é‡ä»¥è¶…ä½æŠ˜æ‰£è¿›è¡Œä¿ƒé”€å¼•æµæŒ‰ç…§ç§’æ€çš„ç‰¹æ€§ï¼Œç‰¹ä»·å•†å“ä¸€èˆ¬åœ¨ä¸€ä¸¤ç§’å†…è¢«æŠ¢å…‰ï¼Œå‰©ä¸‹çš„äººåªä¼šå‡ºç°å”®ç½„é¡µé¢è¿™ä¸€ä¸¤ç§’ä¼šå‡ºç°ä¸€ä¸ªç¬é—´å³°å€¼ï¼Œå› ä¸ºæ˜¯çŸ­æš‚çš„æ´»åŠ¨ï¼Œä¸èƒ½æ¶ˆè€—å¤ªå¤šæœåŠ¡å™¨èµ„æºï¼Œæ‰€ä»¥éœ€è¦è¾¾åˆ°æœ€å°ä»£ä»·åšåˆ°æœ€å¤§çš„æŠ—å‹ï¼Œä¸ç›´æ¥å†²å®æœåŠ¡å™¨ï¼Œè¿˜å¾—ä¿è¯ä¸è¶…å–ï¼Œä¸ä¸¢å•ï¼Œä¸å®•æœºç­‰é—®é¢˜\nseckilléœ€è¦æ³¨æ„å“ªäº›é—®é¢˜å¹‚ç­‰\nå¤šæ¬¡è°ƒç”¨æ–¹æ³•æˆ–è€…æ¥å£ä¸ä¼šæ”¹å˜ä¸šåŠ¡çŠ¶æ€ï¼Œå¯ä»¥ä¿è¯é‡å¤è°ƒç”¨çš„ç»“æœå’Œå•æ¬¡è°ƒç”¨çš„ç»“æœä¸€è‡´\n\næè¿°\nå‰ç«¯é‡å¤æäº¤ï¼šå‰ç«¯ç¬é—´ç‚¹å‡»å¤šæ¬¡é€ æˆè¡¨å•é‡å¤æäº¤\næ¥å£è¶…æ—¶é‡è¯•ï¼šæ¥å£å¯èƒ½ä¼šå› ä¸ºæŸäº›åŸå› è€Œè°ƒç”¨å¤±è´¥ï¼Œå¤„äºå®¹é”™æ€§è€ƒè™‘ä¼šåŠ ä¸Šå¤±è´¥é‡è¯•çš„æœºåˆ¶ã€‚å¦‚æœæ¥å£è°ƒç”¨ä¸€åŠï¼Œå†æ¬¡è°ƒç”¨å°±ä¼šå› ä¸ºè„æ•°æ®çš„å­˜åœ¨è€Œäº§ç”Ÿå¼‚å¸¸\næ¶ˆæ¯é‡å¤æ¶ˆè´¹ï¼šåœ¨ä½¿ç”¨æ¶ˆæ¯ä¸­é—´ä»¶æ¥å¤„ç†æ¶ˆæ¯é˜Ÿåˆ—ï¼Œä¸”æ‰‹åŠ¨ackç¡®è®¤æ¶ˆæ¯è¢«æ­£å¸¸æ¶ˆè´¹æ—¶ã€‚å¦‚æœæ¶ˆè´¹è€…çªç„¶æ–­å¼€é“¾æ¥ï¼Œé‚£ä¹ˆå·²ç»æ‰§è¡Œäº†ä¸€åŠçš„æ¶ˆæ¯ä¼šé‡æ–°æ”¾å›é˜Ÿåˆ—ã€‚è¢«å…¶ä»–æ¶ˆè´¹è€…é‡æ–°æ¶ˆè´¹æ—¶å°±ä¼šå¯¼è‡´ç»“æœå¼‚å¸¸ï¼Œå¦‚æ•°æ®åº“é‡å¤æ•°æ®ï¼Œ æ•°æ®åº“æ•°æ®å†²çªï¼Œèµ„æºé‡å¤ç­‰\nè¯·æ±‚é‡å‘ï¼šç½‘ç»œæŠ–åŠ¨å¼•å‘çš„nginxé‡å‘è¯·æ±‚ï¼Œé€ æˆé‡å¤è°ƒç”¨è§£å†³æ–¹æ¡ˆ\n\n\nç»™å‰ç«¯ç‚¹å‡»æŒ‰é’®è®¾ç½®ç‚¹å‡»ç½®ç°ï¼Œç­‰è·å–åˆ°æ­£ç¡®ç»“æœå†è¿›è¡Œå¯¹åº”çš„å¤„ç†ã€æ²»æ ‡ä¸æ²»æœ¬ï¼Œå®¹æ˜“è¢«ç»•è¿‡ã€‘\nä½¿ç”¨Tokenæœºåˆ¶\né€šè¿‡Tokenæœºåˆ¶å®ç°æ¥å£çš„å¹‚ç­‰æ€§ï¼Œè¿™æ˜¯ä¸€ç§æ¯”è¾ƒé€šç”¨æ€§çš„å®ç°æ–¹æ³•\n\nå®¢æˆ·ç«¯ä¼šå…ˆå‘é€ä¸€ä¸ªè¯·æ±‚å»è·å–Tokenï¼ŒæœåŠ¡ç«¯ä¼šç”Ÿæˆä¸€ä¸ªå…¨å±€å”¯ä¸€çš„UUIDä½œä¸ºTokenä¿å­˜åœ¨Redisä¸­ï¼ŒåŒæ—¶æŠŠè¿™ä¸ªUUIDè¿”å›ç»™å®¢æˆ·ç«¯,å¹¶ç¼“å­˜åˆ°session\nå®¢æˆ·ç«¯ç¬¬äºŒæ¬¡è°ƒç”¨ä¸šåŠ¡è¯·æ±‚çš„æ—¶å€™å¿…é¡»æºå¸¦è¿™ä¸ªToken\næœåŠ¡ç«¯ä¼šæ ¡éªŒè¿™ä¸ªTokenï¼Œå¦‚æœæ ¡éªŒæˆåŠŸï¼Œåˆ™æ‰§è¡Œä¸šåŠ¡ï¼Œå¹¶åˆ é™¤Redisä¸­çš„Token\nå¦‚æœæ ¡éªŒå¤±è´¥ï¼Œè¯´æ˜Redisä¸­å·²ç»æ²¡æœ‰å¯¹åº”çš„Tokenï¼Œåˆ™è¡¨ç¤ºé‡å¤æ“ä½œï¼Œç›´æ¥è¿”å›æŒ‡å®šçš„ç»“æœç»™å®¢æˆ·ç«¯\n\n\n\n\næ³¨æ„ï¼š\n\nå¯¹ redis ä¸­æ˜¯å¦å­˜åœ¨ token ä»¥åŠåˆ é™¤çš„ä»£ç é€»è¾‘å»ºè®®ç”¨ Lua è„šæœ¬æˆ–è€…setNXæ“ä½œå®ç°ï¼Œä¿è¯åŸå­æ€§\nå…¨å±€å”¯ä¸€ ID å¯ä»¥ç”¨ç™¾åº¦çš„ uid-generatorã€ç¾å›¢çš„ Leaf å»ç”Ÿæˆ,ä¹Ÿå¯ä»¥ç”¨é›ªèŠ±ç®—æ³•å®ç°\n\n\nå‰Šå³°ï¼ˆé«˜å¹¶å‘ï¼‰\nå¯¹äºç§’æ€ç³»ç»Ÿç¬æ—¶ä¼šæœ‰å¤§é‡ç”¨æˆ·æ¶Œå…¥ï¼Œæ‰€ä»¥åœ¨æŠ¢è´­ä¸€å¼€å§‹ä¼šæœ‰å¾ˆé«˜çš„ç¬é—´å³°å€¼é«˜å³°å€¼æµé‡æ˜¯å‹å®ç³»ç»Ÿå¾ˆé‡è¦çš„åŸå› ã€ä¼šé€ æˆé›ªå´©æ•ˆåº”ã€‘ï¼Œæ‰€ä»¥å¦‚ä½•æŠŠç¬é—´çš„é«˜æµé‡å˜æˆä¸€æ®µæ—¶é—´å¹³ç¨³çš„æµé‡ä¹Ÿæ˜¯è®¾è®¡ç§’æ€ç³»ç»Ÿå¾ˆé‡è¦çš„æ€è·¯\n\nå¸¸è§å‰Šå³°æ–¹æ¡ˆé¢„çº¦åˆ¶ï¼šç”¨æˆ·åœ¨æå‰å›ºå®šæ—¶é—´å†…é¢„çº¦ä½¿ç”¨æœåŠ¡ï¼Œåœ¨é¢„çº¦æ—¶é—´å†…æœåŠ¡ç¹å¿™æ—¶ä¸å†æ¥å—æ–°çš„è¯·æ±‚ï¼Œä»¥æ­¤æ¥å‰Šå³°ã€‚é—®ç­”å¼éªŒè¯ï¼šåœ¨è¯·æ±‚è®¿é—®æœåŠ¡æ—¶è¦æ±‚ç”¨æˆ·å›ç­”ä¸€äº›ç®€å•çš„é—®é¢˜ï¼Œä»¥æ­¤æ¥å‡å°‘æ¶æ„è¯·æ±‚ï¼Œå¹¶é™ä½ç³»ç»Ÿçš„å³°å€¼å‹åŠ›ã€‚åŠ¨æ€é™æµï¼šæ ¹æ®å®æ—¶çš„ç³»ç»Ÿè´Ÿè½½æƒ…å†µåŠ¨æ€è°ƒæ•´è¯·æ±‚çš„é™æµç­–ç•¥ï¼Œä»¥æ­¤æ¥å‡å°‘ç³»ç»Ÿçš„å³°å€¼å‹åŠ›ã€‚åŠ¨æ€åˆ†é…èµ„æºï¼šæ ¹æ®å®æ—¶çš„ç³»ç»Ÿè´Ÿè½½æƒ…å†µåŠ¨æ€åˆ†é…èµ„æºï¼Œä»¥æ­¤æ¥å‡å°‘ç³»ç»Ÿçš„å³°å€¼å‹åŠ›ã€‚åˆ†æ®µé™æµï¼šå°†è¯·æ±‚åˆ†ä¸ºå‡ ä¸ªæ®µï¼Œåˆ†åˆ«å¯¹æ¯ä¸ªæ®µè®¾ç½®ä¸åŒçš„é™æµç­–ç•¥ï¼Œä»¥æ­¤æ¥å‡å°‘ç³»ç»Ÿçš„å³°å€¼å‹åŠ›ã€‚\næè¿°\næœåŠ¡é›ªå´©ï¼šæœåŠ¡æä¾›è€…ä¸å¯ç”¨å¯¼è‡´æœåŠ¡è°ƒç”¨è€…ä¹Ÿè·Ÿç€ä¸å¯ç”¨ï¼Œä»¥æ­¤ç±»æ¨å¼•èµ·æ•´ä¸ªé“¾è·¯ä¸­çš„æ‰€æœ‰å¾®æœåŠ¡éƒ½ä¸å¯ç”¨\næœåŠ¡å¼‚æ­¥ï¼šå¼‚æ­¥å¤„ç†ä¸ç”¨é˜»å¡å½“å‰çº¿ç¨‹æ¥ç­‰å¾…å¤„ç†å®Œæˆï¼Œè€Œæ˜¯å…è®¸åç»­æ“ä½œï¼Œç›´è‡³å…¶å®ƒçº¿ç¨‹å°†å¤„ç†å®Œæˆï¼Œå¹¶å›è°ƒé€šçŸ¥æ­¤çº¿ç¨‹\nèµ„æºæ§åˆ¶ï¼šå°†æ•´ä½“æµç¨‹ä¸­çš„èµ„æºè°ƒåº¦è¿›è¡Œæ§åˆ¶ï¼Œæ‰¬é•¿é¿çŸ­ï¼Œé˜²æ­¢åŠ è½½å›¾ç‰‡ï¼Œjsç­‰é™æ€èµ„æºå¢åŠ æœåŠ¡å™¨å‹åŠ›è§£å†³æ–¹æ¡ˆé¦–å…ˆäº†è§£ä¸€ä¸‹ä»€ä¹ˆæ˜¯CDNå¹³æ—¶ç”¨æˆ·è®¿é—®çš„åœ°å€æ˜¯ç›´æ¥æŒ‡å‘æˆ‘ä»¬çš„æœåŠ¡å™¨ï¼Œä¸­é—´ä¼šç»è¿‡å¤šå±‚è½¬å‘ï¼Œè€Œè·ç¦»æ¯”è¾ƒè¿œçš„ç”¨æˆ·è®¿é—®æˆ‘ä»¬çš„æœåŠ¡å™¨å¯èƒ½ä¼šæœ‰ç½‘ç»œæ‹¥å µCDNçš„æœåŠ¡å•†åœ¨å„åœ°éƒ½æœ‰æœåŠ¡å™¨ç¾¤ï¼Œå¯ä»¥è§£æDNSè®¡ç®—è·ç¦»ç”¨æˆ·æœ€è¿‘çš„æœåŠ¡å™¨æ¥è·å–ç¼“å­˜èµ„æºï¼Œä»¥é¿å…ç½‘ç»œæ‹¥å µæˆ‘ä»¬å¯ä»¥æŠŠé™æ€èµ„æºï¼ˆå›¾ç‰‡ï¼Œjsï¼Œcssç­‰ï¼‰ä¸¢åˆ°CDNæœåŠ¡å•†ä¸Šé¢ï¼Œä»¥å‡å°‘æˆ‘ä»¬çš„æœåŠ¡å™¨å‹åŠ›ã€è§£è€¦ã€‘ä½¿ç”¨CDNçš„å¥½å¤„å°±æ˜¯ä¸æµªè´¹è‡ªå·±æœåŠ¡å™¨èµ„æºå’Œå¸¦å®½ï¼Œå¹¶ä¸”å“åº”é€Ÿåº¦å¿«ï¼Œç›´æ¥å®ç°äº†åŠ¨é™åˆ†ç¦»ç°åœ¨ç”±äºå¸‚åœºéœ€æ±‚é‡å¤§æŠ€æœ¯æ—¥æ¸æˆç†Ÿï¼ŒCDNçš„æ”¶è´¹ä¹Ÿè¶Šæ¥è¶Šä¾¿å®œä¼ ç»ŸåŠ¨é™åˆ†ç¦»ä¸€èˆ¬åšåŠ¨é™åˆ†ç¦»ä¸»è¦æ˜¯ä¸ºäº†æé«˜ç”¨æˆ·è®¿é—®é™æ€èµ„æºçš„é€Ÿåº¦ï¼Œé™ä½ç›´æ¥å¯¹åå°åº”ç”¨çš„è®¿é—®æœ€åŸºæœ¬çš„åšæ³•å°±æ˜¯ç”¨nginxæ¥æŒ‡å‘é™æ€èµ„æºï¼Œå› ä¸ºnginxçš„ååé‡æ¯”tomcaté«˜ï¼Œå“åº”æ›´å¿«å…·ä½“å¯ä»¥å‚è€ƒï¼šhttps://blog.csdn.net/qq_60387497/article/details/121512895è´Ÿè½½å‡è¡¡\nè´Ÿè½½å‡è¡¡çš„ç›®çš„æ˜¯å°†è¯·æ±‚åˆ†æ‘Šåˆ°å¤šå°æœåŠ¡å™¨ä¸Šï¼Œä»è€Œé™ä½å•å°æœåŠ¡å™¨çš„è´Ÿè½½ï¼Œæé«˜ç³»ç»Ÿçš„ååé‡å’Œå“åº”é€Ÿåº¦ã€‚é€šå¸¸åœ¨ Web åº”ç”¨ã€æ•°æ®åº“åº”ç”¨ã€é‚®ä»¶æœåŠ¡å™¨ã€æ–‡ä»¶æœåŠ¡å™¨ç­‰é«˜å¹¶å‘ç¯å¢ƒä¸­ä½¿ç”¨è´Ÿè½½å‡è¡¡æŠ€æœ¯\n\n\n\nå¸¸ç”¨çš„è´Ÿè½½ä¸€èˆ¬æ˜¯Nginxï¼ŒNetflix Ribbon,Netflix Eureka,Apache Zookeeperå¦‚æœæœ‰é’±ä¹Ÿå¯ä»¥ä¹°äº‘æœåŠ¡å•†çš„ï¼Œæ¯”å¦‚äºšé©¬é€Šï¼Œå¾®è½¯ï¼Œè°·æ­Œï¼Œé˜¿é‡Œå·´å·´ï¼Œè…¾è®¯äº‘ç­‰https://juejin.cn/post/7144621706312613896\né™æµç½‘å…³è¿‡æ»¤æ–¹æ¡ˆå¯¹ç³»ç»Ÿè€Œè¨€ï¼Œå¦‚æœæˆ‘ä»¬å¯ä»¥åœ¨ç½‘å…³å±‚é¢æ‹¦æˆªæ‰ç”¨æˆ·è¯·æ±‚ï¼Œå¯ä»¥è¯´è¿™ä¸ªæ–¹æ¡ˆçš„æ€§ä»·æ¯”å¾ˆé«˜ã€‚è¦æ˜¯èƒ½åœ¨è¿™å±‚è¿‡æ»¤ 95% ä»¥ä¸Šçš„è¯·æ±‚ï¼Œæ•´ä¸ªç³»ç»Ÿä¹Ÿå°±å¾ˆç¨³å®š\n\né™å®šæ¯ä¸ªç”¨æˆ·çš„è®¿é—®é¢‘ç‡ï¼šæ¯”å¦‚å‡ ç§’é’Ÿå¯ä»¥ä¸‹å•ä¸€æ¬¡\né™å®šæ¯ä¸ªipçš„è®¿é—®é¢‘ç‡ï¼šè¿™ç§æ–¹å¼æ‹…å¿ƒæœ‰äº›äººé€šè¿‡è„šæœ¬ä¸‹å•ï¼Œå› æ­¤é”™æ€çœŸå®ç”¨æˆ·\n\nç®—æ³•è¿‡æ»¤æ–¹æ¡ˆåœ¨ç§’æ€æ¨¡å—ä¸­ï¼Œä¸€èˆ¬ä½¿ç”¨ä»¤ç‰Œæ¡¶ç®—æ³•æˆ–è€…å›ºå®šçª—å£ç®—æ³•ä¸€.ä»¤ç‰Œæ¡¶\n\næ¯æ¬¡è¯·æ±‚éœ€è¦æ¶ˆè€—ä¸€ä¸ªä»¤ç‰Œï¼Œä»¤ç‰Œç”Ÿæˆé€Ÿç‡æ˜¯å›ºå®šçš„ï¼Œå½“ä»¤ç‰Œæ¡¶æ»¡æ—¶ï¼Œè¯·æ±‚å°†è¢«é˜»å¡æˆ–æ‹’ç»\n\nhttps://juejin.cn/post/6969182378845536292å¯ä»¥é€šè¿‡Google Guava çš„ RateLimiter å®ç°äº†ä»¤ç‰Œæ¡¶ç®—æ³•ï¼Œå®ƒæä¾›äº†ä¸€ç§ç®€å•çš„æ–¹å¼æ¥é™æµRateLimiter æ”¯æŒä¸¤ç§é™æµæ–¹å¼ï¼š\n\nå›ºå®šé€Ÿç‡é™æµï¼šå›ºå®šé€Ÿç‡é™æµæ˜¯æŒ‡å›ºå®šæ¯ç§’ç”Ÿæˆä»¤ç‰Œçš„é€Ÿç‡ã€‚ä¾‹å¦‚ï¼Œå½“ä»¤ç‰Œç”Ÿæˆé€Ÿç‡ä¸º 10 ä¸ªæ¯ç§’æ—¶ï¼Œç¬¬ä¸€ç§’å¯ä»¥ç”Ÿæˆ 10 ä¸ªä»¤ç‰Œï¼Œç¬¬äºŒç§’ä¹Ÿå¯ä»¥ç”Ÿæˆ 10 ä¸ªä»¤ç‰Œï¼Œä»¥æ­¤ç±»æ¨ã€‚\nSmoothBursty é™æµï¼šSmoothBursty é™æµæ˜¯ä¸€ç§æ›´åŠ çµæ´»çš„é™æµæ–¹å¼ï¼Œå®ƒæ”¯æŒåœ¨çŸ­æ—¶é—´å†…çš„é«˜é€Ÿç‡é™æµï¼Œåœ¨é•¿æ—¶é—´å†…çš„æ›´åŠ ç¼“æ…¢çš„é™æµã€‚è¿™ç§ç®—æ³•é€‚ç”¨äºé‚£äº›å…·æœ‰çŸ­æ—¶é—´å†…çš„çªå‘è¯·æ±‚å’Œé•¿æ—¶é—´å†…çš„å¹³ç¨³è¯·æ±‚çš„åœºæ™¯ã€‚ä¾‹å¦‚ï¼Œåœ¨ä¸€ä¸ªæ—¶é—´æ®µå†…å¯ä»¥ç”Ÿæˆå¤§é‡ä»¤ç‰Œï¼Œä½†åœ¨å¦ä¸€ä¸ªæ—¶é—´æ®µå†…ç”Ÿæˆçš„ä»¤ç‰Œæ•°å¯èƒ½ä¼šå˜å°‘ã€‚\nSmoothBursty é™æµç®—æ³•é€šè¿‡é€‚å½“åœ°è°ƒæ•´ä»¤ç‰Œç”Ÿæˆé€Ÿç‡ï¼Œä»¥é€‚åº”ç³»ç»Ÿçš„éœ€æ±‚æƒ…å†µï¼Œå¹¶åŒæ—¶ä¿è¯åœ¨ä»¤ç‰Œæ¡¶ä¸­ä»¤ç‰Œçš„æœ‰æ•ˆåˆ©ç”¨ã€‚å®ƒå¯ä»¥å¸®åŠ©å®ç°æ›´å¥½çš„èµ„æºåˆ©ç”¨ç‡ï¼ŒåŒæ—¶ä¿è¯ç³»ç»Ÿçš„ç¨³å®šæ€§ã€‚\n\n\n\näºŒ.æ¼æ¡¶ç®—æ³•\n\nå°†è¯·æ±‚ç¼“å­˜åˆ°æ¼æ¡¶ä¸­ï¼Œæ¼æ¡¶çš„å®¹é‡æœ‰é™ï¼Œè¯·æ±‚ä»¥å›ºå®šé€Ÿç‡ä»æ¼æ¡¶ä¸­æµå‡º\n\nä¸‰.æ»‘åŠ¨çª—å£\n\nåœ¨ä¸€æ®µæ—¶é—´å†…ï¼Œå¯¹è¯·æ±‚æ•°é‡è¿›è¡Œé™åˆ¶ï¼Œå¹¶éšæ—¶é—´çª—å£çš„æ»‘åŠ¨è€Œæ”¹å˜é™åˆ¶çš„æ•°é‡\n\nå››.å›ºå®šçª—å£\n\nåœ¨å›ºå®šæ—¶é—´çª—å£å†…ï¼Œå¯¹è¯·æ±‚æ•°é‡è¿›è¡Œé™åˆ¶\n\näº”.éšæœºç®—æ³•\n\néšæœºæ¥å—æˆ–è€…æ‹’ç»\n\næ³¨æ„ï¼šæ¼æ¡¶ç®—æ³•å’Œå›ºå®šçª—å£ç®—æ³•éƒ½æ˜¯é™æµç®—æ³•ï¼Œä½†å®ƒä»¬æœ‰ä¸€äº›é‡è¦çš„å·®å¼‚ï¼š\n\nåŸç†ï¼šæ¼æ¡¶ç®—æ³•åŸºäºç­‰å¾…è¯·æ±‚çš„æ€æƒ³ï¼Œå³è¯·æ±‚è¢«å­˜å‚¨åœ¨æ¼æ¡¶ä¸­ç›´åˆ°æ¼æ¡¶ä¸­æœ‰è¶³å¤Ÿçš„ä»¤ç‰Œæ¥å¤„ç†è¯·æ±‚ã€‚è€Œå›ºå®šçª—å£ç®—æ³•åˆ™æ˜¯é€šè¿‡è®¡ç®—åœ¨å›ºå®šæ—¶é—´çª—å£å†…å¤„ç†çš„è¯·æ±‚æ•°æ¥é™åˆ¶è¯·æ±‚æ•°é‡ã€‚\nå®ç°æ–¹å¼ï¼šæ¼æ¡¶ç®—æ³•é€šè¿‡è®¾ç½®å›ºå®šçš„ä»¤ç‰Œç”Ÿæˆé€Ÿç‡å’Œå›ºå®šçš„æ¼æ¡¶å®¹é‡æ¥å®ç°é™æµã€‚å›ºå®šçª—å£ç®—æ³•åˆ™æ˜¯é€šè¿‡ç»´æŠ¤ä¸€ä¸ªè¯·æ±‚æ•°çš„è®¡æ•°å™¨ï¼Œå¹¶åœ¨å›ºå®šçš„æ—¶é—´çª—å£å†…é‡ç½®è¯¥è®¡æ•°å™¨æ¥å®ç°é™æµã€‚\nåº”ç”¨åœºæ™¯ï¼šæ¼æ¡¶ç®—æ³•é€‚ç”¨äºå¤„ç†çªå‘è¯·æ±‚ï¼Œå¹¶ä¸”è¯·æ±‚å¤„ç†é€Ÿç‡ç›¸å¯¹ç¨³å®šçš„åœºæ™¯ã€‚å›ºå®šçª—å£ç®—æ³•åˆ™é€‚ç”¨äºè¯·æ±‚å¤„ç†é€Ÿç‡éœ€è¦åœ¨å›ºå®šæ—¶é—´çª—å£å†…åŠ¨æ€è°ƒæ•´çš„åœºæ™¯ã€‚\n\næ€»çš„æ¥è¯´ï¼Œæ¼æ¡¶ç®—æ³•å’Œå›ºå®šçª—å£ç®—æ³•éƒ½æ˜¯æœ‰æ•ˆçš„é™æµç®—æ³•ï¼Œé€‰æ‹©å“ªç§ç®—æ³•å–å†³äºåº”ç”¨åœºæ™¯å’Œé™æµéœ€æ±‚ã€‚å¦‚æœéœ€è¦å¤„ç†çªå‘è¯·æ±‚ï¼Œæ¼æ¡¶ç®—æ³•å¯èƒ½æ›´åˆé€‚ï¼›å¦‚æœéœ€è¦åŠ¨æ€è°ƒæ•´è¯·æ±‚å¤„ç†é€Ÿç‡ï¼Œåˆ™å›ºå®šçª—å£ç®—æ³•å¯èƒ½æ›´åˆé€‚ã€‚\nMQå‰Šå³°ã€å¼‚æ­¥ã€è§£è€¦ä¸ºä»€ä¹ˆä½¿ç”¨MQè¿›è¡Œå‰Šå³°æ“ä½œ\n\nå¤„ç†é«˜æµé‡è¯·æ±‚ï¼šå½“ç³»ç»Ÿè¯·æ±‚å³°å€¼å¾ˆé«˜æ—¶ï¼Œå¯ä»¥å°†æ‰€æœ‰çš„è¯·æ±‚æŠ•é€’åˆ°æ¶ˆæ¯é˜Ÿåˆ—ä¸­ï¼Œè®©åå°å¼‚æ­¥å¤„ç†è¯·æ±‚ï¼Œå‡å°‘ç³»ç»Ÿçš„å³°å€¼å‹åŠ›ï¼ˆç¼“å†²è¯·æ±‚ï¼‰\nå¯é æ€§ï¼šèƒ½å¤Ÿæœ‰æ•ˆé¿å…ç¬æ—¶è¯·æ±‚è¿‡é‡ï¼Œå¯¼è‡´çš„ç³»ç»Ÿä¸ç¨³å®šæˆ–è€…æ•°æ®ä¸¢å¤±ï¼ˆç³»ç»Ÿæ•…éšœæ—¶å€™ä¹Ÿä¸ä¼šä¸¢å¤±æ¶ˆæ¯ï¼‰\næ‰©å±•æ€§ï¼šå¯ä»¥æœ‰æ•ˆå°†è¯·æ±‚åˆ†æ•£ç»™å¤šä¸ªç³»ç»Ÿå¤„ç†ï¼Œæé«˜ç³»ç»Ÿçš„å¤„ç†èƒ½åŠ›ï¼Œå¦‚æœæ¶ˆè´¹ä¸è¿‡æ¥å¯ä»¥ä¸´æ—¶åŠ æ¶ˆè´¹è€…è¿›è¡Œå¤„ç†\nå¯ç”¨æ€§æé«˜ï¼šå› ä¸ºæ˜¯å¼‚æ­¥å¤„ç†è¯·æ±‚ï¼Œå³ä½¿åœ¨è¯·æ±‚é‡æ¿€å¢æƒ…å†µä¹Ÿä¸ä¼šå‡ºç°ç³»ç»Ÿæ•…éšœï¼Œå¯ä»¥çµæ´»è°ƒæ•´é˜Ÿåˆ—é•¿åº¦å’Œæ¶ˆæ¯ç”Ÿäº§é€Ÿç‡æ¥æ§åˆ¶ç³»ç»Ÿæ¶ˆè´¹é€Ÿåº¦\n\nå¸¸è§çš„MQæœ‰ActiveMQï¼ŒRocketMQï¼ŒRabbitMQå’ŒKafkaä½¿ç”¨MQæ‰€éœ€è¦æ³¨æ„çš„é—®é¢˜\n\né˜Ÿåˆ—ç®¡ç†ï¼šéœ€è¦ç®¡ç†å¥½é˜Ÿåˆ—çš„é•¿åº¦ï¼Œé¿å…è¿‡é•¿å¯¼è‡´çš„å†…å­˜æº¢å‡º\næ¶ˆæ¯å¯é æ€§ï¼šéœ€è¦è®¾ç½®æ¶ˆæ¯çš„æŒä¹…åŒ–ï¼Œé‡è¯•ç­‰æœºåˆ¶\næ¶ˆæ¯ä¸€è‡´æ€§ï¼šéœ€è¦é¿å…é‡å¤æ¶ˆè´¹æˆ–è€…æ¶ˆæ¯ä¸¢å¤±\næ¶ˆæ¯å¤„ç†èƒ½åŠ›ï¼šéœ€è¦æ ¹æ®å®é™…éœ€æ±‚è°ƒæ•´ç”Ÿäº§é€Ÿç‡å’Œæ¶ˆè´¹é€Ÿç‡\nèµ„æºåˆ©ç”¨ç‡ï¼šéœ€è¦ç›‘æ§ç³»ç»Ÿèµ„æºä½¿ç”¨æƒ…å†µï¼Œé˜²æ­¢å®•æœº\n\nå‡ºç°æ­»ä¿¡é˜Ÿåˆ—æ€ä¹ˆåŠ\n\næ­»ä¿¡é˜Ÿåˆ—ä¸€èˆ¬æ˜¯æŸäº›æ¶ˆæ¯æ— æ³•åœ¨è§„å®šæ—¶é—´å†…æ­£å¸¸å¤„ç†\n\n\næ£€æŸ¥é˜Ÿåˆ—çš„é…ç½®ï¼šæ£€æŸ¥æ¶ˆæ¯çš„å­˜æ´»æ—¶é—´å’Œé˜Ÿåˆ—å¤§å°ï¼Œç¡®ä¿å®ƒä»¬æœ‰è¶³å¤Ÿçš„å†…å­˜ä¿å­˜å¾…å¤„ç†æ¶ˆæ¯\nè·Ÿè¸ªæ¶ˆæ¯ï¼šæŸ¥çœ‹æ—¥å¿—å’Œç›‘æ§å·¥å…·ï¼Œè·Ÿè¸ªæ¶ˆæ¯å¤„ç†çš„æƒ…å†µï¼Œå®šä½é—®é¢˜\né‡è¯•ï¼šå¯¹äºä¸€äº›å¯ä»¥é‡è¯•çš„æ¶ˆæ¯ï¼Œç”¨é‡è¯•æœºåˆ¶é‡æ–°æ¶ˆè´¹\næ¢å¤æ•°æ®ï¼šåœ¨æç«¯æƒ…å†µä¸‹ï¼Œå¦‚æœé‡åˆ°æ— æ³•å¤„ç†æ¶ˆæ¯ï¼Œè€ƒè™‘ä»å¤‡ä»½æ•°æ®ä¸­æ¢å¤æ•°æ®\näººå·¥å¹²é¢„ï¼šå¯¹äºç‰¹å®šæ¶ˆæ¯ï¼Œè‡ªåŠ¨å¤„ç†ä¸äº†ï¼Œå°±äººå·¥å¹²é¢„æ¶ˆè´¹å¤„ç†\n\nMQæ¶ˆè´¹ä¸è¿‡æ¥æ€ä¹ˆåŠ\n\nå‡ºç°è¿™ç§æƒ…å†µä¸€èˆ¬æ˜¯æ¶ˆæ¯ç”Ÿäº§è¿‡å¿«æˆ–è€…æ¶ˆè´¹ç«¯å¤„ç†èƒ½åŠ›ä¸è¶³ï¼Œå¯¼è‡´æ¶ˆæ¯ç§¯å‹\n\n\næé«˜æ¶ˆè´¹ç«¯çš„å¤„ç†èƒ½åŠ›ï¼šå¢åŠ æœºå™¨æ•°é‡ï¼Œé…ç½®æ›´é«˜çš„è®¡ç®—èµ„æºï¼Œä»£ç è°ƒä¼˜ç­‰\nå‡ç¼“ç”Ÿäº§é€Ÿåº¦ï¼šå¯ä»¥é™åˆ¶ç”Ÿäº§è€…çš„ç”Ÿäº§é€Ÿåº¦ï¼Œç”¨ä»¤ç‰Œæ¡¶æˆ–è€…æ¼æ¡¶æ¥é™åˆ¶ï¼Œé¿å…æ¶ˆæ¯ç§¯å‹\né•¿é˜Ÿåˆ—ï¼šå¯ä»¥é€šè¿‡åˆ†æ²»é˜Ÿåˆ—ï¼Œé™ä½å•é˜Ÿåˆ—çš„è´Ÿè·ï¼Œç¼©çŸ­æ¶ˆæ¯å¤„ç†æ—¶é—´\nè®¾ç½®æ­£ç¡®çš„é˜Ÿåˆ—é•¿åº¦é™åˆ¶ï¼šé¿å…é˜Ÿåˆ—è¿‡é•¿å¯¼è‡´çš„ç§¯å‹ã€ä¸€èˆ¬å’Œè¿™ä¸ªæ— å…³ã€‘\n\nMQå¯é æ€§æ¶ˆæ¯æŠ•é€’ã€é«˜å¯é å¿…å®šç‰ºç‰²æ€§èƒ½ã€‘\n\nack+é‡è¯•æœºåˆ¶ã€ç›®å‰å¸¸ç”¨ã€‘\n\né€šè¿‡é…ç½®confirmçš„å‘é€ç¡®è®¤æœºåˆ¶ï¼Œå½“æ¶ˆæ¯å‘é€åˆ°æ¶ˆè´¹è€…å¹¶ä¸”ç¡®è®¤æ”¶åˆ°æ¶ˆæ¯ï¼Œé€šçŸ¥ç”Ÿäº§è€…è¯¥æ¶ˆæ¯å·²æ¶ˆè´¹\n\n\næ¶ˆæ¯å¤šå¤‡\n\nåœ¨ç”Ÿäº§è€…æˆ–è€…brokeræˆ–è€…æ¶ˆè´¹è€…ä¿ç•™ä¸€ä»½ï¼Œå½“æ¶ˆè´¹è€…æ¶ˆè´¹æˆåŠŸåå†åˆ é™¤ã€ åœ¨æ¶ˆæ¯çš„ä¼ è¾“é“¾è·¯ä¸Šæ¯ä¸ªèŠ‚ç‚¹å†—ä½™æ¶ˆæ¯  ã€‘å¦‚æœ Broker æ˜¯é›†ç¾¤éƒ¨ç½²ï¼Œæœ‰å¤šå‰¯æœ¬æœºåˆ¶ï¼Œå³æ¶ˆæ¯ä¸ä»…ä»…è¦å†™å…¥å½“å‰ Broker ,è¿˜éœ€è¦å†™å…¥å‰¯æœ¬æœºä¸­ã€‚é‚£é…ç½®æˆè‡³å°‘å†™å…¥ä¸¤å°æœºå­åå†ç»™ç”Ÿäº§è€…å“åº”ã€‚è¿™æ ·åŸºæœ¬ä¸Šå°±èƒ½ä¿è¯å­˜å‚¨çš„å¯é äº†ã€‚ä¸€å°æŒ‚äº†å¦ä¸€å°è¿˜åœ¨ã€‚\n\n\näº‹åŠ¡æœºåˆ¶ã€å¤ªæ¶ˆè€—æ€§èƒ½ã€‘\n\n1.å°†channelè®¾ç½®ä¸ºäº‹åŠ¡æ¨¡å¼channel.txSelect();2.æäº¤äº‹åŠ¡channel.txCommit();3.äº‹åŠ¡å›æ»šchannel.txRollback();\n\n\n\nå¦‚æœæ¶ˆæ¯å…¥é˜Ÿåˆ—åMQå®•æœºæ­¤æ—¶å°±éœ€è¦ï¼šæŒä¹…åŒ–ï¼Œä¸æ­¢æ¶ˆæ¯çš„æŒä¹…åŒ–ï¼Œè¿˜æœ‰é˜Ÿåˆ—å’ŒExchangeçš„æŒä¹…åŒ–MQå‡ºç°é‡å¤æ¶ˆè´¹æ€ä¹ˆåŠ\n\nåšå¥½å¹‚ç­‰æ€§\nå¤±è´¥ä¸€å®šæ¬¡æ•°å°±é€šçŸ¥äººå·¥å¤„ç†ç¼“å­˜\nç§’æ€æ˜¯ä¸€ä¸ªå…¸å‹çš„è¯»å¤šå†™å°‘çš„åº”ç”¨åœºæ™¯ï¼Œéå¸¸é€‚ç”¨ç¼“å­˜ã€ä¸€ä»¶å•†å“åªæœ‰10ä»¶çš„åº“å­˜ï¼Œæœ‰200wäººæ¥æŠ¢ï¼Œå®é™…å°±åªæœ‰10ä¸ªäººå¯ä»¥ä¸‹å•æˆåŠŸï¼Œå…¶å®ƒçš„éƒ½æ˜¯æŸ¥è¯¢åº“å­˜ã€‘\n\n\n\nç¼“å­˜å¯ä»¥åœ¨ç§’æ€å‰å…ˆç¼“å­˜å•†å“ä¿¡æ¯ï¼Œåº“å­˜ä¿¡æ¯å’Œé¢„çƒ­ç”¨æˆ·å¯¹è¯¥å•†å“çš„è¯·æ±‚ï¼Œè¿™æ ·å¯ä»¥é˜²æ­¢è¯·æ±‚ç›´æ¥æ‰“åˆ°æ•°æ®åº“é‡Œé¢ï¼Œä»è€Œæé«˜ç³»ç»Ÿçš„æ•ˆç‡å¯¹äºè¯»è¯·æ±‚ï¼Œæ— è®ºæ˜¯ Memcached è¿˜æ˜¯ Redis ï¼Œå•æœºæŠ—10wQPSé—®é¢˜éƒ½ä¸å¤§ï¼Œåœ¨ä¸Šå±‚çš„é™æµï¼Œå‰Šå³°ï¼Œäººæœºæ ¡éªŒï¼Œå¹‚ç­‰ä¸­å·²ç»ç­›é€‰æ‰äº†90%çš„è¯·æ±‚ï¼Œæ‰€ä»¥çœŸæ­£èƒ½æ‰“å…¥æ•°æ®åº“çš„æ•°æ®é‡æ˜¯å¾ˆå°‘çš„åŸºäºRediså®ç°ç¼“å­˜ Cache-Aside Pattern(æ—è·¯ç¼“å­˜æ¨¡å¼)\n\nåœ¨è¯·æ±‚è¾¾åˆ°åç«¯ä¹‹åï¼Œé˜²æ­¢è¯·æ±‚ç›´æ¥é¢å‘ä¼ ç»Ÿæ•°æ®åº“ã€RDBMSã€‘ï¼ˆä¼ ç»Ÿæ•°æ®åº“å¤„ç†è¯»å†™æ•ˆæœæ¯”è¾ƒæ…¢ï¼‰ï¼Œä¸€èˆ¬ä¼šåšä¸€å±‚NoSQLç¼“å­˜æ“ä½œã€‚å…ˆå»Redisæ‰¾æœ‰æ²¡æœ‰æ•°æ®ï¼Œå¦‚æœæœ‰å°±è¿”å›ï¼Œæ²¡æœ‰å°±å»RDBMSé‡Œé¢æŸ¥è¯¢æ•°æ®ï¼Œç„¶åå­˜å…¥Rediså¹¶è¿”å›ï¼Œæ–¹ä¾¿ä¸‹æ¬¡ç›´æ¥ä»Redisæ‹¿åˆ°æ•°æ®\n\nå¦‚ä½•ä¿è¯æ•°æ®ä¸€è‡´æ€§\n\nå¼ºä¸€è‡´æ€§ï¼šè¿™ç§ä¸€è‡´æ€§çº§åˆ«æ˜¯æœ€ç¬¦åˆç”¨æˆ·ç›´è§‰çš„ï¼Œå®ƒè¦æ±‚ç³»ç»Ÿå†™å…¥ä»€ä¹ˆï¼Œè¯»å‡ºæ¥çš„ä¹Ÿä¼šæ˜¯ä»€ä¹ˆï¼Œç”¨æˆ·ä½“éªŒå¥½ï¼Œä½†å®ç°èµ·æ¥å¾€å¾€å¯¹ç³»ç»Ÿçš„æ€§èƒ½å½±å“å¤§å¼±ä¸€è‡´æ€§ï¼šè¿™ç§ä¸€è‡´æ€§çº§åˆ«çº¦æŸäº†ç³»ç»Ÿåœ¨å†™å…¥æˆåŠŸåï¼Œä¸æ‰¿è¯ºç«‹å³å¯ä»¥è¯»åˆ°å†™å…¥çš„å€¼ï¼Œä¹Ÿä¸æ‰¿è¯ºå¤šä¹…ä¹‹åæ•°æ®èƒ½å¤Ÿè¾¾åˆ°ä¸€è‡´ï¼Œä½†ä¼šå°½å¯èƒ½åœ°ä¿è¯åˆ°æŸä¸ªæ—¶é—´çº§åˆ«ï¼ˆæ¯”å¦‚ç§’çº§åˆ«ï¼‰åï¼Œæ•°æ®èƒ½å¤Ÿè¾¾åˆ°ä¸€è‡´çŠ¶æ€æœ€ç»ˆä¸€è‡´æ€§ï¼šæœ€ç»ˆä¸€è‡´æ€§æ˜¯å¼±ä¸€è‡´æ€§çš„ä¸€ä¸ªç‰¹ä¾‹ï¼Œç³»ç»Ÿä¼šä¿è¯åœ¨ä¸€å®šæ—¶é—´å†…ï¼Œèƒ½å¤Ÿè¾¾åˆ°ä¸€ä¸ªæ•°æ®ä¸€è‡´çš„çŠ¶æ€ã€‚è¿™é‡Œä¹‹æ‰€ä»¥å°†æœ€ç»ˆä¸€è‡´æ€§å•ç‹¬æå‡ºæ¥ï¼Œæ˜¯å› ä¸ºå®ƒæ˜¯å¼±ä¸€è‡´æ€§ä¸­éå¸¸æ¨å´‡çš„ä¸€ç§ä¸€è‡´æ€§æ¨¡å‹ï¼Œä¹Ÿæ˜¯ä¸šç•Œåœ¨å¤§å‹åˆ†å¸ƒå¼ç³»ç»Ÿçš„æ•°æ®ä¸€è‡´æ€§ä¸Šæ¯”è¾ƒæ¨å´‡çš„æ¨¡å‹\n\n\nå…ˆæ›´æ–°ç¼“å­˜å†æ›´æ–°æ•°æ®åº“ã€è„æ•°æ®ã€‘\n\nçº¿ç¨‹1ï¼šå…ˆæ›´æ–°ç¼“å­˜æˆåŠŸ,ä½†æ˜¯ç½‘ç»œåŸå› å†™æ•°æ®åº“å¤±è´¥ï¼Œå°±ä¼šå¯¼è‡´ç¼“å­˜æ˜¯æœ€æ–°æ•°æ®ï¼Œè€Œæ•°æ®åº“çš„æ•°æ®ä¸ºæ—§æ•°æ®ï¼Œé‚£ç¼“å­˜å°±æ˜¯è„æ•°æ®çº¿ç¨‹2ï¼šè¯»å–ç¼“å­˜ä¸­æ•°æ®ï¼Œè€Œè¿™ä¸ªæ•°æ®æ•°æ®åº“ä¸­å´ä¸å­˜åœ¨ï¼Œæ•°æ®åº“éƒ½ä¸å­˜åœ¨çš„æ•°æ®ï¼Œç¼“å­˜å¹¶è¿”å›å®¢æˆ·ç«¯å°±æ¯«æ— æ„ä¹‰äº†ã€‚\n\nå…ˆæ›´æ–°æ•°æ®åº“ï¼Œå†æ›´æ–°ç¼“å­˜ã€å­˜åœ¨çº¿ç¨‹å®‰å…¨é—®é¢˜ã€‘\n\nçº¿ç¨‹1ï¼šå…ˆæ›´æ–°æ•°æ®åº“æˆåŠŸï¼Œä½†æ˜¯ç”±äºç½‘ç»œå¡é¡¿æ›´æ–°ç¼“å­˜å¤±è´¥ï¼Œä»è€Œå¯¼è‡´ç¼“å­˜ä¸­çš„æ•°æ®ä¸ºæ—§æ•°æ®çº¿ç¨‹2ï¼šä»ç¼“å­˜ä¸­è¯»å–æ•°æ®ï¼Œç¼“å­˜ä¸­çš„æ•°æ®ä¸ºæ—§æ•°ï¼Œä»è€Œå¯¼è‡´æ•°æ®åº“ä¸ç¼“å­˜æ•°æ®ä¸ä¸€è‡´ã€‚\n\nå…ˆåˆ é™¤ç¼“å­˜ï¼Œå†æ›´æ–°æ•°æ®ã€çº¿ç¨‹å®‰å…¨é—®é¢˜ã€‘\n\nçº¿ç¨‹1ï¼šå…ˆåˆ é™¤ç¼“å­˜æˆåŠŸï¼Œä½†æ˜¯ç”±äºç½‘ç»œå¡é¡¿åŸå› ï¼Œæ›´æ–°æ•°æ®åº“å¼‚å¸¸ã€‚çº¿ç¨‹2ï¼šè¯»å–ç¼“å­˜ç”±äºç¼“å­˜æ•°æ®ä¸ºç©ºï¼Œåˆ™ä¼šæŸ¥è¯¢æ•°æ®åº“ä¸­çš„æ•°æ®ï¼ŒæŸ¥è¯¢æˆåŠŸå¹¶å†™å…¥ç¼“å­˜ï¼Œä»è€Œå¯¼è‡´æ•°æ®ä¸ä¸€è‡´ã€‚\n\nå…ˆæ›´æ–°æ•°æ®åº“ï¼Œå†åˆ é™¤ç¼“å­˜ã€çŸ­æš‚ä¸ä¸€è‡´é—®é¢˜ã€‘\n\nçº¿ç¨‹1ï¼šå†™å…¥æ•°æ®åº“æˆåŠŸï¼Œç”±äºç½‘ç»œå¡é¡¿åŸå› ï¼Œå¯¼è‡´åˆ é™¤ç¼“å­˜æ•°æ®å¤±è´¥çº¿ç¨‹2ï¼šè¯»å–æ•°æ®ï¼Œè¯»å–ä¸ºç¼“å­˜ä¸­çš„æ•°æ®ï¼Œä½†æ˜¯å½“ç½‘ç»œæ¢å¤æ­£å¸¸åï¼Œç¼“å­˜ä¸­çš„æ•°æ®ä¼šè¢«åˆ é™¤ï¼Œæ‰€ä»¥å¯èƒ½ä¼šå­˜åœ¨çŸ­æš‚çš„æ•°æ®ä¸ä¸€è‡´\n\nå»¶æ—¶åŒåˆ \n\nå…ˆåˆ é™¤ç¼“å­˜ï¼Œå†æ›´æ–°æ•°æ®åº“ï¼Œç¡®ä¿æ•°æ®åº“äº‹åŠ¡æäº¤æˆåŠŸï¼Œç„¶åä¼‘çœ ä¸€æ®µæ—¶é—´åœ¨åˆ é™¤ç¼“å­˜ã€‚æˆ‘ä»¬éƒ½çŸ¥é“ç¬¬ä¸‰ç§æƒ…å†µæ˜¯å› ä¸ºç½‘ç»œå¡é¡¿å¯¼è‡´æ•°æ®åº“æ›´æ–°å¤±è´¥ï¼Œå½“ç½‘ç»œæ¢å¤æ­£å¸¸åï¼Œæˆ‘ä»¬åœ¨æ‰§è¡Œæ›´æ–°æ•°æ®åº“æ“ä½œï¼Œç„¶åå†åˆ é™¤ç¼“å­˜ï¼Œé‚£ä¹ˆå‡ºç°æ•°æ®ä¸ä¸€è‡´çš„æƒ…å†µä¹Ÿå°±æ˜¯åœ¨ä¼‘çœ çš„è¿™çŸ­æš‚çš„æ—¶é—´å†…\n\nåŒåˆ +é˜Ÿåˆ—é‡è¯•æœºåˆ¶\n\nåœ¨å»¶æ—¶åŒåˆ çš„æ–¹æ¡ˆä¸Šå¼•å…¥é˜Ÿåˆ—ï¼Œéœ€è¦åˆ é™¤å¤±è´¥çš„keyå­˜å…¥æ¶ˆæ¯é˜Ÿåˆ—ä¸­ï¼Œé‡‡ç”¨å¼‚æ­¥çš„æ–¹å¼æ¥è¿›è¡Œåˆ é™¤ï¼Œå¦‚æœåˆ é™¤å¤±è´¥çš„æ¬¡æ•°å·²ç»è¶…è¿‡äº†æœ€å¤§æ¬¡æ•°ï¼Œå‘é€è­¦å‘Šé‚®ä»¶ï¼Œéœ€è¦äººå·¥ä»‹å…¥è§£å†³ã€é‡è¯•æœºåˆ¶ã€‘\n\nç›‘å¬binlogæ—¥å¿—åˆ é™¤\n\nä»¥ mysql ä¸ºä¾‹ å¯ä»¥ä½¿ç”¨é˜¿é‡Œçš„ canal å°† binlog æ—¥å¿—é‡‡é›†å‘é€åˆ° MQ é˜Ÿåˆ—é‡Œé¢ï¼Œç„¶åé€šè¿‡ ACK æœºåˆ¶ç¡®è®¤å¤„ç†è¿™æ¡æ›´æ–°æ¶ˆæ¯ï¼Œåˆ é™¤ç¼“å­˜ï¼Œä¿è¯æ•°æ®ç¼“å­˜ä¸€è‡´æ€§å¦‚ä½•é˜²æ­¢ç©¿é€ï¼Œå‡»ç©¿ï¼Œé›ªå´©\n\nç¼“å­˜ç©¿é€ï¼šè¯·æ±‚åœ¨redisæ²¡å‘½ä¸­ç¼“å­˜ï¼Œåœ¨mysqlä¹Ÿæ²¡æœ‰å‘½ä¸­ï¼ŒæŸ¥è¯¢å¤±è´¥ï¼Œå½“è¯·æ±‚é‡å¤§çš„æ—¶å€™ï¼Œä¸€ç›´æœ‰è¿™ç§è¯·æ±‚è¿›æ¥å°±ä¼šç»™æ•°æ®åº“å¾ˆå¤§å‹åŠ›\n\n1.ä½¿ç”¨å¸ƒéš†è¿‡æ»¤å™¨ã€å¦‚æœå¸ƒéš†è¿‡æ»¤å™¨å­˜åœ¨å°±è¿›è¡Œè¯·æ±‚ï¼Œä¸å­˜åœ¨ç›´æ¥è¿›è¡Œç©ºå€¼æˆ–è€…å¤±è´¥ã€‘2.ç¼“å­˜ç©ºå¯¹è±¡ï¼Œå¹¶ä¸”è®¾ç½®è¿‡æœŸæ—¶é—´ã€ç¼“å­˜å¤±æ•ˆä¸å®œè¿‡é•¿ï¼Œå½“æ•°æ®åº“æ•°æ®è¢«å†™å…¥æ—¶å€™è¦åŠæ—¶åˆ·æ–°ï¼Œé¿å…æ•°æ®ä¸ä¸€è‡´çš„æƒ…å†µå‡ºç°ã€‘3.éæ³•è¯·æ±‚æ ¡éªŒã€å‰ç«¯é¡µé¢å’Œåå°è¯·æ±‚å‚æ•°æ ¡éªŒï¼Œé¿å…å‡ºç°éæ³•è¯·æ±‚ç›´æ¥æ‰“å…¥æ•°æ®åº“ã€‘4.é»‘åå•ã€å¯¹äºè¯·æ±‚é¢‘ç‡è¿‡é«˜ä¸æ­£å¸¸çš„è¿›è¡Œé»‘åå•é™åˆ¶ã€‘\n\nç¼“å­˜å‡»ç©¿ï¼šå¤§é‡çƒ­ç‚¹keyå€¼åŒæ—¶å¤±æ•ˆæˆ–è€…å•ä¸ªçƒ­ç‚¹keyï¼Œåœ¨ä¸åœæŠ—ç€å¤§å¹¶å‘ï¼Œè¿™ä¸ªkeyå¤±æ•ˆçš„ç¬é—´ï¼Œå¤§é‡çš„è¯·æ±‚å°±ä¼šå‡»ç ´ç¼“å­˜ï¼Œæ‰“å…¥æ•°æ®åº“\n\n1.ä½¿ç”¨äº’æ–¥é”ã€å»ºè®®ä½¿ç”¨Redissionåˆ†å¸ƒå¼é”ã€‘ï¼Œå•æœºå¯ä»¥é€šè¿‡synchronizedæˆ–è€…lockæ¥å®ç°ï¼Œåªè®©ä¸€ä¸ªè¯·æ±‚å»è¯·æ±‚æ•°æ®åº“ï¼Œå…¶å®ƒçš„ç­‰å¾…ç¼“å­˜æ„å»ºåå†å»è¯·æ±‚ç¼“å­˜2.çƒ­ç‚¹keyä¸è®¾ç½®è¿‡æœŸæ—¶é—´ï¼Œåä»£å®šæ—¶å¼‚æ­¥æ›´æ–°ç¼“å­˜ã€é€‚ç”¨äºå¼±ä¸€è‡´æ€§åœºæ™¯ã€‘3.ç»­å¤±æ•ˆæ—¶é•¿ï¼Œåœ¨valueå†…éƒ¨è®¾ç½®ä¸€ä¸ªæ¯”ç¼“å­˜è¿‡æœŸæ—¶é—´çŸ­çš„æ ‡è¯†ï¼Œå½“å¼‚æ­¥çº¿ç¨‹å‘ç°è¯¥å€¼å¿«è¿‡æœŸäº†ï¼Œç”¨äº’æ–¥é”å†…ç½®æ—¶é—´ï¼Œå¹¶ä¸”é‡æ–°å»æ•°æ®åº“åŠ è½½è¯¥æ•°æ®\n\nç¼“å­˜é›ªå´©ï¼šå½“ç¼“å­˜ä¸­å¤§é‡çƒ­ç‚¹ç¼“å­˜åŒæ—¶å¤±æ•ˆï¼Œä¼šå¯¼è‡´ç¼“å­˜åœ¨æŸä¸ªæ—¶é—´è¾¾åˆ°å³°å€¼ï¼Œè¯·æ±‚å…¨éƒ½å»è¯·æ±‚æ•°æ®åº“ï¼Œå¯¼è‡´æ•°æ®åº“å‹åŠ›éª¤å¢ï¼Œç”šè‡³å®•æœºã€‚ä»è€Œå½¢æˆè¿é”ååº”ï¼Œå¯¼è‡´ç³»ç»Ÿå´©æºƒ\n\nä¸€èˆ¬æ˜¯å¤§é‡çƒ­ç‚¹keyåŒæ—¶è¿‡æœŸæˆ–è€…ç¼“å­˜æœåŠ¡æ•…éšœ1.çƒ­ç‚¹keyéšæœºå¤±æ•ˆæ—¶é—´ï¼Œé˜²æ­¢åŒæ—¶å¤±æ•ˆ2.åˆ†å¸ƒå¼é”è¯»æ•°æ®åº“3.Redisé‡‡ç”¨é«˜å¯ç”¨é›†ç¾¤ï¼ˆå¿…è¦æ—¶é‡‡ç”¨å¼‚åœ°å¤šæ´»ï¼‰4.é™æµï¼Œé™çº§ï¼Œå®¹ç¾ï¼Œå‰Šå³°ç­‰æªæ–½çƒ­ç‚¹key\n\nè¯·æ±‚æ¬¡æ•°è¿‡å¤šï¼Œé¢‘ç‡è¿‡é«˜ï¼Œåˆè¿‡äºé›†ä¸­çš„ä¸€äº›key\n\nå¤§keyï¼ˆBig Keyï¼‰\n\nBig Keyå°±æ˜¯æŸä¸ªkeyå¯¹åº”çš„valueå¾ˆå¤§ï¼Œå ç”¨çš„redisç©ºé—´å¾ˆå¤§ï¼Œæœ¬è´¨ä¸Šæ˜¯å¤§valueé—®é¢˜\n\nåŸå› ï¼š\n\nredisæ•°æ®ç»“æ„ä½¿ç”¨ä¸å½“\næœªåŠæ—¶æ¸…ç†åƒåœ¾æ•°æ®\nå¯¹ä¸šåŠ¡é¢„ä¼°ä¸å‡†\næ˜æ˜Ÿï¼Œç½‘çº¢ä¹‹ç±»çš„ç²‰ä¸åˆ—è¡¨æˆ–è€…çƒ­ç‚¹æ–°é—»çš„è¯„è®ºåˆ—è¡¨\n\nè§£å†³æ–¹å¼ï¼š\n\nå¯¹å¤§keyè¿›è¡Œæ‹†åˆ†ï¼Œæ‹†åˆ†ä¸ºå°keyï¼Œç„¶åé€šè¿‡getä¸åŒçš„keyæˆ–è€…ä½¿ç”¨mgetæ‰¹é‡è·å–\nå¯¹å¤§keyè¿›è¡Œæ¸…ç†\nç›‘æ§redisçš„å†…å­˜ï¼Œå¸¦å®½ï¼Œè¶…æ—¶æ¯”ä¾‹ï¼Œç„¶åè¿›è¡Œé¢„è­¦\nå®šæ—¶æ¸…ç†å¤±æ•ˆæ•°æ®ï¼Œæœ€å¥½åŠ ä¸€ä¸ªæ—¶æ•ˆæ€§\nå‹ç¼©valueï¼Œé‡‡ç”¨åºåˆ—åŒ–æˆ–è€…å‹ç¼©ç®—æ³•æ–¹å¼å°†keyå¤§å°æ§åˆ¶ï¼Œæ³¨æ„åºåˆ—åŒ–å’Œååºåˆ—åŒ–éƒ½ä¼šå¸¦æ¥æ¶ˆè€—\n\næ•°æ®é¢„çƒ­ã€æå‰åšå¥½çƒ­ç‚¹æ¢æµ‹ã€‘\n\nç¼“å­˜é¢„çƒ­æ˜¯æŒ‡ç³»ç»Ÿä¸Šçº¿åï¼Œæå‰å°†ç›¸å…³çš„ç¼“å­˜æ•°æ®åŠ è½½åˆ°ç¼“å­˜ç³»ç»Ÿã€‚é¿å…åœ¨ç”¨æˆ·è¯·æ±‚çš„æ—¶å€™ï¼Œå…ˆæŸ¥è¯¢æ•°æ®åº“ï¼Œç„¶åå†å°†æ•°æ®ç¼“å­˜çš„é—®é¢˜ï¼Œç”¨æˆ·ç›´æ¥æŸ¥è¯¢äº‹å…ˆè¢«é¢„çƒ­çš„ç¼“å­˜æ•°æ®ã€‚\n\n\næ•°æ®é‡ä¸å¤§çš„æ—¶å€™ï¼Œå·¥ç¨‹å¯åŠ¨çš„æ—¶å€™è¿›è¡ŒåŠ è½½ç¼“å­˜åŠ¨ä½œ\næ•°æ®é‡å¤§çš„æ—¶å€™ï¼Œè®¾ç½®ä¸€ä¸ªå®šæ—¶ä»»åŠ¡è„šæœ¬ï¼Œè¿›è¡Œç¼“å­˜çš„åˆ·æ–°\næ•°æ®é‡å¤ªå¤§çš„æ—¶å€™ï¼Œä¼˜å…ˆä¿è¯çƒ­ç‚¹æ•°æ®è¿›è¡Œæå‰åŠ è½½åˆ°ç¼“å­˜mysql\n\næ•°æ®åº“åŒæ­¥é—®é¢˜\n\nç¼“å­˜å’Œæ•°æ®åº“ä¸€è‡´æ€§é—®é¢˜ åœ¨ä¸Šé¢å·²ç»æåŠ\n\næ•°æ®åº“æ‰©å®¹é—®é¢˜\n\nä¸šåŠ¡ç³»ç»Ÿåœ¨è®¾è®¡åˆæœŸä¸€èˆ¬æ•°æ®é‡å°ï¼Œä¼šé‡‡å–å•æœåŠ¡+å•æ•°æ®åº“ä½†æ˜¯éšç€è®¿é—®é‡ä¸Šå‡ï¼Œä¸ºäº†è¾¾åˆ°æ•°æ®åº“çš„æœ€ä½³å‚¨å­˜å®¹é‡ï¼Œéœ€è¦å¯¹æ•°æ®åº“åšå‚ç›´æˆ–è€…æ°´å¹³æ‹†åˆ†ï¼Œæ¥æå‡æœåŠ¡å“åº”é€Ÿåº¦ï¼Œè¿™æ—¶å€™å°±æ¶‰åŠåˆ°äº†æ‰©å®¹é—®é¢˜\n\néš¾ç‚¹\n\næ•°æ®è¿ç§»é—®é¢˜\nåˆ†ç‰‡è§„åˆ™çš„æ”¹å˜\næ•°æ®åŒæ­¥ï¼Œæ—¶é—´ç‚¹ï¼Œæ•°æ®ä¸€è‡´æ€§\n\nè§£å†³æ–¹å¼\n\nåœæœºæ‰©å®¹ã€ç®€å•æ–¹æ¡ˆã€‘\n\nã€é€‚ç”¨äºç®€å•ä¸šåŠ¡ï¼Œæ•°æ®åº“è¾ƒå°‘çš„æ—¶å€™ã€‘åœæ­¢æœåŠ¡ -ã€‹æ–°å¢æ•°æ®åº“ï¼Œä¿®æ”¹åˆ†ç‰‡è§„åˆ™ï¼Œè¿ç§»æ•°æ® -ã€‹é‡å¯æœåŠ¡ä¼˜ç‚¹ï¼šç®€å•ï¼Œåœæœºé£é™©æ“ä½œä½ç¼ºç‚¹ï¼šç¼ºä¹é«˜å¯ç”¨ï¼Œå¦‚æœæ²¡é…ç½®å¥½ï¼Œå®¹æ˜“é€ æˆæ•°æ®ä¸¢å¤±ï¼Œéš¾ä»¥ä¿®å¤\n\nå¹³æ»‘æ‰©å®¹ã€å¤§æ•°æ®é‡ã€‘\n\nã€ä¿æŒé«˜å¯ç”¨ã€‘å¹³æ»‘æ‰©å®¹å¯ä»¥å®ç°nåº“æ‰©å®¹2nåº“ï¼Œå¢åŠ æ•°æ®åº“æœåŠ¡èƒ½åŠ›æ–°å¢æ•°æ®åº“ -ã€‹é…ç½®åŒä¸»è¿›è¡Œæ•°æ®åŒæ­¥ -ã€‹æ•°æ®åŒæ­¥å®Œæˆåé…ç½®åŒä¸»åŒå†™ -ã€‹åˆ é™¤åŒä¸»åŒæ­¥ï¼Œä¿®æ”¹æ•°æ®åº“é…ç½®å¹¶é‡å¯ -ã€‹ æ¸…ç©ºæ•°æ®åº“å¤šä½™æ•°æ®ä¼˜ç‚¹ï¼šä¸ç”¨åœæœºï¼Œä¿æŒé«˜å¯ç”¨ï¼Œæ‰©å®¹é‡åˆ°é—®é¢˜å®¹æ˜“è§£å†³ï¼Œä¸å½±å“çº¿ä¸ŠæœåŠ¡ï¼Œå¯ä»¥å‡å°‘æ¯ä¸ªæ•°æ®åº“æ•°æ®é‡ç¼ºç‚¹ï¼šç¨‹åºå¤æ‚ï¼Œæ•°æ®é‡å¤§æ—¶ï¼Œä»£ä»·é«˜https://juejin.cn/post/7166859294615273480#heading-6æ•°æ®åº“å†·çƒ­åˆ†ç¦»\n\nå†·çƒ­åˆ†ç¦»å°±æ˜¯åœ¨å¤„ç†æ•°æ®æ—¶ï¼Œæ•°æ®åº“åˆ†ä¸ºå†·åº“å’Œçƒ­åº“å†·åº“ï¼šå­˜æ”¾é‚£äº›èµ°åˆ°äº†ç»ˆæ€çš„æ•°æ®çš„æ•°æ®åº“çƒ­åº“ï¼šè¿˜éœ€è¦ä¿®æ”¹çš„æ•°æ®çš„æ•°æ®åº“å»ºè®®ç”¨esæˆ–è€…clickhouseä½œä¸ºå†·åº“ï¼Œå› ä¸ºå†·åº“ä¸€èˆ¬å­˜å‚¨çš„æ•°æ®é‡æ¯”è¾ƒå¤§ï¼Œeså±äºæ•°æ®é‡è¶Šå¤šä¼˜åŠ¿è¶Šå¤§çš„æ•°æ®åº“\n\n\nä¸šåŠ¡è¯†åˆ«ã€ç®€å•åœºæ™¯é€‚ç”¨ã€‘\n\næ¯”å¦‚æ¯æ¬¡æ›´æ–°äº†è®¢å•çš„çŠ¶æ€ï¼Œå°±å»è§¦å‘è¿™ä¸ªé€»è¾‘\n\nç›‘å¬è¯†åˆ«ã€ä¸šåŠ¡ä»£ç å¤æ‚åœºæ™¯é€‚ç”¨ã€‘\n\nå¯é€šè¿‡ç›‘å¬æ•°æ®åº“å˜æ›´æ—¥å¿—binlogçš„æ–¹å¼æ¥è§¦å‘ï¼ˆæ•°æ®åº“è§¦å‘å™¨ä¹Ÿå¯ï¼‰\n\næ‰«è¡¨è§¦å‘ã€æ—¶é—´åŒºåˆ†å†·çƒ­é€‚ç”¨ã€‘\n\næ•°æ®åº“å®šæ—¶ä»»åŠ¡æˆ–é€šè¿‡ç¨‹åºå®šæ—¶ä»»åŠ¡æ¥è§¦å‘\nè¶…å–å°‘å–é—®é¢˜\njvmçº§åˆ«çš„é” Synchronized æ˜¯æ— æ³•åœ¨åˆ†å¸ƒå¼å¾®æœåŠ¡ä¸‹è§£å†³è¶…å–é—®é¢˜ï¼Œåªèƒ½è§£å†³å½“å‰è¿›ç¨‹çš„è¶…å–é—®é¢˜è¿™ç§æ—¶å€™å°±éœ€è¦å¼•å…¥åˆ†å¸ƒå¼é”\n\n\nRedis setnxå®ç°ç®€å•åˆ†å¸ƒå¼é”ã€ä¸å¤ªå»ºè®®ä½¿ç”¨ã€‘\n\nåœ¨redisä¸­æœ‰ä¸€æ¡å‘½ä»¤ setnx (set if not exists)ï¼šå¦‚æœä¸å­˜åœ¨keyï¼Œåˆ™å¯ä»¥è®¾ç½®æˆåŠŸï¼Œå­˜åœ¨åˆ™å¤±è´¥è¿™ç§æƒ…å†µå¯ä»¥å®ç°æ™®é€šçš„åˆ†å¸ƒå¼é”ï¼Œä½†æ˜¯é‡åˆ°äº†æç«¯æƒ…å†µæ¯”å¦‚æ–­ç”µï¼Œè¶…æ—¶ï¼Œå®•æœºç­‰ä¼šé€ æˆä¸é‡Šæ”¾é”æˆ–è€…æ­»é”\n\nredisson å®ç°åˆ†å¸ƒå¼é”ã€å»ºè®®ä½¿ç”¨ã€‘\n\nåœ¨redissonä¸­æœ‰ä¸€ç§çœ‹é—¨ç‹—æœºåˆ¶ï¼Œå¯ä»¥å®ç°é”ç»­å‘½è¿™æ˜¯ä¸€ç§å·²ç»é€ å¥½çš„è½®å­ï¼Œå¼€ç®±å³ç”¨ï¼Œå®ƒä¹Ÿå¯ä»¥ä½¿ç”¨å¤šrediså®ç°åˆ†å¸ƒå¼é”ï¼Œé˜²æ­¢å•ç‚¹æ•…éšœhttps://juejin.cn/post/7168727597180780574\n\nRedLock é«˜å¯ç”¨å¹¶å‘é”ï¼ˆçº¢é”ï¼‰ã€ä¸å»ºè®®ä½¿ç”¨ã€‘\n\nRedLockä¸ºäº†ä¿è¯é«˜å¯ç”¨ï¼Œåœ¨è®¾ç½®keyçš„æ—¶å€™ï¼Œä¼šåˆ›å»ºå¤šä¸ªèŠ‚ç‚¹ï¼Œå•èŠ‚ç‚¹è®¾ç½®æˆåŠŸä¸ä¼šå‘Šè¯‰ç¨‹åºè·å–åˆ°äº†é”ï¼Œåªæœ‰è¶…è¿‡åŠæ•°èŠ‚ç‚¹è®¾ç½®æˆåŠŸæ‰ä¼šå‘Šè¯‰ç¨‹åºè·å–åˆ°äº†é”https://juejin.cn/post/6983988197420171278\næ¥å£é˜²åˆ·\né¡¾åæ€ä¹‰ï¼Œæƒ³è®©æŸä¸ªæ¥å£æŸä¸ªäººåœ¨æŸæ®µæ—¶é—´å†…åªèƒ½è¯·æ±‚Næ¬¡ã€‚ åœ¨é¡¹ç›®ä¸­æ¯”è¾ƒå¸¸è§çš„é—®é¢˜ä¹Ÿæœ‰ï¼Œé‚£å°±æ˜¯è¿ç‚¹æŒ‰é’®å¯¼è‡´è¯·æ±‚å¤šæ¬¡ï¼Œä»¥å‰åœ¨webç«¯æœ‰è¡¨å•é‡å¤æäº¤ï¼Œå¯ä»¥é€šè¿‡token æ¥è§£å†³ã€‚ é™¤äº†ä¸Šé¢çš„æ–¹æ³•å¤–ï¼Œå‰åç«¯é…åˆçš„æ–¹æ³•ã€‚ç°åœ¨å…¨éƒ¨ç”±åç«¯æ¥æ§åˆ¶\n\n\nå¯¹æ¯”å‰ç«¯è¯·æ±‚å¸¦æ¥çš„æ—¶é—´æˆ³ï¼Œé˜²æ­¢å‡ºç°æå‰è¯·æ±‚\nåŠ ipé™åˆ¶ï¼Œå¦‚æœé‡åˆ°åœ¨è§„å®šæ—¶é—´å†…è¯·æ±‚å¤šæ¬¡ã€ä¸€èˆ¬0.3så†…è¿ç»­ä¸¤æ¬¡éƒ½æ˜¯ä¸æ­£å¸¸çš„ã€‘ï¼Œå¯ä»¥ç›´æ¥åŠ å…¥é»‘åå•ï¼Œæ¯”å¦‚åŠ å…¥redisç»™ä¸€ä¸ªè¢«å°çš„æ—¶é—´\ngetæ¢æˆpostè¯·æ±‚ï¼Œé˜²æ­¢ç›´æ¥é€šè¿‡urlç‚¹å‡»è¯·æ±‚\nåˆ©ç”¨æ³¨è§£aopåšæ‹¦æˆªå™¨ï¼Œè®¾ç½®æ¯ç§’è¯·æ±‚é—´éš”å’Œè¯·æ±‚æ¬¡æ•°https://juejin.cn/post/7109096387886710815https://juejin.cn/post/6844903843516383245\n\nç§’æ€urléšè—\néšè—URLå¹¶ä¸èƒ½å®Œå…¨é˜²æ­¢çˆ¬è™«çš„æ¶æ„æ”»å‡»ï¼Œå› ä¸ºè¿™äº›æ”»å‡»è€…å¯èƒ½é€šè¿‡å¤§é‡çš„å°è¯•æ¥çŒœæµ‹æ­£ç¡®çš„URLä½†æ˜¯åŠ å¯†URLçš„æ„ä¹‰åœ¨äºå¢åŠ æ”»å‡»è€…çŒœæµ‹åˆ°URLçš„éš¾åº¦ï¼Œæ— æ³•è½»æ˜“æ‹¿åˆ°æ­£ç¡®çš„URL\n\n\nç³»ç»Ÿåœ¨ç§’æ€çš„æ—¶é—´ç‚¹æ‰ç”Ÿæˆç§’æ€urlåœ°å€ï¼Œåœ¨éç§’æ€æ—¶é—´è¿”å›ç©ºä¸²ï¼Œé˜²æ­¢æå‰è¢«çŸ¥é“åœ°å€\né€šè¿‡å‰ç«¯ç»™çš„å•†å“id+ç”¨æˆ·id+ç§’æ€å¼€å§‹æ—¥æœŸ+ç§’æ€ç»“æŸæ—¥æœŸ+éšæœºå­—ç¬¦ä¸²æ¥ç”Ÿæˆå”¯ä¸€uuidã€è®°å¾—åŠ ç›åŠ å¯†ã€‘ï¼Œå¹¶ä¸”å­˜å…¥redisã€60sã€‘ï¼Œå¹¶ä¸”è¿”å›ç»™å‰ç«¯\nå‰ç«¯æ‹¿åˆ°uuidè¿›è¡Œåœ°å€æ‹¼æ¥ï¼Œç§’æ€å›ºå®šåœ°å€+uuidè¿›è¡Œè¯·æ±‚\nåç«¯æ‹¿åˆ°è¯·æ±‚åœ°å€çš„uuidï¼Œå»redisæŸ¥è¯¢æœ‰æ²¡æœ‰è¿‡æœŸï¼Œæ²¡æœ‰è¿‡æœŸå¯ä»¥è¿›è¡Œä¸‹ä¸€æ­¥\nåç«¯åœ¨ç§’æ€æ—¶å€™å¯ä»¥é€šè¿‡åŒipç§’æ€é¢‘ç‡æ¥è¿›è¡Œipé»‘åå•é™åˆ¶ï¼Œé˜²æ­¢é€šè¿‡å·¥å…·è‡ªåŠ¨åŒ–åˆ·å•ã€é˜²ä¸äº†åŠ¨æ€ipä»£ç†ã€‘é™æµç†”æ–­\né˜²æ­¢å¤§è¯·æ±‚é‡æ‰“å…¥é¡¶ä¸ä½å¯¼è‡´é›†ä½“å®•æœº\n\n\n\nä¸€èˆ¬åˆ†ä¸ºç›‘æ§ï¼Œé™æµï¼Œç†”æ–­ç›‘æ§ï¼šå¯¹ç³»ç»Ÿçš„å„ä¸ªå…³é”®æŒ‡æ ‡è¿›è¡Œç›‘æ§é‡‡é›†ï¼ŒåŒ…æ‹¬å“åº”æ—¶é—´ï¼Œè¯·æ±‚é‡ï¼Œé”™è¯¯ç‡ç­‰é™æµï¼šå¯¹ç³»ç»Ÿçš„å¹¶å‘è¯·æ±‚è¿›è¡Œé™åˆ¶ï¼Œæ§åˆ¶ç³»ç»Ÿçš„å¤„ç†èƒ½åŠ›ï¼Œé˜²æ­¢ç³»ç»Ÿè¶…è´Ÿè·è¿è¡Œå¯¼è‡´çš„å®•æœºæˆ–è€…å“åº”å˜æ…¢ï¼Œæ¨èä½¿ç”¨guavaé™æµç†”æ–­ï¼šå½“æœåŠ¡æˆ–è€…ä¸‹æ¸¸å‡ºç°æ•…éšœæˆ–è€…ç½‘ç»œå¼‚å¸¸ï¼Œè‡ªåŠ¨åˆ‡æ–­è¯¥æœåŠ¡çš„è°ƒç”¨ï¼Œå¹¶ä¸”è¿”å›æå‰è®¾ç½®å¥½çš„é”™è¯¯å“åº”ï¼Œé˜²æ­¢æœåŠ¡è°ƒç”¨çš„è¿é”ååº”ï¼Œå¯¼è‡´ç³»ç»Ÿå´©æºƒï¼Œå¹¶ä¸”ç»™ç”¨æˆ·ä½“éªŒä¸å¥½ï¼Œæ¨èä½¿ç”¨Hystrixæˆ–è€…Sentinel\næœåŠ¡é™çº§\nç§’æ€ç³»ç»Ÿåœ¨é«˜å¹¶å‘çš„æƒ…å†µä¸‹ï¼Œå¾ˆå®¹æ˜“å› ä¸ºå¤§é‡çš„è¯·æ±‚åŒæ—¶æ¶Œå…¥å¯¼è‡´æœåŠ¡ä¸å¯ç”¨ä¾‹å¦‚ï¼Œåœ¨ç§’æ€æ´»åŠ¨å¼€å§‹å‰ï¼Œå¤§é‡ç”¨æˆ·ä¼šæå‰å‡†å¤‡ï¼Œä¸æ–­åˆ·æ–°å•†å“é¡µé¢ï¼Œå¯¼è‡´å¤§é‡è¯·æ±‚æ¶Œå…¥ç³»ç»Ÿï¼Œä½¿å¾—ç³»ç»Ÿå´©æºƒå› æ­¤ï¼Œåœ¨ç§’æ€ç³»ç»Ÿä¸­ä½¿ç”¨æœåŠ¡é™çº§æ˜¯å¿…è¦çš„ï¼Œä»¥ä¿è¯ç³»ç»Ÿçš„å¯ç”¨æ€§å’Œç¨³å®šæ€§\n\nå½“ç³»ç»Ÿå‡ºç°å¼‚å¸¸æˆ–è€…è¶…è´Ÿè·çš„æƒ…å†µä¸‹ï¼Œé€šè¿‡é™ä½æœåŠ¡è´¨é‡æˆ–è€…åœç”¨éƒ¨åˆ†æœåŠ¡æ¥ä¿è¯æ ¸å¿ƒæœåŠ¡çš„å¯ç”¨æ€§\nè‡ªåŠ¨æ‰©ç¼©å®¹\nå½“è¯·æ±‚é‡è¿‡å¤§æ—¶ï¼Œå•æœºæ— æ³•æ‰¿å—ï¼Œéœ€è¦é€šè¿‡è‡ªåŠ¨æ‰©ç¼©å®¹æ¥ä¿è¯ç³»ç»Ÿçš„æ­£å¸¸è¿è¡Œè‡ªåŠ¨æ‰©ç¼©å®¹æ˜¯æŒ‡æ ¹æ®ç³»ç»Ÿçš„è´Ÿè½½æƒ…å†µè‡ªåŠ¨å¢åŠ æˆ–å‡å°‘ç³»ç»Ÿçš„èŠ‚ç‚¹ï¼Œä»¥é€‚åº”ä¸åŒçš„è´Ÿè½½æƒ…å†µ\n\nç›‘æ§ç³»ç»Ÿé€šè¿‡ç›‘æ§ç³»ç»Ÿå®æ—¶ç›‘æ§ç³»ç»Ÿçš„è´Ÿè½½æƒ…å†µï¼Œå½“è´Ÿè½½è¶…è¿‡ä¸€å®šé˜ˆå€¼æ—¶ï¼Œè‡ªåŠ¨è§¦å‘æ‰©å®¹æ“ä½œï¼Œå½“è´Ÿè½½é™ä½æ—¶ï¼Œè‡ªåŠ¨è§¦å‘ç¼©å®¹æ“ä½œ\näº‘åŸç”Ÿæ¶æ„åœ¨äº‘åŸç”Ÿæ¶æ„ä¸­ï¼Œå¯ä»¥é€šè¿‡äº‘å¹³å°æä¾›çš„è‡ªåŠ¨æ‰©ç¼©å®¹åŠŸèƒ½æ¥å®ç°ç§’æ€ç³»ç»Ÿçš„è‡ªåŠ¨æ‰©ç¼©å®¹ï¼Œä¾‹å¦‚ Kubernetes æä¾›äº†è‡ªåŠ¨æ‰©ç¼©å®¹çš„åŠŸèƒ½ï¼Œå¯ä»¥æ ¹æ®è´Ÿè½½æƒ…å†µè‡ªåŠ¨å¢åŠ æˆ–å‡å°‘å®¹å™¨çš„æ•°é‡\nå¼¹æ€§è®¡ç®—é€šè¿‡å¼¹æ€§è®¡ç®—æ¥å®ç°è‡ªåŠ¨æ‰©ç¼©å®¹ï¼Œä¾‹å¦‚äº‘æœåŠ¡å™¨ ECS æä¾›äº†è‡ªåŠ¨ä¼¸ç¼©ç»„çš„åŠŸèƒ½ï¼Œå¯ä»¥æ ¹æ®è´Ÿè½½æƒ…å†µè‡ªåŠ¨å¢åŠ æˆ–å‡å°‘å®ä¾‹çš„æ•°é‡\nåˆ†å¸ƒå¼äº‹åŠ¡\nä¸‹å•äº‹åŠ¡ï¼šç§’æ€ä¸‹å•éœ€è¦è¿›è¡Œæ‰£å‡åº“å­˜å’Œåˆ›å»ºè®¢å•ä¸¤ä¸ªæ“ä½œï¼Œè¿™ä¸¤ä¸ªæ“ä½œéœ€è¦åœ¨åŒä¸€ä¸ªäº‹åŠ¡ä¸­å®Œæˆï¼Œå¦åˆ™å¯èƒ½ä¼šå‡ºç°åº“å­˜æ‰£å‡æˆåŠŸä½†æ˜¯è®¢å•åˆ›å»ºå¤±è´¥çš„æƒ…å†µã€‚åœ¨åˆ†å¸ƒå¼åœºæ™¯ä¸‹ï¼Œå¯ä»¥ä½¿ç”¨åˆ†å¸ƒå¼äº‹åŠ¡æ¥ä¿è¯è¿™ä¸¤ä¸ªæ“ä½œçš„åŸå­æ€§ï¼Œå¸¸ç”¨çš„åˆ†å¸ƒå¼äº‹åŠ¡è§£å†³æ–¹æ¡ˆæœ‰ TCCã€XAã€SAGA ç­‰ã€‚æ”¯ä»˜äº‹åŠ¡ï¼šå½“ç”¨æˆ·ä¸‹å•æˆåŠŸåéœ€è¦è¿›è¡Œæ”¯ä»˜ï¼Œæ”¯ä»˜ä¹Ÿæ˜¯ä¸€ä¸ªéœ€è¦ä¿è¯åŸå­æ€§çš„æ“ä½œã€‚åœ¨åˆ†å¸ƒå¼åœºæ™¯ä¸‹ï¼Œå¯ä»¥ä½¿ç”¨åˆ†å¸ƒå¼äº‹åŠ¡æ¥ä¿è¯æ”¯ä»˜çš„åŸå­æ€§ï¼Œä½†æ˜¯ç›¸æ¯”äºä¸‹å•äº‹åŠ¡æ›´ä¸ºå¤æ‚ï¼Œå› ä¸ºæ”¯ä»˜æ¶‰åŠåˆ°ç¬¬ä¸‰æ–¹æ”¯ä»˜å¹³å°çš„äº¤äº’ï¼Œå¯èƒ½éœ€è¦å¤„ç†é€€æ¬¾ç­‰å¼‚å¸¸æƒ…å†µã€‚\n\næœ€ç»å…¸çš„äº‹åŠ¡å°±æ˜¯æ•°æ®åº“äº‹åŠ¡ï¼ˆACIDï¼‰\nAï¼šåŸå­æ€§ï¼ˆAtomicityï¼‰ä¸€ä¸ªäº‹åŠ¡ä¸­é—´æ‰§è¡Œçš„æ“ä½œè¦ä¹ˆå…¨éƒ¨æˆåŠŸï¼Œè¦ä¹ˆå…¨éƒ¨å¤±è´¥ï¼Œä¸ä¼šç»“æŸåœ¨æŸä¸ªç¯èŠ‚ã€ä¸å¯åˆ†å‰²çš„æ‰§è¡Œå•å…ƒã€‘äº‹åŠ¡åœ¨æ‰§è¡Œçš„è¿‡ç¨‹ä¸­å¦‚æœå‘ç”Ÿé”™è¯¯ï¼Œä¼šè¿›è¡Œå›æ»šï¼ˆRollbackï¼‰åˆ°äº‹åŠ¡å¼€å§‹å‰çš„çŠ¶æ€ï¼Œå°±åƒè¿™ä¸ªäº‹åŠ¡æ²¡æœ‰æ‰§è¡Œè¿‡ä¸€æ ·\nCï¼šä¸€è‡´æ€§ï¼ˆConsistencyï¼‰ä¸€ä¸ªäº‹åŠ¡æ‰§è¡Œä¹‹å‰å’Œæ‰§è¡Œä¹‹åæ•°æ®åº“éƒ½å¿…é¡»å¤„äºä¸€è‡´æ€§çŠ¶æ€ï¼Œæ•°æ®åº“çš„å®Œæ•´æ€§çº¦æŸæ²¡æœ‰è¢«ç ´å\nIï¼šéš”ç¦»æ€§ï¼ˆIsolationï¼‰äº‹åŠ¡ä¸äº‹åŠ¡ä¹‹é—´æ˜¯äº’ç›¸ç‹¬ç«‹çš„ï¼Œå®ƒä»¬ä¸ä¼šäº’ç›¸å¹²æ‰°ï¼Œä¸€ä¸ªäº‹åŠ¡ä¸ä¼šå½±å“åˆ°å¦å¤–ä¸€ä¸ªäº‹åŠ¡çš„æ•°æ®ï¼Œä¹Ÿä¸ä¼šçœ‹åˆ°å¦å¤–ä¸€ä¸ªäº‹åŠ¡çš„æ•°æ®\nDï¼šæŒä¹…æ€§ï¼ˆDurabilityï¼‰å½“ä¸€ä¸ªäº‹åŠ¡å®Œæˆä¹‹åï¼Œæ‰§è¡Œçš„ç»“æœå¿…é¡»æŒä¹…åŒ–ä¿å­˜ï¼Œå³ä½¿æ•°æ®åº“å´©æºƒï¼Œåœ¨æ•°æ®åº“æ¢å¤åäº‹åŠ¡æäº¤çš„ç»“æœä»ç„¶å­˜åœ¨æ³¨æ„ï¼š\n\näº‹åŠ¡åªèƒ½ä¿è¯æ•°æ®åº“çš„é«˜å¯é æ€§ï¼Œå³æ•°æ®åº“æœ¬èº«å‘ç”Ÿé—®é¢˜åï¼Œäº‹åŠ¡æäº¤åçš„æ•°æ®ä»ç„¶èƒ½æ¢å¤ï¼›è€Œå¦‚æœä¸æ˜¯æ•°æ®åº“æœ¬èº«çš„æ•…éšœï¼Œå¦‚ç¡¬ç›˜æŸåäº†ï¼Œé‚£ä¹ˆäº‹åŠ¡æäº¤çš„æ•°æ®å¯èƒ½å°±ä¸¢å¤±äº†ã€‚è¿™å±äºã€é«˜å¯ç”¨æ€§ã€çš„èŒƒç•´ã€‚å› æ­¤ï¼Œäº‹åŠ¡åªèƒ½ä¿è¯æ•°æ®åº“çš„ã€é«˜å¯é æ€§ã€ï¼Œè€Œã€é«˜å¯ç”¨æ€§ã€éœ€è¦æ•´ä¸ªç³»ç»Ÿå…±åŒé…åˆå®ç°ã€‚\n\nå¯èƒ½å‡ºç°çš„é—®é¢˜æ›´æ–°ä¸¢å¤±å½“æœ‰ä¸¤ä¸ªå¹¶å‘æ‰§è¡Œçš„äº‹åŠ¡ï¼Œæ›´æ–°åŒä¸€è¡Œæ•°æ®ï¼Œé‚£ä¹ˆå…¶ä¸­ä¸€ä¸ªäº‹åŠ¡ä¼šè¦†ç›–å¦å¤–ä¸€ä¸ªäº‹åŠ¡çš„æ•°æ®ã€å½“æ•°æ®åº“æ²¡æœ‰åŠ ä»»ä½•é”æ“ä½œçš„æƒ…å†µä¸‹ä¼šå‘ç”Ÿã€‘è„è¯»ä¸€ä¸ªäº‹åŠ¡è¯»åˆ°å¦å¤–ä¸€ä¸ªæœªæäº¤äº‹åŠ¡çš„æ•°æ®ã€å½“ç¬¬ä¸€ä¸ªäº‹åŠ¡å›æ»šæ—¶å€™ï¼Œç¬¬äºŒä¸ªäº‹åŠ¡æ‹¿ç€å¤±æ•ˆçš„æ•°æ®å»å¤„ç†å°±ä¼šå‡ºç°è„è¯»ã€‘ä¸å¯é‡å¤è¯»ï¼ˆè™šè¯»ï¼Œå¹»è¯»ï¼‰ä¸€ä¸ªäº‹åŠ¡å¯¹åŒä¸€è¡Œæ•°æ®è¯»ä¸¤æ¬¡ï¼Œå´æ‹¿åˆ°äº†ä¸åŒçš„ç»“æœ\n\nè™šè¯»ï¼šäº‹åŠ¡1åœ¨ä¸¤æ¬¡æŸ¥è¯¢çš„è¿‡ç¨‹ä¸­ï¼Œäº‹åŠ¡2è¿›è¡Œäº†ä¸€æ¬¡ä¿®æ”¹ï¼Œå¯¼è‡´äº‹åŠ¡1è¯»åˆ°äº†ä¸ä¸€æ ·çš„è®°å½•\nå¹»è¯»ï¼šäº‹åŠ¡1åœ¨ä¸¤æ¬¡æŸ¥è¯¢çš„è¿‡ç¨‹ä¸­ï¼Œäº‹åŠ¡2è¿›è¡Œäº†æ’å…¥ï¼Œåˆ é™¤æ“ä½œï¼Œå¯¼è‡´äº‹åŠ¡1è¯»å–çš„ç»“æœå‘ç”Ÿäº†å˜åŒ–\n\næ³¨æ„ï¼šè„è¯»æ˜¯å°šæœªæäº¤çš„æ•°æ®ï¼Œä¸å¯é‡å¤è¯»æ˜¯å·²æäº¤çš„æ•°æ®\næ•°æ®åº“çš„å››ç§éš”ç¦»çº§åˆ«è¯»æœªæäº¤ã€Read uncommittedã€‘\nä¸€ä¸ªäº‹åŠ¡å¯¹ä¸€è¡Œæ•°æ®ä¿®æ”¹çš„è¿‡ç¨‹ä¸­ï¼Œä¸å…è®¸å¦å¤–ä¸€ä¸ªäº‹åŠ¡å¯¹è¯¥è¡Œæ•°æ®è¿›è¡Œä¿®æ”¹ï¼Œä½†æ˜¯å…è®¸è¯»å–è¯¥è¡Œæ•°æ®\n\nä¸ä¼šå‡ºç°æ›´æ–°ä¸¢å¤±ï¼Œä½†æ˜¯ä¼šå‡ºç°è„è¯»ï¼Œä¸å¯é‡å¤è¯»\nè¯»å·²æäº¤ã€Read committedã€‘\næœªæäº¤çš„å†™äº‹åŠ¡ä¸å…è®¸å…¶å®ƒäº‹åŠ¡è®¿é—®è¯¥è¡Œï¼Œä½†æ˜¯è¯»å–æ•°æ®çš„äº‹åŠ¡å…è®¸å…¶å®ƒçš„äº‹åŠ¡è¿›è¡Œè®¿é—®è¯¥è¡Œæ•°æ®\n\nä¸ä¼šå‡ºç°è„è¯»ï¼Œä½†æ˜¯ä¼šå‡ºç°ä¸å¯é‡å¤è¯»\né‡å¤è¯»ã€Repeatable readã€‘\nè¯¥çº§åˆ«ç¦æ­¢å†™äº‹åŠ¡ï¼Œä½†æ˜¯å…è®¸è¯»äº‹åŠ¡\n\nä¸ä¼šå‡ºç°ä¸å¯é‡å¤è¯»\nåºåˆ—åŒ–ã€Serializableã€‘\næ‰€æœ‰äº‹åŠ¡éƒ½å¿…é¡»ä¸²è¡Œæ‰§è¡Œ\n\nèƒ½é¿å…ä¸€åˆ‡å› ä¸ºå¹¶å‘å¼•èµ·çš„é—®é¢˜ï¼Œä½†æ˜¯æ•ˆç‡ä½\nå°ç»“éš”ç¦»çº§åˆ«è¶Šé«˜ï¼Œè¶Šèƒ½ä¿è¯æ•°æ®çš„å®Œæ•´æ€§å’Œä¸€è‡´æ€§ï¼Œä½†æ˜¯ï¼Œå¯¹äºå¹¶å‘æ€§èƒ½çš„å½±å“ä¹Ÿè¶Šå¤§å¤§å¤šæ•°æƒ…å†µä¸‹é€‰æ‹©è¯»æäº¤ã€Read committedã€‘ï¼Œå®ƒèƒ½é¿å…è„æ•°æ®ï¼Œå¹¶ä¸”æœ‰è¾ƒå¥½çš„å¹¶å‘æ€§èƒ½ï¼Œè™½ç„¶å®ƒä¼šå¯¼è‡´ä¸å¯é‡å¤è¯»ï¼Œä¸¢å¤±æ›´æ–°çš„å¹¶å‘é—®é¢˜ï¼Œå¯ä»¥é€šè¿‡é‡‡ç”¨æ‚²è§‚é”æˆ–è€…ä¹è§‚é”æ¥æ§åˆ¶\nåˆ†å¸ƒå¼äº‹åŠ¡\nä¸Šé¢çš„äº‹åŠ¡ä»‹ç»çš„æ˜¯æ•°æ®åº“äº‹åŠ¡ï¼Œç›®å‰æ•°æ®åº“åªæ”¯æŒå•åº“äº‹åŠ¡ï¼Œä¸æ”¯æŒè·¨åº“äº‹åŠ¡éšç€å¾®æœåŠ¡æ¶æ„çš„æ™®åŠï¼Œä¸€ä¸ªå¤§å‹çš„ä¸šåŠ¡ç³»ç»Ÿå¾€å¾€æ˜¯å¤šä¸ªæœåŠ¡ç»„æˆï¼Œæ¯ä¸ªæœåŠ¡éƒ½æœ‰è‡ªå·±çš„æ•°æ®åº“ï¼Œç°åœ¨ä¸€æ•´å¥—ä¸šåŠ¡æµç¨‹èµ°ä¸‹å»éœ€è¦å¤šä¸ªæœåŠ¡æ¥å…±åŒå®Œæˆï¼Œè¿™ç§è·¨åº“çš„äº‹åŠ¡æ”¯æŒå°±æ˜¯â€œåˆ†å¸ƒå¼äº‹åŠ¡â€æ¯”è¾ƒå¸¸è§çš„å°±æ˜¯ï¼šå•†å“ç³»ç»Ÿï¼Œè®¢å•ç³»ç»Ÿï¼Œæ”¯ä»˜ç³»ç»Ÿï¼Œç§¯åˆ†ç³»ç»Ÿç­‰ç­‰\n\nCAPç†è®ºï¼ˆå¸ƒé²å°”å®šç†ï¼‰ä¸€è‡´æ€§ã€Consistencyã€‘åŒä¸€æ•°æ®çš„å¤šä¸ªå‰¯æœ¬æ˜¯å¦ç›¸åŒï¼Œæ‰€æœ‰çš„å˜åŒ–éƒ½æ˜¯åŒæ­¥çš„å¯ç”¨æ€§ã€Availabilityã€‘åœ¨å¯ä»¥æ¥å—çš„æ—¶é—´èŒƒå›´å†…æ­£ç¡®çš„å“åº”ç”¨æˆ·è¯·æ±‚ï¼Œè¯·æ±‚ä¸èƒ½æ— é™è¢«é˜»å¡åˆ†åŒºå®¹é”™æ€§ã€Partition toleranceã€‘å½“å‡ºç°ç½‘ç»œåˆ†åŒºåï¼Œç³»ç»Ÿè¿˜æ˜¯èƒ½ç»§ç»­å·¥ä½œï¼Œæ»¡è¶³ä¸€è‡´æ€§å’Œå¯ç”¨æ€§æ³¨æ„ç†Ÿæ‚‰CAPçš„äººéƒ½çŸ¥é“ï¼Œä¸‰è€…ä¸èƒ½å…±å­˜ï¼Œä¸€èˆ¬æ˜¯APæˆ–è€…CP\n\nåœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­ï¼Œç½‘ç»œæ— æ³•100%å¯é ï¼Œåˆ†åŒºå…¶å®æ˜¯ä¸€ä¸ªå¿…ç„¶ç°è±¡å¦‚æœæˆ‘ä»¬é€‰æ‹©äº†CAè€Œæ”¾å¼ƒäº†Pï¼Œé‚£ä¹ˆå½“å‘ç”Ÿåˆ†åŒºç°è±¡æ—¶ï¼Œä¸ºäº†ä¿è¯ä¸€è‡´æ€§ï¼Œè¿™ä¸ªæ—¶å€™å¿…é¡»æ‹’ç»è¯·æ±‚ä½†æ˜¯Aåˆä¸å…è®¸ï¼Œæ‰€ä»¥åˆ†å¸ƒå¼ç³»ç»Ÿç†è®ºä¸Šä¸å¯èƒ½é€‰æ‹©CAæ¶æ„ï¼Œåªèƒ½é€‰æ‹©CPæˆ–è€…APæ¶æ„\n\nCPæ”¾å¼ƒå¯ç”¨æ€§ï¼Œè¿½æ±‚ä¸€è‡´æ€§å’Œåˆ†åŒºå®¹é”™æ€§ï¼Œä¾‹ï¼šZookeeperå°±æ˜¯è¿½æ±‚çš„å¼ºä¸€è‡´æ€§\n\nå•ä¸€èŠ‚ç‚¹ æˆ– å¤šä¸ªèŠ‚ç‚¹å¤„äºç›¸åŒçš„ç½‘ç»œç¯å¢ƒä¸‹ï¼Œé‚£ä¹ˆä¼šå­˜åœ¨ä¸€å®šçš„é£é™©ï¼Œä¸‡ä¸€è¯¥æœºæˆ¿æ–­ç”µã€è¯¥åœ°åŒºå‘ç”Ÿè‡ªç„¶ç¾å®³ï¼Œé‚£ä¹ˆä¸šåŠ¡ç³»ç»Ÿå°±å…¨é¢ç˜«ç—ªäº†ã€‚ä¸ºäº†é˜²æ­¢è¿™ä¸€é—®é¢˜ï¼Œé‡‡ç”¨åˆ†å¸ƒå¼ç³»ç»Ÿï¼Œå°†å¤šä¸ªå­ç³»ç»Ÿåˆ†å¸ƒåœ¨ä¸åŒçš„åœ°åŸŸã€ä¸åŒçš„æœºæˆ¿ä¸­ï¼Œä»è€Œä¿è¯ç³»ç»Ÿé«˜å¯ç”¨æ€§ã€‚\n\nAPæ”¾å¼ƒä¸€è‡´æ€§ã€è¿™é‡Œçš„ä¸€è‡´æ€§æ˜¯å¼ºä¸€è‡´æ€§ã€‘ï¼Œè¿½æ±‚åˆ†åŒºå®¹é”™æ€§å’Œå¯ç”¨æ€§ï¼Œè¿™æ˜¯å¾ˆå¤šåˆ†å¸ƒå¼ç³»ç»Ÿè®¾è®¡æ—¶å€™çš„é€‰æ‹©ï¼Œåé¢çš„BASEç†è®ºä¹Ÿæ˜¯æ ¹æ®APæ‰©å±•\n\nBASEè§£å†³äº†CAPä¸­ç†è®ºæ²¡æœ‰ç½‘ç»œå»¶è¿Ÿï¼Œåœ¨BASEä¸­ç”¨è½¯çŠ¶æ€å’Œæœ€ç»ˆä¸€è‡´ï¼Œä¿è¯äº†å»¶è¿Ÿåçš„ä¸€è‡´æ€§ã€‚BASEå’Œ ACID æ˜¯ç›¸åçš„ï¼Œå®ƒå®Œå…¨ä¸åŒäºACIDçš„å¼ºä¸€è‡´æ€§æ¨¡å‹ï¼Œè€Œæ˜¯é€šè¿‡ç‰ºç‰²å¼ºä¸€è‡´æ€§æ¥è·å¾—å¯ç”¨æ€§ï¼Œå¹¶å…è®¸æ•°æ®åœ¨ä¸€æ®µæ—¶é—´å†…æ˜¯ä¸ä¸€è‡´çš„ï¼Œä½†æœ€ç»ˆè¾¾åˆ°ä¸€è‡´çŠ¶æ€ã€‚\n\nBASEç†è®ºåŸºæœ¬å¯ç”¨ã€Basically Availableã€‘åœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­å‡ºç°æ•…éšœæ—¶ï¼Œå…è®¸æŸå¤±éƒ¨åˆ†åŠŸèƒ½ï¼Œä¿è¯æ ¸å¿ƒåŠŸèƒ½å¯ç”¨ã€æ¯”å¦‚å»¶é•¿å“åº”æ—¶é—´ã€‘è½¯çŠ¶æ€ã€Soft stateã€‘åŒä¸€æ•°æ®çš„ä¸åŒå‰¯æœ¬çš„çŠ¶æ€ï¼Œå¯ä»¥ä¸éœ€è¦å®æ—¶ä¸€è‡´æ€§ã€çŠ¶æ€å¯ä»¥ä¸€æ®µæ—¶é—´ä¸åŒæ­¥ã€‘æœ€ç»ˆä¸€è‡´æ€§ã€Eventually consistentã€‘ç»è¿‡ä¸€æ®µæ—¶é—´åï¼Œæ‰€æœ‰èŠ‚ç‚¹æ•°æ®æœ€åéƒ½ä¼šè¾¾åˆ°ä¸€è‡´ã€ä¸æ˜¯å¼ºä¸€è‡´æ€§ã€‘æ³¨æ„ACIDèƒ½å¤Ÿä¿è¯äº‹åŠ¡çš„å¼ºä¸€è‡´æ€§ï¼Œå³æ•°æ®æ˜¯å®æ—¶ä¸€è‡´çš„ï¼Œåœ¨æœ¬åœ°äº‹åŠ¡ä¸­æ˜¯æ²¡æœ‰é—®é¢˜çš„ï¼Œåœ¨åˆ†å¸ƒå¼äº‹åŠ¡ä¸­ï¼Œå¼ºä¸€è‡´æ€§ä¼šæå¤§å½±å“åˆ†å¸ƒå¼ç³»ç»Ÿçš„æ€§èƒ½ï¼Œå› æ­¤åˆ†å¸ƒå¼ç³»ç»Ÿä¸­éµå¾ªBASEç†è®ºå³å¯ä½†åˆ†å¸ƒå¼ç³»ç»Ÿçš„ä¸åŒä¸šåŠ¡åœºæ™¯å¯¹ä¸€è‡´æ€§çš„è¦æ±‚ä¹Ÿä¸åŒã€‚å¦‚äº¤æ˜“åœºæ™¯ä¸‹ï¼Œå°±è¦æ±‚å¼ºä¸€è‡´æ€§ï¼Œæ­¤æ—¶å°±éœ€è¦éµå¾ªACIDç†è®ºï¼Œè€Œåœ¨æ³¨å†ŒæˆåŠŸåå‘é€çŸ­ä¿¡éªŒè¯ç ç­‰åœºæ™¯ä¸‹ï¼Œå¹¶ä¸éœ€è¦å®æ—¶ä¸€è‡´ï¼Œå› æ­¤éµå¾ªBASEç†è®ºå³å¯ã€‚å› æ­¤è¦æ ¹æ®å…·ä½“ä¸šåŠ¡åœºæ™¯ï¼Œåœ¨ACIDå’ŒBASEä¹‹é—´å¯»æ±‚å¹³è¡¡\nä»€ä¹ˆæ—¶å€™ä½¿ç”¨åˆ†å¸ƒå¼äº‹åŠ¡ä¸€èˆ¬å‡ºç°åˆ†å¸ƒå¼äº‹åŠ¡çš„åŸå› å°±æ˜¯å¾®æœåŠ¡è¿‡å¤š\n\nä¸åŒæœåŠ¡ä¹‹é—´çš„è°ƒç”¨\n\néšç€äº’è”ç½‘å¿«é€Ÿå‘å±•ï¼Œå¾®æœåŠ¡ï¼ŒSOAç­‰æœåŠ¡æ¶æ„æ¨¡å¼æ­£åœ¨è¢«å¤§è§„æ¨¡çš„ä½¿ç”¨ï¼Œä¸¾ä¸ªç®€å•çš„ä¾‹å­ï¼Œä¸€ä¸ªå…¬å¸ä¹‹å†…ï¼Œç”¨æˆ·çš„èµ„äº§å¯èƒ½åˆ†ä¸ºå¥½å¤šä¸ªéƒ¨åˆ†ï¼Œæ¯”å¦‚ä½™é¢ï¼Œç§¯åˆ†ï¼Œä¼˜æƒ åˆ¸ç­‰ç­‰ã€‚åœ¨å…¬å¸å†…éƒ¨æœ‰å¯èƒ½ç§¯åˆ†åŠŸèƒ½ç”±ä¸€ä¸ªå¾®æœåŠ¡å›¢é˜Ÿç»´æŠ¤ï¼Œä¼˜æƒ åˆ¸åˆæ˜¯å¦å¤–çš„å›¢é˜Ÿç»´æŠ¤\n\næ•°æ®åº“ä¸åœ¨åŒä¸€ä¸ªåœ°åŒº\n\næˆ‘ä»¬çš„Mysqlä¸€èˆ¬æ¥è¯´è£…åƒä¸‡çº§çš„æ•°æ®å°±å¾—è¿›è¡Œåˆ†åº“åˆ†è¡¨ï¼Œå¯¹äºä¸€ä¸ªæ”¯ä»˜å®çš„è½¬è´¦ä¸šåŠ¡æ¥è¯´ï¼Œä½ ç»™çš„æœ‹å‹è½¬é’±ï¼Œæœ‰å¯èƒ½ä½ çš„æ•°æ®åº“æ˜¯åœ¨åŒ—äº¬ï¼Œè€Œä½ çš„æœ‹å‹çš„é’±æ˜¯å­˜åœ¨ä¸Šæµ·ï¼Œæ‰€ä»¥æˆ‘ä»¬ä¾ç„¶æ— æ³•ä¿è¯ä»–ä»¬èƒ½åŒæ—¶æˆåŠŸã€‚å› ä¸ºäº‹åŠ¡ä¼šå¢åŠ ç³»ç»Ÿçš„å¤æ‚åº¦ï¼Œå¹¶ä¸”ä¼šå¯¼è‡´å“åº”å˜æ…¢ï¼Œè¿™æ ·çš„æˆæœ¬å®åœ¨æ˜¯å¤ªé«˜äº†ï¼Œä¸è¦å› ä¸ºè¿½æ±‚æŸäº›è®¾è®¡ï¼Œè€Œå¼•å…¥ä¸å¿…è¦çš„æˆæœ¬\nå¸¸è§çš„åˆ†å¸ƒå¼äº‹åŠ¡è§£å†³æ–¹æ¡ˆ2PCã€äºŒæ®µå¼æäº¤ã€‘\n\nç¬¬ä¸€é˜¶æ®µï¼šäº‹åŠ¡ç®¡ç†å™¨é€šçŸ¥æ‰€æœ‰èµ„æºç®¡ç†å™¨è¿›è¡Œé¢„å¤‡ã€prepareã€‘ï¼Œå¦‚æœæ”¶åˆ°å°±ç»ªçŠ¶æ€åˆ™è¿›å…¥ä¸‹ä¸€æ­¥ï¼Œæœ‰ä¸€ä¸ªæœªå°±ç»ªåˆ™å›æ»šç¬¬äºŒé˜¶æ®µï¼šäº‹åŠ¡ç®¡ç†å™¨æ”¶åˆ°æ‰€æœ‰èµ„æºç®¡ç†å™¨éƒ½å‡†å¤‡å®Œæ¯•ï¼Œé€šçŸ¥èµ„æºç®¡ç†å™¨è¿›è¡Œæäº¤æ“ä½œï¼Œå¦‚æœæœ‰ä¸€ä¸ªå¤±è´¥åˆ™è¿›è¡Œå›æ»š\n\nä¼˜ç‚¹ï¼šå°½é‡çš„ä¿è¯äº†æ•°æ®çš„å¼ºä¸€è‡´æ€§ï¼Œå®ç°æˆæœ¬ä½ï¼Œç°åœ¨å„å¤§ä¸»æµæ•°æ®åº“éƒ½æœ‰è‡ªå·±çš„å®ç°ç¼ºç‚¹ï¼š\n\nå•ç‚¹é—®é¢˜ï¼šå¦‚æœåœ¨ç¬¬ä¸€é˜¶æ®µå®Œæˆï¼Œç¬¬äºŒé˜¶æ®µæ­£å‡†å¤‡æäº¤çš„æ—¶å€™å‡ºç°äº‹åŠ¡ç®¡ç†å™¨å®•æœºï¼Œèµ„æºç®¡ç†å™¨å°±ä¼šå­˜åœ¨ä¸€ç›´é˜»å¡çŠ¶æ€ï¼Œå¯¼è‡´æ•°æ®åº“æ— æ³•ä½¿ç”¨ã€éœ€è¦å¤‡æœºè¿›è¡Œå®¹é”™ã€‘\nåŒæ­¥é˜»å¡ï¼šåœ¨å‡†å¤‡å°±ç»ªåï¼Œèµ„æºç®¡ç†å™¨æ˜¯å‡ºäºé˜»å¡çŠ¶æ€ï¼Œå½“æäº¤å®Œæˆæ‰é‡Šæ”¾èµ„æºï¼Œå…¶å®ƒç¬¬ä¸‰æ–¹èŠ‚ç‚¹èŒƒå›´å…¬å…±èµ„æºçš„æ—¶å€™å°±å¾—å¤„äºé˜»å¡ç­‰å¾…çŠ¶æ€\næ•°æ®ä¸ä¸€è‡´ï¼šåœ¨ç¬¬äºŒé˜¶æ®µä¸­ï¼Œå‡è®¾åè°ƒè€…å‘å‡ºäº†äº‹åŠ¡commitçš„é€šçŸ¥ï¼Œä½†æ˜¯å› ä¸ºç½‘ç»œé—®é¢˜è¯¥é€šçŸ¥ä»…è¢«ä¸€éƒ¨åˆ†å‚ä¸è€…æ‰€æ”¶åˆ°å¹¶æ‰§è¡Œäº†commitæ“ä½œï¼Œå…¶ä½™çš„å‚ä¸è€…åˆ™å› ä¸ºæ²¡æœ‰æ”¶åˆ°é€šçŸ¥ä¸€ç›´å¤„äºé˜»å¡çŠ¶æ€ï¼Œè¿™æ—¶å€™å°±äº§ç”Ÿäº†æ•°æ®çš„ä¸ä¸€è‡´æ€§\n\n3PCã€ä¸‰æ®µå¼æäº¤ã€‘\n\nä¸‰æ®µæäº¤ï¼ˆ3PCï¼‰æ˜¯å¯¹ä¸¤æ®µæäº¤ï¼ˆ2PCï¼‰çš„ä¸€ç§å‡çº§ä¼˜åŒ–ï¼Œ3PCåœ¨2PCçš„ç¬¬ä¸€é˜¶æ®µå’Œç¬¬äºŒé˜¶æ®µä¸­æ’å…¥ä¸€ä¸ªå‡†å¤‡é˜¶æ®µã€‚ä¿è¯äº†åœ¨æœ€åæäº¤é˜¶æ®µä¹‹å‰ï¼Œå„å‚ä¸è€…èŠ‚ç‚¹çš„çŠ¶æ€éƒ½ä¸€è‡´ã€‚åŒæ—¶åœ¨åè°ƒè€…å’Œå‚ä¸è€…ä¸­éƒ½å¼•å…¥è¶…æ—¶æœºåˆ¶ï¼Œå½“å‚ä¸è€…å„ç§åŸå› æœªæ”¶åˆ°åè°ƒè€…çš„commitè¯·æ±‚åï¼Œä¼šå¯¹æœ¬åœ°äº‹åŠ¡è¿›è¡Œcommitï¼Œä¸ä¼šä¸€ç›´é˜»å¡ç­‰å¾…ï¼Œè§£å†³äº†2PCçš„å•ç‚¹æ•…éšœé—®é¢˜ï¼Œä½†3PC è¿˜æ˜¯æ²¡èƒ½ä»æ ¹æœ¬ä¸Šè§£å†³æ•°æ®ä¸€è‡´æ€§çš„é—®é¢˜ã€‚\n\n3PC çš„ä¸‰ä¸ªé˜¶æ®µåˆ†åˆ«æ˜¯CanCommitã€PreCommitã€DoCommitCanCommitï¼šåè°ƒè€…å‘æ‰€æœ‰å‚ä¸è€…å‘é€CanCommitå‘½ä»¤ï¼Œè¯¢é—®æ˜¯å¦å¯ä»¥æ‰§è¡Œäº‹åŠ¡æäº¤æ“ä½œã€‚å¦‚æœå…¨éƒ¨å“åº”YESåˆ™è¿›å…¥ä¸‹ä¸€ä¸ªé˜¶æ®µã€‚\n\n3PCçš„CanCommité˜¶æ®µå…¶å®å’Œ2PCçš„å‡†å¤‡é˜¶æ®µå¾ˆåƒã€‚åè°ƒè€…å‘å‚ä¸è€…å‘é€commitè¯·æ±‚ï¼Œå‚ä¸è€…å¦‚æœå¯ä»¥æäº¤å°±è¿”å›Yeså“åº”ï¼Œå¦åˆ™è¿”å›Noå“åº”ã€‚\n\näº‹åŠ¡è¯¢é—® åè°ƒè€…å‘å‚ä¸è€…å‘é€CanCommitè¯·æ±‚ã€‚è¯¢é—®æ˜¯å¦å¯ä»¥æ‰§è¡Œäº‹åŠ¡æäº¤æ“ä½œã€‚ç„¶åå¼€å§‹ç­‰å¾…å‚ä¸è€…çš„å“åº”ã€‚\nå“åº”åé¦ˆ å‚ä¸è€…æ¥åˆ°CanCommitè¯·æ±‚ä¹‹åï¼Œæ­£å¸¸æƒ…å†µä¸‹ï¼Œå¦‚æœå…¶è‡ªèº«è®¤ä¸ºå¯ä»¥é¡ºåˆ©æ‰§è¡Œäº‹åŠ¡ï¼Œåˆ™è¿”å›Yeså“åº”ï¼Œå¹¶è¿›å…¥é¢„å¤‡çŠ¶æ€ã€‚å¦åˆ™åé¦ˆNo\n\n\nPreCommitï¼šåè°ƒè€…å‘æ‰€æœ‰å‚ä¸è€…å‘é€PreCommitå‘½ä»¤ï¼Œè¯¢é—®æ˜¯å¦å¯ä»¥è¿›è¡Œäº‹åŠ¡çš„é¢„æäº¤æ“ä½œï¼Œå‚ä¸è€…æ¥æ”¶åˆ°PreCommitè¯·æ±‚åï¼Œå¦‚å‚ä¸è€…æˆåŠŸçš„æ‰§è¡Œäº†äº‹åŠ¡æ“ä½œï¼Œåˆ™è¿”å›Yeså“åº”ï¼Œè¿›å…¥æœ€ç»ˆcommité˜¶æ®µã€‚ä¸€æ—¦å‚ä¸è€…ä¸­æœ‰å‘åè°ƒè€…å‘é€äº†Noå“åº”ï¼Œæˆ–å› ç½‘ç»œé€ æˆè¶…æ—¶ï¼Œåè°ƒè€…æ²¡æœ‰æ¥åˆ°å‚ä¸è€…çš„å“åº”ï¼Œåè°ƒè€…å‘æ‰€æœ‰å‚ä¸è€…å‘é€abortè¯·æ±‚ï¼Œå‚ä¸è€…æ¥å—abortå‘½ä»¤æ‰§è¡Œäº‹åŠ¡çš„ä¸­æ–­ã€‚\n\nåè°ƒè€…æ ¹æ®å‚ä¸è€…çš„ååº”æƒ…å†µæ¥å†³å®šæ˜¯å¦å¯ä»¥è®°æ€§äº‹åŠ¡çš„PreCommitæ“ä½œã€‚æ ¹æ®å“åº”æƒ…å†µï¼Œæœ‰ä»¥ä¸‹ä¸¤ç§å¯èƒ½ã€‚ å‡å¦‚åè°ƒè€…ä»æ‰€æœ‰çš„å‚ä¸è€…è·å¾—çš„åé¦ˆéƒ½æ˜¯Yeså“åº”ï¼Œé‚£ä¹ˆå°±ä¼šæ‰§è¡Œäº‹åŠ¡çš„é¢„æ‰§è¡Œã€‚\n\nå‘é€é¢„æäº¤è¯·æ±‚ åè°ƒè€…å‘å‚ä¸è€…å‘é€PreCommitè¯·æ±‚ï¼Œå¹¶è¿›å…¥Preparedé˜¶æ®µã€‚\näº‹åŠ¡é¢„æäº¤ å‚ä¸è€…æ¥æ”¶åˆ°PreCommitè¯·æ±‚åï¼Œä¼šæ‰§è¡Œäº‹åŠ¡æ“ä½œï¼Œå¹¶å°†undoå’Œredoä¿¡æ¯è®°å½•åˆ°äº‹åŠ¡æ—¥å¿—ä¸­ã€‚\nå“åº”åé¦ˆ å¦‚æœå‚ä¸è€…æˆåŠŸçš„æ‰§è¡Œäº†äº‹åŠ¡æ“ä½œï¼Œåˆ™è¿”å›ACKå“åº”ï¼ŒåŒæ—¶å¼€å§‹ç­‰å¾…æœ€ç»ˆæŒ‡ä»¤ã€‚\n\n\nå‡å¦‚æœ‰ä»»ä½•ä¸€ä¸ªå‚ä¸è€…å‘åè°ƒè€…å‘é€äº†Noå“åº”ï¼Œæˆ–è€…ç­‰å¾…è¶…æ—¶ä¹‹åï¼Œåè°ƒè€…éƒ½æ²¡æœ‰æ¥åˆ°å‚ä¸è€…çš„å“åº”ï¼Œé‚£ä¹ˆå°±æ‰§è¡Œäº‹åŠ¡çš„ä¸­æ–­ã€‚\n\n\nå‘é€ä¸­æ–­è¯·æ±‚ åè°ƒè€…å‘æ‰€æœ‰å‚ä¸è€…å‘é€abortè¯·æ±‚ã€‚\nä¸­æ–­äº‹åŠ¡ å‚ä¸è€…æ”¶åˆ°æ¥è‡ªåè°ƒè€…çš„abortè¯·æ±‚ä¹‹åï¼ˆæˆ–è¶…æ—¶ä¹‹åï¼Œä»æœªæ”¶åˆ°åè°ƒè€…çš„è¯·æ±‚ï¼‰ï¼Œæ‰§è¡Œäº‹åŠ¡çš„ä¸­æ–­ã€‚\n\n\nDoCommitï¼š åœ¨å‰ä¸¤ä¸ªé˜¶æ®µä¸­æ‰€æœ‰å‚ä¸è€…çš„å“åº”åé¦ˆå‡æ˜¯YESåï¼Œåè°ƒè€…å‘å‚ä¸è€…å‘é€DoCommitå‘½ä»¤æ­£å¼æäº¤äº‹åŠ¡ï¼Œå¦‚åè°ƒè€…æ²¡æœ‰æ¥æ”¶åˆ°å‚ä¸è€…å‘é€çš„ACKå“åº”ï¼Œä¼šå‘æ‰€æœ‰å‚ä¸è€…å‘é€abortè¯·æ±‚å‘½ä»¤ï¼Œæ‰§è¡Œäº‹åŠ¡çš„ä¸­æ–­ã€‚TCCã€äºŒæ®µå¼æäº¤ï¼Œè¡¥å¿å‹ã€‘\n\nTCCã€Try-Confirm-Cancelã€‘åˆè¢«ç§°ä¸ºè¡¥å¿äº‹åŠ¡ï¼ŒTCCä¸2PCçš„æ€æƒ³å¾ˆç›¸ä¼¼ï¼Œäº‹åŠ¡å¤„ç†æµç¨‹ä¹Ÿå¾ˆç›¸ä¼¼ï¼Œä½†æ˜¯2PCåº”ç”¨äºDBå±‚é¢ï¼ŒTCCåˆ™åº”ç”¨äºåº”ç”¨å±‚é¢ï¼Œéœ€è¦ç¼–å†™ä¸šåŠ¡é€»è¾‘æ¥å®ç°å®ƒçš„æ ¸å¿ƒæ€æƒ³ï¼šé’ˆå¯¹æ¯ä¸ªæ“ä½œéƒ½è¦æ³¨å†Œä¸€ä¸ªä¸å…¶å¯¹åº”çš„ç¡®è®¤ï¼ˆtryï¼‰å’Œè¡¥å¿ï¼ˆcancelï¼‰\n\nTryé˜¶æ®µï¼šå°è¯•æ‰§è¡Œï¼Œå®Œæˆæ‰€æœ‰çš„ä¸šåŠ¡æ£€æŸ¥ï¼ˆä¸€è‡´æ€§ï¼‰ï¼Œé¢„ç•™å¿…é¡»ä¸šåŠ¡èµ„æºï¼ˆå‡†éš”ç¦»æ€§ï¼‰Confirmé˜¶æ®µï¼šç¡®è®¤æ‰§è¡Œä¸šåŠ¡ï¼Œä¸åšä»»ä½•ä¸šåŠ¡æ£€æŸ¥ï¼Œåªä½¿ç”¨tryé˜¶æ®µé¢„ç•™çš„ä¸šåŠ¡èµ„æºï¼ŒConfirmé˜¶æ®µéœ€è¦æ»¡è¶³å¹‚ç­‰æ€§è¦æ±‚å¹‚ç­‰è®¾è®¡ï¼Œå¤±è´¥åè¿›è¡Œé‡è¯•æˆ–è€…å…¶å®ƒå¤„ç†Cancelé˜¶æ®µï¼šå–æ¶ˆæ‰§è¡Œï¼Œé‡Šæ”¾tryé˜¶æ®µé¢„ç•™çš„ä¸šåŠ¡èµ„æºï¼Œå¹¶è¿›è¡Œå›æ»šå°ç»“ï¼š\n\nè§£å†³äº†åè°ƒè€…å•ç‚¹é—®é¢˜ï¼Œç”±ä¸»ä¸šåŠ¡æ–¹å‘èµ·å¹¶ä¸”å®Œæˆè¿™ä¸ªä¸šåŠ¡\nè§£å†³åŒæ­¥é˜»å¡é—®é¢˜ï¼Œå¯ä»¥å¼•å…¥è¶…æ—¶ï¼Œè¶…æ—¶åè¿›è¡Œè¡¥å¿ï¼Œè¿™æ ·ä¸ä¼šé”å®šæ•´ä¸ªèµ„æºï¼Œå°†èµ„æºè½¬ä¸ºä¸šåŠ¡é€»è¾‘å½¢å¼ï¼Œç²’åº¦å˜å°\næ•°æ®ä¸€è‡´æ€§é—®é¢˜ï¼Œæœ‰äº†è¡¥å¿æœºåˆ¶ï¼Œä¸šåŠ¡å±‚å¯ä»¥æ§åˆ¶ä¸€è‡´æ€§\n\nç¼ºç‚¹æ˜¯åº”ç”¨ä¾µå…¥æ€§å¼ºï¼Œæ¯ä¸ªæ“ä½œéƒ½éœ€è¦try-confirm-cancelï¼Œå…¶æ¬¡å¼€å‘éš¾åº¦å¤§ï¼Œä»£ç é‡å¤šï¼Œéœ€è¦ä¿è¯å¹‚ç­‰æ€§å’Œæ•°æ®ä¸€è‡´æ€§ã€å¯¹äºç¨‹åºå‘˜æ°´å¹³è¦æ±‚è¾ƒé«˜ã€‘\nMQäº‹åŠ¡æœ¬åœ°æ¶ˆæ¯è¡¨ï¼šå°†éœ€è¦åˆ†å¸ƒå¼å¤„ç†çš„ä»»åŠ¡é€šè¿‡æ¶ˆæ¯æ—¥å¿—çš„æ–¹å¼è¿›è¡Œå¼‚æ­¥æ‰§è¡Œã€‚æ¶ˆæ¯æ—¥å¿—å¯ä»¥å­˜å‚¨åˆ°æœ¬åœ°æ–‡æœ¬ï¼Œæ•°æ®åº“æˆ–è€…æ¶ˆæ¯é˜Ÿåˆ—ï¼Œå†é€šè¿‡ä¸šåŠ¡è§„åˆ™è‡ªåŠ¨æˆ–è€…äººå·¥å‘èµ·é‡è¯•æœ¬åœ°æ¶ˆæ¯è¡¨å¯¹åº”çš„æ˜¯BASEç†è®ºï¼Œè¿½æ±‚çš„æ˜¯æœ€ç»ˆä¸€è‡´æ€§ï¼Œé€‚ç”¨äºå¯¹ä¸€è‡´æ€§è¦æ±‚ä¸é«˜çš„MQäº‹åŠ¡å°±æ˜¯æœ¬åœ°æ¶ˆæ¯è¡¨çš„å‡çº§ç‰ˆä¸­é—´å¦‚æœå­˜åœ¨æ¶ˆæ¯ç¡®è®¤å¤±è´¥æˆ–è€…æ²¡æœ‰ç¡®è®¤çš„æƒ…å†µï¼Œä¼šè¿›è¡Œä¸€ä¸ªé‡è¯•æœºåˆ¶ï¼Œéœ€è¦ä¿è¯å¹‚ç­‰\nä¸­é—´ä»¶æ¨èSeata æ˜¯ä¸€æ¬¾å¼€æºçš„åˆ†å¸ƒå¼äº‹åŠ¡è§£å†³æ–¹æ¡ˆï¼Œè‡´åŠ›äºæä¾›é«˜æ€§èƒ½å’Œç®€å•æ˜“ç”¨çš„åˆ†å¸ƒå¼äº‹åŠ¡æœåŠ¡ã€‚Seata å°†ä¸ºç”¨æˆ·æä¾›äº† ATã€TCCã€SAGA å’Œ XA äº‹åŠ¡æ¨¡å¼ï¼Œä¸ºç”¨æˆ·æ‰“é€ ä¸€ç«™å¼çš„åˆ†å¸ƒå¼è§£å†³æ–¹æ¡ˆã€‚ATæ¨¡å¼æ˜¯é˜¿é‡Œé¦–æ¨çš„æ¨¡å¼,é˜¿é‡Œäº‘ä¸Šæœ‰å•†ç”¨ç‰ˆæœ¬çš„GTS(Global Transaction Service å…¨å±€äº‹åŠ¡æœåŠ¡)å®˜ç½‘:seata.io/zh-cn/indexâ€¦æºç : github.com/seata/seataå®˜æ–¹Demo: github.com/seata/seataâ€¦\né˜²æ­¢é»„ç‰›\né»„ç‰›ä¸ºä»€ä¹ˆéš¾é˜²\n\næ¨¡æ‹Ÿå™¨ä½œå¼Šï¼šæ¨¡æ‹Ÿç¡¬ä»¶è®¾å¤‡ï¼Œå¯ä»¥ä¿®æ”¹è®¾å¤‡ä¿¡æ¯\nè®¾å¤‡ç‰§åœºä½œå¼Šï¼šå·¥ä½œå®¤é‡Œé¢ä¸€å¤§æ‰¹ç§»åŠ¨è®¾å¤‡åŒæ—¶æŠ¢\näººå·¥ä½œå¼Šï¼šé ä½£é‡‘å¸å¼•å…¼èŒäººå‘˜åˆ·å•\n\n\nè§£å†³æ–¹æ¡ˆï¼š\n\néªŒè¯ç ï¼ŒéªŒè¯ç ç¬¦åˆ91åŸåˆ™ï¼Œ90%æ—¶é—´éƒ½ç”¨åœ¨éªŒè¯ç è¾“å…¥ä¸Šï¼Œå¦‚æœä½¿ç”¨è‡ªåŠ¨åŒ–å·¥å…·ä¼šé™ä½å½±å“\nä»£ç æ··æ·†ï¼Œurléšè—ï¼Œé˜²æ­¢é»„ç‰›é€šè¿‡æå‰è§£æjsæ¥æ‰¾åˆ°åç«¯æ¥å£\nipé»‘åå•ï¼Œå¯¹äºåŒä¸€ä¸ªipè¯·æ±‚é¢‘ç‡è¿‡å¤šçš„ç›´æ¥æ‹‰é»‘ï¼Œæˆ–è€…å¼•å…¥é»„ç‰›ä¸“ç”¨ç§’æ€é€šé“ï¼ˆç°åœ¨ç§’æ€ï¼Œæœ‰å¾ˆå¤šå¯ä»¥é€šè¿‡é¢‘ç‡æ¥åŒºåˆ†é»„ç‰›è¿˜æ˜¯çœŸäººï¼Œç„¶åè´Ÿè½½åˆ°ä¸åŒçš„æœåŠ¡å™¨ï¼Œè®©é»„ç‰›å’Œé»„ç‰›æŠ¢ï¼ŒçœŸäººå’ŒçœŸäººæŠ¢ï¼Œåªæ˜¯é»„ç‰›çš„é€šé“é‡Œé¢ç§’æ€çš„æ•°é‡å°‘äºçœŸäººæ•°é‡ï¼‰\né™è´­ï¼Œæ¯ä¸ªç”¨æˆ·åªèƒ½è´­ä¹°ä¸€å°ã€é‡åˆ°ç‰§åœºä½œå¼Šçš„å¯èƒ½é˜²ä¸ä½ï¼Œä½†æ˜¯åŒç½‘ç»œçš„æƒ…å†µå¯ä»¥é˜²ã€‘\né£æ§ç³»ç»Ÿï¼Œç»™æ¯ä¸ªç”¨æˆ·åšä¸€ä¸ªç”¨æˆ·ç”»åƒï¼Œæ‰“ä¸€ä¸ªå¯ç–‘åº¦åˆ†æ•°ï¼Œæ¥è¿›è¡Œä¸åŒè´Ÿè½½åŒºåˆ†ä»¥åŠé™æµç§’æ€æ—¶åºå›¾ç§’æ€æµç¨‹å›¾ç§’æ€æ¶æ„å¾®æœåŠ¡æ¶æ„ã€å‚è€ƒç”¨ã€‘å‚è€ƒ\n\nhttps://cloud.tencent.com/developer/article/1762003\nhttps://blog.51cto.com/u_8238263/6020353#:~:text=ä½¿ç”¨%E2%80%8B%20%E2%80%8BToken%E2%80%8B%20%E2%80%8B%E2%80%8Bæœºåˆ¶ï¼Œæˆ–ä½¿ç”¨%E2%80%8B%20%E2%80%8BToken%E2%80%8B%20%E2%80%8B%20%2B%20åˆ†å¸ƒå¼é”çš„æ–¹æ¡ˆæ¥è§£å†³å¹‚ç­‰æ€§é—®é¢˜%E3%80%82,4-å¹‚ç­‰æ€§è§£å†³æ–¹æ¡ˆå®ç°æ€è·¯%204-1-%20Tokenæœºåˆ¶å®ç°%20é€šè¿‡%E2%80%8B%20%E2%80%8BToken%E2%80%8B%20%E2%80%8B%20æœºåˆ¶å®ç°æ¥å£çš„å¹‚ç­‰æ€§ï¼Œè¿™æ˜¯ä¸€ç§æ¯”è¾ƒé€šç”¨æ€§çš„å®ç°æ–¹æ³•%E3%80%82\nhttps://blog.csdn.net/a419240016/article/details/117236135\nhttps://blog.csdn.net/wyouwd1/article/details/125705646\nhttps://blog.csdn.net/qq_65567681/article/details/127712631\nhttps://blog.csdn.net/weixin_35835508/article/details/112668412\nhttps://www.cnblogs.com/hanease/p/15863393.html\nhttps://juejin.cn/post/7112466891335008270\nhttps://juejin.cn/post/6998416509026435108\nhttps://blog.csdn.net/qq1309664161/article/details/118650154\nhttps://juejin.cn/post/7126188464713760776#heading-7\nhttps://juejin.cn/post/6862875289786662926\nhttps://juejin.cn/post/6844903933182214151#heading-3\nhttps://juejin.cn/post/6844903843516383245\nhttps://juejin.cn/post/6844904087390011405#heading-5\nhttps://juejin.cn/post/6844903573667446797#heading-13\nhttps://juejin.cn/post/6844903647197806605#heading-15\nhttps://juejin.cn/post/6899645923024355336#heading-1\nhttps://juejin.cn/post/6844904176430874632\nhttps://juejin.cn/post/6992767837702111269\nhttps://juejin.cn/post/7044032901662375949#heading-10\n","tags":["ä¸­é—´ä»¶","åœºæ™¯"]},{"title":"è§„åˆ™æšä¸¾","url":"/2023/06/06/0.4.2-%E8%A7%84%E5%88%99%E6%9E%9A%E4%B8%BE/","content":"è§„åˆ™æšä¸¾ä¸€äº›ç®€å•çš„çŒœæƒ³å®ç°ï¼Œç”¨æ¥å»é™¤ifelseæˆ–è€…switchï¼Œè™½ç„¶åœ¨jdk17ä¸­å·²ç»å¼•å…¥äº†æ–°çš„switchè¯­æ³•ï¼Œä½†æ˜¯è¿˜æ˜¯æƒ³åšä¸€äº›å°è¯•\npackage com.tthk.inland.ticket.core.enums.czloworder;import lombok.AllArgsConstructor;import lombok.Getter;import java.util.Arrays;/** * @author Foam * @Description æšä¸¾ * @date 2023/5/4 17:12 */@Getter@AllArgsConstructorpublic enum LowOrderEnums &#123;    UNLIMITED(&quot;æšä¸¾1&quot;)&#123;        @Override        public boolean check(Integer id) &#123;            return id&lt;1;        &#125;    &#125;,    ENUM2(&quot;æšä¸¾2&quot;)&#123;        @Override        public boolean check(Integer id) &#123;            return id &gt;= 1 &amp;&amp; id &lt; 3;        &#125;    &#125;,    ENUM3(&quot;æšä¸¾3&quot;)&#123;        @Override        public boolean check(Integer id) &#123;            return id &gt; 3;        &#125;    &#125;;    private String name;    public abstract boolean check(Integer id);    public static String getEnums(Integer id)&#123;        return Arrays.stream(LowOrderEnums.values()).filter(x -&gt; x.check(id)).findFirst().map(LowOrderEnums::getName).orElse(id+&quot;&quot;);    &#125;    public static void main(String[] args) &#123;        System.out.println(getEnums(1));        System.out.println(getEnums(2));        System.out.println(getEnums(3));        System.out.println(getEnums(4));    &#125;&#125;\npackage com.tthk.inland.ticket.core.enums.czloworder;import lombok.AllArgsConstructor;import lombok.Getter;import java.util.Arrays;import java.util.function.Predicate;/** * @author Foam * @Description æšä¸¾ * @date 2023/5/4 17:12 */@Getter@AllArgsConstructorpublic enum LowOrderEnums &#123;    UNLIMITED(x -&gt; x &lt; 1,&quot;æšä¸¾1&quot;),    ENUM2(x -&gt; x &gt;= 1 &amp;&amp; x &lt; 3,&quot;æšä¸¾2&quot;),    ENUM3(x -&gt; x &gt; 3,&quot;æšä¸¾3&quot;);    private Predicate&lt;Integer&gt; accumulator;    private String name;    public static String getEnums(Integer id)&#123;        return Arrays.stream(LowOrderEnums.values()).filter(x -&gt; x.getAccumulator().test(id)).findFirst().map(LowOrderEnums::getName).orElse(&quot;æ²¡åŒ¹é…åˆ°&quot;);    &#125;    public static void main(String[] args) &#123;        System.out.println(getEnums(1));        System.out.println(getEnums(2));        System.out.println(getEnums(3));        System.out.println(getEnums(4));    &#125;&#125;\n","tags":["å·¥å…·ç±»","æšä¸¾"]},{"title":"å®šä¹‰eitherç±»","url":"/2023/06/06/0.4.3-%E5%AE%9A%E4%B9%89either%E7%B1%BB/","content":"å®šä¹‰eitherç±»\nåœ¨æˆ‘ä»¬æ—¥å¸¸å¼€å‘ä¸­ï¼Œstreamæµé‡Œé¢å¦‚æœå‡ºç°äº†å¼‚å¸¸æ˜¯æ²¡æ³•ç›´æ¥æŠ›å‡ºçš„ï¼Œéœ€è¦è¿›è¡Œtry-catchè¿›è¡Œæ•è·ç„¶åè¿›è¡Œå¤„ç†ï¼Œæˆ–è€…å¹²è„†ç›´æ¥æŠ›å‡ºå¼‚å¸¸åœæ­¢\n\nè¿™ä¸ªæ—¶å€™æˆ‘ä»¬éœ€è¦ä¸€ä¸ªeitherå·¥å…·ç±»ï¼ŒåŒºåˆ†æˆåŠŸå’Œå¤±è´¥çš„æ‰§è¡Œç»“æœï¼Œå¹¶ä¸”å•ç‹¬å¯¹å¤±è´¥çš„è¿™äº›ç»“æœè¿›è¡Œå¤„ç†ï¼Œä»¥ä¸‹æ˜¯ä¸€äº›ç®€å•çš„å®ç°\npackage com.tthk.inland.ticket.core.utils.stream;import java.util.List;import java.util.Random;import java.util.stream.Collectors;import java.util.stream.Stream;/** * @Description eitherç±» * @date 2023/4/20_15:05 * @author Foam */public class Either&lt;L, R&gt; &#123;    public static void main(String[] args) &#123;        List&lt;EitherUtil&lt;String,String&gt;&gt; collect = Stream.iterate(1, i -&gt; i + 1).limit(100).map(Either::readline).collect(Collectors.toList());        EitherUtil&lt;String, List&lt;String&gt;&gt; sequence = EitherUtil.sequence(collect, (s1, s2) -&gt; s1 + s2);        if(sequence.isLeft())&#123;            System.out.println(sequence.getLeft());        &#125;else&#123;            List&lt;String&gt; right = sequence.getRight();            for (String s : right) &#123;                System.out.println(s);            &#125;        &#125;    &#125;    public static EitherUtil&lt;String,String&gt; readline(int i)&#123;        if((new Random().nextInt() %2) &gt;= 0)&#123;            return EitherUtil.right(&quot;æˆåŠŸ&quot;);        &#125;else &#123;            return EitherUtil.left(&quot;é”™è¯¯&quot;);        &#125;    &#125;&#125;\npackage com.tthk.inland.ticket.core.utils.stream;import lombok.AllArgsConstructor;import lombok.Data;import lombok.NoArgsConstructor;import java.util.List;import java.util.function.BinaryOperator;import java.util.function.Function;import java.util.stream.Collectors;/** * @Description eitherå·¥å…·ç±» * @date 2023/4/20_15:12 * @author Foam */@Data@AllArgsConstructor@NoArgsConstructorpublic class EitherUtil&lt;L,R&gt; &#123;    /**     * @Description å¼‚å¸¸æ•°æ®     * @date 2023/4/20     **/    private L left;    /**     * @Description æ­£å¸¸æ•°æ®     * @date 2023/4/20     **/    private R right;    public boolean isLeft()&#123;        return left != null;    &#125;    public boolean isRight()&#123;        return right != null;    &#125;    /**     * @Description å·¥å‚æ–¹æ³• - å·¦å€¼     * @date 2023/4/20     **/    public static &lt;L,R&gt; EitherUtil&lt;L,R&gt; left(L exception)&#123;        EitherUtil&lt;L,R&gt; e = new EitherUtil&lt;L,R&gt;();        e.left = exception;        return e;    &#125;    /**     * @Description å·¥å‚æ–¹æ³• - å³å€¼     * @date 2023/4/20     **/    public static &lt;L,R&gt; EitherUtil&lt;L,R&gt; right(R value)&#123;        EitherUtil&lt;L,R&gt; e = new EitherUtil&lt;L,R&gt;();        e.right = value;        return e;    &#125;    /**     * @Description mapæ–¹æ³•ï¼Œå¦‚æœæ˜¯å¼‚å¸¸å€¼ï¼Œè¿›è¡Œä¿å­˜ï¼Œå¦‚æœæ˜¯æ­£å¸¸å€¼ï¼Œè¿›è¡Œå‡½æ•°æ˜ å°„     * @date 2023/4/20     **/    public &lt;T&gt; EitherUtil&lt;L,T&gt; map(Function&lt;R,T&gt; function)&#123;        if(isLeft())&#123;            return left(left);        &#125;else &#123;            return right(function.apply(right));        &#125;    &#125;    /**     * @Description å°†eitherçš„listè½¬æ¢æˆä¸€ä¸ªeitherå¯¹è±¡ï¼Œé‡Œé¢åˆ†åˆ«è£…æ­£å¸¸å€¼å’Œå¼‚å¸¸å€¼     * @date 2023/4/20     **/    public static &lt;L,R&gt; EitherUtil&lt;L, List&lt;R&gt;&gt; sequence(List&lt;EitherUtil&lt;L,R&gt;&gt; eitherList, BinaryOperator&lt;L&gt; accumulator)&#123;        if(eitherList.stream().allMatch(EitherUtil::isRight))&#123;            // å°†æ‰€æœ‰æ•°æ®å­˜å…¥            return right(eitherList.stream().map(EitherUtil::getRight).collect(Collectors.toList()));        &#125;else &#123;            // ç»“åˆéœ€æ±‚ï¼Œç¡®å®šæ˜¯å–ç¬¬ä¸€ä¸ªå¼‚å¸¸è¿˜æ˜¯å–å…¨éƒ¨å¼‚å¸¸            // 1.å–ç¬¬ä¸€ä¸ªå¼‚å¸¸//            return left(eitherList.stream().filter(EitherUtil::isLeft).findFirst().orElseThrow().getLeft());            // 2.å–å…¨éƒ¨å¼‚å¸¸            return left(eitherList.stream().filter(EitherUtil::isLeft).map(EitherUtil::getLeft).reduce(accumulator).orElseThrow());        &#125;    &#125;    /**     * @Description è·å–æ‰€æœ‰çš„å¼‚å¸¸æ•°æ®     * @date 2023/4/20     **/    public static &lt;L,R&gt; EitherUtil&lt;L, List&lt;R&gt;&gt; sequenceLift(List&lt;EitherUtil&lt;L,R&gt;&gt; eitherList, BinaryOperator&lt;L&gt; accumulator)&#123;        return left(eitherList.stream().filter(EitherUtil::isLeft).map(EitherUtil::getLeft).reduce(accumulator).orElseThrow());    &#125;&#125;\n","tags":["å·¥å…·ç±»"]},{"title":"ç½‘é¡µæ·»åŠ L2DçŒ«","url":"/2022/07/30/0.3.0-%E7%BD%91%E9%A1%B5%E6%B7%BB%E5%8A%A0L2D%E7%8C%AB/","content":"&lt;!DOCTYPE html&gt;&lt;!-- saved from url=(0047)https://www.cnblogs.com/icemomo/p/16004713.html --&gt;&lt;html lang=&quot;zh-cn&quot; style=&quot;--olcb-folder-code-block-max-height:80vh;&quot; class=&quot;windows desktop landscape&quot; mode=&quot;light&quot; theme=&quot;a&quot;&gt;&lt;head&gt;&lt;meta http-equiv=&quot;Content-Type&quot; content=&quot;text/html; charset=UTF-8&quot;&gt;    &lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1.0&quot;&gt;    &lt;meta name=&quot;referrer&quot; content=&quot;origin-when-cross-origin&quot;&gt;    &lt;meta http-equiv=&quot;Cache-Control&quot; content=&quot;no-transform&quot;&gt;    &lt;meta http-equiv=&quot;Cache-Control&quot; content=&quot;no-siteapp&quot;&gt;    &lt;meta http-equiv=&quot;X-UA-Compatible&quot; content=&quot;IE=edge&quot;&gt;&lt;style type=&quot;text/css&quot;&gt;.heart&#123;width: 10px;height: 10px;position: fixed;background: #f00;transform: rotate(45deg);-webkit-transform: rotate(45deg);-moz-transform: rotate(45deg);&#125;.heart:after,.heart:before&#123;content: &#x27;&#x27;;width: inherit;height: inherit;background: inherit;border-radius: 50%;-webkit-border-radius: 50%;-moz-border-radius: 50%;position: absolute;&#125;.heart:after&#123;top: -5px;&#125;.heart:before&#123;left: -5px;&#125;&lt;/style&gt;&lt;meta http-equiv=&quot;origin-trial&quot; content=&quot;AzoawhTRDevLR66Y6MROu167EDncFPBvcKOaQispTo9ouEt5LvcBjnRFqiAByRT+2cDHG1Yj4dXwpLeIhc98/gIAAACFeyJvcmlnaW4iOiJodHRwczovL2RvdWJsZWNsaWNrLm5ldDo0NDMiLCJmZWF0dXJlIjoiUHJpdmFjeVNhbmRib3hBZHNBUElzIiwiZXhwaXJ5IjoxNjYxMjk5MTk5LCJpc1N1YmRvbWFpbiI6dHJ1ZSwiaXNUaGlyZFBhcnR5Ijp0cnVlfQ==&quot;&gt;&lt;meta http-equiv=&quot;origin-trial&quot; content=&quot;A6+nc62kbJgC46ypOwRsNW6RkDn2x7tgRh0wp7jb3DtFF7oEhu1hhm4rdZHZ6zXvnKZLlYcBlQUImC4d3kKihAcAAACLeyJvcmlnaW4iOiJodHRwczovL2dvb2dsZXN5bmRpY2F0aW9uLmNvbTo0NDMiLCJmZWF0dXJlIjoiUHJpdmFjeVNhbmRib3hBZHNBUElzIiwiZXhwaXJ5IjoxNjYxMjk5MTk5LCJpc1N1YmRvbWFpbiI6dHJ1ZSwiaXNUaGlyZFBhcnR5Ijp0cnVlfQ==&quot;&gt;&lt;meta http-equiv=&quot;origin-trial&quot; content=&quot;A/9La288e7MDEU2ifusFnMg1C2Ij6uoa/Z/ylwJIXSsWfK37oESIPbxbt4IU86OGqDEPnNVruUiMjfKo65H/CQwAAACLeyJvcmlnaW4iOiJodHRwczovL2dvb2dsZXRhZ3NlcnZpY2VzLmNvbTo0NDMiLCJmZWF0dXJlIjoiUHJpdmFjeVNhbmRib3hBZHNBUElzIiwiZXhwaXJ5IjoxNjYxMjk5MTk5LCJpc1N1YmRvbWFpbiI6dHJ1ZSwiaXNUaGlyZFBhcnR5Ijp0cnVlfQ==&quot;&gt;&lt;script src=&quot;./Javaè¯»å–é…ç½®æ–‡ä»¶çš„å‡ ç§æ–¹å¼ - å†°è«è« - åšå®¢å›­_files/pubads_impl_2022071401.js.ä¸‹è½½&quot; async=&quot;&quot;&gt;&lt;/script&gt;&lt;script src=&quot;./Javaè¯»å–é…ç½®æ–‡ä»¶çš„å‡ ç§æ–¹å¼ - å†°è«è« - åšå®¢å›­_files/L2Dwidget.min.js.ä¸‹è½½&quot;&gt;&lt;/script&gt;&lt;style&gt;  .live2d-widget-dialog-container &#123;    width: 300px;    height: 120px;    position: absolute;    bottom: 65%;    right: 0px;    transform-origin: right;    padding: 12px;    box-sizing: border-box;    -webkit-font-smoothing: antialiased;  &#125;  .live2d-widget-dialog &#123;    width: 100%;    height: 100%;    color: #917159;    font-size: 16px;    padding: 12px;    border: 2px solid rgb(236, 203, 180);    background: rgba(236, 203, 180, 0.14);    box-sizing: border-box;    border-radius: 10px;    transform: rotate(-2deg);    opacity: 0;    transition: 200ms opacity;    box-shadow: rgba(0, 0, 0, 0.12) 0px 1px 6px, rgba(0, 0, 0, 0.12) 0px 1px 4px;    animation: live2d-widget-dialog-tingle 4s ease-in-out 0s infinite alternate;  &#125;  @keyframes live2d-widget-dialog-tingle &#123;    0% &#123; transform: translate(-1px, 1.5px) rotate(-2deg); &#125;    100% &#123; transform: translate(1px, -1.5px) rotate(2deg); &#125;  &#125;&lt;/style&gt;&lt;script type=&quot;text/javascript&quot; charset=&quot;utf-8&quot; async=&quot;&quot; src=&quot;./Javaè¯»å–é…ç½®æ–‡ä»¶çš„å‡ ç§æ–¹å¼ - å†°è«è« - åšå®¢å›­_files/L2Dwidget.0.min.js.ä¸‹è½½&quot;&gt;&lt;/script&gt;&lt;body class=&quot;skin-custom no-navbar hljs-engine&quot;&gt;&lt;script type=&quot;text/javascript&quot;&gt;   L2Dwidget.init(     ã€€&#123;ã€€&quot;model&quot;: &#123; ã€€ã€€ã€€ã€€jsonPath: &quot;https://unpkg.com/live2d-widget-model-hijiki@1.0.5/assets/hijiki.model.json&quot;,//è¿™æ˜¯æ’ä»¶æ¨¡å‹ï¼Œå¯ä»¥ä»»æ„é€‰æ‹©æƒ³è¦æ·»åŠ çš„2dåŠ¨ç”»ã€€ã€€ã€€ã€€&quot;scale&quot;: 1 ã€€ã€€&#125;&#125;,         &#123;      &quot;display&quot;: &#123;        &quot;superSample&quot;: 2,        &quot;width&quot;: 200,//å®½åº¦        &quot;height&quot;: 400,//é«˜åº¦        &quot;position&quot;: &quot;left&quot;,//ä½ç½®ï¼Œright,left                &quot;hOffset&quot;: 0,        &quot;vOffset&quot;: 0      &#125;   &#125;);  window.$silence = &#123;          defaultTheme: &#x27;c&#x27;,      navbars: [        &#123;        title: &#x27;é¦–é¡µ&#x27;,        url: &#x27;https://www.cnblogs.com/icemomo&#x27;    &#125;,        &#123;        title: &#x27;æ ‡ç­¾&#x27;,        url: &#x27;https://www.cnblogs.com/icemomo/tag/&#x27;    &#125;],    favicon:&#x27;https://blog-static.cnblogs.com/files/blogs/740138/anido-geh1u-001.ico?t=1646927784&#x27;,     defaultMode: &#x27;auto&#x27;,    hljsln: true,        catalog: &#123;        enable: true,        index: true,        active: false,        levels: [&#x27;h2&#x27;, &#x27;h3&#x27;, &#x27;h4&#x27;]    &#125;,    avatar:&#x27;https://s1.ax1x.com/2022/03/10/b5p0e0.jpg&#x27;,    enable:true,      signature: &#123;        enable: true,        author: null,        license: [&#x27;ç½²å-éå•†ä¸šæ€§ä½¿ç”¨-ç›¸åŒæ–¹å¼å…±äº« 4.0 å›½é™…&#x27;, &#x27;https://creativecommons.org/licenses/by-nc-sa/4.0/&#x27;],        remark: &#x27;è½¬è½½è¯·æ³¨æ˜å‡ºå¤„&#x27;,    &#125;,    github: &#x27;https://github.com/icemomo-hgy&#x27;,     sponsor: &#123;        enable: false,        text: &#x27;&#x27;,        wechat: &#x27;https://s1.ax1x.com/2022/03/10/b5StDx.jpg&#x27;,        alipay:  &#x27;https://images.cnblogs.com/cnblogs_com/blogs/740138/galleries/2122692/o_220311012057_d8cb988f0f3669b0e9d18b910d05514.jpg&#x27;    &#125;&#125;&lt;/script&gt;&lt;/body&gt;&lt;/html&gt;\n\n/*! https://github.com/xiazeyu/live2d-widget.js built@2019-4-2 16:24:00 */webpackJsonpL2Dwidget([0],&#123;79:function(t,e,i)&#123;&quot;use strict&quot;;Object.defineProperty(e,&quot;__esModule&quot;,&#123;value:!0&#125;),e.captureFrame=e.theRealInit=void 0;var r,o=i(26),n=i(83),s=i(80),_=i(81),a=i(86),h=i(84),l=i(82),$=i(39),u=(r=$)&amp;&amp;r.__esModule?r:&#123;default:r&#125;;var p=null,c=void 0,f=!1,g=null,y=null,d=null,m=null,T=!1,P=.5,S=null;function v(t,e,i)&#123;if(e.x&lt;i.left+i.width&amp;&amp;e.y&lt;i.top+i.height&amp;&amp;e.x&gt;i.left&amp;&amp;e.y&gt;i.top)return e;var r=t.x-e.x,o=t.y-e.y;function n(t,e)&#123;return 180*Math.acos((i=&#123;x:0,y:1&#125;,o=t,n=e,s=Math.sqrt(o*o+n*n),r=&#123;x:o/s,y:n/s&#125;,i.x*r.x+i.y*r.y))/Math.PI;var i,r,o,n,s&#125;var s=n(r,o);e.x&lt;t.x&amp;&amp;(s=360-s);var _=360-n(i.left-t.x,-1*(i.top-t.y)),a=360-n(i.left-t.x,-1*(i.top+i.height-t.y)),h=n(i.left+i.width-t.x,-1*(i.top-t.y)),l=n(i.left+i.width-t.x,-1*(i.top+i.height-t.y)),$=o/r,u=&#123;&#125;;if(s&lt;h)&#123;var p=i.top-t.y,c=p/$;u=&#123;y:t.y+p,x:t.x+c&#125;&#125;else if(s&lt;l)&#123;var f=i.left+i.width-t.x,g=f*$;u=&#123;y:t.y+g,x:t.x+f&#125;&#125;else if(s&lt;a)&#123;var y=i.top+i.height-t.y,d=y/$;u=&#123;y:t.y+y,x:t.x+d&#125;&#125;else if(s&lt;_)&#123;var m=t.x-i.left,T=m*$;u=&#123;y:t.y-T,x:t.x-m&#125;&#125;else&#123;var P=i.top-t.y,S=P/$;u=&#123;y:t.y+P,x:t.x+S&#125;&#125;return u&#125;function L(t)&#123;T=!0;var e=n.currCanvas.getBoundingClientRect(),i=w(t.clientX-e.left),r=D(t.clientY-e.top),o=v(&#123;x:e.left+e.width/2,y:e.top+e.height*P&#125;,&#123;x:t.clientX,y:t.clientY&#125;,e),s=x(o.x-e.left),_=I(o.y-e.top);l.cDefine.DEBUG_MOUSE_LOG&amp;&amp;console.log(&quot;modelTapEvent onMouseDown device( x:&quot;+t.clientX+&quot; y:&quot;+t.clientY+&quot; ) view( x:&quot;+s+&quot; y:&quot;+_+&quot;)&quot;),i,r,S.emit(&quot;tap&quot;,t),p.tapEvent(s,_)&#125;function M()&#123;T&amp;&amp;(T=!1),g.setPoint(0,0)&#125;function E(t)&#123;if(&quot;mousedown&quot;==t.type)L(t);else if(&quot;mousemove&quot;==t.type)!function(t)&#123;T=!0;var e=n.currCanvas.getBoundingClientRect(),i=w(t.clientX-e.left),r=D(t.clientY-e.top),o=v(&#123;x:e.left+e.width/2,y:e.top+e.height*P&#125;,&#123;x:t.clientX,y:t.clientY&#125;,e),s=x(o.x-e.left),_=I(o.y-e.top);l.cDefine.DEBUG_MOUSE_LOG&amp;&amp;console.log(&quot;modelTurnHead onMouseMove device( x:&quot;+t.clientX+&quot; y:&quot;+t.clientY+&quot; ) view( x:&quot;+s+&quot; y:&quot;+_+&quot;)&quot;),i,r,g.setPoint(s,_)&#125;(t);else if(&quot;mouseup&quot;==t.type)&#123;if(&quot;button&quot;in t&amp;&amp;0!=t.button)return&#125;else&quot;mouseleave&quot;==t.type&amp;&amp;M()&#125;function A(t)&#123;var e,i,r,o,s,_,a,h=t.touches[0];&quot;touchstart&quot;==t.type?1==t.touches.length&amp;&amp;L(h):&quot;touchmove&quot;==t.type?(e=h,i=n.currCanvas.getBoundingClientRect(),r=w(e.clientX-i.left),o=D(e.clientY-i.top),s=v(&#123;x:i.left+i.width/2,y:i.top+i.height*P&#125;,&#123;x:e.clientX,y:e.clientY&#125;,i),_=x(s.x-i.left),a=I(s.y-i.top),l.cDefine.DEBUG_MOUSE_LOG&amp;&amp;console.log(&quot;followPointer onMouseMove device( x:&quot;+e.clientX+&quot; y:&quot;+e.clientY+&quot; ) view( x:&quot;+_+&quot; y:&quot;+a+&quot;)&quot;),T&amp;&amp;(r,o,g.setPoint(_,a))):&quot;touchend&quot;==t.type&amp;&amp;M()&#125;function x(t)&#123;var e=m.transformX(t);return y.invertTransformX(e)&#125;function I(t)&#123;var e=m.transformY(t);return y.invertTransformY(e)&#125;function w(t)&#123;return m.transformX(t)&#125;function D(t)&#123;return m.transformY(t)&#125;e.theRealInit=function(t)&#123;(0,n.createElement)(),n.currCanvas.addEventListener&amp;&amp;(window.addEventListener(&quot;click&quot;,E),window.addEventListener(&quot;mousedown&quot;,E),window.addEventListener(&quot;mousemove&quot;,E),window.addEventListener(&quot;mouseup&quot;,E),document.addEventListener(&quot;mouseleave&quot;,E),window.addEventListener(&quot;touchstart&quot;,A),window.addEventListener(&quot;touchend&quot;,A),window.addEventListener(&quot;touchmove&quot;,A)),p=new a.cManager(S),g=new _.L2DTargetPoint;var e,i,r=n.currCanvas.getBoundingClientRect(),$=r.height/r.width,T=l.cDefine.VIEW_LOGICAL_LEFT,P=l.cDefine.VIEW_LOGICAL_RIGHT,v=-$,L=$;(y=new _.L2DViewMatrix).setScreenRect(T,P,v,L),y.setMaxScreenRect(l.cDefine.VIEW_LOGICAL_MAX_LEFT,l.cDefine.VIEW_LOGICAL_MAX_RIGHT,l.cDefine.VIEW_LOGICAL_MAX_BOTTOM,l.cDefine.VIEW_LOGICAL_MAX_TOP),e=u.default.mobile()&amp;&amp;o.config.mobile.scale||o.config.model.scale,y.adjustScale(0,0,e),(d=new _.L2DMatrix44).multScale(1,r.width/r.height),(m=new _.L2DMatrix44).multTranslate(-r.width/2,-r.height/2),m.multScale(2/r.width,-2/r.height),s.Live2D.setGL(n.currWebGL),n.currWebGL.clearColor(0,0,0,0),i=o.config.model.jsonPath,p.reloadFlg=!0,p.count++,p.changeModel(n.currWebGL,i),f||(f=!0,function t()&#123;!function()&#123;h.MatrixStack.reset(),h.MatrixStack.loadIdentity(),g.update(),p.setDrag(g.getX(),g.getY()),n.currWebGL.clear(n.currWebGL.COLOR_BUFFER_BIT),h.MatrixStack.multMatrix(d.getArray()),h.MatrixStack.multMatrix(y.getArray()),h.MatrixStack.push();for(var t=0;t&lt;p.numModels();t++)&#123;var e=p.getModel(t);if(null==e)return;e.initialized&amp;&amp;!e.updating&amp;&amp;(e.update(),e.draw(n.currWebGL))&#125;h.MatrixStack.pop()&#125;();var e=window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||window.msRequestAnimationFrame;e(t,n.currCanvas),void 0!==c&amp;&amp;(c(n.currCanvas.toDataURL()),c=void 0)&#125;())&#125;,e.captureFrame=function(t)&#123;c=t&#125;&#125;,80:function(t,e,i)&#123;&quot;use strict&quot;;(function(t)&#123;Object.defineProperty(e,&quot;__esModule&quot;,&#123;value:!0&#125;);var i=!0;function r()&#123;i||(this._$MT=null,this._$5S=null,this._$NP=0,r._$42++,this._$5S=new U(this))&#125;function o(t)&#123;if(!i)&#123;this.clipContextList=new Array,this.glcontext=t.gl,this.dp_webgl=t,this.curFrameNo=0,this.firstError_clipInNotUpdate=!0,this.colorBuffer=0,this.isInitGLFBFunc=!1,this.tmpBoundsOnModel=new P,_t.glContext.length&gt;_t.frameBuffers.length&amp;&amp;(this.curFrameNo=this.getMaskRenderTexture()),this.tmpModelToViewMatrix=new O,this.tmpMatrix2=new O,this.tmpMatrixForMask=new O,this.tmpMatrixForDraw=new O,this.CHANNEL_COLORS=new Array;var e=new E;(e=new E).r=0,e.g=0,e.b=0,e.a=1,this.CHANNEL_COLORS.push(e),(e=new E).r=1,e.g=0,e.b=0,e.a=0,this.CHANNEL_COLORS.push(e),(e=new E).r=0,e.g=1,e.b=0,e.a=0,this.CHANNEL_COLORS.push(e),(e=new E).r=0,e.g=0,e.b=1,e.a=0,this.CHANNEL_COLORS.push(e);for(var r=0;r&lt;this.CHANNEL_COLORS.length;r++)this.dp_webgl.setChannelFlagAsColor(r,this.CHANNEL_COLORS[r])&#125;&#125;function n(t,e,i)&#123;this.clipIDList=new Array,this.clipIDList=i,this.clippingMaskDrawIndexList=new Array;for(var r=0;r&lt;i.length;r++)this.clippingMaskDrawIndexList.push(e.getDrawDataIndex(i[r]));this.clippedDrawContextList=new Array,this.isUsing=!0,this.layoutChannelNo=0,this.layoutBounds=new P,this.allClippedDrawRect=new P,this.matrixForMask=new Float32Array(16),this.matrixForDraw=new Float32Array(16),this.owner=t&#125;function s()&#123;i||(this._$dP=null,this._$eo=null,this._$V0=null,this._$dP=1e3,this._$eo=1e3,this._$V0=1,this._$a0())&#125;function _()&#123;&#125;function a()&#123;i||(this.x=null,this.y=null,this.width=null,this.height=null)&#125;function h(t)&#123;i||it.prototype.constructor.call(this,t)&#125;function l(t)&#123;i||it.prototype.constructor.call(this,t)&#125;function $()&#123;i||(this._$vo=null,this._$F2=null,this._$ao=400,this._$1S=400,$._$42++)&#125;function u()&#123;i||(this.p1=new p,this.p2=new p,this._$Fo=0,this._$Db=0,this._$L2=0,this._$M2=0,this._$ks=0,this._$9b=0,this._$iP=0,this._$iT=0,this._$lL=new Array,this._$qP=new Array,this.setup(.3,.5,.1))&#125;function p()&#123;this._$p=1,this.x=0,this.y=0,this.vx=0,this.vy=0,this.ax=0,this.ay=0,this.fx=0,this.fy=0,this._$s0=0,this._$70=0,this._$7L=0,this._$HL=0&#125;function c(t,e,i)&#123;this._$wL=null,this.scale=null,this._$V0=null,this._$wL=t,this.scale=e,this._$V0=i&#125;function f(t,e,i,r)&#123;c.prototype.constructor.call(this,e,i,r),this._$tL=null,this._$tL=t&#125;function g(t,e,i)&#123;this._$wL=null,this.scale=null,this._$V0=null,this._$wL=t,this.scale=e,this._$V0=i&#125;function y(t,e,i,r)&#123;g.prototype.constructor.call(this,e,i,r),this._$YP=null,this._$YP=t&#125;function d()&#123;i||(this._$fL=0,this._$gL=0,this._$B0=1,this._$z0=1,this._$qT=0,this.reflectX=!1,this.reflectY=!1)&#125;r._$0s=1,r._$4s=2,r._$42=0,r._$62=function(t,e)&#123;try&#123;if(e instanceof ArrayBuffer&amp;&amp;(e=new DataView(e)),!(e instanceof DataView))throw new ht(&quot;_$SS#loadModel(b) / b _$x be DataView or ArrayBuffer&quot;);var i,o=new Pt(e),n=o._$ST(),s=o._$ST(),a=o._$ST();if(109!=n||111!=s||99!=a)throw new ht(&quot;_$gi _$C _$li , _$Q0 _$P0.&quot;);if(i=o._$ST(),o._$gr(i),i&gt;G._$T7)throw t._$NP|=r._$4s,new ht(&quot;_$gi _$C _$li , _$n0 _$_ version _$li ( SDK : &quot;+G._$T7+&quot; &lt; _$f0 : &quot;+i+&quot; )@_$SS#loadModel()\\n&quot;);var h=o._$nP();if(i&gt;=G._$s7)&#123;var l=o._$9T(),$=o._$9T();if(-30584!=l||-30584!=$)throw t._$NP|=r._$0s,new ht(&quot;_$gi _$C _$li , _$0 _$6 _$Ui.&quot;)&#125;t._$KS(h);var u=t.getModelContext();u.setDrawParam(t.getDrawParam()),u.init()&#125;catch(t)&#123;_._$Rb(t)&#125;&#125;,r.prototype._$KS=function(t)&#123;this._$MT=t&#125;,r.prototype.getModelImpl=function()&#123;return null==this._$MT&amp;&amp;(this._$MT=new $,this._$MT._$zP()),this._$MT&#125;,r.prototype.getCanvasWidth=function()&#123;return null==this._$MT?0:this._$MT.getCanvasWidth()&#125;,r.prototype.getCanvasHeight=function()&#123;return null==this._$MT?0:this._$MT.getCanvasHeight()&#125;,r.prototype.getParamFloat=function(t)&#123;return&quot;number&quot;!=typeof t&amp;&amp;(t=this._$5S.getParamIndex(l.getID(t))),this._$5S.getParamFloat(t)&#125;,r.prototype.setParamFloat=function(t,e,i)&#123;&quot;number&quot;!=typeof t&amp;&amp;(t=this._$5S.getParamIndex(l.getID(t))),arguments.length&lt;3&amp;&amp;(i=1),this._$5S.setParamFloat(t,this._$5S.getParamFloat(t)*(1-i)+e*i)&#125;,r.prototype.addToParamFloat=function(t,e,i)&#123;&quot;number&quot;!=typeof t&amp;&amp;(t=this._$5S.getParamIndex(l.getID(t))),arguments.length&lt;3&amp;&amp;(i=1),this._$5S.setParamFloat(t,this._$5S.getParamFloat(t)+e*i)&#125;,r.prototype.multParamFloat=function(t,e,i)&#123;&quot;number&quot;!=typeof t&amp;&amp;(t=this._$5S.getParamIndex(l.getID(t))),arguments.length&lt;3&amp;&amp;(i=1),this._$5S.setParamFloat(t,this._$5S.getParamFloat(t)*(1+(e-1)*i))&#125;,r.prototype.getParamIndex=function(t)&#123;return this._$5S.getParamIndex(l.getID(t))&#125;,r.prototype.loadParam=function()&#123;this._$5S.loadParam()&#125;,r.prototype.saveParam=function()&#123;this._$5S.saveParam()&#125;,r.prototype.init=function()&#123;this._$5S.init()&#125;,r.prototype.update=function()&#123;this._$5S.update()&#125;,r.prototype._$Rs=function()&#123;return _._$li(&quot;_$60 _$PT _$Rs()&quot;),-1&#125;,r.prototype._$Ds=function(t)&#123;_._$li(&quot;_$60 _$PT _$SS#_$Ds() \\n&quot;)&#125;,r.prototype._$K2=function()&#123;&#125;,r.prototype.draw=function()&#123;&#125;,r.prototype.getModelContext=function()&#123;return this._$5S&#125;,r.prototype._$s2=function()&#123;return this._$NP&#125;,r.prototype._$P7=function(t,e,i,r)&#123;var o=-1,n=0,s=this;if(0!=i)if(1==t.length)&#123;p=t[0];var _=0!=s.getParamFloat(p),a=(c=e[0],s.getPartsOpacity(c)),h=i/r;_?(a+=h)&gt;1&amp;&amp;(a=1):(a-=h)&lt;0&amp;&amp;(a=0),s.setPartsOpacity(c,a)&#125;else&#123;for(u=0;u&lt;t.length;u++)&#123;p=t[u];if(f=0!=s.getParamFloat(p))&#123;if(o&gt;=0)break;o=u;c=e[u];n=s.getPartsOpacity(c),(n+=i/r)&gt;1&amp;&amp;(n=1)&#125;&#125;o&lt;0&amp;&amp;(console.log(&quot;No _$wi _$q0/ _$U default[%s]&quot;,t[0]),o=0,n=1,s.loadParam(),s.setParamFloat(t[o],n),s.saveParam());for(u=0;u&lt;t.length;u++)&#123;c=e[u];if(o==u)s.setPartsOpacity(c,n);else&#123;var l,$=s.getPartsOpacity(c);(1-(l=n&lt;.5?-.5*n/.5+1:.5*(1-n)/.5))*(1-n)&gt;.15&amp;&amp;(l=1-.15/(1-n)),$&gt;l&amp;&amp;($=l),s.setPartsOpacity(c,$)&#125;&#125;&#125;else for(var u=0;u&lt;t.length;u++)&#123;var p=t[u],c=e[u],f=0!=s.getParamFloat(p);s.setPartsOpacity(c,f?1:0)&#125;&#125;,r.prototype.setPartsOpacity=function(t,e)&#123;&quot;number&quot;!=typeof t&amp;&amp;(t=this._$5S.getPartsDataIndex(h.getID(t))),this._$5S.setPartsOpacity(t,e)&#125;,r.prototype.getPartsDataIndex=function(t)&#123;return t instanceof h||(t=h.getID(t)),this._$5S.getPartsDataIndex(t)&#125;,r.prototype.getPartsOpacity=function(t)&#123;return&quot;number&quot;!=typeof t&amp;&amp;(t=this._$5S.getPartsDataIndex(h.getID(t))),t&lt;0?0:this._$5S.getPartsOpacity(t)&#125;,r.prototype.getDrawParam=function()&#123;&#125;,r.prototype.getDrawDataIndex=function(t)&#123;return this._$5S.getDrawDataIndex(R.getID(t))&#125;,r.prototype.getDrawData=function(t)&#123;return this._$5S.getDrawData(t)&#125;,r.prototype.getTransformedPoints=function(t)&#123;var e=this._$5S._$C2(t);return e instanceof $t?e.getTransformedPoints():null&#125;,r.prototype.getIndexArray=function(t)&#123;if(t&lt;0||t&gt;=this._$5S._$aS.length)return null;var e=this._$5S._$aS[t];return null!=e&amp;&amp;e.getType()==W._$wb&amp;&amp;e instanceof lt?e.getIndexArray():null&#125;,o.CHANNEL_COUNT=4,o.RENDER_TEXTURE_USE_MIPMAP=!1,o.NOT_USED_FRAME=-100,o.prototype._$L7=function()&#123;if(this.tmpModelToViewMatrix&amp;&amp;(this.tmpModelToViewMatrix=null),this.tmpMatrix2&amp;&amp;(this.tmpMatrix2=null),this.tmpMatrixForMask&amp;&amp;(this.tmpMatrixForMask=null),this.tmpMatrixForDraw&amp;&amp;(this.tmpMatrixForDraw=null),this.tmpBoundsOnModel&amp;&amp;(this.tmpBoundsOnModel=null),this.CHANNEL_COLORS)&#123;for(var t=this.CHANNEL_COLORS.length-1;t&gt;=0;--t)this.CHANNEL_COLORS.splice(t,1);this.CHANNEL_COLORS=[]&#125;this.releaseShader()&#125;,o.prototype.releaseShader=function()&#123;for(var t=_t.frameBuffers.length,e=0;e&lt;t;e++)this.gl.deleteFramebuffer(_t.frameBuffers[e].framebuffer);_t.frameBuffers=[],_t.glContext=[]&#125;,o.prototype.init=function(t,e,i)&#123;for(var r=0;r&lt;e.length;r++)&#123;var o=e[r].getClipIDList();if(null!=o)&#123;var s=this.findSameClip(o);null==s&amp;&amp;(s=new n(this,t,o),this.clipContextList.push(s));var _=e[r].getDrawDataID(),a=t.getDrawDataIndex(_);s.addClippedDrawData(_,a),i[r].clipBufPre_clipContext=s&#125;&#125;&#125;,o.prototype.getMaskRenderTexture=function()&#123;var t;return t=this.dp_webgl.createFramebuffer(),_t.frameBuffers[this.dp_webgl.glno]=t,this.dp_webgl.glno&#125;,o.prototype.setupClip=function(t,e)&#123;for(var i=0,r=0;r&lt;this.clipContextList.length;r++)&#123;var o=this.clipContextList[r];this.calcClippedDrawTotalBounds(t,o),o.isUsing&amp;&amp;i++&#125;if(i&gt;0)&#123;var n=e.gl.getParameter(e.gl.FRAMEBUFFER_BINDING),s=new Array(4);s[0]=0,s[1]=0,s[2]=e.gl.canvas.width,s[3]=e.gl.canvas.height,e.gl.viewport(0,0,_t.clippingMaskBufferSize,_t.clippingMaskBufferSize),this.setupLayoutBounds(i),e.gl.bindFramebuffer(e.gl.FRAMEBUFFER,_t.frameBuffers[this.curFrameNo].framebuffer),e.gl.clearColor(0,0,0,0),e.gl.clear(e.gl.COLOR_BUFFER_BIT);for(r=0;r&lt;this.clipContextList.length;r++)&#123;var _=(o=this.clipContextList[r]).allClippedDrawRect,a=(o.layoutChannelNo,o.layoutBounds);this.tmpBoundsOnModel._$jL(_),this.tmpBoundsOnModel.expand(.05*_.width,.05*_.height);var h=a.width/this.tmpBoundsOnModel.width,l=a.height/this.tmpBoundsOnModel.height;this.tmpMatrix2.identity(),this.tmpMatrix2.translate(-1,-1,0),this.tmpMatrix2.scale(2,2,1),this.tmpMatrix2.translate(a.x,a.y,0),this.tmpMatrix2.scale(h,l,1),this.tmpMatrix2.translate(-this.tmpBoundsOnModel.x,-this.tmpBoundsOnModel.y,0),this.tmpMatrixForMask.setMatrix(this.tmpMatrix2.m),this.tmpMatrix2.identity(),this.tmpMatrix2.translate(a.x,a.y,0),this.tmpMatrix2.scale(h,l,1),this.tmpMatrix2.translate(-this.tmpBoundsOnModel.x,-this.tmpBoundsOnModel.y,0),this.tmpMatrixForDraw.setMatrix(this.tmpMatrix2.m);for(var $=this.tmpMatrixForMask.getArray(),u=0;u&lt;16;u++)o.matrixForMask[u]=$[u];var p=this.tmpMatrixForDraw.getArray();for(u=0;u&lt;16;u++)o.matrixForDraw[u]=p[u];for(var c=o.clippingMaskDrawIndexList.length,f=0;f&lt;c;f++)&#123;var g=o.clippingMaskDrawIndexList[f],y=t.getDrawData(g),d=t._$C2(g);e.setClipBufPre_clipContextForMask(o),y.draw(e,t,d)&#125;&#125;e.gl.bindFramebuffer(e.gl.FRAMEBUFFER,n),e.setClipBufPre_clipContextForMask(null),e.gl.viewport(s[0],s[1],s[2],s[3])&#125;&#125;,o.prototype.getColorBuffer=function()&#123;return this.colorBuffer&#125;,o.prototype.findSameClip=function(t)&#123;for(var e=0;e&lt;this.clipContextList.length;e++)&#123;var i=this.clipContextList[e],r=i.clipIDList.length;if(r==t.length)&#123;for(var o=0,n=0;n&lt;r;n++)for(var s=i.clipIDList[n],_=0;_&lt;r;_++)if(t[_]==s)&#123;o++;break&#125;if(o==r)return i&#125;&#125;return null&#125;,o.prototype.calcClippedDrawTotalBounds=function(t,e)&#123;for(var i=t._$Ri.getModelImpl().getCanvasWidth(),r=t._$Ri.getModelImpl().getCanvasHeight(),o=i&gt;r?i:r,n=o,s=o,_=0,a=0,h=e.clippedDrawContextList.length,l=0;l&lt;h;l++)&#123;var $=e.clippedDrawContextList[l].drawDataIndex,u=t._$C2($);if(u._$yo())&#123;for(var p=u.getTransformedPoints(),c=p.length,f=[],g=[],y=0,d=B._$i2;d&lt;c;d+=B._$No)f[y]=p[d],g[y]=p[d+1],y++;var m=Math.min.apply(null,f),T=Math.min.apply(null,g),P=Math.max.apply(null,f),S=Math.max.apply(null,g);m&lt;n&amp;&amp;(n=m),T&lt;s&amp;&amp;(s=T),P&gt;_&amp;&amp;(_=P),S&gt;a&amp;&amp;(a=S)&#125;&#125;if(n==o)e.allClippedDrawRect.x=0,e.allClippedDrawRect.y=0,e.allClippedDrawRect.width=0,e.allClippedDrawRect.height=0,e.isUsing=!1;else&#123;var v=_-n,L=a-s;e.allClippedDrawRect.x=n,e.allClippedDrawRect.y=s,e.allClippedDrawRect.width=v,e.allClippedDrawRect.height=L,e.isUsing=!0&#125;&#125;,o.prototype.setupLayoutBounds=function(t)&#123;var e=t/o.CHANNEL_COUNT,i=t%o.CHANNEL_COUNT;e=~~e,i=~~i;for(var r=0,n=0;n&lt;o.CHANNEL_COUNT;n++)&#123;var s=e+(n&lt;i?1:0);if(0==s);else if(1==s)($=this.clipContextList[r++]).layoutChannelNo=n,$.layoutBounds.x=0,$.layoutBounds.y=0,$.layoutBounds.width=1,$.layoutBounds.height=1;else if(2==s)for(var a=0;a&lt;s;a++)&#123;var h=0;l=~~(l=a%2),($=this.clipContextList[r++]).layoutChannelNo=n,$.layoutBounds.x=.5*l,$.layoutBounds.y=0,$.layoutBounds.width=.5,$.layoutBounds.height=1&#125;else if(s&lt;=4)for(a=0;a&lt;s;a++)&#123;l=~~(l=a%2),h=~~(h=a/2),($=this.clipContextList[r++]).layoutChannelNo=n,$.layoutBounds.x=.5*l,$.layoutBounds.y=.5*h,$.layoutBounds.width=.5,$.layoutBounds.height=.5&#125;else if(s&lt;=9)for(a=0;a&lt;s;a++)&#123;var l,$;l=~~(l=a%3),h=~~(h=a/3),($=this.clipContextList[r++]).layoutChannelNo=n,$.layoutBounds.x=l/3,$.layoutBounds.y=h/3,$.layoutBounds.width=1/3,$.layoutBounds.height=1/3&#125;else _._$li(&quot;_$6 _$0P mask count : %d&quot;,s)&#125;&#125;,n.prototype.addClippedDrawData=function(t,e)&#123;var i=new function(t,e)&#123;this._$gP=t,this.drawDataIndex=e&#125;(t,e);this.clippedDrawContextList.push(i)&#125;,s._$JT=function(t,e,i)&#123;var r=t/e,o=i/e,n=1-(1-o)*(1-o),s=1-(1-o)*(1-o),_=1/3*(1-o)*n+(o*(2/3)+1/3*(1-o))*(1-n),a=(o+2/3*(1-o))*s+(o*(1/3)+2/3*(1-o))*(1-s),h=1-3*a+3*_-0,l=3*a-6*_+0,$=3*_-0;if(r&lt;=0)return 0;if(r&gt;=1)return 1;var u=r*r;return h*(r*u)+l*u+$*r+0&#125;,s.prototype._$a0=function()&#123;&#125;,s.prototype.setFadeIn=function(t)&#123;this._$dP=t&#125;,s.prototype.setFadeOut=function(t)&#123;this._$eo=t&#125;,s.prototype._$pT=function(t)&#123;this._$V0=t&#125;,s.prototype.getFadeOut=function()&#123;return this._$eo&#125;,s.prototype._$4T=function()&#123;return this._$eo&#125;,s.prototype._$mT=function()&#123;return this._$V0&#125;,s.prototype.getDurationMSec=function()&#123;return-1&#125;,s.prototype.getLoopDurationMSec=function()&#123;return-1&#125;,s.prototype.updateParam=function(t,e)&#123;if(e._$AT&amp;&amp;!e._$9L)&#123;var i=x.getUserTimeMSec();if(e._$z2&lt;0)&#123;e._$z2=i,e._$bs=i;var r=this.getDurationMSec();e._$Do&lt;0&amp;&amp;(e._$Do=r&lt;=0?-1:e._$z2+r)&#125;var o=this._$V0;0&lt;=(o=o*(0==this._$dP?1:at._$r2((i-e._$bs)/this._$dP))*(0==this._$eo||e._$Do&lt;0?1:at._$r2((e._$Do-i)/this._$eo)))&amp;&amp;o&lt;=1||console.log(&quot;### assert!! ### &quot;),this.updateParamExe(t,i,o,e),e._$Do&gt;0&amp;&amp;e._$Do&lt;i&amp;&amp;(e._$9L=!0)&#125;&#125;,s.prototype.updateParamExe=function(t,e,i,r)&#123;&#125;,_._$8s=0,_._$fT=new Object,_.start=function(t)&#123;var e=_._$fT[t];null==e&amp;&amp;((e=new function()&#123;this._$r=null,this._$0S=null&#125;)._$r=t,_._$fT[t]=e),e._$0S=x.getSystemTimeMSec()&#125;,_.dump=function(t)&#123;var e=_._$fT[t];if(null!=e)&#123;var i=x.getSystemTimeMSec()-e._$0S;return console.log(t+&quot; : &quot;+i+&quot;ms&quot;),i&#125;return-1&#125;,_.end=function(t)&#123;var e=_._$fT[t];return null!=e?x.getSystemTimeMSec()-e._$0S:-1&#125;,_._$li=function(t,e)&#123;console.log(&quot;_$li : &quot;+t+&quot;\\n&quot;,e)&#125;,_._$Ji=function(t,e)&#123;console.log(t,e)&#125;,_._$dL=function(t,e)&#123;console.log(t,e),console.log(&quot;\\n&quot;)&#125;,_._$KL=function(t,e)&#123;for(var i=0;i&lt;e;i++)i%16==0&amp;&amp;i&gt;0?console.log(&quot;\\n&quot;):i%8==0&amp;&amp;i&gt;0&amp;&amp;console.log(&quot;  &quot;),console.log(&quot;%02X &quot;,255&amp;t[i]);console.log(&quot;\\n&quot;)&#125;,_._$nr=function(t,e,i)&#123;console.log(&quot;%s\\n&quot;,t);for(var r=e.length,o=0;o&lt;r;++o)console.log(&quot;%5d&quot;,e[o]),console.log(&quot;%s\\n&quot;,i),console.log(&quot;,&quot;);console.log(&quot;\\n&quot;)&#125;,_._$Rb=function(t)&#123;console.log(&quot;dump exception : &quot;+t),console.log(&quot;stack :: &quot;+t.stack)&#125;,a.prototype._$8P=function()&#123;return.5*(this.x+this.x+this.width)&#125;,a.prototype._$6P=function()&#123;return.5*(this.y+this.y+this.height)&#125;,a.prototype._$EL=function()&#123;return this.x+this.width&#125;,a.prototype._$5T=function()&#123;return this.y+this.height&#125;,a.prototype._$jL=function(t,e,i,r)&#123;this.x=t,this.y=e,this.width=i,this.height=r&#125;,a.prototype._$jL=function(t)&#123;this.x=t.x,this.y=t.y,this.width=t.width,this.height=t.height&#125;,h.prototype=new it,h._$tP=new Object,h._$27=function()&#123;h._$tP.clear()&#125;,h.getID=function(t)&#123;var e=h._$tP[t];return null==e&amp;&amp;(e=new h(t),h._$tP[t]=e),e&#125;,h.prototype._$3s=function()&#123;return new h&#125;,l.prototype=new it,l._$tP=new Object,l._$27=function()&#123;l._$tP.clear()&#125;,l.getID=function(t)&#123;var e=l._$tP[t];return null==e&amp;&amp;(e=new l(t),l._$tP[t]=e),e&#125;,l.prototype._$3s=function()&#123;return new l&#125;,$._$42=0,$.prototype._$zP=function()&#123;null==this._$vo&amp;&amp;(this._$vo=new rt),null==this._$F2&amp;&amp;(this._$F2=new Array)&#125;,$.prototype.getCanvasWidth=function()&#123;return this._$ao&#125;,$.prototype.getCanvasHeight=function()&#123;return this._$1S&#125;,$.prototype._$F0=function(t)&#123;this._$vo=t._$nP(),this._$F2=t._$nP(),this._$ao=t._$6L(),this._$1S=t._$6L()&#125;,$.prototype._$6S=function(t)&#123;this._$F2.push(t)&#125;,$.prototype._$Xr=function()&#123;return this._$F2&#125;,$.prototype._$E2=function()&#123;return this._$vo&#125;,u.prototype.setup=function(t,e,i)&#123;this._$ks=this._$Yb(),this.p2._$xT(),3==arguments.length&amp;&amp;(this._$Fo=t,this._$L2=e,this.p1._$p=i,this.p2._$p=i,this.p2.y=t,this.setup())&#125;,u.prototype.getPhysicsPoint1=function()&#123;return this.p1&#125;,u.prototype.getPhysicsPoint2=function()&#123;return this.p2&#125;,u.prototype._$qr=function()&#123;return this._$Db&#125;,u.prototype._$pr=function(t)&#123;this._$Db=t&#125;,u.prototype._$5r=function()&#123;return this._$M2&#125;,u.prototype._$Cs=function()&#123;return this._$9b&#125;,u.prototype._$Yb=function()&#123;return-180*Math.atan2(this.p1.x-this.p2.x,-(this.p1.y-this.p2.y))/Math.PI&#125;,u.prototype.addSrcParam=function(t,e,i,r)&#123;var o=new f(t,e,i,r);this._$lL.push(o)&#125;,u.prototype.addTargetParam=function(t,e,i,r)&#123;var o=new y(t,e,i,r);this._$qP.push(o)&#125;,u.prototype.update=function(t,e)&#123;if(0==this._$iP)return this._$iP=this._$iT=e,void(this._$Fo=Math.sqrt((this.p1.x-this.p2.x)*(this.p1.x-this.p2.x)+(this.p1.y-this.p2.y)*(this.p1.y-this.p2.y)));var i=(e-this._$iT)/1e3;if(0!=i)&#123;for(var r=this._$lL.length-1;r&gt;=0;--r)&#123;this._$lL[r]._$oP(t,this)&#125;this._$oo(t,i),this._$M2=this._$Yb(),this._$9b=(this._$M2-this._$ks)/i,this._$ks=this._$M2&#125;for(r=this._$qP.length-1;r&gt;=0;--r)&#123;this._$qP[r]._$YS(t,this)&#125;this._$iT=e&#125;,u.prototype._$oo=function(t,e)&#123;e&lt;.033&amp;&amp;(e=.033);var i=1/e;this.p1.vx=(this.p1.x-this.p1._$s0)*i,this.p1.vy=(this.p1.y-this.p1._$70)*i,this.p1.ax=(this.p1.vx-this.p1._$7L)*i,this.p1.ay=(this.p1.vy-this.p1._$HL)*i,this.p1.fx=this.p1.ax*this.p1._$p,this.p1.fy=this.p1.ay*this.p1._$p,this.p1._$xT();var r,o,n=-Math.atan2(this.p1.y-this.p2.y,this.p1.x-this.p2.x),s=Math.cos(n),_=Math.sin(n),a=9.8*this.p2._$p,h=this._$Db*vt._$bS,l=a*Math.cos(n-h);r=l*_,o=l*s;var $=-this.p1.fx*_*_,u=-this.p1.fy*_*s,p=-this.p2.vx*this._$L2,c=-this.p2.vy*this._$L2;this.p2.fx=r+$+p,this.p2.fy=o+u+c,this.p2.ax=this.p2.fx/this.p2._$p,this.p2.ay=this.p2.fy/this.p2._$p,this.p2.vx+=this.p2.ax*e,this.p2.vy+=this.p2.ay*e,this.p2.x+=this.p2.vx*e,this.p2.y+=this.p2.vy*e;var f=Math.sqrt((this.p1.x-this.p2.x)*(this.p1.x-this.p2.x)+(this.p1.y-this.p2.y)*(this.p1.y-this.p2.y));this.p2.x=this.p1.x+this._$Fo*(this.p2.x-this.p1.x)/f,this.p2.y=this.p1.y+this._$Fo*(this.p2.y-this.p1.y)/f,this.p2.vx=(this.p2.x-this.p2._$s0)*i,this.p2.vy=(this.p2.y-this.p2._$70)*i,this.p2._$xT()&#125;,p.prototype._$xT=function()&#123;this._$s0=this.x,this._$70=this.y,this._$7L=this.vx,this._$HL=this.vy&#125;,c.prototype._$oP=function(t,e)&#123;&#125;,f.prototype=new c,f.prototype._$oP=function(t,e)&#123;var i=this.scale*t.getParamFloat(this._$wL),r=e.getPhysicsPoint1();switch(this._$tL)&#123;default:case u.Src.SRC_TO_X:r.x=r.x+(i-r.x)*this._$V0;break;case u.Src.SRC_TO_Y:r.y=r.y+(i-r.y)*this._$V0;break;case u.Src.SRC_TO_G_ANGLE:var o=e._$qr();o+=(i-o)*this._$V0,e._$pr(o)&#125;&#125;,g.prototype._$YS=function(t,e)&#123;&#125;,y.prototype=new g,y.prototype._$YS=function(t,e)&#123;switch(this._$YP)&#123;default:case u.Target.TARGET_FROM_ANGLE:t.setParamFloat(this._$wL,this.scale*e._$5r(),this._$V0);break;case u.Target.TARGET_FROM_ANGLE_V:t.setParamFloat(this._$wL,this.scale*e._$Cs(),this._$V0)&#125;&#125;,u.Src=function()&#123;&#125;,u.Src.SRC_TO_X=&quot;SRC_TO_X&quot;,u.Src.SRC_TO_Y=&quot;SRC_TO_Y&quot;,u.Src.SRC_TO_G_ANGLE=&quot;SRC_TO_G_ANGLE&quot;,u.Target=function()&#123;&#125;,u.Target.TARGET_FROM_ANGLE=&quot;TARGET_FROM_ANGLE&quot;,u.Target.TARGET_FROM_ANGLE_V=&quot;TARGET_FROM_ANGLE_V&quot;,d.prototype.init=function(t)&#123;this._$fL=t._$fL,this._$gL=t._$gL,this._$B0=t._$B0,this._$z0=t._$z0,this._$qT=t._$qT,this.reflectX=t.reflectX,this.reflectY=t.reflectY&#125;,d.prototype._$F0=function(t)&#123;this._$fL=t._$_T(),this._$gL=t._$_T(),this._$B0=t._$_T(),this._$z0=t._$_T(),this._$qT=t._$_T(),t.getFormatVersion()&gt;=G.LIVE2D_FORMAT_VERSION_V2_10_SDK2&amp;&amp;(this.reflectX=t._$po(),this.reflectY=t._$po())&#125;,d.prototype._$e=function()&#123;&#125;;var T=function()&#123;&#125;;function P()&#123;i||(this.x=null,this.y=null,this.width=null,this.height=null)&#125;function S()&#123;&#125;function v()&#123;i||(this.x=null,this.y=null)&#125;function L()&#123;i||(this._$gP=null,this._$dr=null,this._$GS=null,this._$qb=null,this._$Lb=null,this._$mS=null,this.clipID=null,this.clipIDList=new Array)&#125;function M()&#123;i||(this._$Eb=M._$ps,this._$lT=1,this._$C0=1,this._$tT=1,this._$WL=1,this.culling=!1,this.matrix4x4=new Float32Array(16),this.premultipliedAlpha=!1,this.anisotropy=0,this.clippingProcess=M.CLIPPING_PROCESS_NONE,this.clipBufPre_clipContextMask=null,this.clipBufPre_clipContextDraw=null,this.CHANNEL_COLORS=new Array)&#125;function E()&#123;i||(this.a=1,this.r=1,this.g=1,this.b=1,this.scale=1,this._$ho=1,this.blendMode=_t.L2D_COLOR_BLEND_MODE_MULT)&#125;function A()&#123;i||(this._$kP=null,this._$dr=null,this._$Ai=!0,this._$mS=null)&#125;function x()&#123;&#125;function I()&#123;i||(this._$VP=0,this._$wL=null,this._$GP=null,this._$8o=I._$ds,this._$2r=-1,this._$O2=0,this._$ri=0)&#125;function w()&#123;&#125;function D()&#123;i||(this._$Ob=null)&#125;function O()&#123;this.m=new Float32Array(16),this.identity()&#125;function R(t)&#123;i||it.prototype.constructor.call(this,t)&#125;function b()&#123;i||(this._$7=1,this._$f=0,this._$H=0,this._$g=1,this._$k=0,this._$w=0,this._$hi=STATE_IDENTITY,this._$Z=_$pS)&#125;function F()&#123;i||(s.prototype.constructor.call(this),this.motions=new Array,this._$7r=null,this._$7r=F._$Co++,this._$D0=30,this._$yT=0,this._$E=!0,this.loopFadeIn=!0,this._$AS=-1,_$a0())&#125;function C()&#123;this._$P=new Float32Array(100),this.size=0&#125;function N()&#123;this._$4P=null,this._$I0=null,this._$RP=null&#125;function B()&#123;&#125;function G()&#123;&#125;function U(t)&#123;i||(this._$QT=!0,this._$co=-1,this._$qo=0,this._$pb=new Array(U._$is),this._$_2=new Float32Array(U._$is),this._$vr=new Float32Array(U._$is),this._$Rr=new Float32Array(U._$is),this._$Or=new Float32Array(U._$is),this._$fs=new Float32Array(U._$is),this._$Js=new Array(U._$is),this._$3S=new Array,this._$aS=new Array,this._$Bo=null,this._$F2=new Array,this._$db=new Array,this._$8b=new Array,this._$Hr=new Array,this._$Ws=null,this._$Vs=null,this._$Er=null,this._$Es=new Int16Array(B._$Qb),this._$ZP=new Float32Array(2*B._$1r),this._$Ri=t,this._$b0=U._$HP++,this.clipManager=null,this.dp_webgl=null)&#125;function Y()&#123;&#125;function k()&#123;i||(this._$12=null,this._$bb=null,this._$_L=null,this._$jo=null,this._$iL=null,this._$0L=null,this._$Br=null,this._$Dr=null,this._$Cb=null,this._$mr=null,this._$_L=V.STATE_FIRST,this._$Br=4e3,this._$Dr=100,this._$Cb=50,this._$mr=150,this._$jo=!0,this._$iL=&quot;PARAM_EYE_L_OPEN&quot;,this._$0L=&quot;PARAM_EYE_R_OPEN&quot;)&#125;T._$ni=function(t,e,i,r,o,n,s,_,a)&#123;var h=s*n-_*o;if(0==h)return null;var l,$=((t-i)*n-(e-r)*o)/h;return l=0!=o?(t-i-$*s)/o:(e-r-$*_)/n,isNaN(l)&amp;&amp;(l=(t-i-$*s)/o,isNaN(l)&amp;&amp;(l=(e-r-$*_)/n),isNaN(l)&amp;&amp;(console.log(&quot;a is NaN @UtVector#_$ni() &quot;),console.log(&quot;v1x : &quot;+o),console.log(&quot;v1x != 0 ? &quot;+(0!=o)))),null==a?new Array(l,$):(a[0]=l,a[1]=$,a)&#125;,P.prototype._$8P=function()&#123;return this.x+.5*this.width&#125;,P.prototype._$6P=function()&#123;return this.y+.5*this.height&#125;,P.prototype._$EL=function()&#123;return this.x+this.width&#125;,P.prototype._$5T=function()&#123;return this.y+this.height&#125;,P.prototype._$jL=function(t,e,i,r)&#123;this.x=t,this.y=e,this.width=i,this.height=r&#125;,P.prototype._$jL=function(t)&#123;this.x=t.x,this.y=t.y,this.width=t.width,this.height=t.height&#125;,P.prototype.contains=function(t,e)&#123;return this.x&lt;=this.x&amp;&amp;this.y&lt;=this.y&amp;&amp;this.x&lt;=this.x+this.width&amp;&amp;this.y&lt;=this.y+this.height&#125;,P.prototype.expand=function(t,e)&#123;this.x-=t,this.y-=e,this.width+=2*t,this.height+=2*e&#125;,S._$Z2=function(t,e,i,r)&#123;var o=e._$Q2(t,i),n=t._$vs(),s=t._$Tr();if(e._$zr(n,s,o),o&lt;=0)return r[n[0]];if(1==o)return(_=r[n[0]])+((a=r[n[1]])-_)*($=s[0])|0;if(2==o)&#123;var _=r[n[0]],a=r[n[1]],h=r[n[2]],l=r[n[3]],$=s[0],u=s[1];return(S=_+(a-_)*$|0)+((h+(l-h)*$|0)-S)*u|0&#125;if(3==o)&#123;var p=r[n[0]],c=r[n[1]],f=r[n[2]],g=r[n[3]],y=r[n[4]],d=r[n[5]],m=r[n[6]],T=r[n[7]],P=($=s[0],u=s[1],s[2]);return(S=(_=p+(c-p)*$|0)+((a=f+(g-f)*$|0)-_)*u|0)+(((h=y+(d-y)*$|0)+((l=m+(T-m)*$|0)-h)*u|0)-S)*P|0&#125;if(4==o)&#123;var S,v=r[n[0]],L=r[n[1]],M=r[n[2]],E=r[n[3]],A=r[n[4]],x=r[n[5]],I=r[n[6]],w=r[n[7]],D=r[n[8]],O=r[n[9]],R=r[n[10]],b=r[n[11]],F=r[n[12]],C=r[n[13]],N=r[n[14]],B=r[n[15]],G=($=s[0],u=s[1],P=s[2],s[3]);return(S=(_=(p=v+(L-v)*$|0)+((c=M+(E-M)*$|0)-p)*u|0)+((a=(f=A+(x-A)*$|0)+((g=I+(w-I)*$|0)-f)*u|0)-_)*P|0)+(((h=(y=D+(O-D)*$|0)+((d=R+(b-R)*$|0)-y)*u|0)+((l=(m=F+(C-F)*$|0)+((T=N+(B-N)*$|0)-m)*u|0)-h)*P|0)-S)*G|0&#125;for(var U=1&lt;&lt;o,Y=new Float32Array(U),k=0;k&lt;U;k++)&#123;for(var V=k,X=1,z=0;z&lt;o;z++)X*=V%2==0?1-s[z]:s[z],V/=2;Y[k]=X&#125;for(var H=new Float32Array(U),W=0;W&lt;U;W++)H[W]=r[n[W]];var j=0;for(W=0;W&lt;U;W++)j+=Y[W]*H[W];return j+.5|0&#125;,S._$br=function(t,e,i,r)&#123;var o=e._$Q2(t,i),n=t._$vs(),s=t._$Tr();if(e._$zr(n,s,o),o&lt;=0)return r[n[0]];if(1==o)return(_=r[n[0]])+((a=r[n[1]])-_)*($=s[0]);if(2==o)&#123;var _=r[n[0]],a=r[n[1]],h=r[n[2]],l=r[n[3]],$=s[0];return(1-(T=s[1]))*(_+(a-_)*$)+T*(h+(l-h)*$)&#125;if(3==o)&#123;var u=r[n[0]],p=r[n[1]],c=r[n[2]],f=r[n[3]],g=r[n[4]],y=r[n[5]],d=r[n[6]],m=r[n[7]],T=($=s[0],s[1]);return(1-(N=s[2]))*((1-T)*(u+(p-u)*$)+T*(c+(f-c)*$))+N*((1-T)*(g+(y-g)*$)+T*(d+(m-d)*$))&#125;if(4==o)&#123;var P=r[n[0]],S=r[n[1]],v=r[n[2]],L=r[n[3]],M=r[n[4]],E=r[n[5]],A=r[n[6]],x=r[n[7]],I=r[n[8]],w=r[n[9]],D=r[n[10]],O=r[n[11]],R=r[n[12]],b=r[n[13]],F=r[n[14]],C=r[n[15]],N=($=s[0],T=s[1],s[2]),B=s[3];return(1-B)*((1-N)*((1-T)*(P+(S-P)*$)+T*(v+(L-v)*$))+N*((1-T)*(M+(E-M)*$)+T*(A+(x-A)*$)))+B*((1-N)*((1-T)*(I+(w-I)*$)+T*(D+(O-D)*$))+N*((1-T)*(R+(b-R)*$)+T*(F+(C-F)*$)))&#125;for(var G=1&lt;&lt;o,U=new Float32Array(G),Y=0;Y&lt;G;Y++)&#123;for(var k=Y,V=1,X=0;X&lt;o;X++)V*=k%2==0?1-s[X]:s[X],k/=2;U[Y]=V&#125;for(var z=new Float32Array(G),H=0;H&lt;G;H++)z[H]=r[n[H]];var W=0;for(H=0;H&lt;G;H++)W+=U[H]*z[H];return W&#125;,S._$Vr=function(t,e,i,r,o,n,s,_)&#123;var a=e._$Q2(t,i),h=t._$vs(),l=t._$Tr();e._$zr(h,l,a);var $=2*r,u=s;if(a&lt;=0)&#123;var p=o[h[0]];if(2==_&amp;&amp;0==s)x._$jT(p,0,n,0,$);else for(var c=0;c&lt;$;)n[u]=p[c++],n[u+1]=p[c++],u+=_&#125;else if(1==a)&#123;p=o[h[0]];var f=o[h[1]],g=1-(m=l[0]);for(c=0;c&lt;$;)n[u]=p[c]*g+f[c]*m,++c,n[u+1]=p[c]*g+f[c]*m,++c,u+=_&#125;else if(2==a)&#123;p=o[h[0]],f=o[h[1]];var y=o[h[2]],d=o[h[3]],m=l[0],T=(k=1-(R=l[1]))*(g=1-m),P=k*m,S=R*g,v=R*m;for(c=0;c&lt;$;)n[u]=T*p[c]+P*f[c]+S*y[c]+v*d[c],++c,n[u+1]=T*p[c]+P*f[c]+S*y[c]+v*d[c],++c,u+=_&#125;else if(3==a)&#123;var L=o[h[0]],M=o[h[1]],E=o[h[2]],A=o[h[3]],I=o[h[4]],w=o[h[5]],D=o[h[6]],O=o[h[7]],R=(m=l[0],l[1]),b=(V=1-(st=l[2]))*(k=1-R)*(g=1-m),F=V*k*m,C=V*R*g,N=V*R*m,B=st*k*g,G=st*k*m,U=st*R*g,Y=st*R*m;for(c=0;c&lt;$;)n[u]=b*L[c]+F*M[c]+C*E[c]+N*A[c]+B*I[c]+G*w[c]+U*D[c]+Y*O[c],++c,n[u+1]=b*L[c]+F*M[c]+C*E[c]+N*A[c]+B*I[c]+G*w[c]+U*D[c]+Y*O[c],++c,u+=_&#125;else if(4==a)&#123;var k,V,X=o[h[0]],z=o[h[1]],H=o[h[2]],W=o[h[3]],j=o[h[4]],q=o[h[5]],J=o[h[6]],Q=o[h[7]],Z=o[h[8]],K=o[h[9]],tt=o[h[10]],et=o[h[11]],it=o[h[12]],rt=o[h[13]],ot=o[h[14]],nt=o[h[15]],st=(m=l[0],R=l[1],l[2]),_t=l[3],at=1-_t,ht=at*(V=1-st)*(k=1-R)*(g=1-m),lt=at*V*k*m,$t=at*V*R*g,ut=at*V*R*m,pt=at*st*k*g,ct=at*st*k*m,ft=at*st*R*g,gt=at*st*R*m,yt=_t*V*k*g,dt=_t*V*k*m,mt=_t*V*R*g,Tt=_t*V*R*m,Pt=_t*st*k*g,St=_t*st*k*m,vt=_t*st*R*g,Lt=_t*st*R*m;for(c=0;c&lt;$;)n[u]=ht*X[c]+lt*z[c]+$t*H[c]+ut*W[c]+pt*j[c]+ct*q[c]+ft*J[c]+gt*Q[c]+yt*Z[c]+dt*K[c]+mt*tt[c]+Tt*et[c]+Pt*it[c]+St*rt[c]+vt*ot[c]+Lt*nt[c],++c,n[u+1]=ht*X[c]+lt*z[c]+$t*H[c]+ut*W[c]+pt*j[c]+ct*q[c]+ft*J[c]+gt*Q[c]+yt*Z[c]+dt*K[c]+mt*tt[c]+Tt*et[c]+Pt*it[c]+St*rt[c]+vt*ot[c]+Lt*nt[c],++c,u+=_&#125;else&#123;for(var Mt=1&lt;&lt;a,Et=new Float32Array(Mt),At=0;At&lt;Mt;At++)&#123;for(var xt=At,It=1,wt=0;wt&lt;a;wt++)It*=xt%2==0?1-l[wt]:l[wt],xt/=2;Et[At]=It&#125;for(var Dt=new Float32Array(Mt),Ot=0;Ot&lt;Mt;Ot++)Dt[Ot]=o[h[Ot]];for(c=0;c&lt;$;)&#123;var Rt=0,bt=0,Ft=c+1;for(Ot=0;Ot&lt;Mt;Ot++)Rt+=Et[Ot]*Dt[Ot][c],bt+=Et[Ot]*Dt[Ot][Ft];c+=2,n[u]=Rt,n[u+1]=bt,u+=_&#125;&#125;&#125;,v.prototype._$HT=function(t,e)&#123;this.x=t,this.y=e&#125;,v.prototype._$HT=function(t)&#123;this.x=t.x,this.y=t.y&#125;,L._$ur=-2,L._$ES=500,L._$wb=2,L._$8S=3,L._$52=L._$ES,L._$R2=L._$ES,L._$or=function()&#123;return L._$52&#125;,L._$Pr=function()&#123;return L._$R2&#125;,L.prototype.convertClipIDForV2_11=function(t)&#123;var e=[];return null==t?null:0==t.length?null:/,/.test(t)?e=t.id.split(&quot;,&quot;):(e.push(t.id),e)&#125;,L.prototype._$F0=function(t)&#123;this._$gP=t._$nP(),this._$dr=t._$nP(),this._$GS=t._$nP(),this._$qb=t._$6L(),this._$Lb=t._$cS(),this._$mS=t._$Tb(),t.getFormatVersion()&gt;=G._$T7?(this.clipID=t._$nP(),this.clipIDList=this.convertClipIDForV2_11(this.clipID)):this.clipIDList=[],this._$MS(this._$Lb)&#125;,L.prototype.getClipIDList=function()&#123;return this.clipIDList&#125;,L.prototype.init=function(t)&#123;&#125;,L.prototype._$Nr=function(t,e)&#123;if(e._$IS[0]=!1,e._$Us=S._$Z2(t,this._$GS,e._$IS,this._$Lb),_t._$Zs);else if(e._$IS[0])return;e._$7s=S._$br(t,this._$GS,e._$IS,this._$mS)&#125;,L.prototype._$2b=function(t,e)&#123;&#125;,L.prototype.getDrawDataID=function()&#123;return this._$gP&#125;,L.prototype._$j2=function(t)&#123;this._$gP=t&#125;,L.prototype.getOpacity=function(t,e)&#123;return e._$7s&#125;,L.prototype._$zS=function(t,e)&#123;return e._$Us&#125;,L.prototype._$MS=function(t)&#123;for(var e=t.length-1;e&gt;=0;--e)&#123;var i=t[e];i&lt;L._$52?L._$52=i:i&gt;L._$R2&amp;&amp;(L._$R2=i)&#125;&#125;,L.prototype.getTargetBaseDataID=function()&#123;return this._$dr&#125;,L.prototype._$gs=function(t)&#123;this._$dr=t&#125;,L.prototype._$32=function()&#123;return null!=this._$dr&amp;&amp;this._$dr!=yt._$2o()&#125;,L.prototype.preDraw=function(t,e,i)&#123;&#125;,L.prototype.draw=function(t,e,i)&#123;&#125;,L.prototype.getType=function()&#123;&#125;,L.prototype._$B2=function(t,e,i)&#123;&#125;,M._$ps=32,M.CLIPPING_PROCESS_NONE=0,M.CLIPPING_PROCESS_OVERWRITE_ALPHA=1,M.CLIPPING_PROCESS_MULTIPLY_ALPHA=2,M.CLIPPING_PROCESS_DRAW=3,M.CLIPPING_PROCESS_CLEAR_ALPHA=4,M.prototype.setChannelFlagAsColor=function(t,e)&#123;this.CHANNEL_COLORS[t]=e&#125;,M.prototype.getChannelFlagAsColor=function(t)&#123;return this.CHANNEL_COLORS[t]&#125;,M.prototype._$ZT=function()&#123;&#125;,M.prototype._$Uo=function(t,e,i,r,o,n,s)&#123;&#125;,M.prototype._$Rs=function()&#123;return-1&#125;,M.prototype._$Ds=function(t)&#123;&#125;,M.prototype.setBaseColor=function(t,e,i,r)&#123;t&lt;0?t=0:t&gt;1&amp;&amp;(t=1),e&lt;0?e=0:e&gt;1&amp;&amp;(e=1),i&lt;0?i=0:i&gt;1&amp;&amp;(i=1),r&lt;0?r=0:r&gt;1&amp;&amp;(r=1),this._$lT=t,this._$C0=e,this._$tT=i,this._$WL=r&#125;,M.prototype._$WP=function(t)&#123;this.culling=t&#125;,M.prototype.setMatrix=function(t)&#123;for(var e=0;e&lt;16;e++)this.matrix4x4[e]=t[e]&#125;,M.prototype._$IT=function()&#123;return this.matrix4x4&#125;,M.prototype.setPremultipliedAlpha=function(t)&#123;this.premultipliedAlpha=t&#125;,M.prototype.isPremultipliedAlpha=function()&#123;return this.premultipliedAlpha&#125;,M.prototype.setAnisotropy=function(t)&#123;this.anisotropy=t&#125;,M.prototype.getAnisotropy=function()&#123;return this.anisotropy&#125;,M.prototype.getClippingProcess=function()&#123;return this.clippingProcess&#125;,M.prototype.setClippingProcess=function(t)&#123;this.clippingProcess=t&#125;,M.prototype.setClipBufPre_clipContextForMask=function(t)&#123;this.clipBufPre_clipContextMask=t&#125;,M.prototype.getClipBufPre_clipContextMask=function()&#123;return this.clipBufPre_clipContextMask&#125;,M.prototype.setClipBufPre_clipContextForDraw=function(t)&#123;this.clipBufPre_clipContextDraw=t&#125;,M.prototype.getClipBufPre_clipContextDraw=function()&#123;return this.clipBufPre_clipContextDraw&#125;,A._$ur=-2,A._$c2=1,A._$_b=2,A.prototype._$F0=function(t)&#123;this._$kP=t._$nP(),this._$dr=t._$nP()&#125;,A.prototype.readV2_opacity=function(t)&#123;t.getFormatVersion()&gt;=G.LIVE2D_FORMAT_VERSION_V2_10_SDK2&amp;&amp;(this._$mS=t._$Tb())&#125;,A.prototype.init=function(t)&#123;&#125;,A.prototype._$Nr=function(t,e)&#123;&#125;,A.prototype.interpolateOpacity=function(t,e,i,r)&#123;null==this._$mS?i.setInterpolatedOpacity(1):i.setInterpolatedOpacity(S._$br(t,e,r,this._$mS))&#125;,A.prototype._$2b=function(t,e)&#123;&#125;,A.prototype._$nb=function(t,e,i,r,o,n,s)&#123;&#125;,A.prototype.getType=function()&#123;&#125;,A.prototype._$gs=function(t)&#123;this._$dr=t&#125;,A.prototype._$a2=function(t)&#123;this._$kP=t&#125;,A.prototype.getTargetBaseDataID=function()&#123;return this._$dr&#125;,A.prototype.getBaseDataID=function()&#123;return this._$kP&#125;,A.prototype._$32=function()&#123;return null!=this._$dr&amp;&amp;this._$dr!=yt._$2o()&#125;,x._$W2=0,x._$CS=x._$W2,x._$Mo=function()&#123;return!0&#125;,x._$XP=function(t)&#123;try&#123;for(var e=getTimeMSec();getTimeMSec()-e&lt;t;);&#125;catch(t)&#123;t._$Rb()&#125;&#125;,x.getUserTimeMSec=function()&#123;return x._$CS==x._$W2?x.getSystemTimeMSec():x._$CS&#125;,x.setUserTimeMSec=function(t)&#123;x._$CS=t&#125;,x.updateUserTimeMSec=function()&#123;return x._$CS=x.getSystemTimeMSec()&#125;,x.getTimeMSec=function()&#123;return(new Date).getTime()&#125;,x.getSystemTimeMSec=function()&#123;return(new Date).getTime()&#125;,x._$Q=function(t)&#123;&#125;,x._$jT=function(t,e,i,r,o)&#123;for(var n=0;n&lt;o;n++)i[r+n]=t[e+n]&#125;,I._$ds=-2,I.prototype._$F0=function(t)&#123;this._$wL=t._$nP(),this._$VP=t._$6L(),this._$GP=t._$nP()&#125;,I.prototype.getParamIndex=function(t)&#123;return this._$2r!=t&amp;&amp;(this._$8o=I._$ds),this._$8o&#125;,I.prototype._$Pb=function(t,e)&#123;this._$8o=t,this._$2r=e&#125;,I.prototype.getParamID=function()&#123;return this._$wL&#125;,I.prototype._$yP=function(t)&#123;this._$wL=t&#125;,I.prototype._$N2=function()&#123;return this._$VP&#125;,I.prototype._$d2=function()&#123;return this._$GP&#125;,I.prototype._$t2=function(t,e)&#123;this._$VP=t,this._$GP=e&#125;,I.prototype._$Lr=function()&#123;return this._$O2&#125;,I.prototype._$wr=function(t)&#123;this._$O2=t&#125;,I.prototype._$SL=function()&#123;return this._$ri&#125;,I.prototype._$AL=function(t)&#123;this._$ri=t&#125;,w.startsWith=function(t,e,i)&#123;var r=e+i.length;if(r&gt;=t.length)return!1;for(var o=e;o&lt;r;o++)if(w.getChar(t,o)!=i.charAt(o-e))return!1;return!0&#125;,w.getChar=function(t,e)&#123;return String.fromCharCode(t.getUint8(e))&#125;,w.createString=function(t,e,i)&#123;for(var r=new ArrayBuffer(2*i),o=new Uint16Array(r),n=0;n&lt;i;n++)o[n]=t.getUint8(e+n);return String.fromCharCode.apply(null,o)&#125;,w._$LS=function(t,e,i,r)&#123;t instanceof ArrayBuffer&amp;&amp;(t=new DataView(t));var o=i,n=!1,s=!1,_=0,a=w.getChar(t,o);&quot;-&quot;==a&amp;&amp;(n=!0,o++);for(var h=!1;o&lt;e;o++)&#123;switch(a=w.getChar(t,o))&#123;case&quot;0&quot;:_*=10;break;case&quot;1&quot;:_=10*_+1;break;case&quot;2&quot;:_=10*_+2;break;case&quot;3&quot;:_=10*_+3;break;case&quot;4&quot;:_=10*_+4;break;case&quot;5&quot;:_=10*_+5;break;case&quot;6&quot;:_=10*_+6;break;case&quot;7&quot;:_=10*_+7;break;case&quot;8&quot;:_=10*_+8;break;case&quot;9&quot;:_=10*_+9;break;case&quot;.&quot;:s=!0,o++,h=!0;break;default:h=!0&#125;if(h)break&#125;if(s)for(var l=.1,$=!1;o&lt;e;o++)&#123;switch(a=w.getChar(t,o))&#123;case&quot;0&quot;:break;case&quot;1&quot;:_+=1*l;break;case&quot;2&quot;:_+=2*l;break;case&quot;3&quot;:_+=3*l;break;case&quot;4&quot;:_+=4*l;break;case&quot;5&quot;:_+=5*l;break;case&quot;6&quot;:_+=6*l;break;case&quot;7&quot;:_+=7*l;break;case&quot;8&quot;:_+=8*l;break;case&quot;9&quot;:_+=9*l;break;default:$=!0&#125;if(l*=.1,$)break&#125;return n&amp;&amp;(_=-_),r[0]=o,_&#125;,D.prototype._$zP=function()&#123;this._$Ob=new Array&#125;,D.prototype._$F0=function(t)&#123;this._$Ob=t._$nP()&#125;,D.prototype._$Ur=function(t)&#123;if(t._$WS())return!0;for(var e=t._$v2(),i=this._$Ob.length-1;i&gt;=0;--i)&#123;var r=this._$Ob[i].getParamIndex(e);if(r==I._$ds&amp;&amp;(r=t.getParamIndex(this._$Ob[i].getParamID())),t._$Xb(r))return!0&#125;return!1&#125;,D.prototype._$Q2=function(t,e)&#123;for(var i,r,o=this._$Ob.length,n=t._$v2(),s=0,_=0;_&lt;o;_++)&#123;var a=this._$Ob[_];if((i=a.getParamIndex(n))==I._$ds&amp;&amp;(i=t.getParamIndex(a.getParamID()),a._$Pb(i,n)),i&lt;0)throw new Exception(&quot;err 23242 : &quot;+a.getParamID());var h=i&lt;0?0:t.getParamFloat(i);r=a._$N2();var l,$,u=a._$d2(),p=-1,c=0;if(r&lt;1);else if(1==r)(l=u[0])-B._$J&lt;h&amp;&amp;h&lt;l+B._$J?(p=0,c=0):(p=0,e[0]=!0);else if(h&lt;(l=u[0])-B._$J)p=0,e[0]=!0;else if(h&lt;l+B._$J)p=0;else&#123;for(var f=!1,g=1;g&lt;r;++g)&#123;if(h&lt;($=u[g])+B._$J)&#123;$-B._$J&lt;h?p=g:(p=g-1,c=(h-l)/($-l),s++),f=!0;break&#125;l=$&#125;f||(p=r-1,c=0,e[0]=!0)&#125;a._$wr(p),a._$AL(c)&#125;return s&#125;,D.prototype._$zr=function(t,e,i)&#123;var r=1&lt;&lt;i;r+1&gt;B._$Qb&amp;&amp;console.log(&quot;err 23245\\n&quot;);for(var o=this._$Ob.length,n=1,s=1,_=0,a=0;a&lt;r;++a)t[a]=0;for(var h=0;h&lt;o;++h)&#123;var l=this._$Ob[h];if(0==l._$SL())&#123;if(($=l._$Lr()*n)&lt;0&amp;&amp;_t._$3T)throw new Exception(&quot;err 23246&quot;);for(a=0;a&lt;r;++a)t[a]+=$&#125;else&#123;var $=n*l._$Lr(),u=n*(l._$Lr()+1);for(a=0;a&lt;r;++a)t[a]+=(a/s|0)%2==0?$:u;e[_++]=l._$SL(),s*=2&#125;n*=l._$N2()&#125;t[r]=65535,e[_]=-1&#125;,D.prototype._$h2=function(t,e,i)&#123;for(var r=new Float32Array(e),o=0;o&lt;e;++o)r[o]=i[o];var n=new I;n._$yP(t),n._$t2(e,r),this._$Ob.push(n)&#125;,D.prototype._$J2=function(t)&#123;for(var e=t,i=this._$Ob.length,r=0;r&lt;i;++r)&#123;var o=this._$Ob[r],n=o._$N2(),s=e%o._$N2(),_=o._$d2()[s];console.log(&quot;%s[%d]=%7.2f / &quot;,o.getParamID(),s,_),e/=n&#125;console.log(&quot;\\n&quot;)&#125;,D.prototype.getParamCount=function()&#123;return this._$Ob.length&#125;,D.prototype._$zs=function()&#123;return this._$Ob&#125;,O.prototype.identity=function()&#123;for(var t=0;t&lt;16;t++)this.m[t]=t%5==0?1:0&#125;,O.prototype.getArray=function()&#123;return this.m&#125;,O.prototype.getCopyMatrix=function()&#123;return new Float32Array(this.m)&#125;,O.prototype.setMatrix=function(t)&#123;if(null!=t&amp;&amp;16==t.length)for(var e=0;e&lt;16;e++)this.m[e]=t[e]&#125;,O.prototype.mult=function(t,e,i)&#123;return null==e?null:(this==e?this.mult_safe(this.m,t.m,e.m,i):this.mult_fast(this.m,t.m,e.m,i),e)&#125;,O.prototype.mult_safe=function(t,e,i,r)&#123;if(t==i)&#123;var o=new Array(16);this.mult_fast(t,e,o,r);for(var n=15;n&gt;=0;--n)i[n]=o[n]&#125;else this.mult_fast(t,e,i,r)&#125;,O.prototype.mult_fast=function(t,e,i,r)&#123;r?(i[0]=t[0]*e[0]+t[4]*e[1]+t[8]*e[2],i[4]=t[0]*e[4]+t[4]*e[5]+t[8]*e[6],i[8]=t[0]*e[8]+t[4]*e[9]+t[8]*e[10],i[12]=t[0]*e[12]+t[4]*e[13]+t[8]*e[14]+t[12],i[1]=t[1]*e[0]+t[5]*e[1]+t[9]*e[2],i[5]=t[1]*e[4]+t[5]*e[5]+t[9]*e[6],i[9]=t[1]*e[8]+t[5]*e[9]+t[9]*e[10],i[13]=t[1]*e[12]+t[5]*e[13]+t[9]*e[14]+t[13],i[2]=t[2]*e[0]+t[6]*e[1]+t[10]*e[2],i[6]=t[2]*e[4]+t[6]*e[5]+t[10]*e[6],i[10]=t[2]*e[8]+t[6]*e[9]+t[10]*e[10],i[14]=t[2]*e[12]+t[6]*e[13]+t[10]*e[14]+t[14],i[3]=i[7]=i[11]=0,i[15]=1):(i[0]=t[0]*e[0]+t[4]*e[1]+t[8]*e[2]+t[12]*e[3],i[4]=t[0]*e[4]+t[4]*e[5]+t[8]*e[6]+t[12]*e[7],i[8]=t[0]*e[8]+t[4]*e[9]+t[8]*e[10]+t[12]*e[11],i[12]=t[0]*e[12]+t[4]*e[13]+t[8]*e[14]+t[12]*e[15],i[1]=t[1]*e[0]+t[5]*e[1]+t[9]*e[2]+t[13]*e[3],i[5]=t[1]*e[4]+t[5]*e[5]+t[9]*e[6]+t[13]*e[7],i[9]=t[1]*e[8]+t[5]*e[9]+t[9]*e[10]+t[13]*e[11],i[13]=t[1]*e[12]+t[5]*e[13]+t[9]*e[14]+t[13]*e[15],i[2]=t[2]*e[0]+t[6]*e[1]+t[10]*e[2]+t[14]*e[3],i[6]=t[2]*e[4]+t[6]*e[5]+t[10]*e[6]+t[14]*e[7],i[10]=t[2]*e[8]+t[6]*e[9]+t[10]*e[10]+t[14]*e[11],i[14]=t[2]*e[12]+t[6]*e[13]+t[10]*e[14]+t[14]*e[15],i[3]=t[3]*e[0]+t[7]*e[1]+t[11]*e[2]+t[15]*e[3],i[7]=t[3]*e[4]+t[7]*e[5]+t[11]*e[6]+t[15]*e[7],i[11]=t[3]*e[8]+t[7]*e[9]+t[11]*e[10]+t[15]*e[11],i[15]=t[3]*e[12]+t[7]*e[13]+t[11]*e[14]+t[15]*e[15])&#125;,O.prototype.translate=function(t,e,i)&#123;this.m[12]=this.m[0]*t+this.m[4]*e+this.m[8]*i+this.m[12],this.m[13]=this.m[1]*t+this.m[5]*e+this.m[9]*i+this.m[13],this.m[14]=this.m[2]*t+this.m[6]*e+this.m[10]*i+this.m[14],this.m[15]=this.m[3]*t+this.m[7]*e+this.m[11]*i+this.m[15]&#125;,O.prototype.scale=function(t,e,i)&#123;this.m[0]*=t,this.m[4]*=e,this.m[8]*=i,this.m[1]*=t,this.m[5]*=e,this.m[9]*=i,this.m[2]*=t,this.m[6]*=e,this.m[10]*=i,this.m[3]*=t,this.m[7]*=e,this.m[11]*=i&#125;,O.prototype.rotateX=function(t)&#123;var e=vt.fcos(t),i=vt._$9(t),r=this.m[4];this.m[4]=r*e+this.m[8]*i,this.m[8]=r*-i+this.m[8]*e,r=this.m[5],this.m[5]=r*e+this.m[9]*i,this.m[9]=r*-i+this.m[9]*e,r=this.m[6],this.m[6]=r*e+this.m[10]*i,this.m[10]=r*-i+this.m[10]*e,r=this.m[7],this.m[7]=r*e+this.m[11]*i,this.m[11]=r*-i+this.m[11]*e&#125;,O.prototype.rotateY=function(t)&#123;var e=vt.fcos(t),i=vt._$9(t),r=this.m[0];this.m[0]=r*e+this.m[8]*-i,this.m[8]=r*i+this.m[8]*e,r=this.m[1],this.m[1]=r*e+this.m[9]*-i,this.m[9]=r*i+this.m[9]*e,r=m[2],this.m[2]=r*e+this.m[10]*-i,this.m[10]=r*i+this.m[10]*e,r=m[3],this.m[3]=r*e+this.m[11]*-i,this.m[11]=r*i+this.m[11]*e&#125;,O.prototype.rotateZ=function(t)&#123;var e=vt.fcos(t),i=vt._$9(t),r=this.m[0];this.m[0]=r*e+this.m[4]*i,this.m[4]=r*-i+this.m[4]*e,r=this.m[1],this.m[1]=r*e+this.m[5]*i,this.m[5]=r*-i+this.m[5]*e,r=this.m[2],this.m[2]=r*e+this.m[6]*i,this.m[6]=r*-i+this.m[6]*e,r=this.m[3],this.m[3]=r*e+this.m[7]*i,this.m[7]=r*-i+this.m[7]*e&#125;,R.prototype=new it,R._$tP=new Object,R._$27=function()&#123;R._$tP.clear()&#125;,R.getID=function(t)&#123;var e=R._$tP[t];return null==e&amp;&amp;(e=new R(t),R._$tP[t]=e),e&#125;,R.prototype._$3s=function()&#123;return new R&#125;,b._$kS=-1,b._$pS=0,b._$hb=1,b.STATE_IDENTITY=0,b._$gb=1,b._$fo=2,b._$go=4,b.prototype.transform=function(t,e,i)&#123;var r,o,n,s,_,a,h=0,l=0;switch(this._$hi)&#123;default:return;case b._$go|b._$fo|b._$gb:for(r=this._$7,o=this._$H,n=this._$k,s=this._$f,_=this._$g,a=this._$w;--i&gt;=0;)&#123;var $=t[h++],u=t[h++];e[l++]=r*$+o*u+n,e[l++]=s*$+_*u+a&#125;return;case b._$go|b._$fo:for(r=this._$7,o=this._$H,s=this._$f,_=this._$g;--i&gt;=0;)&#123;$=t[h++],u=t[h++];e[l++]=r*$+o*u,e[l++]=s*$+_*u&#125;return;case b._$go|b._$gb:for(o=this._$H,n=this._$k,s=this._$f,a=this._$w;--i&gt;=0;)&#123;$=t[h++];e[l++]=o*t[h++]+n,e[l++]=s*$+a&#125;return;case b._$go:for(o=this._$H,s=this._$f;--i&gt;=0;)&#123;$=t[h++];e[l++]=o*t[h++],e[l++]=s*$&#125;return;case b._$fo|b._$gb:for(r=this._$7,n=this._$k,_=this._$g,a=this._$w;--i&gt;=0;)e[l++]=r*t[h++]+n,e[l++]=_*t[h++]+a;return;case b._$fo:for(r=this._$7,_=this._$g;--i&gt;=0;)e[l++]=r*t[h++],e[l++]=_*t[h++];return;case b._$gb:for(n=this._$k,a=this._$w;--i&gt;=0;)e[l++]=t[h++]+n,e[l++]=t[h++]+a;return;case b.STATE_IDENTITY:return void(t==e&amp;&amp;h==l||x._$jT(t,h,e,l,2*i))&#125;&#125;,b.prototype.update=function()&#123;0==this._$H&amp;&amp;0==this._$f?1==this._$7&amp;&amp;1==this._$g?0==this._$k&amp;&amp;0==this._$w?(this._$hi=b.STATE_IDENTITY,this._$Z=b._$pS):(this._$hi=b._$gb,this._$Z=b._$hb):0==this._$k&amp;&amp;0==this._$w?(this._$hi=b._$fo,this._$Z=b._$kS):(this._$hi=b._$fo|b._$gb,this._$Z=b._$kS):0==this._$7&amp;&amp;0==this._$g?0==this._$k&amp;&amp;0==this._$w?(this._$hi=b._$go,this._$Z=b._$kS):(this._$hi=b._$go|b._$gb,this._$Z=b._$kS):0==this._$k&amp;&amp;0==this._$w?(this._$hi=b._$go|b._$fo,this._$Z=b._$kS):(this._$hi=b._$go|b._$fo|b._$gb,this._$Z=b._$kS)&#125;,b.prototype._$RT=function(t)&#123;this._$IT(t);var e=t[0],i=t[2],r=t[1],o=t[3],n=Math.sqrt(e*e+r*r),s=e*o-i*r;0==n?_t._$so&amp;&amp;console.log(&quot;affine._$RT() / rt==0&quot;):(t[0]=n,t[1]=s/n,t[2]=(r*o+e*i)/s,t[3]=Math.atan2(r,e))&#125;,b.prototype._$ho=function(t,e,i,r)&#123;var o=new Float32Array(6),n=new Float32Array(6);t._$RT(o),e._$RT(n);var s=new Float32Array(6);s[0]=o[0]+(n[0]-o[0])*i,s[1]=o[1]+(n[1]-o[1])*i,s[2]=o[2]+(n[2]-o[2])*i,s[3]=o[3]+(n[3]-o[3])*i,s[4]=o[4]+(n[4]-o[4])*i,s[5]=o[5]+(n[5]-o[5])*i,r._$CT(s)&#125;,b.prototype._$CT=function(t)&#123;var e=Math.cos(t[3]),i=Math.sin(t[3]);this._$7=t[0]*e,this._$f=t[0]*i,this._$H=t[1]*(t[2]*e-i),this._$g=t[1]*(t[2]*i+e),this._$k=t[4],this._$w=t[5],this.update()&#125;,b.prototype._$IT=function(t)&#123;t[0]=this._$7,t[1]=this._$f,t[2]=this._$H,t[3]=this._$g,t[4]=this._$k,t[5]=this._$w&#125;,F.prototype=new s,F._$cs=&quot;VISIBLE:&quot;,F._$ar=&quot;LAYOUT:&quot;,F._$Co=0,F._$D2=[],F._$1T=1,F.loadMotion=function(t)&#123;var e=new F,i=[0],r=t.length;e._$yT=0;for(var o=0;o&lt;r;++o)&#123;var n=255&amp;t[o];if(&quot;\\n&quot;!=n&amp;&amp;&quot;\\r&quot;!=n)if(&quot;#&quot;!=n)if(&quot;$&quot;!=n)&#123;if(&quot;a&quot;&lt;=n&amp;&amp;n&lt;=&quot;z&quot;||&quot;A&quot;&lt;=n&amp;&amp;n&lt;=&quot;Z&quot;||&quot;_&quot;==n)&#123;for(h=o,l=-1;o&lt;r&amp;&amp;(&quot;\\r&quot;!=(n=255&amp;t[o])&amp;&amp;&quot;\\n&quot;!=n);++o)if(&quot;=&quot;==n)&#123;l=o;break&#125;if(l&gt;=0)&#123;var s=new N;w.startsWith(t,h,F._$cs)?(s._$RP=N._$hs,s._$4P=new String(t,h,l-h)):w.startsWith(t,h,F._$ar)?(s._$4P=new String(t,h+7,l-h-7),w.startsWith(t,h+7,&quot;ANCHOR_X&quot;)?s._$RP=N._$xs:w.startsWith(t,h+7,&quot;ANCHOR_Y&quot;)?s._$RP=N._$us:w.startsWith(t,h+7,&quot;SCALE_X&quot;)?s._$RP=N._$qs:w.startsWith(t,h+7,&quot;SCALE_Y&quot;)?s._$RP=N._$Ys:w.startsWith(t,h+7,&quot;X&quot;)?s._$RP=N._$ws:w.startsWith(t,h+7,&quot;Y&quot;)&amp;&amp;(s._$RP=N._$Ns)):(s._$RP=N._$Fr,s._$4P=new String(t,h,l-h)),e.motions.push(s);var _=0;for(F._$D2.clear(),o=l+1;o&lt;r&amp;&amp;(&quot;\\r&quot;!=(n=255&amp;t[o])&amp;&amp;&quot;\\n&quot;!=n);++o)if(&quot;,&quot;!=n&amp;&amp;&quot; &quot;!=n&amp;&amp;&quot;\\t&quot;!=n)&#123;u=w._$LS(t,r,o,i);if(i[0]&gt;0)&#123;F._$D2.push(u),_++;var a=i[0];if(a&lt;o)&#123;console.log(&quot;_$n0 _$hi . @Live2DMotion loadMotion()\\n&quot;);break&#125;o=a&#125;&#125;s._$I0=F._$D2._$BL(),_&gt;e._$yT&amp;&amp;(e._$yT=_)&#125;&#125;&#125;else&#123;for(var h=o,l=-1;o&lt;r&amp;&amp;(&quot;\\r&quot;!=(n=255&amp;t[o])&amp;&amp;&quot;\\n&quot;!=n);++o)if(&quot;=&quot;==n)&#123;l=o;break&#125;var $=!1;if(l&gt;=0)for(l==h+4&amp;&amp;&quot;f&quot;==t[h+1]&amp;&amp;&quot;p&quot;==t[h+2]&amp;&amp;&quot;s&quot;==t[h+3]&amp;&amp;($=!0),o=l+1;o&lt;r&amp;&amp;(&quot;\\r&quot;!=(n=255&amp;t[o])&amp;&amp;&quot;\\n&quot;!=n);++o)if(&quot;,&quot;!=n&amp;&amp;&quot; &quot;!=n&amp;&amp;&quot;\\t&quot;!=n)&#123;var u=w._$LS(t,r,o,i);i[0]&gt;0&amp;&amp;$&amp;&amp;5&lt;u&amp;&amp;u&lt;121&amp;&amp;(e._$D0=u),o=i[0]&#125;for(;o&lt;r&amp;&amp;(&quot;\\n&quot;!=t[o]&amp;&amp;&quot;\\r&quot;!=t[o]);++o);&#125;else for(;o&lt;r&amp;&amp;(&quot;\\n&quot;!=t[o]&amp;&amp;&quot;\\r&quot;!=t[o]);++o);&#125;return e._$AS=1e3*e._$yT/e._$D0|0,e&#125;,F.prototype.getDurationMSec=function()&#123;return this._$AS&#125;,F.prototype.dump=function()&#123;for(var t=0;t&lt;this.motions.length;t++)&#123;var e=this.motions[t];console.log(&quot;_$wL[%s] [%d]. &quot;,e._$4P,e._$I0.length);for(var i=0;i&lt;e._$I0.length&amp;&amp;i&lt;10;i++)console.log(&quot;%5.2f ,&quot;,e._$I0[i]);console.log(&quot;\\n&quot;)&#125;&#125;,F.prototype.updateParamExe=function(t,e,i,r)&#123;for(var o=(e-r._$z2)*this._$D0/1e3,n=0|o,s=o-n,_=0;_&lt;this.motions.length;_++)&#123;var a=this.motions[_],h=a._$I0.length,l=a._$4P;if(a._$RP==N._$hs)&#123;var $=a._$I0[n&gt;=h?h-1:n];t.setParamFloat(l,$)&#125;else if(N._$ws&lt;=a._$RP&amp;&amp;a._$RP&lt;=N._$Ys);else&#123;var u=t.getParamFloat(l),p=a._$I0[n&gt;=h?h-1:n],c=u+(p+(a._$I0[n+1&gt;=h?h-1:n+1]-p)*s-u)*i;t.setParamFloat(l,c)&#125;&#125;n&gt;=this._$yT&amp;&amp;(this._$E?(r._$z2=e,this.loopFadeIn&amp;&amp;(r._$bs=e)):r._$9L=!0)&#125;,F.prototype._$r0=function()&#123;return this._$E&#125;,F.prototype._$aL=function(t)&#123;this._$E=t&#125;,F.prototype.isLoopFadeIn=function()&#123;return this.loopFadeIn&#125;,F.prototype.setLoopFadeIn=function(t)&#123;this.loopFadeIn=t&#125;,C.prototype.clear=function()&#123;this.size=0&#125;,C.prototype.add=function(t)&#123;if(this._$P.length&lt;=this.size)&#123;var e=new Float32Array(2*this.size);x._$jT(this._$P,0,e,0,this.size),this._$P=e&#125;this._$P[this.size++]=t&#125;,C.prototype._$BL=function()&#123;var t=new Float32Array(this.size);return x._$jT(this._$P,0,t,0,this.size),t&#125;,N._$Fr=0,N._$hs=1,N._$ws=100,N._$Ns=101,N._$xs=102,N._$us=103,N._$qs=104,N._$Ys=105,B._$Ms=1,B._$Qs=2,B._$i2=0,B._$No=2,B._$do=B._$Ms,B._$Ls=!0,B._$1r=5,B._$Qb=65,B._$J=1e-4,B._$FT=.001,B._$Ss=3,G._$o7=6,G._$S7=7,G._$s7=8,G._$77=9,G.LIVE2D_FORMAT_VERSION_V2_10_SDK2=10,G.LIVE2D_FORMAT_VERSION_V2_11_SDK2_1=11,G._$T7=G.LIVE2D_FORMAT_VERSION_V2_11_SDK2_1,G._$Is=-2004318072,G._$h0=0,G._$4L=23,G._$7P=33,G._$uT=function(t)&#123;console.log(&quot;_$bo :: _$6 _$mo _$E0 : %d\\n&quot;,t)&#125;,G._$9o=function(t)&#123;if(t&lt;40)return G._$uT(t),null;if(t&lt;50)return G._$uT(t),null;if(t&lt;60)return G._$uT(t),null;if(t&lt;100)switch(t)&#123;case 65:return new Z;case 66:return new D;case 67:return new I;case 68:return new z;case 69:return new d;case 70:return new lt;default:return G._$uT(t),null&#125;else if(t&lt;150)switch(t)&#123;case 131:return new nt;case 133:return new tt;case 136:return new $;case 137:return new rt;case 142:return new j&#125;return G._$uT(t),null&#125;,U._$HP=0,U._$_0=!0,U._$V2=-1,U._$W0=-1,U._$jr=!1,U._$ZS=!0,U._$tr=-1e6,U._$lr=1e6,U._$is=32,U._$e=!1,U.prototype.getDrawDataIndex=function(t)&#123;for(var e=this._$aS.length-1;e&gt;=0;--e)if(null!=this._$aS[e]&amp;&amp;this._$aS[e].getDrawDataID()==t)return e;return-1&#125;,U.prototype.getDrawData=function(t)&#123;if(t instanceof R)&#123;if(null==this._$Bo)&#123;this._$Bo=new Object;for(var e=this._$aS.length,i=0;i&lt;e;i++)&#123;var r=this._$aS[i],o=r.getDrawDataID();null!=o&amp;&amp;(this._$Bo[o]=r)&#125;&#125;return this._$Bo[id]&#125;return t&lt;this._$aS.length?this._$aS[t]:null&#125;,U.prototype.release=function()&#123;this._$3S.clear(),this._$aS.clear(),this._$F2.clear(),null!=this._$Bo&amp;&amp;this._$Bo.clear(),this._$db.clear(),this._$8b.clear(),this._$Hr.clear()&#125;,U.prototype.init=function()&#123;this._$co++,this._$F2.length&gt;0&amp;&amp;this.release();for(var t=this._$Ri.getModelImpl(),e=t._$Xr(),i=e.length,r=new Array,n=new Array,s=0;s&lt;i;++s)&#123;var _=e[s];this._$F2.push(_),this._$Hr.push(_.init(this));for(var a=_.getBaseData(),h=a.length,l=0;l&lt;h;++l)r.push(a[l]);for(l=0;l&lt;h;++l)&#123;var $=a[l].init(this);$._$l2(s),n.push($)&#125;var u=_.getDrawData(),p=u.length;for(l=0;l&lt;p;++l)&#123;var c=u[l],f=c.init(this);f._$IP=s,this._$aS.push(c),this._$8b.push(f)&#125;&#125;for(var g=r.length,y=yt._$2o();;)&#123;var d=!1;for(s=0;s&lt;g;++s)&#123;var m=r[s];if(null!=m)&#123;var T=m.getTargetBaseDataID();(null==T||T==y||this.getBaseDataIndex(T)&gt;=0)&amp;&amp;(this._$3S.push(m),this._$db.push(n[s]),r[s]=null,d=!0)&#125;&#125;if(!d)break&#125;var P=t._$E2();if(null!=P)&#123;var S=P._$1s();if(null!=S)&#123;var v=S.length;for(s=0;s&lt;v;++s)&#123;var L=S[s];null!=L&amp;&amp;this._$02(L.getParamID(),L.getDefaultValue(),L.getMinValue(),L.getMaxValue())&#125;&#125;&#125;this.clipManager=new o(this.dp_webgl),this.clipManager.init(this,this._$aS,this._$8b),this._$QT=!0&#125;,U.prototype.update=function()&#123;U._$e&amp;&amp;_.start(&quot;_$zL&quot;);for(var t=this._$_2.length,e=0;e&lt;t;e++)this._$_2[e]!=this._$vr[e]&amp;&amp;(this._$Js[e]=U._$ZS,this._$vr[e]=this._$_2[e]);var i=this._$3S.length,r=this._$aS.length,o=W._$or(),n=W._$Pr()-o+1;(null==this._$Ws||this._$Ws.length&lt;n)&amp;&amp;(this._$Ws=new Int16Array(n),this._$Vs=new Int16Array(n));for(e=0;e&lt;n;e++)this._$Ws[e]=U._$V2,this._$Vs[e]=U._$V2;(null==this._$Er||this._$Er.length&lt;r)&amp;&amp;(this._$Er=new Int16Array(r));for(e=0;e&lt;r;e++)this._$Er[e]=U._$W0;U._$e&amp;&amp;_.dump(&quot;_$zL&quot;),U._$e&amp;&amp;_.start(&quot;_$UL&quot;);for(var s=null,a=0;a&lt;i;++a)&#123;var h=this._$3S[a],l=this._$db[a];try&#123;h._$Nr(this,l),h._$2b(this,l)&#125;catch(t)&#123;null==s&amp;&amp;(s=t)&#125;&#125;null!=s&amp;&amp;U._$_0&amp;&amp;_._$Rb(s),U._$e&amp;&amp;_.dump(&quot;_$UL&quot;),U._$e&amp;&amp;_.start(&quot;_$DL&quot;);for(var $=null,u=0;u&lt;r;++u)&#123;var p=this._$aS[u],c=this._$8b[u];try&#123;if(p._$Nr(this,c),c._$u2())continue;p._$2b(this,c);var f,g=Math.floor(p._$zS(this,c)-o);try&#123;f=this._$Vs[g]&#125;catch(t)&#123;console.log(&quot;_$li :: %s / %s        @@_$fS\\n&quot;,t.toString(),p.getDrawDataID().toString()),g=Math.floor(p._$zS(this,c)-o);continue&#125;f==U._$V2?this._$Ws[g]=u:this._$Er[f]=u,this._$Vs[g]=u&#125;catch(t)&#123;null==$&amp;&amp;($=t,_t._$sT(_t._$H7))&#125;&#125;null!=$&amp;&amp;U._$_0&amp;&amp;_._$Rb($),U._$e&amp;&amp;_.dump(&quot;_$DL&quot;),U._$e&amp;&amp;_.start(&quot;_$eL&quot;);for(e=this._$Js.length-1;e&gt;=0;e--)this._$Js[e]=U._$jr;return this._$QT=!1,U._$e&amp;&amp;_.dump(&quot;_$eL&quot;),!1&#125;,U.prototype.preDraw=function(t)&#123;null!=this.clipManager&amp;&amp;(t._$ZT(),this.clipManager.setupClip(this,t))&#125;,U.prototype.draw=function(t)&#123;if(null!=this._$Ws)&#123;var e=this._$Ws.length;t._$ZT();for(var i=0;i&lt;e;++i)&#123;var r=this._$Ws[i];if(r!=U._$V2)for(;;)&#123;var o=this._$aS[r],n=this._$8b[r];if(n._$yo())&#123;var s=n._$IP,a=this._$Hr[s];n._$VS=a.getPartsOpacity(),o.draw(t,this,n)&#125;var h=this._$Er[r];if(h&lt;=r||h==U._$W0)break;r=h&#125;&#125;&#125;else _._$li(&quot;call _$Ri.update() before _$Ri.draw() &quot;)&#125;,U.prototype.getParamIndex=function(t)&#123;for(var e=this._$pb.length-1;e&gt;=0;--e)if(this._$pb[e]==t)return e;return this._$02(t,0,U._$tr,U._$lr)&#125;,U.prototype._$BS=function(t)&#123;return this.getBaseDataIndex(t)&#125;,U.prototype.getBaseDataIndex=function(t)&#123;for(var e=this._$3S.length-1;e&gt;=0;--e)if(null!=this._$3S[e]&amp;&amp;this._$3S[e].getBaseDataID()==t)return e;return-1&#125;,U.prototype._$UT=function(t,e)&#123;var i=new Float32Array(e);return x._$jT(t,0,i,0,t.length),i&#125;,U.prototype._$02=function(t,e,i,r)&#123;if(this._$qo&gt;=this._$pb.length)&#123;var o=this._$pb.length,n=new Array(2*o);x._$jT(this._$pb,0,n,0,o),this._$pb=n,this._$_2=this._$UT(this._$_2,2*o),this._$vr=this._$UT(this._$vr,2*o),this._$Rr=this._$UT(this._$Rr,2*o),this._$Or=this._$UT(this._$Or,2*o);var s=new Array;x._$jT(this._$Js,0,s,0,o),this._$Js=s&#125;return this._$pb[this._$qo]=t,this._$_2[this._$qo]=e,this._$vr[this._$qo]=e,this._$Rr[this._$qo]=i,this._$Or[this._$qo]=r,this._$Js[this._$qo]=U._$ZS,this._$qo++&#125;,U.prototype._$Zo=function(t,e)&#123;this._$3S[t]=e&#125;,U.prototype.setParamFloat=function(t,e)&#123;e&lt;this._$Rr[t]&amp;&amp;(e=this._$Rr[t]),e&gt;this._$Or[t]&amp;&amp;(e=this._$Or[t]),this._$_2[t]=e&#125;,U.prototype.loadParam=function()&#123;var t=this._$_2.length;t&gt;this._$fs.length&amp;&amp;(t=this._$fs.length),x._$jT(this._$fs,0,this._$_2,0,t)&#125;,U.prototype.saveParam=function()&#123;var t=this._$_2.length;t&gt;this._$fs.length&amp;&amp;(this._$fs=new Float32Array(t)),x._$jT(this._$_2,0,this._$fs,0,t)&#125;,U.prototype._$v2=function()&#123;return this._$co&#125;,U.prototype._$WS=function()&#123;return this._$QT&#125;,U.prototype._$Xb=function(t)&#123;return this._$Js[t]==U._$ZS&#125;,U.prototype._$vs=function()&#123;return this._$Es&#125;,U.prototype._$Tr=function()&#123;return this._$ZP&#125;,U.prototype.getBaseData=function(t)&#123;return this._$3S[t]&#125;,U.prototype.getParamFloat=function(t)&#123;return this._$_2[t]&#125;,U.prototype.getParamMax=function(t)&#123;return this._$Or[t]&#125;,U.prototype.getParamMin=function(t)&#123;return this._$Rr[t]&#125;,U.prototype.setPartsOpacity=function(t,e)&#123;this._$Hr[t].setPartsOpacity(e)&#125;,U.prototype.getPartsOpacity=function(t)&#123;return this._$Hr[t].getPartsOpacity()&#125;,U.prototype.getPartsDataIndex=function(t)&#123;for(var e=this._$F2.length-1;e&gt;=0;--e)if(null!=this._$F2[e]&amp;&amp;this._$F2[e]._$p2()==t)return e;return-1&#125;,U.prototype._$q2=function(t)&#123;return this._$db[t]&#125;,U.prototype._$C2=function(t)&#123;return this._$8b[t]&#125;,U.prototype._$Bb=function(t)&#123;return this._$Hr[t]&#125;,U.prototype._$5s=function(t,e)&#123;for(var i=this._$Ws.length,r=t,o=0;o&lt;i;++o)&#123;var n=this._$Ws[o];if(n!=U._$V2)for(;;)&#123;var s=this._$8b[n];s._$yo()&amp;&amp;(s._$GT()._$B2(this,s,r),r+=e);var _=this._$Er[n];if(_&lt;=n||_==U._$W0)break;n=_&#125;&#125;&#125;,U.prototype.setDrawParam=function(t)&#123;this.dp_webgl=t&#125;,U.prototype.getDrawParam=function()&#123;return this.dp_webgl&#125;,Y._$0T=function(t)&#123;return Y._$0T(new _$5(t))&#125;,Y._$0T=function(t)&#123;if(!t.exists())throw new _$ls(t._$3b());for(var e,i=t.length(),r=new Int8Array(i),o=new _$Xs(new _$kb(t),8192),n=0;(e=o.read(r,n,i-n))&gt;0;)n+=e;return r&#125;,Y._$C=function(t)&#123;var e=null,i=null;try&#123;e=t instanceof Array?t:new _$Xs(t,8192),i=new _$js;for(var r,o=new Int8Array(1e3);(r=e.read(o))&gt;0;)i.write(o,0,r);return i._$TS()&#125;finally&#123;null!=t&amp;&amp;t.close(),null!=i&amp;&amp;(i.flush(),i.close())&#125;&#125;,k.prototype._$T2=function()&#123;return x.getUserTimeMSec()+Math._$10()*(2*this._$Br-1)&#125;,k.prototype._$uo=function(t)&#123;this._$Br=t&#125;,k.prototype._$QS=function(t,e,i)&#123;this._$Dr=t,this._$Cb=e,this._$mr=i&#125;,k.prototype._$7T=function(t)&#123;var e,i=x.getUserTimeMSec(),r=0;switch(this._$_L)&#123;case STATE_CLOSING:(r=(i-this._$bb)/this._$Dr)&gt;=1&amp;&amp;(r=1,this._$_L=V.STATE_CLOSED,this._$bb=i),e=1-r;break;case STATE_CLOSED:(r=(i-this._$bb)/this._$Cb)&gt;=1&amp;&amp;(this._$_L=V.STATE_OPENING,this._$bb=i),e=0;break;case STATE_OPENING:(r=(i-this._$bb)/this._$mr)&gt;=1&amp;&amp;(r=1,this._$_L=V.STATE_INTERVAL,this._$12=this._$T2()),e=r;break;case STATE_INTERVAL:this._$12&lt;i&amp;&amp;(this._$_L=V.STATE_CLOSING,this._$bb=i),e=1;break;case STATE_FIRST:default:this._$_L=V.STATE_INTERVAL,this._$12=this._$T2(),e=1&#125;this._$jo||(e=-e),t.setParamFloat(this._$iL,e),t.setParamFloat(this._$0L,e)&#125;;var V=function()&#123;&#125;;function X()&#123;i||(M.prototype.constructor.call(this),this._$sb=new Int32Array(X._$As),this._$U2=new Array,this.transform=null,this.gl=null,null==X._$NT&amp;&amp;(X._$NT=X._$9r(256),X._$vS=X._$9r(256),X._$no=X._$vb(256)))&#125;function z()&#123;i||(A.prototype.constructor.call(this),this._$GS=null,this._$Y0=null)&#125;function H(t)&#123;st.prototype.constructor.call(this,t),this._$8r=A._$ur,this._$Yr=null,this._$Wr=null&#125;function W()&#123;i||(L.prototype.constructor.call(this),this._$gP=null,this._$dr=null,this._$GS=null,this._$qb=null,this._$Lb=null,this._$mS=null)&#125;function j()&#123;i||(this._$NL=null,this._$3S=null,this._$aS=null,j._$42++)&#125;function q()&#123;i||(r.prototype.constructor.call(this),this._$zo=new X)&#125;function J()&#123;i||(s.prototype.constructor.call(this),this.motions=new Array,this._$o2=null,this._$7r=J._$Co++,this._$D0=30,this._$yT=0,this._$E=!1,this.loopFadeIn=!0,this._$rr=-1,this._$eP=0)&#125;function Q(t,e)&#123;return String.fromCharCode(t.getUint8(e))&#125;function C()&#123;this._$P=new Float32Array(100),this.size=0&#125;function N()&#123;this._$4P=null,this._$I0=null,this._$RP=null&#125;function Z()&#123;i||(A.prototype.constructor.call(this),this._$o=0,this._$A=0,this._$GS=null,this._$Eo=null)&#125;function K(t)&#123;st.prototype.constructor.call(this,t),this._$8r=A._$ur,this._$Cr=null,this._$hr=null&#125;function tt()&#123;i||(this.visible=!0,this._$g0=!1,this._$NL=null,this._$3S=null,this._$aS=null,tt._$42++)&#125;function et(t)&#123;this._$VS=null,this._$e0=null,this._$e0=t&#125;function it(t)&#123;i||(this.id=t)&#125;function rt()&#123;i||(this._$4S=null)&#125;function ot(t,e)&#123;this.canvas=t,this.context=e,this.viewport=new Array(0,0,t.width,t.height),this._$6r=1,this._$xP=0,this._$3r=1,this._$uP=0,this._$Qo=-1,this.cacheImages=&#123;&#125;&#125;function nt()&#123;i||(this._$TT=null,this._$LT=null,this._$FS=null,this._$wL=null)&#125;function st(t)&#123;i||(this._$e0=null,this._$IP=null,this._$JS=!1,this._$AT=!0,this._$e0=t,this.totalScale=1,this._$7s=1,this.totalOpacity=1)&#125;function _t()&#123;&#125;function at()&#123;&#125;function ht(t)&#123;i||(this._$ib=t)&#125;function lt()&#123;i||(W.prototype.constructor.call(this),this._$LP=-1,this._$d0=0,this._$Yo=0,this._$JP=null,this._$5P=null,this._$BP=null,this._$Eo=null,this._$Qi=null,this._$6s=lt._$ms,this.culling=!0,this.gl_cacheImage=null,this.instanceNo=lt._$42++)&#125;function $t(t)&#123;Lt.prototype.constructor.call(this,t),this._$8r=W._$ur,this._$Cr=null,this._$hr=null&#125;function ut()&#123;i||(this.x=null,this.y=null)&#125;function pt(t)&#123;i||(r.prototype.constructor.call(this),this.drawParamWebGL=new dt(t),this.drawParamWebGL.setGL(_t.getGL(t)))&#125;function ct()&#123;i||(this.motions=null,this._$eb=!1,this.motions=new Array)&#125;function ft()&#123;this._$w0=null,this._$AT=!0,this._$9L=!1,this._$z2=-1,this._$bs=-1,this._$Do=-1,this._$sr=null,this._$sr=ft._$Gs++&#125;function gt()&#123;this.m=new Array(1,0,0,0,1,0,0,0,1)&#125;function yt(t)&#123;i||it.prototype.constructor.call(this,t)&#125;function dt(t)&#123;i||(M.prototype.constructor.call(this),this.textures=new Array,this.transform=null,this.gl=null,this.glno=t,this.firstDraw=!0,this.anisotropyExt=null,this.maxAnisotropy=0,this._$As=32,this._$Gr=!1,this._$NT=null,this._$vS=null,this._$no=null,this.vertShader=null,this.fragShader=null,this.vertShaderOff=null,this.fragShaderOff=null)&#125;function mt(t,e,i)&#123;return null==e&amp;&amp;(e=t.createBuffer()),t.bindBuffer(t.ARRAY_BUFFER,e),t.bufferData(t.ARRAY_BUFFER,i,t.DYNAMIC_DRAW),e&#125;function Tt(t,e,i)&#123;return null==e&amp;&amp;(e=t.createBuffer()),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,e),t.bufferData(t.ELEMENT_ARRAY_BUFFER,i,t.DYNAMIC_DRAW),e&#125;function Pt(t)&#123;i||(this._$P=new Int8Array(8),this._$R0=new DataView(this._$P.buffer),this._$3i=new Int8Array(1e3),this._$hL=0,this._$v0=0,this._$S2=0,this._$Ko=new Array,this._$T=t,this._$F=0)&#125;V.STATE_FIRST=&quot;STATE_FIRST&quot;,V.STATE_INTERVAL=&quot;STATE_INTERVAL&quot;,V.STATE_CLOSING=&quot;STATE_CLOSING&quot;,V.STATE_CLOSED=&quot;STATE_CLOSED&quot;,V.STATE_OPENING=&quot;STATE_OPENING&quot;,X.prototype=new M,X._$As=32,X._$Gr=!1,X._$NT=null,X._$vS=null,X._$no=null,X._$9r=function(t)&#123;return new Float32Array(t)&#125;,X._$vb=function(t)&#123;return new Int16Array(t)&#125;,X._$cr=function(t,e)&#123;return null==t||t._$yL()&lt;e.length?((t=X._$9r(2*e.length)).put(e),t._$oT(0)):(t.clear(),t.put(e),t._$oT(0)),t&#125;,X._$mb=function(t,e)&#123;return null==t||t._$yL()&lt;e.length?((t=X._$vb(2*e.length)).put(e),t._$oT(0)):(t.clear(),t.put(e),t._$oT(0)),t&#125;,X._$Hs=function()&#123;return X._$Gr&#125;,X._$as=function(t)&#123;X._$Gr=t&#125;,X.prototype.setGL=function(t)&#123;this.gl=t&#125;,X.prototype.setTransform=function(t)&#123;this.transform=t&#125;,X.prototype._$ZT=function()&#123;&#125;,X.prototype._$Uo=function(t,e,i,r,o,n,s,_)&#123;if(!(n&lt;.01))&#123;var a=this._$U2[t],h=n&gt;.9?_t.EXPAND_W:0;this.gl.drawElements(a,i,r,o,n,h,this.transform,_)&#125;&#125;,X.prototype._$Rs=function()&#123;throw new Error(&quot;_$Rs&quot;)&#125;,X.prototype._$Ds=function(t)&#123;throw new Error(&quot;_$Ds&quot;)&#125;,X.prototype._$K2=function()&#123;for(var t=0;t&lt;this._$sb.length;t++)&#123;0!=this._$sb[t]&amp;&amp;(this.gl._$Sr(1,this._$sb,t),this._$sb[t]=0)&#125;&#125;,X.prototype.setTexture=function(t,e)&#123;this._$sb.length&lt;t+1&amp;&amp;this._$nS(t),this._$sb[t]=e&#125;,X.prototype.setTexture=function(t,e)&#123;this._$sb.length&lt;t+1&amp;&amp;this._$nS(t),this._$U2[t]=e&#125;,X.prototype._$nS=function(t)&#123;var e=Math.max(2*this._$sb.length,t+1+10),i=new Int32Array(e);x._$jT(this._$sb,0,i,0,this._$sb.length),this._$sb=i;var r=new Array;x._$jT(this._$U2,0,r,0,this._$U2.length),this._$U2=r&#125;,z.prototype=new A,z._$Xo=new Float32Array(2),z._$io=new Float32Array(2),z._$0o=new Float32Array(2),z._$Lo=new Float32Array(2),z._$To=new Float32Array(2),z._$Po=new Float32Array(2),z._$gT=new Array,z.prototype._$zP=function()&#123;this._$GS=new D,this._$GS._$zP(),this._$Y0=new Array&#125;,z.prototype.getType=function()&#123;return A._$c2&#125;,z.prototype._$F0=function(t)&#123;A.prototype._$F0.call(this,t),this._$GS=t._$nP(),this._$Y0=t._$nP(),A.prototype.readV2_opacity.call(this,t)&#125;,z.prototype.init=function(t)&#123;var e=new H(this);return e._$Yr=new d,this._$32()&amp;&amp;(e._$Wr=new d),e&#125;,z.prototype._$Nr=function(t,e)&#123;this!=e._$GT()&amp;&amp;console.log(&quot;### assert!! ### &quot;);var i=e;if(this._$GS._$Ur(t))&#123;var r=z._$gT;r[0]=!1;var o=this._$GS._$Q2(t,r);e._$Ib(r[0]),this.interpolateOpacity(t,this._$GS,e,r);var n=t._$vs(),s=t._$Tr();if(this._$GS._$zr(n,s,o),o&lt;=0)&#123;var _=this._$Y0[n[0]];i._$Yr.init(_)&#125;else if(1==o)&#123;_=this._$Y0[n[0]];var a=this._$Y0[n[1]],h=s[0];i._$Yr._$fL=_._$fL+(a._$fL-_._$fL)*h,i._$Yr._$gL=_._$gL+(a._$gL-_._$gL)*h,i._$Yr._$B0=_._$B0+(a._$B0-_._$B0)*h,i._$Yr._$z0=_._$z0+(a._$z0-_._$z0)*h,i._$Yr._$qT=_._$qT+(a._$qT-_._$qT)*h&#125;else if(2==o)&#123;_=this._$Y0[n[0]],a=this._$Y0[n[1]];var l=this._$Y0[n[2]],$=this._$Y0[n[3]],u=(h=s[0],s[1]),p=_._$fL+(a._$fL-_._$fL)*h,c=l._$fL+($._$fL-l._$fL)*h;i._$Yr._$fL=p+(c-p)*u,p=_._$gL+(a._$gL-_._$gL)*h,c=l._$gL+($._$gL-l._$gL)*h,i._$Yr._$gL=p+(c-p)*u,p=_._$B0+(a._$B0-_._$B0)*h,c=l._$B0+($._$B0-l._$B0)*h,i._$Yr._$B0=p+(c-p)*u,p=_._$z0+(a._$z0-_._$z0)*h,c=l._$z0+($._$z0-l._$z0)*h,i._$Yr._$z0=p+(c-p)*u,p=_._$qT+(a._$qT-_._$qT)*h,c=l._$qT+($._$qT-l._$qT)*h,i._$Yr._$qT=p+(c-p)*u&#125;else if(3==o)&#123;var f=this._$Y0[n[0]],g=this._$Y0[n[1]],y=this._$Y0[n[2]],d=this._$Y0[n[3]],m=this._$Y0[n[4]],T=this._$Y0[n[5]],P=this._$Y0[n[6]],S=this._$Y0[n[7]],v=(h=s[0],u=s[1],s[2]),L=(p=f._$fL+(g._$fL-f._$fL)*h,c=y._$fL+(d._$fL-y._$fL)*h,m._$fL+(T._$fL-m._$fL)*h),M=P._$fL+(S._$fL-P._$fL)*h;i._$Yr._$fL=(1-v)*(p+(c-p)*u)+v*(L+(M-L)*u),p=f._$gL+(g._$gL-f._$gL)*h,c=y._$gL+(d._$gL-y._$gL)*h,L=m._$gL+(T._$gL-m._$gL)*h,M=P._$gL+(S._$gL-P._$gL)*h,i._$Yr._$gL=(1-v)*(p+(c-p)*u)+v*(L+(M-L)*u),p=f._$B0+(g._$B0-f._$B0)*h,c=y._$B0+(d._$B0-y._$B0)*h,L=m._$B0+(T._$B0-m._$B0)*h,M=P._$B0+(S._$B0-P._$B0)*h,i._$Yr._$B0=(1-v)*(p+(c-p)*u)+v*(L+(M-L)*u),p=f._$z0+(g._$z0-f._$z0)*h,c=y._$z0+(d._$z0-y._$z0)*h,L=m._$z0+(T._$z0-m._$z0)*h,M=P._$z0+(S._$z0-P._$z0)*h,i._$Yr._$z0=(1-v)*(p+(c-p)*u)+v*(L+(M-L)*u),p=f._$qT+(g._$qT-f._$qT)*h,c=y._$qT+(d._$qT-y._$qT)*h,L=m._$qT+(T._$qT-m._$qT)*h,M=P._$qT+(S._$qT-P._$qT)*h,i._$Yr._$qT=(1-v)*(p+(c-p)*u)+v*(L+(M-L)*u)&#125;else if(4==o)&#123;var E=this._$Y0[n[0]],A=this._$Y0[n[1]],x=this._$Y0[n[2]],I=this._$Y0[n[3]],w=this._$Y0[n[4]],D=this._$Y0[n[5]],O=this._$Y0[n[6]],R=this._$Y0[n[7]],b=this._$Y0[n[8]],F=this._$Y0[n[9]],C=this._$Y0[n[10]],N=this._$Y0[n[11]],B=this._$Y0[n[12]],G=this._$Y0[n[13]],U=this._$Y0[n[14]],Y=this._$Y0[n[15]],k=(h=s[0],u=s[1],v=s[2],s[3]),V=(p=E._$fL+(A._$fL-E._$fL)*h,c=x._$fL+(I._$fL-x._$fL)*h,L=w._$fL+(D._$fL-w._$fL)*h,M=O._$fL+(R._$fL-O._$fL)*h,b._$fL+(F._$fL-b._$fL)*h),X=C._$fL+(N._$fL-C._$fL)*h,H=B._$fL+(G._$fL-B._$fL)*h,W=U._$fL+(Y._$fL-U._$fL)*h;i._$Yr._$fL=(1-k)*((1-v)*(p+(c-p)*u)+v*(L+(M-L)*u))+k*((1-v)*(V+(X-V)*u)+v*(H+(W-H)*u)),p=E._$gL+(A._$gL-E._$gL)*h,c=x._$gL+(I._$gL-x._$gL)*h,L=w._$gL+(D._$gL-w._$gL)*h,M=O._$gL+(R._$gL-O._$gL)*h,V=b._$gL+(F._$gL-b._$gL)*h,X=C._$gL+(N._$gL-C._$gL)*h,H=B._$gL+(G._$gL-B._$gL)*h,W=U._$gL+(Y._$gL-U._$gL)*h,i._$Yr._$gL=(1-k)*((1-v)*(p+(c-p)*u)+v*(L+(M-L)*u))+k*((1-v)*(V+(X-V)*u)+v*(H+(W-H)*u)),p=E._$B0+(A._$B0-E._$B0)*h,c=x._$B0+(I._$B0-x._$B0)*h,L=w._$B0+(D._$B0-w._$B0)*h,M=O._$B0+(R._$B0-O._$B0)*h,V=b._$B0+(F._$B0-b._$B0)*h,X=C._$B0+(N._$B0-C._$B0)*h,H=B._$B0+(G._$B0-B._$B0)*h,W=U._$B0+(Y._$B0-U._$B0)*h,i._$Yr._$B0=(1-k)*((1-v)*(p+(c-p)*u)+v*(L+(M-L)*u))+k*((1-v)*(V+(X-V)*u)+v*(H+(W-H)*u)),p=E._$z0+(A._$z0-E._$z0)*h,c=x._$z0+(I._$z0-x._$z0)*h,L=w._$z0+(D._$z0-w._$z0)*h,M=O._$z0+(R._$z0-O._$z0)*h,V=b._$z0+(F._$z0-b._$z0)*h,X=C._$z0+(N._$z0-C._$z0)*h,H=B._$z0+(G._$z0-B._$z0)*h,W=U._$z0+(Y._$z0-U._$z0)*h,i._$Yr._$z0=(1-k)*((1-v)*(p+(c-p)*u)+v*(L+(M-L)*u))+k*((1-v)*(V+(X-V)*u)+v*(H+(W-H)*u)),p=E._$qT+(A._$qT-E._$qT)*h,c=x._$qT+(I._$qT-x._$qT)*h,L=w._$qT+(D._$qT-w._$qT)*h,M=O._$qT+(R._$qT-O._$qT)*h,V=b._$qT+(F._$qT-b._$qT)*h,X=C._$qT+(N._$qT-C._$qT)*h,H=B._$qT+(G._$qT-B._$qT)*h,W=U._$qT+(Y._$qT-U._$qT)*h,i._$Yr._$qT=(1-k)*((1-v)*(p+(c-p)*u)+v*(L+(M-L)*u))+k*((1-v)*(V+(X-V)*u)+v*(H+(W-H)*u))&#125;else&#123;for(var j=0|Math.pow(2,o),q=new Float32Array(j),J=0;J&lt;j;J++)&#123;for(var Q=J,Z=1,K=0;K&lt;o;K++)Z*=Q%2==0?1-s[K]:s[K],Q/=2;q[J]=Z&#125;for(var tt=new Array,et=0;et&lt;j;et++)tt[et]=this._$Y0[n[et]];var it=0,rt=0,ot=0,nt=0,st=0;for(et=0;et&lt;j;et++)it+=q[et]*tt[et]._$fL,rt+=q[et]*tt[et]._$gL,ot+=q[et]*tt[et]._$B0,nt+=q[et]*tt[et]._$z0,st+=q[et]*tt[et]._$qT;i._$Yr._$fL=it,i._$Yr._$gL=rt,i._$Yr._$B0=ot,i._$Yr._$z0=nt,i._$Yr._$qT=st&#125;_=this._$Y0[n[0]];i._$Yr.reflectX=_.reflectX,i._$Yr.reflectY=_.reflectY&#125;&#125;,z.prototype._$2b=function(t,e)&#123;this!=e._$GT()&amp;&amp;console.log(&quot;### assert!! ### &quot;);var i=e;if(i._$hS(!0),this._$32())&#123;var r=this.getTargetBaseDataID();if(i._$8r==A._$ur&amp;&amp;(i._$8r=t.getBaseDataIndex(r)),i._$8r&lt;0)_t._$so&amp;&amp;_._$li(&quot;_$L _$0P _$G :: %s&quot;,r),i._$hS(!1);else&#123;var o=t.getBaseData(i._$8r);if(null!=o)&#123;var n=t._$q2(i._$8r),s=z._$Xo;s[0]=i._$Yr._$fL,s[1]=i._$Yr._$gL;var a=z._$io;a[0]=0,a[1]=-.1,n._$GT().getType()==A._$c2?a[1]=-10:a[1]=-.1;var h=z._$0o;this._$Jr(t,o,n,s,a,h);var l=vt._$92(a,h);o._$nb(t,n,s,s,1,0,2),i._$Wr._$fL=s[0],i._$Wr._$gL=s[1],i._$Wr._$B0=i._$Yr._$B0,i._$Wr._$z0=i._$Yr._$z0,i._$Wr._$qT=i._$Yr._$qT-l*vt._$NS;var $=n.getTotalScale();i.setTotalScale_notForClient($*i._$Wr._$B0);var u=n.getTotalOpacity();i.setTotalOpacity(u*i.getInterpolatedOpacity()),i._$Wr.reflectX=i._$Yr.reflectX,i._$Wr.reflectY=i._$Yr.reflectY,i._$hS(n._$yo())&#125;else i._$hS(!1)&#125;&#125;else i.setTotalScale_notForClient(i._$Yr._$B0),i.setTotalOpacity(i.getInterpolatedOpacity())&#125;,z.prototype._$nb=function(t,e,i,r,o,n,s)&#123;this!=e._$GT()&amp;&amp;console.log(&quot;### assert!! ### &quot;);for(var _,a,h=e,l=null!=h._$Wr?h._$Wr:h._$Yr,$=Math.sin(vt._$bS*l._$qT),u=Math.cos(vt._$bS*l._$qT),p=h.getTotalScale(),c=l.reflectX?-1:1,f=l.reflectY?-1:1,g=u*p*c,y=-$*p*f,d=$*p*c,m=u*p*f,T=l._$fL,P=l._$gL,S=o*s,v=n;v&lt;S;v+=s)_=i[v],a=i[v+1],r[v]=g*_+y*a+T,r[v+1]=d*_+m*a+P&#125;,z.prototype._$Jr=function(t,e,i,r,o,n)&#123;e!=i._$GT()&amp;&amp;console.log(&quot;### assert!! ### &quot;);var s=z._$Lo;z._$Lo[0]=r[0],z._$Lo[1]=r[1],e._$nb(t,i,s,s,1,0,2);for(var _=z._$To,a=z._$Po,h=1,l=0;l&lt;10;l++)&#123;if(a[0]=r[0]+h*o[0],a[1]=r[1]+h*o[1],e._$nb(t,i,a,_,1,0,2),_[0]-=s[0],_[1]-=s[1],0!=_[0]||0!=_[1])return n[0]=_[0],void(n[1]=_[1]);if(a[0]=r[0]-h*o[0],a[1]=r[1]-h*o[1],e._$nb(t,i,a,_,1,0,2),_[0]-=s[0],_[1]-=s[1],0!=_[0]||0!=_[1])return _[0]=-_[0],_[0]=-_[0],n[0]=_[0],void(n[1]=_[1]);h*=.1&#125;_t._$so&amp;&amp;console.log(&quot;_$L0 to transform _$SP\\n&quot;)&#125;,H.prototype=new st,W.prototype=new L,W._$ur=-2,W._$ES=500,W._$wb=2,W._$8S=3,W._$os=4,W._$52=W._$ES,W._$R2=W._$ES,W._$Sb=function(t)&#123;for(var e=t.length-1;e&gt;=0;--e)&#123;var i=t[e];i&lt;W._$52?W._$52=i:i&gt;W._$R2&amp;&amp;(W._$R2=i)&#125;&#125;,W._$or=function()&#123;return W._$52&#125;,W._$Pr=function()&#123;return W._$R2&#125;,W.prototype._$F0=function(t)&#123;this._$gP=t._$nP(),this._$dr=t._$nP(),this._$GS=t._$nP(),this._$qb=t._$6L(),this._$Lb=t._$cS(),this._$mS=t._$Tb(),t.getFormatVersion()&gt;=G._$T7?(this.clipID=t._$nP(),this.clipIDList=this.convertClipIDForV2_11(this.clipID)):this.clipIDList=null,W._$Sb(this._$Lb)&#125;,W.prototype.getClipIDList=function()&#123;return this.clipIDList&#125;,W.prototype._$Nr=function(t,e)&#123;if(e._$IS[0]=!1,e._$Us=S._$Z2(t,this._$GS,e._$IS,this._$Lb),_t._$Zs);else if(e._$IS[0])return;e._$7s=S._$br(t,this._$GS,e._$IS,this._$mS)&#125;,W.prototype._$2b=function(t)&#123;&#125;,W.prototype.getDrawDataID=function()&#123;return this._$gP&#125;,W.prototype._$j2=function(t)&#123;this._$gP=t&#125;,W.prototype.getOpacity=function(t,e)&#123;return e._$7s&#125;,W.prototype._$zS=function(t,e)&#123;return e._$Us&#125;,W.prototype.getTargetBaseDataID=function()&#123;return this._$dr&#125;,W.prototype._$gs=function(t)&#123;this._$dr=t&#125;,W.prototype._$32=function()&#123;return null!=this._$dr&amp;&amp;this._$dr!=yt._$2o()&#125;,W.prototype.getType=function()&#123;&#125;,j._$42=0,j.prototype._$1b=function()&#123;return this._$3S&#125;,j.prototype.getDrawDataList=function()&#123;return this._$aS&#125;,j.prototype._$F0=function(t)&#123;this._$NL=t._$nP(),this._$aS=t._$nP(),this._$3S=t._$nP()&#125;,j.prototype._$kr=function(t)&#123;t._$Zo(this._$3S),t._$xo(this._$aS),this._$3S=null,this._$aS=null&#125;,q.prototype=new r,q.loadModel=function(t)&#123;var e=new q;return r._$62(e,t),e&#125;,q.loadModel=function(t)&#123;var e=new q;return r._$62(e,t),e&#125;,q._$to=function()&#123;return new q&#125;,q._$er=function(t)&#123;var e=new _$5(&quot;../_$_r/_$t0/_$Ri/_$_P._$d&quot;);if(0==e.exists())throw new _$ls(&quot;_$t0 _$_ _$6 _$Ui :: &quot;+e._$PL());for(var i=[&quot;../_$_r/_$t0/_$Ri/_$_P.512/_$CP._$1&quot;,&quot;../_$_r/_$t0/_$Ri/_$_P.512/_$vP._$1&quot;,&quot;../_$_r/_$t0/_$Ri/_$_P.512/_$EP._$1&quot;,&quot;../_$_r/_$t0/_$Ri/_$_P.512/_$pP._$1&quot;],r=q.loadModel(e._$3b()),o=0;o&lt;i.length;o++)&#123;var n=new _$5(i[o]);if(0==n.exists())throw new _$ls(&quot;_$t0 _$_ _$6 _$Ui :: &quot;+n._$PL());r.setTexture(o,_$nL._$_o(t,n._$3b()))&#125;return r&#125;,q.prototype.setGL=function(t)&#123;this._$zo.setGL(t)&#125;,q.prototype.setTransform=function(t)&#123;this._$zo.setTransform(t)&#125;,q.prototype.draw=function()&#123;this._$5S.draw(this._$zo)&#125;,q.prototype._$K2=function()&#123;this._$zo._$K2()&#125;,q.prototype.setTexture=function(t,e)&#123;null==this._$zo&amp;&amp;_._$li(&quot;_$Yi for QT _$ki / _$XS() is _$6 _$ui!!&quot;),this._$zo.setTexture(t,e)&#125;,q.prototype.setTexture=function(t,e)&#123;null==this._$zo&amp;&amp;_._$li(&quot;_$Yi for QT _$ki / _$XS() is _$6 _$ui!!&quot;),this._$zo.setTexture(t,e)&#125;,q.prototype._$Rs=function()&#123;return this._$zo._$Rs()&#125;,q.prototype._$Ds=function(t)&#123;this._$zo._$Ds(t)&#125;,q.prototype.getDrawParam=function()&#123;return this._$zo&#125;,J.prototype=new s,J._$cs=&quot;VISIBLE:&quot;,J._$ar=&quot;LAYOUT:&quot;,J.MTN_PREFIX_FADEIN=&quot;FADEIN:&quot;,J.MTN_PREFIX_FADEOUT=&quot;FADEOUT:&quot;,J._$Co=0,J._$1T=1,J.loadMotion=function(t)&#123;var e=Y._$C(t);return J.loadMotion(e)&#125;,J.loadMotion=function(t)&#123;t instanceof ArrayBuffer&amp;&amp;(t=new DataView(t));var e=new J,i=[0],r=t.byteLength;e._$yT=0;for(var o=0;o&lt;r;++o)&#123;var n=Q(t,o),s=n.charCodeAt(0);if(&quot;\\n&quot;!=n&amp;&amp;&quot;\\r&quot;!=n)if(&quot;#&quot;!=n)if(&quot;$&quot;!=n)&#123;if(97&lt;=s&amp;&amp;s&lt;=122||65&lt;=s&amp;&amp;s&lt;=90||&quot;_&quot;==n)&#123;for($=o,u=-1;o&lt;r&amp;&amp;(&quot;\\r&quot;!=(n=Q(t,o))&amp;&amp;&quot;\\n&quot;!=n);++o)if(&quot;=&quot;==n)&#123;u=o;break&#125;if(u&gt;=0)&#123;var _=new N;w.startsWith(t,$,J._$cs)?(_._$RP=N._$hs,_._$4P=w.createString(t,$,u-$)):w.startsWith(t,$,J._$ar)?(_._$4P=w.createString(t,$+7,u-$-7),w.startsWith(t,$+7,&quot;ANCHOR_X&quot;)?_._$RP=N._$xs:w.startsWith(t,$+7,&quot;ANCHOR_Y&quot;)?_._$RP=N._$us:w.startsWith(t,$+7,&quot;SCALE_X&quot;)?_._$RP=N._$qs:w.startsWith(t,$+7,&quot;SCALE_Y&quot;)?_._$RP=N._$Ys:w.startsWith(t,$+7,&quot;X&quot;)?_._$RP=N._$ws:w.startsWith(t,$+7,&quot;Y&quot;)&amp;&amp;(_._$RP=N._$Ns)):(_._$RP=N._$Fr,_._$4P=w.createString(t,$,u-$)),e.motions.push(_);var a=0,h=[];for(o=u+1;o&lt;r&amp;&amp;(&quot;\\r&quot;!=(n=Q(t,o))&amp;&amp;&quot;\\n&quot;!=n);++o)if(&quot;,&quot;!=n&amp;&amp;&quot; &quot;!=n&amp;&amp;&quot;\\t&quot;!=n)&#123;c=w._$LS(t,r,o,i);if(i[0]&gt;0)&#123;h.push(c),a++;var l=i[0];if(l&lt;o)&#123;console.log(&quot;_$n0 _$hi . @Live2DMotion loadMotion()\\n&quot;);break&#125;o=l-1&#125;&#125;_._$I0=new Float32Array(h),a&gt;e._$yT&amp;&amp;(e._$yT=a)&#125;&#125;&#125;else&#123;for(var $=o,u=-1;o&lt;r&amp;&amp;(&quot;\\r&quot;!=(n=Q(t,o))&amp;&amp;&quot;\\n&quot;!=n);++o)if(&quot;=&quot;==n)&#123;u=o;break&#125;var p=!1;if(u&gt;=0)for(u==$+4&amp;&amp;&quot;f&quot;==Q(t,$+1)&amp;&amp;&quot;p&quot;==Q(t,$+2)&amp;&amp;&quot;s&quot;==Q(t,$+3)&amp;&amp;(p=!0),o=u+1;o&lt;r&amp;&amp;(&quot;\\r&quot;!=(n=Q(t,o))&amp;&amp;&quot;\\n&quot;!=n);++o)if(&quot;,&quot;!=n&amp;&amp;&quot; &quot;!=n&amp;&amp;&quot;\\t&quot;!=n)&#123;var c=w._$LS(t,r,o,i);i[0]&gt;0&amp;&amp;p&amp;&amp;5&lt;c&amp;&amp;c&lt;121&amp;&amp;(e._$D0=c),o=i[0]&#125;for(;o&lt;r&amp;&amp;(&quot;\\n&quot;!=Q(t,o)&amp;&amp;&quot;\\r&quot;!=Q(t,o));++o);&#125;else for(;o&lt;r&amp;&amp;(&quot;\\n&quot;!=Q(t,o)&amp;&amp;&quot;\\r&quot;!=Q(t,o));++o);&#125;return e._$rr=1e3*e._$yT/e._$D0|0,e&#125;,J.prototype.getDurationMSec=function()&#123;return this._$E?-1:this._$rr&#125;,J.prototype.getLoopDurationMSec=function()&#123;return this._$rr&#125;,J.prototype.dump=function()&#123;for(var t=0;t&lt;this.motions.length;t++)&#123;var e=this.motions[t];console.log(&quot;_$wL[%s] [%d]. &quot;,e._$4P,e._$I0.length);for(var i=0;i&lt;e._$I0.length&amp;&amp;i&lt;10;i++)console.log(&quot;%5.2f ,&quot;,e._$I0[i]);console.log(&quot;\\n&quot;)&#125;&#125;,J.prototype.updateParamExe=function(t,e,i,r)&#123;for(var o=(e-r._$z2)*this._$D0/1e3,n=0|o,s=o-n,_=0;_&lt;this.motions.length;_++)&#123;var a=this.motions[_],h=a._$I0.length,l=a._$4P;if(a._$RP==N._$hs)&#123;var $=a._$I0[n&gt;=h?h-1:n];t.setParamFloat(l,$)&#125;else if(N._$ws&lt;=a._$RP&amp;&amp;a._$RP&lt;=N._$Ys);else&#123;var u=t.getParamIndex(l),p=t.getModelContext(),c=.4*(p.getParamMax(u)-p.getParamMin(u)),f=p.getParamFloat(u),g=a._$I0[n&gt;=h?h-1:n],y=a._$I0[n+1&gt;=h?h-1:n+1],d=f+((g&lt;y&amp;&amp;y-g&gt;c||g&gt;y&amp;&amp;g-y&gt;c?g:g+(y-g)*s)-f)*i;t.setParamFloat(l,d)&#125;&#125;n&gt;=this._$yT&amp;&amp;(this._$E?(r._$z2=e,this.loopFadeIn&amp;&amp;(r._$bs=e)):r._$9L=!0),this._$eP=i&#125;,J.prototype._$r0=function()&#123;return this._$E&#125;,J.prototype._$aL=function(t)&#123;this._$E=t&#125;,J.prototype._$S0=function()&#123;return this._$D0&#125;,J.prototype._$U0=function(t)&#123;this._$D0=t&#125;,J.prototype.isLoopFadeIn=function()&#123;return this.loopFadeIn&#125;,J.prototype.setLoopFadeIn=function(t)&#123;this.loopFadeIn=t&#125;,C.prototype.clear=function()&#123;this.size=0&#125;,C.prototype.add=function(t)&#123;if(this._$P.length&lt;=this.size)&#123;var e=new Float32Array(2*this.size);x._$jT(this._$P,0,e,0,this.size),this._$P=e&#125;this._$P[this.size++]=t&#125;,C.prototype._$BL=function()&#123;var t=new Float32Array(this.size);return x._$jT(this._$P,0,t,0,this.size),t&#125;,N._$Fr=0,N._$hs=1,N._$ws=100,N._$Ns=101,N._$xs=102,N._$us=103,N._$qs=104,N._$Ys=105,Z.prototype=new A,Z._$gT=new Array,Z.prototype._$zP=function()&#123;this._$GS=new D,this._$GS._$zP()&#125;,Z.prototype._$F0=function(t)&#123;A.prototype._$F0.call(this,t),this._$A=t._$6L(),this._$o=t._$6L(),this._$GS=t._$nP(),this._$Eo=t._$nP(),A.prototype.readV2_opacity.call(this,t)&#125;,Z.prototype.init=function(t)&#123;var e=new K(this),i=(this._$o+1)*(this._$A+1);return null!=e._$Cr&amp;&amp;(e._$Cr=null),e._$Cr=new Float32Array(2*i),null!=e._$hr&amp;&amp;(e._$hr=null),this._$32()?e._$hr=new Float32Array(2*i):e._$hr=null,e&#125;,Z.prototype._$Nr=function(t,e)&#123;var i=e;if(this._$GS._$Ur(t))&#123;var r=this._$VT(),o=Z._$gT;o[0]=!1,S._$Vr(t,this._$GS,o,r,this._$Eo,i._$Cr,0,2),e._$Ib(o[0]),this.interpolateOpacity(t,this._$GS,e,o)&#125;&#125;,Z.prototype._$2b=function(t,e)&#123;var i=e;if(i._$hS(!0),this._$32())&#123;var r=this.getTargetBaseDataID();if(i._$8r==A._$ur&amp;&amp;(i._$8r=t.getBaseDataIndex(r)),i._$8r&lt;0)_t._$so&amp;&amp;_._$li(&quot;_$L _$0P _$G :: %s&quot;,r),i._$hS(!1);else&#123;var o=t.getBaseData(i._$8r),n=t._$q2(i._$8r);if(null!=o&amp;&amp;n._$yo())&#123;var s=n.getTotalScale();i.setTotalScale_notForClient(s);var a=n.getTotalOpacity();i.setTotalOpacity(a*i.getInterpolatedOpacity()),o._$nb(t,n,i._$Cr,i._$hr,this._$VT(),0,2),i._$hS(!0)&#125;else i._$hS(!1)&#125;&#125;else i.setTotalOpacity(i.getInterpolatedOpacity())&#125;,Z.prototype._$nb=function(t,e,i,r,o,n,s)&#123;var _=e,a=null!=_._$hr?_._$hr:_._$Cr;Z.transformPoints_sdk2(i,r,o,n,s,a,this._$o,this._$A)&#125;,Z.transformPoints_sdk2=function(e,i,r,o,n,s,_,a)&#123;for(var h,l,$,u=r*n,p=0,c=0,f=0,g=0,y=0,d=0,m=!1,T=o;T&lt;u;T+=n)&#123;var P,S,v,L;if(v=e[T],S=(L=e[T+1])*a,(P=v*_)&lt;0||S&lt;0||_&lt;=P||a&lt;=S)&#123;var M=_+1;if(!m)&#123;m=!0,p=.25*(s[2*(0+0*M)]+s[2*(_+0*M)]+s[2*(0+a*M)]+s[2*(_+a*M)]),c=.25*(s[2*(0+0*M)+1]+s[2*(_+0*M)+1]+s[2*(0+a*M)+1]+s[2*(_+a*M)+1]);var E=s[2*(_+a*M)]-s[2*(0+0*M)],A=s[2*(_+a*M)+1]-s[2*(0+0*M)+1],x=s[2*(_+0*M)]-s[2*(0+a*M)],I=s[2*(_+0*M)+1]-s[2*(0+a*M)+1];p-=.5*((f=.5*(E+x))+(y=.5*(E-x))),c-=.5*((g=.5*(A+I))+(d=.5*(A-I)))&#125;if(-2&lt;v&amp;&amp;v&lt;3&amp;&amp;-2&lt;L&amp;&amp;L&lt;3)if(v&lt;=0)if(L&lt;=0)&#123;var w=s[2*(0+0*M)],D=s[2*(0+0*M)+1],O=p-2*f,R=c-2*g,b=p-2*y,F=c-2*d,C=p-2*f-2*y,N=c-2*g-2*d;(B=.5*(v- -2))+(G=.5*(L- -2))&lt;=1?(i[T]=C+(b-C)*B+(O-C)*G,i[T+1]=N+(F-N)*B+(R-N)*G):(i[T]=w+(O-w)*(1-B)+(b-w)*(1-G),i[T+1]=D+(R-D)*(1-B)+(F-D)*(1-G))&#125;else if(L&gt;=1)&#123;b=s[2*(0+a*M)],F=s[2*(0+a*M)+1],C=p-2*f+1*y,N=c-2*g+1*d,w=p+3*y,D=c+3*d,O=p-2*f+3*y,R=c-2*g+3*d;(B=.5*(v- -2))+(G=.5*(L-1))&lt;=1?(i[T]=C+(b-C)*B+(O-C)*G,i[T+1]=N+(F-N)*B+(R-N)*G):(i[T]=w+(O-w)*(1-B)+(b-w)*(1-G),i[T+1]=D+(R-D)*(1-B)+(F-D)*(1-G))&#125;else&#123;(k=0|S)==a&amp;&amp;(k=a-1);var B=.5*(v- -2),G=S-k,U=k/a,Y=(k+1)/a;b=s[2*(0+k*M)],F=s[2*(0+k*M)+1],w=s[2*(0+(k+1)*M)],D=s[2*(0+(k+1)*M)+1],C=p-2*f+U*y,N=c-2*g+U*d,O=p-2*f+Y*y,R=c-2*g+Y*d;B+G&lt;=1?(i[T]=C+(b-C)*B+(O-C)*G,i[T+1]=N+(F-N)*B+(R-N)*G):(i[T]=w+(O-w)*(1-B)+(b-w)*(1-G),i[T+1]=D+(R-D)*(1-B)+(F-D)*(1-G))&#125;else if(1&lt;=v)if(L&lt;=0)&#123;O=s[2*(_+0*M)],R=s[2*(_+0*M)+1],w=p+3*f,D=c+3*g,C=p+1*f-2*y,N=c+1*g-2*d,b=p+3*f-2*y,F=c+3*g-2*d;(B=.5*(v-1))+(G=.5*(L- -2))&lt;=1?(i[T]=C+(b-C)*B+(O-C)*G,i[T+1]=N+(F-N)*B+(R-N)*G):(i[T]=w+(O-w)*(1-B)+(b-w)*(1-G),i[T+1]=D+(R-D)*(1-B)+(F-D)*(1-G))&#125;else if(L&gt;=1)&#123;C=s[2*(_+a*M)],N=s[2*(_+a*M)+1],b=p+3*f+1*y,F=c+3*g+1*d,O=p+1*f+3*y,R=c+1*g+3*d,w=p+3*f+3*y,D=c+3*g+3*d;(B=.5*(v-1))+(G=.5*(L-1))&lt;=1?(i[T]=C+(b-C)*B+(O-C)*G,i[T+1]=N+(F-N)*B+(R-N)*G):(i[T]=w+(O-w)*(1-B)+(b-w)*(1-G),i[T+1]=D+(R-D)*(1-B)+(F-D)*(1-G))&#125;else&#123;var k;(k=0|S)==a&amp;&amp;(k=a-1);B=.5*(v-1),G=S-k,U=k/a,Y=(k+1)/a,C=s[2*(_+k*M)],N=s[2*(_+k*M)+1],O=s[2*(_+(k+1)*M)],R=s[2*(_+(k+1)*M)+1],b=p+3*f+U*y,F=c+3*g+U*d,w=p+3*f+Y*y,D=c+3*g+Y*d;B+G&lt;=1?(i[T]=C+(b-C)*B+(O-C)*G,i[T+1]=N+(F-N)*B+(R-N)*G):(i[T]=w+(O-w)*(1-B)+(b-w)*(1-G),i[T+1]=D+(R-D)*(1-B)+(F-D)*(1-G))&#125;else if(L&lt;=0)&#123;(z=0|P)==_&amp;&amp;(z=_-1);B=P-z,G=.5*(L- -2);var V=z/_,X=(z+1)/_;O=s[2*(z+0*M)],R=s[2*(z+0*M)+1],w=s[2*(z+1+0*M)],D=s[2*(z+1+0*M)+1],C=p+V*f-2*y,N=c+V*g-2*d,b=p+X*f-2*y,F=c+X*g-2*d;B+G&lt;=1?(i[T]=C+(b-C)*B+(O-C)*G,i[T+1]=N+(F-N)*B+(R-N)*G):(i[T]=w+(O-w)*(1-B)+(b-w)*(1-G),i[T+1]=D+(R-D)*(1-B)+(F-D)*(1-G))&#125;else if(L&gt;=1)&#123;var z;(z=0|P)==_&amp;&amp;(z=_-1);B=P-z,G=.5*(L-1),V=z/_,X=(z+1)/_,C=s[2*(z+a*M)],N=s[2*(z+a*M)+1],b=s[2*(z+1+a*M)],F=s[2*(z+1+a*M)+1],O=p+V*f+3*y,R=c+V*g+3*d,w=p+X*f+3*y,D=c+X*g+3*d;B+G&lt;=1?(i[T]=C+(b-C)*B+(O-C)*G,i[T+1]=N+(F-N)*B+(R-N)*G):(i[T]=w+(O-w)*(1-B)+(b-w)*(1-G),i[T+1]=D+(R-D)*(1-B)+(F-D)*(1-G))&#125;else t.err.printf(&quot;_$li calc : %.4f , %.4f          @@BDBoxGrid\\n&quot;,v,L);else i[T]=p+v*f+L*y,i[T+1]=c+v*g+L*d&#125;else h=2*((0|P)+(0|S)*(_+1)),(l=P-(0|P))+($=S-(0|S))&lt;1?(i[T]=s[h]*(1-l-$)+s[h+2]*l+s[h+2*(_+1)]*$,i[T+1]=s[h+1]*(1-l-$)+s[h+3]*l+s[h+2*(_+1)+1]*$):(i[T]=s[h+2*(_+1)+2]*(l-1+$)+s[h+2*(_+1)]*(1-l)+s[h+2]*(1-$),i[T+1]=s[h+2*(_+1)+3]*(l-1+$)+s[h+2*(_+1)+1]*(1-l)+s[h+3]*(1-$))&#125;&#125;,Z.prototype.transformPoints_sdk1=function(t,e,i,r,o,n,s)&#123;for(var _,a,h,l,$,u,p,c=e,f=this._$o,g=this._$A,y=o*s,d=null!=c._$hr?c._$hr:c._$Cr,m=n;m&lt;y;m+=s)_t._$ts?(_=i[m],a=i[m+1],_&lt;0?_=0:_&gt;1&amp;&amp;(_=1),a&lt;0?a=0:a&gt;1&amp;&amp;(a=1),l=0|(a*=g),(h=0|(_*=f))&gt;f-1&amp;&amp;(h=f-1),l&gt;g-1&amp;&amp;(l=g-1),u=_-h,p=a-l,$=2*(h+l*(f+1))):(u=(_=i[m]*f)-(0|_),p=(a=i[m+1]*g)-(0|a),$=2*((0|_)+(0|a)*(f+1))),u+p&lt;1?(r[m]=d[$]*(1-u-p)+d[$+2]*u+d[$+2*(f+1)]*p,r[m+1]=d[$+1]*(1-u-p)+d[$+3]*u+d[$+2*(f+1)+1]*p):(r[m]=d[$+2*(f+1)+2]*(u-1+p)+d[$+2*(f+1)]*(1-u)+d[$+2]*(1-p),r[m+1]=d[$+2*(f+1)+3]*(u-1+p)+d[$+2*(f+1)+1]*(1-u)+d[$+3]*(1-p))&#125;,Z.prototype._$VT=function()&#123;return(this._$o+1)*(this._$A+1)&#125;,Z.prototype.getType=function()&#123;return A._$_b&#125;,K.prototype=new st,tt._$42=0,tt.prototype._$zP=function()&#123;this._$3S=new Array,this._$aS=new Array&#125;,tt.prototype._$F0=function(t)&#123;this._$g0=t._$8L(),this.visible=t._$8L(),this._$NL=t._$nP(),this._$3S=t._$nP(),this._$aS=t._$nP()&#125;,tt.prototype.init=function(t)&#123;var e=new et(this);return e.setPartsOpacity(this.isVisible()?1:0),e&#125;,tt.prototype._$6o=function(t)&#123;if(null==this._$3S)throw new Error(&quot;_$3S _$6 _$Wo@_$6o&quot;);this._$3S.push(t)&#125;,tt.prototype._$3o=function(t)&#123;if(null==this._$aS)throw new Error(&quot;_$aS _$6 _$Wo@_$3o&quot;);this._$aS.push(t)&#125;,tt.prototype._$Zo=function(t)&#123;this._$3S=t&#125;,tt.prototype._$xo=function(t)&#123;this._$aS=t&#125;,tt.prototype.isVisible=function()&#123;return this.visible&#125;,tt.prototype._$uL=function()&#123;return this._$g0&#125;,tt.prototype._$KP=function(t)&#123;this.visible=t&#125;,tt.prototype._$ET=function(t)&#123;this._$g0=t&#125;,tt.prototype.getBaseData=function()&#123;return this._$3S&#125;,tt.prototype.getDrawData=function()&#123;return this._$aS&#125;,tt.prototype._$p2=function()&#123;return this._$NL&#125;,tt.prototype._$ob=function(t)&#123;this._$NL=t&#125;,tt.prototype.getPartsID=function()&#123;return this._$NL&#125;,tt.prototype._$MP=function(t)&#123;this._$NL=t&#125;,et.prototype=new function()&#123;&#125;,et.prototype.getPartsOpacity=function()&#123;return this._$VS&#125;,et.prototype.setPartsOpacity=function(t)&#123;this._$VS=t&#125;,it._$L7=function()&#123;l._$27(),yt._$27(),R._$27(),h._$27()&#125;,it.prototype.toString=function()&#123;return this.id&#125;,rt.prototype._$1s=function()&#123;return this._$4S&#125;,rt.prototype._$zP=function()&#123;this._$4S=new Array&#125;,rt.prototype._$F0=function(t)&#123;this._$4S=t._$nP()&#125;,rt.prototype._$Ks=function(t)&#123;this._$4S.push(t)&#125;,ot.tr=new gt,ot._$50=new gt,ot._$Ti=new Array(0,0),ot._$Pi=new Array(0,0),ot._$B=new Array(0,0),ot.prototype._$lP=function(t,e,i,r)&#123;this.viewport=new Array(t,e,i,r)&#125;,ot.prototype._$bL=function()&#123;this.context.save();var t=this.viewport;null!=t&amp;&amp;(this.context.beginPath(),this.context._$Li(t[0],t[1],t[2],t[3]),this.context.clip())&#125;,ot.prototype._$ei=function()&#123;this.context.restore()&#125;,ot.prototype.drawElements=function(t,e,i,r,o,n,s,a)&#123;try&#123;o!=this._$Qo&amp;&amp;(this._$Qo=o,this.context.globalAlpha=o);for(var h=e.length,l=t.width,$=t.height,u=this.context,p=this._$xP,c=this._$uP,f=this._$6r,g=this._$3r,y=ot.tr,d=ot._$Ti,m=ot._$Pi,P=ot._$B,S=0;S&lt;h;S+=3)&#123;u.save();var v=e[S],L=e[S+1],M=e[S+2],E=p+f*i[2*v],A=c+g*i[2*v+1],x=p+f*i[2*L],I=c+g*i[2*L+1],w=p+f*i[2*M],D=c+g*i[2*M+1];s&amp;&amp;(s._$PS(E,A,P),E=P[0],A=P[1],s._$PS(x,I,P),x=P[0],I=P[1],s._$PS(w,D,P),w=P[0],D=P[1]);var O=l*r[2*v],R=$-$*r[2*v+1],b=l*r[2*L],F=$-$*r[2*L+1],C=l*r[2*M],N=$-$*r[2*M+1],B=Math.atan2(F-R,b-O),G=Math.atan2(I-A,x-E),U=x-E,Y=I-A,k=Math.sqrt(U*U+Y*Y),V=b-O,X=F-R,z=k/Math.sqrt(V*V+X*X);T._$ni(C,N,O,R,b-O,F-R,-(F-R),b-O,d),T._$ni(w,D,E,A,x-E,I-A,-(I-A),x-E,m);var H=(m[0]-d[0])/d[1],W=Math.min(O,b,C),j=Math.max(O,b,C),q=Math.min(R,F,N),J=Math.max(R,F,N),Q=Math.floor(W),Z=Math.floor(q),K=Math.ceil(j),tt=Math.ceil(J);y.identity(),y.translate(E,A),y.rotate(G),y.scale(1,m[1]/d[1]),y.shear(H,0),y.scale(z,z),y.rotate(-B),y.translate(-O,-R),y.setContext(u);if(n||(n=1.2),_t.IGNORE_EXPAND&amp;&amp;(n=0),_t.USE_CACHED_POLYGON_IMAGE)&#123;var et=a._$e0;if(et.gl_cacheImage=et.gl_cacheImage||&#123;&#125;,!et.gl_cacheImage[S])&#123;var it=ot.createCanvas(K-Q,tt-Z);_t.DEBUG_DATA.LDGL_CANVAS_MB=_t.DEBUG_DATA.LDGL_CANVAS_MB||0,_t.DEBUG_DATA.LDGL_CANVAS_MB+=(K-Q)*(tt-Z)*4;var rt=it.getContext(&quot;2d&quot;);rt.translate(-Q,-Z),ot.clip(rt,y,n,k,O,R,b,F,C,N,E,A,x,I,w,D),rt.drawImage(t,0,0),et.gl_cacheImage[S]=&#123;cacheCanvas:it,cacheContext:rt&#125;&#125;u.drawImage(et.gl_cacheImage[S].cacheCanvas,Q,Z)&#125;else _t.IGNORE_CLIP||ot.clip(u,y,n,k,O,R,b,F,C,N,E,A,x,I,w,D),_t.USE_ADJUST_TRANSLATION&amp;&amp;(W=0,j=l,q=0,J=$),u.drawImage(t,W,q,j-W,J-q,W,q,j-W,J-q);u.restore()&#125;&#125;catch(t)&#123;_._$Rb(t)&#125;&#125;,ot.clip=function(t,e,i,r,o,n,s,_,a,h,l,$,u,p,c,f)&#123;i&gt;.02?ot.expandClip(t,e,i,r,l,$,u,p,c,f):ot.clipWithTransform(t,null,o,n,s,_,a,h)&#125;,ot.expandClip=function(t,e,i,r,o,n,s,_,a,h)&#123;var l=s-o,$=_-n,u=a-o,p=h-n,c=l*p-$*u&gt;0?i:-i,f=-$,g=l,y=a-s,d=h-_,m=-d,T=y,P=Math.sqrt(y*y+d*d),S=-p,v=u,L=Math.sqrt(u*u+p*p),M=o-c*f/r,E=n-c*g/r,A=s-c*f/r,x=_-c*g/r,I=s-c*m/P,w=_-c*T/P,D=a-c*m/P,O=h-c*T/P,R=o+c*S/L,b=n+c*v/L,F=a+c*S/L,C=h+c*v/L,N=ot._$50;return null!=e._$P2(N)&amp;&amp;(ot.clipWithTransform(t,N,M,E,A,x,I,w,D,O,F,C,R,b),!0)&#125;,ot.clipWithTransform=function(t,e,i,r,o,n,s,a)&#123;if(arguments.length&lt;7)_._$li(&quot;err : @LDGL.clip()&quot;);else if(arguments[1]instanceof gt)&#123;var h=ot._$B,l=e,$=arguments;if(t.beginPath(),l)&#123;l._$PS($[2],$[3],h),t.moveTo(h[0],h[1]);for(var u=4;u&lt;$.length;u+=2)l._$PS($[u],$[u+1],h),t.lineTo(h[0],h[1])&#125;else&#123;t.moveTo($[2],$[3]);for(u=4;u&lt;$.length;u+=2)t.lineTo($[u],$[u+1])&#125;t.clip()&#125;else _._$li(&quot;err : a[0] is _$6 LDTransform @LDGL.clip()&quot;)&#125;,ot.createCanvas=function(t,e)&#123;var i=document.createElement(&quot;canvas&quot;);return i.setAttribute(&quot;width&quot;,t),i.setAttribute(&quot;height&quot;,e),i||_._$li(&quot;err : &quot;+i),i&#125;,ot.dumpValues=function()&#123;for(var t=&quot;&quot;,e=0;e&lt;arguments.length;e++)t+=&quot;[&quot;+e+&quot;]= &quot;+arguments[e].toFixed(3)+&quot; , &quot;;console.log(t)&#125;,nt.prototype._$F0=function(t)&#123;this._$TT=t._$_T(),this._$LT=t._$_T(),this._$FS=t._$_T(),this._$wL=t._$nP()&#125;,nt.prototype.getMinValue=function()&#123;return this._$TT&#125;,nt.prototype.getMaxValue=function()&#123;return this._$LT&#125;,nt.prototype.getDefaultValue=function()&#123;return this._$FS&#125;,nt.prototype.getParamID=function()&#123;return this._$wL&#125;,st.prototype._$yo=function()&#123;return this._$AT&amp;&amp;!this._$JS&#125;,st.prototype._$hS=function(t)&#123;this._$AT=t&#125;,st.prototype._$GT=function()&#123;return this._$e0&#125;,st.prototype._$l2=function(t)&#123;this._$IP=t&#125;,st.prototype.getPartsIndex=function()&#123;return this._$IP&#125;,st.prototype._$x2=function()&#123;return this._$JS&#125;,st.prototype._$Ib=function(t)&#123;this._$JS=t&#125;,st.prototype.getTotalScale=function()&#123;return this.totalScale&#125;,st.prototype.setTotalScale_notForClient=function(t)&#123;this.totalScale=t&#125;,st.prototype.getInterpolatedOpacity=function()&#123;return this._$7s&#125;,st.prototype.setInterpolatedOpacity=function(t)&#123;this._$7s=t&#125;,st.prototype.getTotalOpacity=function(t)&#123;return this.totalOpacity&#125;,st.prototype.setTotalOpacity=function(t)&#123;this.totalOpacity=t&#125;,_t._$2s=&quot;2.1.00_1&quot;,_t._$Kr=201001e3,_t._$sP=!0,_t._$so=!0,_t._$cb=!1,_t._$3T=!0,_t._$Ts=!0,_t._$fb=!0,_t._$ts=!0,_t.L2D_DEFORMER_EXTEND=!0,_t._$Wb=!1,_t._$yr=!1,_t._$Zs=!1,_t.L2D_NO_ERROR=0,_t._$i7=1e3,_t._$9s=1001,_t._$es=1100,_t._$r7=2e3,_t._$07=2001,_t._$b7=2002,_t._$H7=4e3,_t.L2D_COLOR_BLEND_MODE_MULT=0,_t.L2D_COLOR_BLEND_MODE_ADD=1,_t.L2D_COLOR_BLEND_MODE_INTERPOLATE=2,_t._$6b=!0,_t._$cT=0,_t.clippingMaskBufferSize=256,_t.glContext=new Array,_t.frameBuffers=new Array,_t.fTexture=new Array,_t.IGNORE_CLIP=!1,_t.IGNORE_EXPAND=!1,_t.EXPAND_W=2,_t.USE_ADJUST_TRANSLATION=!0,_t.USE_CANVAS_TRANSFORM=!0,_t.USE_CACHED_POLYGON_IMAGE=!1,_t.DEBUG_DATA=&#123;&#125;,_t.PROFILE_IOS_SPEED=&#123;PROFILE_NAME:&quot;iOS Speed&quot;,USE_ADJUST_TRANSLATION:!0,USE_CACHED_POLYGON_IMAGE:!0,EXPAND_W:4&#125;,_t.PROFILE_IOS_QUALITY=&#123;PROFILE_NAME:&quot;iOS HiQ&quot;,USE_ADJUST_TRANSLATION:!0,USE_CACHED_POLYGON_IMAGE:!1,EXPAND_W:2&#125;,_t.PROFILE_IOS_DEFAULT=_t.PROFILE_IOS_QUALITY,_t.PROFILE_ANDROID=&#123;PROFILE_NAME:&quot;Android&quot;,USE_ADJUST_TRANSLATION:!1,USE_CACHED_POLYGON_IMAGE:!1,EXPAND_W:2&#125;,_t.PROFILE_DESKTOP=&#123;PROFILE_NAME:&quot;Desktop&quot;,USE_ADJUST_TRANSLATION:!1,USE_CACHED_POLYGON_IMAGE:!1,EXPAND_W:2&#125;,_t.initProfile=function()&#123;Mt.isIOS()?_t.setupProfile(_t.PROFILE_IOS_DEFAULT):Mt.isAndroid()?_t.setupProfile(_t.PROFILE_ANDROID):_t.setupProfile(_t.PROFILE_DESKTOP)&#125;,_t.setupProfile=function(t,e)&#123;if(&quot;number&quot;==typeof t)switch(t)&#123;case 9901:t=_t.PROFILE_IOS_SPEED;break;case 9902:t=_t.PROFILE_IOS_QUALITY;break;case 9903:t=_t.PROFILE_IOS_DEFAULT;break;case 9904:t=_t.PROFILE_ANDROID;break;case 9905:t=_t.PROFILE_DESKTOP;break;default:alert(&quot;profile _$6 _$Ui : &quot;+t)&#125;for(var i in arguments.length&lt;2&amp;&amp;(e=!0),e&amp;&amp;console.log(&quot;profile : &quot;+t.PROFILE_NAME),t)_t[i]=t[i],e&amp;&amp;console.log(&quot;  [&quot;+i+&quot;] = &quot;+t[i])&#125;,_t.init=function()&#123;if(_t._$6b)&#123;console.log(&quot;Live2D %s&quot;,_t._$2s),_t._$6b=!1;!0,_t.initProfile()&#125;&#125;,_t.getVersionStr=function()&#123;return _t._$2s&#125;,_t.getVersionNo=function()&#123;return _t._$Kr&#125;,_t._$sT=function(t)&#123;_t._$cT=t&#125;,_t.getError=function()&#123;var t=_t._$cT;return _t._$cT=0,t&#125;,_t.dispose=function()&#123;_t.glContext=[],_t.frameBuffers=[],_t.fTexture=[]&#125;,_t.setGL=function(t,e)&#123;var i=e||0;_t.glContext[i]=t&#125;,_t.getGL=function(t)&#123;return _t.glContext[t]&#125;,_t.setClippingMaskBufferSize=function(t)&#123;_t.clippingMaskBufferSize=t&#125;,_t.getClippingMaskBufferSize=function()&#123;return _t.clippingMaskBufferSize&#125;,_t.deleteBuffer=function(t)&#123;_t.getGL(t).deleteFramebuffer(_t.frameBuffers[t].framebuffer),delete _t.frameBuffers[t],delete _t.glContext[t]&#125;,at._$r2=function(t)&#123;return t&lt;0?0:t&gt;1?1:.5-.5*Math.cos(t*vt.PI_F)&#125;,ht._$fr=-1,ht.prototype.toString=function()&#123;return this._$ib&#125;,lt.prototype=new W,lt._$42=0,lt._$Os=30,lt._$ms=0,lt._$ns=1,lt._$_s=2,lt._$gT=new Array,lt.prototype._$_S=function(t)&#123;this._$LP=t&#125;,lt.prototype.getTextureNo=function()&#123;return this._$LP&#125;,lt.prototype._$ZL=function()&#123;return this._$Qi&#125;,lt.prototype._$H2=function()&#123;return this._$JP&#125;,lt.prototype.getNumPoints=function()&#123;return this._$d0&#125;,lt.prototype.getType=function()&#123;return W._$wb&#125;,lt.prototype._$B2=function(t,e,i)&#123;var r=e,o=null!=r._$hr?r._$hr:r._$Cr;switch(B._$do)&#123;default:case B._$Ms:throw new Error(&quot;_$L _$ro &quot;);case B._$Qs:for(var n=this._$d0-1;n&gt;=0;--n)&#123;o[n*B._$No+4]=i&#125;&#125;&#125;,lt.prototype._$zP=function()&#123;this._$GS=new D,this._$GS._$zP()&#125;,lt.prototype._$F0=function(t)&#123;W.prototype._$F0.call(this,t),this._$LP=t._$6L(),this._$d0=t._$6L(),this._$Yo=t._$6L();var e=t._$nP();this._$BP=new Int16Array(3*this._$Yo);for(var i=3*this._$Yo-1;i&gt;=0;--i)this._$BP[i]=e[i];if(this._$Eo=t._$nP(),this._$Qi=t._$nP(),t.getFormatVersion()&gt;=G._$s7)&#123;if(this._$JP=t._$6L(),0!=this._$JP)&#123;if(0!=(1&amp;this._$JP))&#123;var r=t._$6L();null==this._$5P&amp;&amp;(this._$5P=new Object),this._$5P._$Hb=parseInt(r)&#125;0!=(this._$JP&amp;lt._$Os)?this._$6s=(this._$JP&amp;lt._$Os)&gt;&gt;1:this._$6s=lt._$ms,0!=(32&amp;this._$JP)&amp;&amp;(this.culling=!1)&#125;&#125;else this._$JP=0&#125;,lt.prototype.init=function(t)&#123;var e=new $t(this),i=this._$d0*B._$No,r=this._$32();switch(null!=e._$Cr&amp;&amp;(e._$Cr=null),e._$Cr=new Float32Array(i),null!=e._$hr&amp;&amp;(e._$hr=null),e._$hr=r?new Float32Array(i):null,B._$do)&#123;default:case B._$Ms:if(B._$Ls)for(var o=this._$d0-1;o&gt;=0;--o)&#123;var n=o&lt;&lt;1;this._$Qi[n+1]=1-this._$Qi[n+1]&#125;break;case B._$Qs:for(o=this._$d0-1;o&gt;=0;--o)&#123;n=o&lt;&lt;1;var s=o*B._$No,_=this._$Qi[n],a=this._$Qi[n+1];e._$Cr[s]=_,e._$Cr[s+1]=a,e._$Cr[s+4]=0,r&amp;&amp;(e._$hr[s]=_,e._$hr[s+1]=a,e._$hr[s+4]=0)&#125;&#125;return e&#125;,lt.prototype._$Nr=function(t,e)&#123;var i=e;if(this!=i._$GT()&amp;&amp;console.log(&quot;### assert!! ### &quot;),this._$GS._$Ur(t)&amp;&amp;(W.prototype._$Nr.call(this,t,i),!i._$IS[0]))&#123;var r=lt._$gT;r[0]=!1,S._$Vr(t,this._$GS,r,this._$d0,this._$Eo,i._$Cr,B._$i2,B._$No)&#125;&#125;,lt.prototype._$2b=function(t,e)&#123;try&#123;this!=e._$GT()&amp;&amp;console.log(&quot;### assert!! ### &quot;);var i=!1;e._$IS[0]&amp;&amp;(i=!0);var r=e;if(!i&amp;&amp;(W.prototype._$2b.call(this,t),this._$32()))&#123;var o=this.getTargetBaseDataID();if(r._$8r==W._$ur&amp;&amp;(r._$8r=t.getBaseDataIndex(o)),r._$8r&lt;0)_t._$so&amp;&amp;_._$li(&quot;_$L _$0P _$G :: %s&quot;,o);else&#123;var n=t.getBaseData(r._$8r),s=t._$q2(r._$8r);null==n||s._$x2()?r._$AT=!1:(n._$nb(t,s,r._$Cr,r._$hr,this._$d0,B._$i2,B._$No),r._$AT=!0),r.baseOpacity=s.getTotalOpacity()&#125;&#125;&#125;catch(t)&#123;throw t&#125;&#125;,lt.prototype.draw=function(t,e,i)&#123;if(this!=i._$GT()&amp;&amp;console.log(&quot;### assert!! ### &quot;),!i._$IS[0])&#123;var r=i,o=this._$LP;o&lt;0&amp;&amp;(o=1);var n=this.getOpacity(e,r)*i._$VS*i.baseOpacity,s=null!=r._$hr?r._$hr:r._$Cr;t.setClipBufPre_clipContextForDraw(i.clipBufPre_clipContext),t._$WP(this.culling),t._$Uo(o,3*this._$Yo,this._$BP,s,this._$Qi,n,this._$6s,r)&#125;&#125;,lt.prototype.dump=function()&#123;console.log(&quot;  _$yi( %d ) , _$d0( %d ) , _$Yo( %d ) \\n&quot;,this._$LP,this._$d0,this._$Yo),console.log(&quot;  _$Oi _$di = &#123; &quot;);for(var t=0;t&lt;this._$BP.length;t++)console.log(&quot;%5d ,&quot;,this._$BP[t]);console.log(&quot;\\n  _$5i _$30&quot;);for(t=0;t&lt;this._$Eo.length;t++)&#123;console.log(&quot;\\n    _$30[%d] = &quot;,t);for(var e=this._$Eo[t],i=0;i&lt;e.length;i++)console.log(&quot;%6.2f, &quot;,e[i])&#125;console.log(&quot;\\n&quot;)&#125;,lt.prototype._$72=function(t)&#123;return null==this._$5P?null:this._$5P[t]&#125;,lt.prototype.getIndexArray=function()&#123;return this._$BP&#125;,$t.prototype=new Lt,$t.prototype.getTransformedPoints=function()&#123;return null!=this._$hr?this._$hr:this._$Cr&#125;,ut.prototype._$HT=function(t)&#123;this.x=t.x,this.y=t.y&#125;,ut.prototype._$HT=function(t,e)&#123;this.x=t,this.y=e&#125;,pt.prototype=new r,pt.loadModel=function(t)&#123;var e=new pt;return r._$62(e,t),e&#125;,pt.loadModel=function(t,e)&#123;var i=new pt(e||0);return r._$62(i,t),i&#125;,pt._$to=function()&#123;return new pt&#125;,pt._$er=function(t)&#123;var e=new _$5(&quot;../_$_r/_$t0/_$Ri/_$_P._$d&quot;);if(0==e.exists())throw new _$ls(&quot;_$t0 _$_ _$6 _$Ui :: &quot;+e._$PL());for(var i=[&quot;../_$_r/_$t0/_$Ri/_$_P.512/_$CP._$1&quot;,&quot;../_$_r/_$t0/_$Ri/_$_P.512/_$vP._$1&quot;,&quot;../_$_r/_$t0/_$Ri/_$_P.512/_$EP._$1&quot;,&quot;../_$_r/_$t0/_$Ri/_$_P.512/_$pP._$1&quot;],r=pt.loadModel(e._$3b()),o=0;o&lt;i.length;o++)&#123;var n=new _$5(i[o]);if(0==n.exists())throw new _$ls(&quot;_$t0 _$_ _$6 _$Ui :: &quot;+n._$PL());r.setTexture(o,_$nL._$_o(t,n._$3b()))&#125;return r&#125;,pt.prototype.setGL=function(t)&#123;_t.setGL(t)&#125;,pt.prototype.setTransform=function(t)&#123;this.drawParamWebGL.setTransform(t)&#125;,pt.prototype.update=function()&#123;this._$5S.update(),this._$5S.preDraw(this.drawParamWebGL)&#125;,pt.prototype.draw=function()&#123;this._$5S.draw(this.drawParamWebGL)&#125;,pt.prototype._$K2=function()&#123;this.drawParamWebGL._$K2()&#125;,pt.prototype.setTexture=function(t,e)&#123;null==this.drawParamWebGL&amp;&amp;_._$li(&quot;_$Yi for QT _$ki / _$XS() is _$6 _$ui!!&quot;),this.drawParamWebGL.setTexture(t,e)&#125;,pt.prototype.setTexture=function(t,e)&#123;null==this.drawParamWebGL&amp;&amp;_._$li(&quot;_$Yi for QT _$ki / _$XS() is _$6 _$ui!!&quot;),this.drawParamWebGL.setTexture(t,e)&#125;,pt.prototype._$Rs=function()&#123;return this.drawParamWebGL._$Rs()&#125;,pt.prototype._$Ds=function(t)&#123;this.drawParamWebGL._$Ds(t)&#125;,pt.prototype.getDrawParam=function()&#123;return this.drawParamWebGL&#125;,pt.prototype.setMatrix=function(t)&#123;this.drawParamWebGL.setMatrix(t)&#125;,pt.prototype.setPremultipliedAlpha=function(t)&#123;this.drawParamWebGL.setPremultipliedAlpha(t)&#125;,pt.prototype.isPremultipliedAlpha=function()&#123;return this.drawParamWebGL.isPremultipliedAlpha()&#125;,pt.prototype.setAnisotropy=function(t)&#123;this.drawParamWebGL.setAnisotropy(t)&#125;,pt.prototype.getAnisotropy=function()&#123;return this.drawParamWebGL.getAnisotropy()&#125;,ct.prototype._$tb=function()&#123;return this.motions&#125;,ct.prototype.startMotion=function(t,e)&#123;for(var i=null,r=this.motions.length,o=0;o&lt;r;++o)null!=(i=this.motions[o])&amp;&amp;(i._$qS(i._$w0.getFadeOut()),this._$eb&amp;&amp;_._$Ji(&quot;MotionQueueManager[size:%2d]-&gt;startMotion() / start _$K _$3 (m%d)\\n&quot;,r,i._$sr));if(null==t)return-1;(i=new ft)._$w0=t,this.motions.push(i);var n=i._$sr;return this._$eb&amp;&amp;_._$Ji(&quot;MotionQueueManager[size:%2d]-&gt;startMotion() / new _$w0 (m%d)\\n&quot;,r,n),n&#125;,ct.prototype.updateParam=function(t)&#123;try&#123;for(var e=!1,i=0;i&lt;this.motions.length;i++)&#123;var r=this.motions[i];if(null!=r)&#123;var o=r._$w0;null!=o?(o.updateParam(t,r),e=!0,r.isFinished()&amp;&amp;(this._$eb&amp;&amp;_._$Ji(&quot;MotionQueueManager[size:%2d]-&gt;updateParam() / _$T0 _$w0 (m%d)\\n&quot;,this.motions.length-1,r._$sr),this.motions.splice(i,1),i--)):(this.motions=this.motions.splice(i,1),i--)&#125;else this.motions.splice(i,1),i--&#125;return e&#125;catch(t)&#123;return _._$li(t),!0&#125;&#125;,ct.prototype.isFinished=function(t)&#123;if(arguments.length&gt;=1)&#123;for(var e=0;e&lt;this.motions.length;e++)&#123;if(null!=(i=this.motions[e])&amp;&amp;(i._$sr==t&amp;&amp;!i.isFinished()))return!1&#125;return!0&#125;for(e=0;e&lt;this.motions.length;e++)&#123;var i;if(null!=(i=this.motions[e]))if(null!=i._$w0)&#123;if(!i.isFinished())return!1&#125;else this.motions.splice(e,1),e--;else this.motions.splice(e,1),e--&#125;return!0&#125;,ct.prototype.stopAllMotions=function()&#123;for(var t=0;t&lt;this.motions.length;t++)&#123;var e=this.motions[t];if(null!=e)&#123;e._$w0;this.motions.splice(t,1),t--&#125;else this.motions.splice(t,1),t--&#125;&#125;,ct.prototype._$Zr=function(t)&#123;this._$eb=t&#125;,ct.prototype._$e=function()&#123;console.log(&quot;-- _$R --\\n&quot;);for(var t=0;t&lt;this.motions.length;t++)&#123;var e=this.motions[t]._$w0;console.log(&quot;MotionQueueEnt[%d] :: %s\\n&quot;,this.motions.length,e.toString())&#125;&#125;,ft._$Gs=0,ft.prototype.isFinished=function()&#123;return this._$9L&#125;,ft.prototype._$qS=function(t)&#123;var e=x.getUserTimeMSec()+t;(this._$Do&lt;0||e&lt;this._$Do)&amp;&amp;(this._$Do=e)&#125;,ft.prototype._$Bs=function()&#123;return this._$sr&#125;,gt.prototype.setContext=function(t)&#123;var e=this.m;t.transform(e[0],e[1],e[3],e[4],e[6],e[7])&#125;,gt.prototype.toString=function()&#123;for(var t=&quot;LDTransform &#123; &quot;,e=0;e&lt;9;e++)t+=this.m[e].toFixed(2)+&quot; ,&quot;;return t+=&quot; &#125;&quot;&#125;,gt.prototype.identity=function()&#123;var t=this.m;t[0]=t[4]=t[8]=1,t[1]=t[2]=t[3]=t[5]=t[6]=t[7]=0&#125;,gt.prototype._$PS=function(t,e,i)&#123;null==i&amp;&amp;(i=new Array(0,0));var r=this.m;return i[0]=r[0]*t+r[3]*e+r[6],i[1]=r[1]*t+r[4]*e+r[7],i&#125;,gt.prototype._$P2=function(t)&#123;t||(t=new gt);var e=this.m,i=e[0],r=e[1],o=e[2],n=e[3],s=e[4],_=e[5],a=e[6],h=e[7],l=e[8],$=i*s*l+r*_*a+o*n*h-i*_*h-o*s*a-r*n*l;if(0==$)return null;var u=1/$;return t.m[0]=u*(s*l-h*_),t.m[1]=u*(h*o-r*l),t.m[2]=u*(r*_-s*o),t.m[3]=u*(a*_-n*l),t.m[4]=u*(i*l-a*o),t.m[5]=u*(n*o-i*_),t.m[6]=u*(n*h-a*s),t.m[7]=u*(a*r-i*h),t.m[8]=u*(i*s-n*r),t&#125;,gt.prototype.transform=function(t,e,i)&#123;null==i&amp;&amp;(i=new Array(0,0));var r=this.m;return i[0]=r[0]*t+r[3]*e+r[6],i[1]=r[1]*t+r[4]*e+r[7],i&#125;,gt.prototype.translate=function(t,e)&#123;var i=this.m;i[6]=i[0]*t+i[3]*e+i[6],i[7]=i[1]*t+i[4]*e+i[7],i[8]=i[2]*t+i[5]*e+i[8]&#125;,gt.prototype.scale=function(t,e)&#123;var i=this.m;i[0]*=t,i[1]*=t,i[2]*=t,i[3]*=e,i[4]*=e,i[5]*=e&#125;,gt.prototype.shear=function(t,e)&#123;var i=this.m,r=i[0]+i[3]*e,o=i[1]+i[4]*e,n=i[2]+i[5]*e;i[3]=i[0]*t+i[3],i[4]=i[1]*t+i[4],i[5]=i[2]*t+i[5],i[0]=r,i[1]=o,i[2]=n&#125;,gt.prototype.rotate=function(t)&#123;var e=this.m,i=Math.cos(t),r=Math.sin(t),o=e[0]*i+e[3]*r,n=e[1]*i+e[4]*r,s=e[2]*i+e[5]*r;e[3]=-e[0]*r+e[3]*i,e[4]=-e[1]*r+e[4]*i,e[5]=-e[2]*r+e[5]*i,e[0]=o,e[1]=n,e[2]=s&#125;,gt.prototype.concatenate=function(t)&#123;var e=this.m,i=t.m,r=e[0]*i[0]+e[3]*i[1]+e[6]*i[2],o=e[1]*i[0]+e[4]*i[1]+e[7]*i[2],n=e[2]*i[0]+e[5]*i[1]+e[8]*i[2],s=e[0]*i[3]+e[3]*i[4]+e[6]*i[5],_=e[1]*i[3]+e[4]*i[4]+e[7]*i[5],a=e[2]*i[3]+e[5]*i[4]+e[8]*i[5],h=e[0]*i[6]+e[3]*i[7]+e[6]*i[8],l=e[1]*i[6]+e[4]*i[7]+e[7]*i[8],$=e[2]*i[6]+e[5]*i[7]+e[8]*i[8];m[0]=r,m[1]=o,m[2]=n,m[3]=s,m[4]=_,m[5]=a,m[6]=h,m[7]=l,m[8]=$&#125;,yt.prototype=new it,yt._$eT=null,yt._$tP=new Object,yt._$2o=function()&#123;return null==yt._$eT&amp;&amp;(yt._$eT=yt.getID(&quot;DST_BASE&quot;)),yt._$eT&#125;,yt._$27=function()&#123;yt._$tP.clear(),yt._$eT=null&#125;,yt.getID=function(t)&#123;var e=yt._$tP[t];return null==e&amp;&amp;(e=new yt(t),yt._$tP[t]=e),e&#125;,yt.prototype._$3s=function()&#123;return new yt&#125;,dt.prototype=new M,dt._$9r=function(t)&#123;return new Float32Array(t)&#125;,dt._$vb=function(t)&#123;return new Int16Array(t)&#125;,dt._$cr=function(t,e)&#123;return null==t||t._$yL()&lt;e.length?((t=dt._$9r(2*e.length)).put(e),t._$oT(0)):(t.clear(),t.put(e),t._$oT(0)),t&#125;,dt._$mb=function(t,e)&#123;return null==t||t._$yL()&lt;e.length?((t=dt._$vb(2*e.length)).put(e),t._$oT(0)):(t.clear(),t.put(e),t._$oT(0)),t&#125;,dt._$Hs=function()&#123;return this._$Gr&#125;,dt._$as=function(t)&#123;this._$Gr=t&#125;,dt.prototype.getGL=function()&#123;return this.gl&#125;,dt.prototype.setGL=function(t)&#123;this.gl=t&#125;,dt.prototype.setTransform=function(t)&#123;this.transform=t&#125;,dt.prototype._$ZT=function()&#123;var t=this.gl;this.firstDraw&amp;&amp;(this.initShader(),this.firstDraw=!1,this.anisotropyExt=t.getExtension(&quot;EXT_texture_filter_anisotropic&quot;)||t.getExtension(&quot;WEBKIT_EXT_texture_filter_anisotropic&quot;)||t.getExtension(&quot;MOZ_EXT_texture_filter_anisotropic&quot;),this.anisotropyExt&amp;&amp;(this.maxAnisotropy=t.getParameter(this.anisotropyExt.MAX_TEXTURE_MAX_ANISOTROPY_EXT))),t.disable(t.SCISSOR_TEST),t.disable(t.STENCIL_TEST),t.disable(t.DEPTH_TEST),t.frontFace(t.CW),t.enable(t.BLEND),t.colorMask(1,1,1,1),t.bindBuffer(t.ARRAY_BUFFER,null),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,null)&#125;,dt.prototype._$Uo=function(t,e,i,r,o,n,s,_)&#123;if(!(n&lt;.01&amp;&amp;null==this.clipBufPre_clipContextMask))&#123;n&gt;.9&amp;&amp;_t.EXPAND_W;var a=this.gl;if(null==this.gl)throw new Error(&quot;gl is null&quot;);var h,l,$,u,p=1*this._$C0*n,c=1*this._$tT*n,f=1*this._$WL*n,g=this._$lT*n;if(null!=this.clipBufPre_clipContextMask)&#123;a.frontFace(a.CCW),a.useProgram(this.shaderProgram),this._$vS=mt(a,this._$vS,r),this._$no=Tt(a,this._$no,i),a.enableVertexAttribArray(this.a_position_Loc),a.vertexAttribPointer(this.a_position_Loc,2,a.FLOAT,!1,0,0),this._$NT=mt(a,this._$NT,o),a.activeTexture(a.TEXTURE1),a.bindTexture(a.TEXTURE_2D,this.textures[t]),a.uniform1i(this.s_texture0_Loc,1),a.enableVertexAttribArray(this.a_texCoord_Loc),a.vertexAttribPointer(this.a_texCoord_Loc,2,a.FLOAT,!1,0,0),a.uniformMatrix4fv(this.u_matrix_Loc,!1,this.getClipBufPre_clipContextMask().matrixForMask);var y=this.getClipBufPre_clipContextMask().layoutChannelNo,d=this.getChannelFlagAsColor(y);a.uniform4f(this.u_channelFlag,d.r,d.g,d.b,d.a);var m=this.getClipBufPre_clipContextMask().layoutBounds;a.uniform4f(this.u_baseColor_Loc,2*m.x-1,2*m.y-1,2*m._$EL()-1,2*m._$5T()-1),a.uniform1i(this.u_maskFlag_Loc,!0)&#125;else if(null!=this.getClipBufPre_clipContextDraw())&#123;a.useProgram(this.shaderProgramOff),this._$vS=mt(a,this._$vS,r),this._$no=Tt(a,this._$no,i),a.enableVertexAttribArray(this.a_position_Loc_Off),a.vertexAttribPointer(this.a_position_Loc_Off,2,a.FLOAT,!1,0,0),this._$NT=mt(a,this._$NT,o),a.activeTexture(a.TEXTURE1),a.bindTexture(a.TEXTURE_2D,this.textures[t]),a.uniform1i(this.s_texture0_Loc_Off,1),a.enableVertexAttribArray(this.a_texCoord_Loc_Off),a.vertexAttribPointer(this.a_texCoord_Loc_Off,2,a.FLOAT,!1,0,0),a.uniformMatrix4fv(this.u_clipMatrix_Loc_Off,!1,this.getClipBufPre_clipContextDraw().matrixForDraw),a.uniformMatrix4fv(this.u_matrix_Loc_Off,!1,this.matrix4x4),a.activeTexture(a.TEXTURE2),a.bindTexture(a.TEXTURE_2D,_t.fTexture[this.glno]),a.uniform1i(this.s_texture1_Loc_Off,2);y=this.getClipBufPre_clipContextDraw().layoutChannelNo,d=this.getChannelFlagAsColor(y);a.uniform4f(this.u_channelFlag_Loc_Off,d.r,d.g,d.b,d.a),a.uniform4f(this.u_baseColor_Loc_Off,p,c,f,g)&#125;else a.useProgram(this.shaderProgram),this._$vS=mt(a,this._$vS,r),this._$no=Tt(a,this._$no,i),a.enableVertexAttribArray(this.a_position_Loc),a.vertexAttribPointer(this.a_position_Loc,2,a.FLOAT,!1,0,0),this._$NT=mt(a,this._$NT,o),a.activeTexture(a.TEXTURE1),a.bindTexture(a.TEXTURE_2D,this.textures[t]),a.uniform1i(this.s_texture0_Loc,1),a.enableVertexAttribArray(this.a_texCoord_Loc),a.vertexAttribPointer(this.a_texCoord_Loc,2,a.FLOAT,!1,0,0),a.uniformMatrix4fv(this.u_matrix_Loc,!1,this.matrix4x4),a.uniform4f(this.u_baseColor_Loc,p,c,f,g),a.uniform1i(this.u_maskFlag_Loc,!1);if(this.culling?this.gl.enable(a.CULL_FACE):this.gl.disable(a.CULL_FACE),this.gl.enable(a.BLEND),null!=this.clipBufPre_clipContextMask)h=a.ONE,l=a.ONE_MINUS_SRC_ALPHA,$=a.ONE,u=a.ONE_MINUS_SRC_ALPHA;else switch(s)&#123;case lt._$ms:h=a.ONE,l=a.ONE_MINUS_SRC_ALPHA,$=a.ONE,u=a.ONE_MINUS_SRC_ALPHA;break;case lt._$ns:h=a.ONE,l=a.ONE,$=a.ZERO,u=a.ONE;break;case lt._$_s:h=a.DST_COLOR,l=a.ONE_MINUS_SRC_ALPHA,$=a.ZERO,u=a.ONE&#125;a.blendEquationSeparate(a.FUNC_ADD,a.FUNC_ADD),a.blendFuncSeparate(h,l,$,u),this.anisotropyExt&amp;&amp;a.texParameteri(a.TEXTURE_2D,this.anisotropyExt.TEXTURE_MAX_ANISOTROPY_EXT,this.maxAnisotropy);var T=i.length;a.drawElements(a.TRIANGLES,T,a.UNSIGNED_SHORT,0),a.bindTexture(a.TEXTURE_2D,null)&#125;&#125;,dt.prototype._$Rs=function()&#123;throw new Error(&quot;_$Rs&quot;)&#125;,dt.prototype._$Ds=function(t)&#123;throw new Error(&quot;_$Ds&quot;)&#125;,dt.prototype._$K2=function()&#123;for(var t=0;t&lt;this.textures.length;t++)&#123;0!=this.textures[t]&amp;&amp;(this.gl._$K2(1,this.textures,t),this.textures[t]=null)&#125;&#125;,dt.prototype.setTexture=function(t,e)&#123;this.textures[t]=e&#125;,dt.prototype.initShader=function()&#123;var t=this.gl;this.loadShaders2(),this.a_position_Loc=t.getAttribLocation(this.shaderProgram,&quot;a_position&quot;),this.a_texCoord_Loc=t.getAttribLocation(this.shaderProgram,&quot;a_texCoord&quot;),this.u_matrix_Loc=t.getUniformLocation(this.shaderProgram,&quot;u_mvpMatrix&quot;),this.s_texture0_Loc=t.getUniformLocation(this.shaderProgram,&quot;s_texture0&quot;),this.u_channelFlag=t.getUniformLocation(this.shaderProgram,&quot;u_channelFlag&quot;),this.u_baseColor_Loc=t.getUniformLocation(this.shaderProgram,&quot;u_baseColor&quot;),this.u_maskFlag_Loc=t.getUniformLocation(this.shaderProgram,&quot;u_maskFlag&quot;),this.a_position_Loc_Off=t.getAttribLocation(this.shaderProgramOff,&quot;a_position&quot;),this.a_texCoord_Loc_Off=t.getAttribLocation(this.shaderProgramOff,&quot;a_texCoord&quot;),this.u_matrix_Loc_Off=t.getUniformLocation(this.shaderProgramOff,&quot;u_mvpMatrix&quot;),this.u_clipMatrix_Loc_Off=t.getUniformLocation(this.shaderProgramOff,&quot;u_ClipMatrix&quot;),this.s_texture0_Loc_Off=t.getUniformLocation(this.shaderProgramOff,&quot;s_texture0&quot;),this.s_texture1_Loc_Off=t.getUniformLocation(this.shaderProgramOff,&quot;s_texture1&quot;),this.u_channelFlag_Loc_Off=t.getUniformLocation(this.shaderProgramOff,&quot;u_channelFlag&quot;),this.u_baseColor_Loc_Off=t.getUniformLocation(this.shaderProgramOff,&quot;u_baseColor&quot;)&#125;,dt.prototype.disposeShader=function()&#123;var t=this.gl;this.shaderProgram&amp;&amp;(t.deleteProgram(this.shaderProgram),this.shaderProgram=null),this.shaderProgramOff&amp;&amp;(t.deleteProgram(this.shaderProgramOff),this.shaderProgramOff=null)&#125;,dt.prototype.compileShader=function(t,e)&#123;var i=this.gl,r=e,o=i.createShader(t);if(null==o)return _._$Ji(&quot;_$L0 to create shader&quot;),null;if(i.shaderSource(o,r),i.compileShader(o),!i.getShaderParameter(o,i.COMPILE_STATUS))&#123;var n=i.getShaderInfoLog(o);return _._$Ji(&quot;_$L0 to compile shader : &quot;+n),i.deleteShader(o),null&#125;return o&#125;,dt.prototype.loadShaders2=function()&#123;var t=this.gl;if(this.shaderProgram=t.createProgram(),!this.shaderProgram)return!1;if(this.shaderProgramOff=t.createProgram(),!this.shaderProgramOff)return!1;if(this.vertShader=this.compileShader(t.VERTEX_SHADER,&quot;attribute vec4     a_position;attribute vec2     a_texCoord;varying vec2       v_texCoord;varying vec4       v_ClipPos;uniform mat4       u_mvpMatrix;void main()&#123;    gl_Position = u_mvpMatrix * a_position;    v_ClipPos = u_mvpMatrix * a_position;    v_texCoord = a_texCoord;&#125;&quot;),!this.vertShader)return _._$Ji(&quot;Vertex shader compile _$li!&quot;),!1;if(this.vertShaderOff=this.compileShader(t.VERTEX_SHADER,&quot;attribute vec4     a_position;attribute vec2     a_texCoord;varying vec2       v_texCoord;varying vec4       v_ClipPos;uniform mat4       u_mvpMatrix;uniform mat4       u_ClipMatrix;void main()&#123;    gl_Position = u_mvpMatrix * a_position;    v_ClipPos = u_ClipMatrix * a_position;    v_texCoord = a_texCoord ;&#125;&quot;),!this.vertShaderOff)return _._$Ji(&quot;OffVertex shader compile _$li!&quot;),!1;if(this.fragShader=this.compileShader(t.FRAGMENT_SHADER,&quot;precision mediump float;varying vec2       v_texCoord;varying vec4       v_ClipPos;uniform sampler2D  s_texture0;uniform vec4       u_channelFlag;uniform vec4       u_baseColor;uniform bool       u_maskFlag;void main()&#123;    vec4 smpColor;     if(u_maskFlag)&#123;        float isInside =             step(u_baseColor.x, v_ClipPos.x/v_ClipPos.w)          * step(u_baseColor.y, v_ClipPos.y/v_ClipPos.w)          * step(v_ClipPos.x/v_ClipPos.w, u_baseColor.z)          * step(v_ClipPos.y/v_ClipPos.w, u_baseColor.w);        smpColor = u_channelFlag * texture2D(s_texture0 , v_texCoord).a * isInside;    &#125;else&#123;        smpColor = texture2D(s_texture0 , v_texCoord) * u_baseColor;    &#125;    gl_FragColor = smpColor;&#125;&quot;),!this.fragShader)return _._$Ji(&quot;Fragment shader compile _$li!&quot;),!1;if(this.fragShaderOff=this.compileShader(t.FRAGMENT_SHADER,&quot;precision mediump float ;varying vec2       v_texCoord;varying vec4       v_ClipPos;uniform sampler2D  s_texture0;uniform sampler2D  s_texture1;uniform vec4       u_channelFlag;uniform vec4       u_baseColor ;void main()&#123;    vec4 col_formask = texture2D(s_texture0, v_texCoord) * u_baseColor;    vec4 clipMask = texture2D(s_texture1, v_ClipPos.xy / v_ClipPos.w) * u_channelFlag;    float maskVal = clipMask.r + clipMask.g + clipMask.b + clipMask.a;    col_formask = col_formask * maskVal;    gl_FragColor = col_formask;&#125;&quot;),!this.fragShaderOff)return _._$Ji(&quot;OffFragment shader compile _$li!&quot;),!1;if(t.attachShader(this.shaderProgram,this.vertShader),t.attachShader(this.shaderProgram,this.fragShader),t.attachShader(this.shaderProgramOff,this.vertShaderOff),t.attachShader(this.shaderProgramOff,this.fragShaderOff),t.linkProgram(this.shaderProgram),t.linkProgram(this.shaderProgramOff),!t.getProgramParameter(this.shaderProgram,t.LINK_STATUS))&#123;var e=t.getProgramInfoLog(this.shaderProgram);return _._$Ji(&quot;_$L0 to link program: &quot;+e),this.vertShader&amp;&amp;(t.deleteShader(this.vertShader),this.vertShader=0),this.fragShader&amp;&amp;(t.deleteShader(this.fragShader),this.fragShader=0),this.shaderProgram&amp;&amp;(t.deleteProgram(this.shaderProgram),this.shaderProgram=0),this.vertShaderOff&amp;&amp;(t.deleteShader(this.vertShaderOff),this.vertShaderOff=0),this.fragShaderOff&amp;&amp;(t.deleteShader(this.fragShaderOff),this.fragShaderOff=0),this.shaderProgramOff&amp;&amp;(t.deleteProgram(this.shaderProgramOff),this.shaderProgramOff=0),!1&#125;return!0&#125;,dt.prototype.createFramebuffer=function()&#123;var t=this.gl,e=_t.clippingMaskBufferSize,i=t.createFramebuffer();t.bindFramebuffer(t.FRAMEBUFFER,i);var r=t.createRenderbuffer();t.bindRenderbuffer(t.RENDERBUFFER,r),t.renderbufferStorage(t.RENDERBUFFER,t.RGBA4,e,e),t.framebufferRenderbuffer(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.RENDERBUFFER,r);var o=t.createTexture();return t.bindTexture(t.TEXTURE_2D,o),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,e,e,0,t.RGBA,t.UNSIGNED_BYTE,null),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,o,0),t.bindTexture(t.TEXTURE_2D,null),t.bindRenderbuffer(t.RENDERBUFFER,null),t.bindFramebuffer(t.FRAMEBUFFER,null),_t.fTexture[this.glno]=o,&#123;framebuffer:i,renderbuffer:r,texture:_t.fTexture[this.glno]&#125;&#125;,Pt.prototype._$fP=function()&#123;var t,e,i,r=this._$ST();if(0==(128&amp;r))return 255&amp;r;if(0==(128&amp;(t=this._$ST())))return(127&amp;r)&lt;&lt;7|127&amp;t;if(0==(128&amp;(e=this._$ST())))return(127&amp;r)&lt;&lt;14|(127&amp;t)&lt;&lt;7|255&amp;e;if(0==(128&amp;(i=this._$ST())))return(127&amp;r)&lt;&lt;21|(127&amp;t)&lt;&lt;14|(127&amp;e)&lt;&lt;7|255&amp;i;throw new ht(&quot;_$L _$0P  _&quot;)&#125;,Pt.prototype.getFormatVersion=function()&#123;return this._$S2&#125;,Pt.prototype._$gr=function(t)&#123;this._$S2=t&#125;,Pt.prototype._$3L=function()&#123;return this._$fP()&#125;,Pt.prototype._$mP=function()&#123;return this._$zT(),this._$F+=8,this._$T.getFloat64(this._$F-8)&#125;,Pt.prototype._$_T=function()&#123;return this._$zT(),this._$F+=4,this._$T.getFloat32(this._$F-4)&#125;,Pt.prototype._$6L=function()&#123;return this._$zT(),this._$F+=4,this._$T.getInt32(this._$F-4)&#125;,Pt.prototype._$ST=function()&#123;return this._$zT(),this._$T.getInt8(this._$F++)&#125;,Pt.prototype._$9T=function()&#123;return this._$zT(),this._$F+=2,this._$T.getInt16(this._$F-2)&#125;,Pt.prototype._$2T=function()&#123;throw this._$zT(),this._$F+=8,new ht(&quot;_$L _$q read long&quot;)&#125;,Pt.prototype._$po=function()&#123;return this._$zT(),0!=this._$T.getInt8(this._$F++)&#125;;var St=!0;function vt()&#123;&#125;function Lt(t)&#123;i||(this._$e0=null,this._$IP=null,this._$Us=null,this._$7s=null,this._$IS=[!1],this._$VS=null,this._$AT=!0,this.baseOpacity=1,this.clipBufPre_clipContext=null,this._$e0=t)&#125;function Mt()&#123;&#125;Pt.prototype._$bT=function()&#123;this._$zT();var t=this._$3L(),e=null;if(St)try&#123;var i=new ArrayBuffer(2*t);e=new Uint16Array(i);for(var r=0;r&lt;t;++r)e[r]=this._$T.getUint8(this._$F++);return String.fromCharCode.apply(null,e)&#125;catch(t)&#123;St=!1&#125;try&#123;var o=new Array;if(null==e)for(r=0;r&lt;t;++r)o[r]=this._$T.getUint8(this._$F++);else for(r=0;r&lt;t;++r)o[r]=e[r];return String.fromCharCode.apply(null,o)&#125;catch(t)&#123;console.log(&quot;read utf8 / _$rT _$L0 !! : &quot;+t)&#125;&#125;,Pt.prototype._$cS=function()&#123;this._$zT();for(var t=this._$3L(),e=new Int32Array(t),i=0;i&lt;t;i++)e[i]=this._$T.getInt32(this._$F),this._$F+=4;return e&#125;,Pt.prototype._$Tb=function()&#123;this._$zT();for(var t=this._$3L(),e=new Float32Array(t),i=0;i&lt;t;i++)e[i]=this._$T.getFloat32(this._$F),this._$F+=4;return e&#125;,Pt.prototype._$5b=function()&#123;this._$zT();for(var t=this._$3L(),e=new Float64Array(t),i=0;i&lt;t;i++)e[i]=this._$T.getFloat64(this._$F),this._$F+=8;return e&#125;,Pt.prototype._$nP=function()&#123;return this._$Jb(-1)&#125;,Pt.prototype._$Jb=function(t)&#123;if(this._$zT(),t&lt;0&amp;&amp;(t=this._$3L()),t==G._$7P)&#123;var e=this._$6L();if(0&lt;=e&amp;&amp;e&lt;this._$Ko.length)return this._$Ko[e];throw new ht(&quot;_$sL _$4i @_$m0&quot;)&#125;var i=this._$4b(t);return this._$Ko.push(i),i&#125;,Pt.prototype._$4b=function(t)&#123;if(0==t)return null;if(50==t)&#123;var e=this._$bT();return n=R.getID(e)&#125;if(51==t)&#123;e=this._$bT();return n=yt.getID(e)&#125;if(134==t)&#123;e=this._$bT();return n=h.getID(e)&#125;if(60==t)&#123;e=this._$bT();return n=l.getID(e)&#125;if(t&gt;=48)&#123;var r=G._$9o(t);return null!=r?(r._$F0(this),r):null&#125;switch(t)&#123;case 1:return this._$bT();case 10:return new function()&#123;i||(this.color=null)&#125;(this._$6L(),!0);case 11:return new P(this._$mP(),this._$mP(),this._$mP(),this._$mP());case 12:return new P(this._$_T(),this._$_T(),this._$_T(),this._$_T());case 13:return new v(this._$mP(),this._$mP());case 14:return new v(this._$_T(),this._$_T());case 15:for(var o=this._$3L(),n=new Array(o),s=0;s&lt;o;s++)n[s]=this._$nP();return n;case 17:return n=new b(this._$mP(),this._$mP(),this._$mP(),this._$mP(),this._$mP(),this._$mP());case 21:return new a(this._$6L(),this._$6L(),this._$6L(),this._$6L());case 22:return new ut(this._$6L(),this._$6L());case 23:throw new Error(&quot;_$L _$ro &quot;);case 16:case 25:return this._$cS();case 26:return this._$5b();case 27:return this._$Tb();case 2:case 3:case 4:case 5:case 6:case 7:case 8:case 9:case 18:case 19:case 20:case 24:case 28:throw new ht(&quot;_$6 _$q : _$nP() of 2-9 ,18,19,20,24,28 : &quot;+t);default:throw new ht(&quot;_$6 _$q : _$nP() NO _$i : &quot;+t)&#125;&#125;,Pt.prototype._$8L=function()&#123;return 0==this._$hL?this._$v0=this._$ST():8==this._$hL&amp;&amp;(this._$v0=this._$ST(),this._$hL=0),1==(this._$v0&gt;&gt;7-this._$hL++&amp;1)&#125;,Pt.prototype._$zT=function()&#123;0!=this._$hL&amp;&amp;(this._$hL=0)&#125;,vt._$2S=Math.PI/180,vt._$bS=Math.PI/180,vt._$wS=180/Math.PI,vt._$NS=180/Math.PI,vt.PI_F=Math.PI,vt._$kT=[0,.012368,.024734,.037097,.049454,.061803,.074143,.086471,.098786,.111087,.12337,.135634,.147877,.160098,.172295,.184465,.196606,.208718,.220798,.232844,.244854,.256827,.268761,.280654,.292503,.304308,.316066,.327776,.339436,.351044,.362598,.374097,.385538,.396921,.408243,.419502,.430697,.441826,.452888,.463881,.474802,.485651,.496425,.507124,.517745,.528287,.538748,.549126,.559421,.56963,.579752,.589785,.599728,.609579,.619337,.629,.638567,.648036,.657406,.666676,.675843,.684908,.693867,.70272,.711466,.720103,.72863,.737045,.745348,.753536,.76161,.769566,.777405,.785125,.792725,.800204,.807561,.814793,.821901,.828884,.835739,.842467,.849066,.855535,.861873,.868079,.874153,.880093,.885898,.891567,.897101,.902497,.907754,.912873,.917853,.922692,.92739,.931946,.936359,.940629,.944755,.948737,.952574,.956265,.959809,.963207,.966457,.96956,.972514,.97532,.977976,.980482,.982839,.985045,.987101,.989006,.990759,.992361,.993811,.995109,.996254,.997248,.998088,.998776,.999312,.999694,.999924,1],vt._$92=function(t,e)&#123;var i=Math.atan2(t[1],t[0]),r=Math.atan2(e[1],e[0]);return vt._$tS(i,r)&#125;,vt._$tS=function(t,e)&#123;for(var i=t-e;i&lt;-Math.PI;)i+=2*Math.PI;for(;i&gt;Math.PI;)i-=2*Math.PI;return i&#125;,vt._$9=function(t)&#123;return Math.sin(t)&#125;,vt.fcos=function(t)&#123;return Math.cos(t)&#125;,Lt.prototype._$u2=function()&#123;return this._$IS[0]&#125;,Lt.prototype._$yo=function()&#123;return this._$AT&amp;&amp;!this._$IS[0]&#125;,Lt.prototype._$GT=function()&#123;return this._$e0&#125;,Mt._$W2=0,Mt.SYSTEM_INFO=null,Mt.USER_AGENT=navigator.userAgent,Mt.isIPhone=function()&#123;return Mt.SYSTEM_INFO||Mt.setup(),Mt.SYSTEM_INFO._isIPhone&#125;,Mt.isIOS=function()&#123;return Mt.SYSTEM_INFO||Mt.setup(),Mt.SYSTEM_INFO._isIPhone||Mt.SYSTEM_INFO._isIPad&#125;,Mt.isAndroid=function()&#123;return Mt.SYSTEM_INFO||Mt.setup(),Mt.SYSTEM_INFO._isAndroid&#125;,Mt.getOSVersion=function()&#123;return Mt.SYSTEM_INFO||Mt.setup(),Mt.SYSTEM_INFO.version&#125;,Mt.getOS=function()&#123;return Mt.SYSTEM_INFO||Mt.setup(),Mt.SYSTEM_INFO._isIPhone||Mt.SYSTEM_INFO._isIPad?&quot;iOS&quot;:Mt.SYSTEM_INFO._isAndroid?&quot;Android&quot;:&quot;_$Q0 OS&quot;&#125;,Mt.setup=function()&#123;var t,e=Mt.USER_AGENT;function i(t,e)&#123;for(var i=t.substring(e).split(/[ _,;\\.]/),r=0,o=0;o&lt;=2&amp;&amp;!isNaN(i[o]);o++)&#123;var n=parseInt(i[o]);if(n&lt;0||n&gt;999)&#123;_._$li(&quot;err : &quot;+n+&quot; @UtHtml5.setup()&quot;),r=0;break&#125;r+=n*Math.pow(1e3,2-o)&#125;return r&#125;var r=Mt.SYSTEM_INFO=&#123;userAgent:e&#125;;if((t=e.indexOf(&quot;iPhone OS &quot;))&gt;=0)r.os=&quot;iPhone&quot;,r._isIPhone=!0,r.version=i(e,t+&quot;iPhone OS &quot;.length);else if((t=e.indexOf(&quot;iPad&quot;))&gt;=0)&#123;if((t=e.indexOf(&quot;CPU OS&quot;))&lt;0)return void _._$li(&quot; err : &quot;+e+&quot; @UtHtml5.setup()&quot;);r.os=&quot;iPad&quot;,r._isIPad=!0,r.version=i(e,t+&quot;CPU OS &quot;.length)&#125;else(t=e.indexOf(&quot;Android&quot;))&gt;=0?(r.os=&quot;Android&quot;,r._isAndroid=!0,r.version=i(e,t+&quot;Android &quot;.length)):(r.os=&quot;-&quot;,r.version=-1)&#125;,_t.init();i=!1;e.UtSystem=x,e.UtDebug=_,e.LDTransform=gt,e.LDGL=ot,e.Live2D=_t,e.Live2DModelWebGL=pt,e.Live2DModelJS=q,e.Live2DMotion=J,e.MotionQueueManager=ct,e.PhysicsHair=u,e.AMotion=s,e.PartsDataID=h,e.DrawDataID=R,e.BaseDataID=yt,e.ParamID=l&#125;).call(e,i(85))&#125;,81:function(t,e,i)&#123;&quot;use strict&quot;;Object.defineProperty(e,&quot;__esModule&quot;,&#123;value:!0&#125;),e.L2DBaseModel=e.L2DExpressionMotion=e.L2DExpressionParam=e.L2DEyeBlink=e.EYE_STATE=e.L2DMatrix44=e.L2DModelMatrix=e.L2DMotionManager=e.L2DPhysics=e.L2DPartsParam=e.L2DPose=e.L2DViewMatrix=e.Live2DFramework=e.L2DTargetPoint=void 0;var r=i(80);function o()&#123;this.live2DModel=null,this.modelMatrix=null,this.eyeBlink=null,this.physics=null,this.pose=null,this.debugMode=!1,this.initialized=!1,this.updating=!1,this.alpha=1,this.accAlpha=0,this.lipSync=!1,this.lipSyncValue=0,this.accelX=0,this.accelY=0,this.accelZ=0,this.dragX=0,this.dragY=0,this.startTimeMSec=null,this.mainMotionManager=new u,this.expressionManager=new u,this.motions=&#123;&#125;,this.expressions=&#123;&#125;,this.isTexLoaded=!1&#125;var n=0;function s()&#123;r.AMotion.prototype.constructor.call(this),this.paramList=new Array&#125;function _()&#123;this.id=&quot;&quot;,this.type=-1,this.value=null&#125;function a()&#123;this.nextBlinkTime=null,this.stateStartTime=null,this.blinkIntervalMsec=null,this.eyeState=h.STATE_FIRST,this.blinkIntervalMsec=4e3,this.closingMotionMsec=100,this.closedMotionMsec=50,this.openingMotionMsec=150,this.closeIfZero=!0,this.eyeID_L=&quot;PARAM_EYE_L_OPEN&quot;,this.eyeID_R=&quot;PARAM_EYE_R_OPEN&quot;&#125;o.prototype.getModelMatrix=function()&#123;return this.modelMatrix&#125;,o.prototype.setAlpha=function(t)&#123;t&gt;.999&amp;&amp;(t=1),t&lt;.001&amp;&amp;(t=0),this.alpha=t&#125;,o.prototype.getAlpha=function()&#123;return this.alpha&#125;,o.prototype.isInitialized=function()&#123;return this.initialized&#125;,o.prototype.setInitialized=function(t)&#123;this.initialized=t&#125;,o.prototype.isUpdating=function()&#123;return this.updating&#125;,o.prototype.setUpdating=function(t)&#123;this.updating=t&#125;,o.prototype.getLive2DModel=function()&#123;return this.live2DModel&#125;,o.prototype.setLipSync=function(t)&#123;this.lipSync=t&#125;,o.prototype.setLipSyncValue=function(t)&#123;this.lipSyncValue=t&#125;,o.prototype.setAccel=function(t,e,i)&#123;this.accelX=t,this.accelY=e,this.accelZ=i&#125;,o.prototype.setDrag=function(t,e)&#123;this.dragX=t,this.dragY=e&#125;,o.prototype.getMainMotionManager=function()&#123;return this.mainMotionManager&#125;,o.prototype.getExpressionManager=function()&#123;return this.expressionManager&#125;,o.prototype.loadModelData=function(t,e)&#123;var i=d.getPlatformManager();this.debugMode&amp;&amp;i.log(&quot;Load model : &quot;+t);var o=this;i.loadLive2DModel(t,function(t)&#123;o.live2DModel=t,o.live2DModel.saveParam(),0==r.Live2D.getError()?(o.modelMatrix=new $(o.live2DModel.getCanvasWidth(),o.live2DModel.getCanvasHeight()),o.modelMatrix.setWidth(2),o.modelMatrix.setCenterPosition(0,0),e(o.live2DModel)):console.error(&quot;Error : Failed to loadModelData().&quot;)&#125;)&#125;,o.prototype.loadTexture=function(t,e,i)&#123;n++;var r=d.getPlatformManager();this.debugMode&amp;&amp;r.log(&quot;Load Texture : &quot;+e);var o=this;r.loadTexture(this.live2DModel,t,e,function()&#123;0==--n&amp;&amp;(o.isTexLoaded=!0),&quot;function&quot;==typeof i&amp;&amp;i()&#125;)&#125;,o.prototype.loadMotion=function(t,e,i)&#123;var o=d.getPlatformManager();this.debugMode&amp;&amp;o.log(&quot;Load Motion : &quot;+e);var n=null,s=this;o.loadBytes(e,function(e)&#123;n=r.Live2DMotion.loadMotion(e),null!=t&amp;&amp;(s.motions[t]=n),i(n)&#125;)&#125;,o.prototype.loadExpression=function(t,e,i)&#123;var r=d.getPlatformManager();this.debugMode&amp;&amp;r.log(&quot;Load Expression : &quot;+e);var o=this;r.loadBytes(e,function(e)&#123;null!=t&amp;&amp;(o.expressions[t]=s.loadJson(e)),&quot;function&quot;==typeof i&amp;&amp;i()&#125;)&#125;,o.prototype.loadPose=function(t,e)&#123;var i=d.getPlatformManager();this.debugMode&amp;&amp;i.log(&quot;Load Pose : &quot;+t);var r=this;try&#123;i.loadBytes(t,function(t)&#123;r.pose=c.load(t),&quot;function&quot;==typeof e&amp;&amp;e()&#125;)&#125;catch(t)&#123;console.warn(t)&#125;&#125;,o.prototype.loadPhysics=function(t)&#123;var e=d.getPlatformManager();this.debugMode&amp;&amp;e.log(&quot;Load Physics : &quot;+t);var i=this;try&#123;e.loadBytes(t,function(t)&#123;i.physics=p.load(t)&#125;)&#125;catch(t)&#123;console.warn(t)&#125;&#125;,o.prototype.hitTestSimple=function(t,e,i)&#123;if(null===this.live2DModel)return!1;var r=this.live2DModel.getDrawDataIndex(t);if(r&lt;0)return!1;for(var o=this.live2DModel.getTransformedPoints(r),n=this.live2DModel.getCanvasWidth(),s=0,_=this.live2DModel.getCanvasHeight(),a=0,h=0;h&lt;o.length;h+=2)&#123;var l=o[h],$=o[h+1];l&lt;n&amp;&amp;(n=l),l&gt;s&amp;&amp;(s=l),$&lt;_&amp;&amp;(_=$),$&gt;a&amp;&amp;(a=$)&#125;var u=this.modelMatrix.invertTransformX(e),p=this.modelMatrix.invertTransformY(i);return n&lt;=u&amp;&amp;u&lt;=s&amp;&amp;_&lt;=p&amp;&amp;p&lt;=a&#125;,s.prototype=new r.AMotion,s.EXPRESSION_DEFAULT=&quot;DEFAULT&quot;,s.TYPE_SET=0,s.TYPE_ADD=1,s.TYPE_MULT=2,s.loadJson=function(t)&#123;var e=new s,i=d.getPlatformManager().jsonParseFromBytes(t);if(e.setFadeIn(parseInt(i.fade_in)&gt;0?parseInt(i.fade_in):1e3),e.setFadeOut(parseInt(i.fade_out)&gt;0?parseInt(i.fade_out):1e3),null==i.params)return e;var r=i.params,o=r.length;e.paramList=[];for(var n=0;n&lt;o;n++)&#123;var a=r[n],h=a.id.toString(),l=parseFloat(a.val),$=s.TYPE_ADD,u=null!=a.calc?a.calc.toString():&quot;add&quot;;if(($=&quot;add&quot;===u?s.TYPE_ADD:&quot;mult&quot;===u?s.TYPE_MULT:&quot;set&quot;===u?s.TYPE_SET:s.TYPE_ADD)==s.TYPE_ADD)l-=p=null==a.def?0:parseFloat(a.def);else if($==s.TYPE_MULT)&#123;var p;0==(p=null==a.def?1:parseFloat(a.def))&amp;&amp;(p=1),l/=p&#125;var c=new _;c.id=h,c.type=$,c.value=l,e.paramList.push(c)&#125;return e&#125;,s.prototype.updateParamExe=function(t,e,i,r)&#123;for(var o=this.paramList.length-1;o&gt;=0;--o)&#123;var n=this.paramList[o];n.type==s.TYPE_ADD?t.addToParamFloat(n.id,n.value,i):n.type==s.TYPE_MULT?t.multParamFloat(n.id,n.value,i):n.type==s.TYPE_SET&amp;&amp;t.setParamFloat(n.id,n.value,i)&#125;&#125;,a.prototype.calcNextBlink=function()&#123;return r.UtSystem.getUserTimeMSec()+Math.random()*(2*this.blinkIntervalMsec-1)&#125;,a.prototype.setInterval=function(t)&#123;this.blinkIntervalMsec=t&#125;,a.prototype.setEyeMotion=function(t,e,i)&#123;this.closingMotionMsec=t,this.closedMotionMsec=e,this.openingMotionMsec=i&#125;,a.prototype.updateParam=function(t)&#123;var e,i=r.UtSystem.getUserTimeMSec(),o=0;switch(this.eyeState)&#123;case h.STATE_CLOSING:(o=(i-this.stateStartTime)/this.closingMotionMsec)&gt;=1&amp;&amp;(o=1,this.eyeState=h.STATE_CLOSED,this.stateStartTime=i),e=1-o;break;case h.STATE_CLOSED:(o=(i-this.stateStartTime)/this.closedMotionMsec)&gt;=1&amp;&amp;(this.eyeState=h.STATE_OPENING,this.stateStartTime=i),e=0;break;case h.STATE_OPENING:(o=(i-this.stateStartTime)/this.openingMotionMsec)&gt;=1&amp;&amp;(o=1,this.eyeState=h.STATE_INTERVAL,this.nextBlinkTime=this.calcNextBlink()),e=o;break;case h.STATE_INTERVAL:this.nextBlinkTime&lt;i&amp;&amp;(this.eyeState=h.STATE_CLOSING,this.stateStartTime=i),e=1;break;case h.STATE_FIRST:default:this.eyeState=h.STATE_INTERVAL,this.nextBlinkTime=this.calcNextBlink(),e=1&#125;this.closeIfZero||(e=-e),t.setParamFloat(this.eyeID_L,e),t.setParamFloat(this.eyeID_R,e)&#125;;var h=function()&#123;&#125;;function l()&#123;this.tr=new Float32Array(16),this.identity()&#125;function $(t,e)&#123;l.prototype.constructor.call(this),this.width=t,this.height=e&#125;function u()&#123;r.MotionQueueManager.prototype.constructor.call(this),this.currentPriority=null,this.reservePriority=null,this.super=r.MotionQueueManager.prototype&#125;function p()&#123;this.physicsList=new Array,this.startTimeMSec=r.UtSystem.getUserTimeMSec()&#125;function c()&#123;this.lastTime=0,this.lastModel=null,this.partsGroups=new Array&#125;function f(t)&#123;this.paramIndex=-1,this.partsIndex=-1,this.link=null,this.id=t&#125;function g()&#123;this.EPSILON=.01,this.faceTargetX=0,this.faceTargetY=0,this.faceX=0,this.faceY=0,this.faceVX=0,this.faceVY=0,this.lastTimeSec=0&#125;function y()&#123;l.prototype.constructor.call(this),this.screenLeft=null,this.screenRight=null,this.screenTop=null,this.screenBottom=null,this.maxLeft=null,this.maxRight=null,this.maxTop=null,this.maxBottom=null&#125;function d()&#123;&#125;h.STATE_FIRST=&quot;STATE_FIRST&quot;,h.STATE_INTERVAL=&quot;STATE_INTERVAL&quot;,h.STATE_CLOSING=&quot;STATE_CLOSING&quot;,h.STATE_CLOSED=&quot;STATE_CLOSED&quot;,h.STATE_OPENING=&quot;STATE_OPENING&quot;,l.mul=function(t,e,i)&#123;var r,o,n,s=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];for(r=0;r&lt;4;r++)for(o=0;o&lt;4;o++)for(n=0;n&lt;4;n++)s[r+4*o]+=t[r+4*n]*e[n+4*o];for(r=0;r&lt;16;r++)i[r]=s[r]&#125;,l.prototype.identity=function()&#123;for(var t=0;t&lt;16;t++)this.tr[t]=t%5==0?1:0&#125;,l.prototype.getArray=function()&#123;return this.tr&#125;,l.prototype.getCopyMatrix=function()&#123;return new Float32Array(this.tr)&#125;,l.prototype.setMatrix=function(t)&#123;if(null!=this.tr&amp;&amp;this.tr.length==this.tr.length)for(var e=0;e&lt;16;e++)this.tr[e]=t[e]&#125;,l.prototype.getScaleX=function()&#123;return this.tr[0]&#125;,l.prototype.getScaleY=function()&#123;return this.tr[5]&#125;,l.prototype.transformX=function(t)&#123;return this.tr[0]*t+this.tr[12]&#125;,l.prototype.transformY=function(t)&#123;return this.tr[5]*t+this.tr[13]&#125;,l.prototype.invertTransformX=function(t)&#123;return(t-this.tr[12])/this.tr[0]&#125;,l.prototype.invertTransformY=function(t)&#123;return(t-this.tr[13])/this.tr[5]&#125;,l.prototype.multTranslate=function(t,e)&#123;var i=[1,0,0,0,0,1,0,0,0,0,1,0,t,e,0,1];l.mul(i,this.tr,this.tr)&#125;,l.prototype.translate=function(t,e)&#123;this.tr[12]=t,this.tr[13]=e&#125;,l.prototype.translateX=function(t)&#123;this.tr[12]=t&#125;,l.prototype.translateY=function(t)&#123;this.tr[13]=t&#125;,l.prototype.multScale=function(t,e)&#123;var i=[t,0,0,0,0,e,0,0,0,0,1,0,0,0,0,1];l.mul(i,this.tr,this.tr)&#125;,l.prototype.scale=function(t,e)&#123;this.tr[0]=t,this.tr[5]=e&#125;,$.prototype=new l,$.prototype.setPosition=function(t,e)&#123;this.translate(t,e)&#125;,$.prototype.setCenterPosition=function(t,e)&#123;var i=this.width*this.getScaleX(),r=this.height*this.getScaleY();this.translate(t-i/2,e-r/2)&#125;,$.prototype.top=function(t)&#123;this.setY(t)&#125;,$.prototype.bottom=function(t)&#123;var e=this.height*this.getScaleY();this.translateY(t-e)&#125;,$.prototype.left=function(t)&#123;this.setX(t)&#125;,$.prototype.right=function(t)&#123;var e=this.width*this.getScaleX();this.translateX(t-e)&#125;,$.prototype.centerX=function(t)&#123;var e=this.width*this.getScaleX();this.translateX(t-e/2)&#125;,$.prototype.centerY=function(t)&#123;var e=this.height*this.getScaleY();this.translateY(t-e/2)&#125;,$.prototype.setX=function(t)&#123;this.translateX(t)&#125;,$.prototype.setY=function(t)&#123;this.translateY(t)&#125;,$.prototype.setHeight=function(t)&#123;var e=t/this.height,i=-e;this.scale(e,i)&#125;,$.prototype.setWidth=function(t)&#123;var e=t/this.width,i=-e;this.scale(e,i)&#125;,u.prototype=new r.MotionQueueManager,u.prototype.getCurrentPriority=function()&#123;return this.currentPriority&#125;,u.prototype.getReservePriority=function()&#123;return this.reservePriority&#125;,u.prototype.reserveMotion=function(t)&#123;return!(this.reservePriority&gt;=t)&amp;&amp;(!(this.currentPriority&gt;=t)&amp;&amp;(this.reservePriority=t,!0))&#125;,u.prototype.setReservePriority=function(t)&#123;this.reservePriority=t&#125;,u.prototype.updateParam=function(t)&#123;var e=r.MotionQueueManager.prototype.updateParam.call(this,t);return this.isFinished()&amp;&amp;(this.currentPriority=0),e&#125;,u.prototype.startMotionPrio=function(t,e)&#123;return e==this.reservePriority&amp;&amp;(this.reservePriority=0),this.currentPriority=e,this.startMotion(t,!1)&#125;,p.load=function(t)&#123;for(var e=new p,i=d.getPlatformManager().jsonParseFromBytes(t).physics_hair,o=i.length,n=0;n&lt;o;n++)&#123;var s=i[n],_=new r.PhysicsHair,a=s.setup,h=parseFloat(a.length),l=parseFloat(a.regist),$=parseFloat(a.mass);_.setup(h,l,$);for(var u=s.src,c=u.length,f=0;f&lt;c;f++)&#123;var g=u[f],y=g.id,m=r.PhysicsHair.Src.SRC_TO_X;&quot;x&quot;===(L=g.ptype)?m=r.PhysicsHair.Src.SRC_TO_X:&quot;y&quot;===L?m=r.PhysicsHair.Src.SRC_TO_Y:&quot;angle&quot;===L?m=r.PhysicsHair.Src.SRC_TO_G_ANGLE:r.UtDebug.error(&quot;live2d&quot;,&quot;Invalid parameter:PhysicsHair.Src&quot;);var T=parseFloat(g.scale),P=parseFloat(g.weight);_.addSrcParam(m,y,T,P)&#125;var S=s.targets,v=S.length;for(f=0;f&lt;v;f++)&#123;var L,M=S[f];y=M.id,m=r.PhysicsHair.Target.TARGET_FROM_ANGLE;&quot;angle&quot;===(L=M.ptype)?m=r.PhysicsHair.Target.TARGET_FROM_ANGLE:&quot;angle_v&quot;===L?m=r.PhysicsHair.Target.TARGET_FROM_ANGLE_V:r.UtDebug.error(&quot;live2d&quot;,&quot;Invalid parameter:PhysicsHair.Target&quot;);T=parseFloat(M.scale),P=parseFloat(M.weight);_.addTargetParam(m,y,T,P)&#125;e.physicsList.push(_)&#125;return e&#125;,p.prototype.updateParam=function(t)&#123;for(var e=r.UtSystem.getUserTimeMSec()-this.startTimeMSec,i=0;i&lt;this.physicsList.length;i++)this.physicsList[i].update(t,e)&#125;,c.load=function(t)&#123;for(var e=new c,i=d.getPlatformManager().jsonParseFromBytes(t).parts_visible,r=i.length,o=0;o&lt;r;o++)&#123;for(var n=i[o].group,s=n.length,_=new Array,a=0;a&lt;s;a++)&#123;var h=n[a],l=new f(h.id);if(_[a]=l,null!=h.link)&#123;var $=h.link,u=$.length;l.link=new Array;for(var p=0;p&lt;u;p++)&#123;var g=new f($[p]);l.link.push(g)&#125;&#125;&#125;e.partsGroups.push(_)&#125;return e&#125;,c.prototype.updateParam=function(t)&#123;if(null!=t)&#123;t!=this.lastModel&amp;&amp;this.initParam(t),this.lastModel=t;var e=r.UtSystem.getUserTimeMSec(),i=0==this.lastTime?0:(e-this.lastTime)/1e3;this.lastTime=e,i&lt;0&amp;&amp;(i=0);for(var o=0;o&lt;this.partsGroups.length;o++)this.normalizePartsOpacityGroup(t,this.partsGroups[o],i),this.copyOpacityOtherParts(t,this.partsGroups[o])&#125;&#125;,c.prototype.initParam=function(t)&#123;if(null!=t)for(var e=0;e&lt;this.partsGroups.length;e++)for(var i=this.partsGroups[e],r=0;r&lt;i.length;r++)&#123;i[r].initIndex(t);var o=i[r].partsIndex,n=i[r].paramIndex;if(!(o&lt;0))&#123;var s=0!=t.getParamFloat(n);if(t.setPartsOpacity(o,s?1:0),t.setParamFloat(n,s?1:0),null!=i[r].link)for(var _=0;_&lt;i[r].link.length;_++)i[r].link[_].initIndex(t)&#125;&#125;&#125;,c.prototype.normalizePartsOpacityGroup=function(t,e,i)&#123;for(var r=-1,o=1,n=0;n&lt;e.length;n++)&#123;var s=e[n].partsIndex,_=e[n].paramIndex;if(!(s&lt;0)&amp;&amp;0!=t.getParamFloat(_))&#123;if(r&gt;=0)break;r=n,o=t.getPartsOpacity(s),(o+=i/.5)&gt;1&amp;&amp;(o=1)&#125;&#125;r&lt;0&amp;&amp;(r=0,o=1);for(n=0;n&lt;e.length;n++)&#123;if(!((s=e[n].partsIndex)&lt;0))if(r==n)t.setPartsOpacity(s,o);else&#123;var a,h=t.getPartsOpacity(s);(1-(a=o&lt;.5?-.5*o/.5+1:.5*(1-o)/.5))*(1-o)&gt;.15&amp;&amp;(a=1-.15/(1-o)),h&gt;a&amp;&amp;(h=a),t.setPartsOpacity(s,h)&#125;&#125;&#125;,c.prototype.copyOpacityOtherParts=function(t,e)&#123;for(var i=0;i&lt;e.length;i++)&#123;var r=e[i];if(null!=r.link&amp;&amp;!(r.partsIndex&lt;0))for(var o=t.getPartsOpacity(r.partsIndex),n=0;n&lt;r.link.length;n++)&#123;var s=r.link[n];s.partsIndex&lt;0||t.setPartsOpacity(s.partsIndex,o)&#125;&#125;&#125;,f.prototype.initIndex=function(t)&#123;this.paramIndex=t.getParamIndex(&quot;VISIBLE:&quot;+this.id),this.partsIndex=t.getPartsDataIndex(r.PartsDataID.getID(this.id)),t.setParamFloat(this.paramIndex,1)&#125;,g.FRAME_RATE=60,g.prototype.setPoint=function(t,e)&#123;this.faceTargetX=t,this.faceTargetY=e&#125;,g.prototype.getX=function()&#123;return this.faceX&#125;,g.prototype.getY=function()&#123;return this.faceY&#125;,g.prototype.update=function()&#123;var t=40/7.5/g.FRAME_RATE;if(0!=this.lastTimeSec)&#123;var e=r.UtSystem.getUserTimeMSec(),i=(e-this.lastTimeSec)*g.FRAME_RATE/1e3;this.lastTimeSec=e;var o=i*t/(.15*g.FRAME_RATE),n=this.faceTargetX-this.faceX,s=this.faceTargetY-this.faceY;if(!(Math.abs(n)&lt;=this.EPSILON&amp;&amp;Math.abs(s)&lt;=this.EPSILON))&#123;var _=Math.sqrt(n*n+s*s),a=t*s/_,h=t*n/_-this.faceVX,l=a-this.faceVY,$=Math.sqrt(h*h+l*l);($&lt;-o||$&gt;o)&amp;&amp;(h*=o/$,l*=o/$,$=o),this.faceVX+=h,this.faceVY+=l;var u=.5*(Math.sqrt(o*o+16*o*_-8*o*_)-o),p=Math.sqrt(this.faceVX*this.faceVX+this.faceVY*this.faceVY);p&gt;u&amp;&amp;(this.faceVX*=u/p,this.faceVY*=u/p),this.faceX+=this.faceVX,this.faceY+=this.faceVY&#125;&#125;else this.lastTimeSec=r.UtSystem.getUserTimeMSec()&#125;,y.prototype=new l,y.prototype.adjustTranslate=function(t,e)&#123;this.tr[0]*this.maxLeft+(this.tr[12]+t)&gt;this.screenLeft&amp;&amp;(t=this.screenLeft-this.tr[0]*this.maxLeft-this.tr[12]),this.tr[0]*this.maxRight+(this.tr[12]+t)&lt;this.screenRight&amp;&amp;(t=this.screenRight-this.tr[0]*this.maxRight-this.tr[12]),this.tr[5]*this.maxTop+(this.tr[13]+e)&lt;this.screenTop&amp;&amp;(e=this.screenTop-this.tr[5]*this.maxTop-this.tr[13]),this.tr[5]*this.maxBottom+(this.tr[13]+e)&gt;this.screenBottom&amp;&amp;(e=this.screenBottom-this.tr[5]*this.maxBottom-this.tr[13]);var i=[1,0,0,0,0,1,0,0,0,0,1,0,t,e,0,1];l.mul(i,this.tr,this.tr)&#125;,y.prototype.adjustScale=function(t,e,i)&#123;this.tr[0];var r=[1,0,0,0,0,1,0,0,0,0,1,0,t,e,0,1],o=[i,0,0,0,0,i,0,0,0,0,1,0,0,0,0,1],n=[1,0,0,0,0,1,0,0,0,0,1,0,-t,-e,0,1];l.mul(n,this.tr,this.tr),l.mul(o,this.tr,this.tr),l.mul(r,this.tr,this.tr)&#125;,y.prototype.setScreenRect=function(t,e,i,r)&#123;this.screenLeft=t,this.screenRight=e,this.screenTop=r,this.screenBottom=i&#125;,y.prototype.setMaxScreenRect=function(t,e,i,r)&#123;this.maxLeft=t,this.maxRight=e,this.maxTop=r,this.maxBottom=i&#125;,y.prototype.getScreenLeft=function()&#123;return this.screenLeft&#125;,y.prototype.getScreenRight=function()&#123;return this.screenRight&#125;,y.prototype.getScreenBottom=function()&#123;return this.screenBottom&#125;,y.prototype.getScreenTop=function()&#123;return this.screenTop&#125;,y.prototype.getMaxLeft=function()&#123;return this.maxLeft&#125;,y.prototype.getMaxRight=function()&#123;return this.maxRight&#125;,y.prototype.getMaxBottom=function()&#123;return this.maxBottom&#125;,y.prototype.getMaxTop=function()&#123;return this.maxTop&#125;,d.platformManager=null,d.getPlatformManager=function()&#123;return d.platformManager&#125;,d.setPlatformManager=function(t)&#123;d.platformManager=t&#125;,e.L2DTargetPoint=g,e.Live2DFramework=d,e.L2DViewMatrix=y,e.L2DPose=c,e.L2DPartsParam=f,e.L2DPhysics=p,e.L2DMotionManager=u,e.L2DModelMatrix=$,e.L2DMatrix44=l,e.EYE_STATE=h,e.L2DEyeBlink=a,e.L2DExpressionParam=_,e.L2DExpressionMotion=s,e.L2DBaseModel=o&#125;,82:function(t,e,i)&#123;&quot;use strict&quot;;Object.defineProperty(e,&quot;__esModule&quot;,&#123;value:!0&#125;);e.cDefine=&#123;VIEW_LOGICAL_LEFT:-1,VIEW_LOGICAL_RIGHT:1,VIEW_LOGICAL_MAX_LEFT:-2,VIEW_LOGICAL_MAX_RIGHT:2,VIEW_LOGICAL_MAX_BOTTOM:-2,VIEW_LOGICAL_MAX_TOP:2,PRIORITY_NONE:0,PRIORITY_IDLE:1,PRIORITY_NORMAL:2,PRIORITY_FORCE:3,MOTION_GROUP_IDLE:&quot;idle&quot;,MOTION_GROUP_TAP_BODY:&quot;tap_body&quot;,MOTION_GROUP_FLICK_HEAD:&quot;flick_head&quot;,MOTION_GROUP_PINCH_IN:&quot;pinch_in&quot;,MOTION_GROUP_PINCH_OUT:&quot;pinch_out&quot;,MOTION_GROUP_SHAKE:&quot;shake&quot;,HIT_AREA_HEAD:&quot;head&quot;,HIT_AREA_BODY:&quot;body&quot;&#125;&#125;,83:function(t,e,i)&#123;&quot;use strict&quot;;Object.defineProperty(e,&quot;__esModule&quot;,&#123;value:!0&#125;),e.currCanvas=e.currWebGL=e.createElement=void 0;var r=i(26),o=i(27),n=i(40),s=void 0,_=void 0;e.createElement=function()&#123;var t=document.getElementById(r.config.name.div);null!==t&amp;&amp;document.body.removeChild(t);var i=document.createElement(&quot;div&quot;);i.id=r.config.name.div,i.className=&quot;live2d-widget-container&quot;,i.style.setProperty(&quot;position&quot;,&quot;fixed&quot;),i.style.setProperty(r.config.display.position,r.config.display.hOffset+&quot;px&quot;),i.style.setProperty(&quot;bottom&quot;,r.config.display.vOffset+&quot;px&quot;),i.style.setProperty(&quot;width&quot;,r.config.display.width+&quot;px&quot;),i.style.setProperty(&quot;height&quot;,r.config.display.height+&quot;px&quot;),i.style.setProperty(&quot;z-index&quot;,99999),i.style.setProperty(&quot;opacity&quot;,r.config.react.opacity),i.style.setProperty(&quot;pointer-events&quot;,&quot;none&quot;),document.body.appendChild(i),o.L2Dwidget.emit(&quot;create-container&quot;,i),r.config.dialog.enable&amp;&amp;(0,n.createDialogElement)(i);var a=document.createElement(&quot;canvas&quot;);a.setAttribute(&quot;id&quot;,r.config.name.canvas),a.setAttribute(&quot;width&quot;,r.config.display.width*r.config.display.superSample),a.setAttribute(&quot;height&quot;,r.config.display.height*r.config.display.superSample),a.style.setProperty(&quot;position&quot;,&quot;absolute&quot;),a.style.setProperty(&quot;left&quot;,&quot;0px&quot;),a.style.setProperty(&quot;top&quot;,&quot;0px&quot;),a.style.setProperty(&quot;width&quot;,r.config.display.width+&quot;px&quot;),a.style.setProperty(&quot;height&quot;,r.config.display.height+&quot;px&quot;),r.config.dev.border&amp;&amp;a.style.setProperty(&quot;border&quot;,&quot;dashed 1px #CCC&quot;),i.appendChild(a),e.currCanvas=_=document.getElementById(r.config.name.canvas),o.L2Dwidget.emit(&quot;create-canvas&quot;,a),function()&#123;for(var t=[&quot;webgl2&quot;,&quot;webgl&quot;,&quot;experimental-webgl2&quot;,&quot;experimental-webgl&quot;,&quot;webkit-3d&quot;,&quot;moz-webgl&quot;],i=0;i&lt;t.length;i++)try&#123;var r=_.getContext(t[i],&#123;alpha:!0,antialias:!0,premultipliedAlpha:!0,failIfMajorPerformanceCaveat:!1&#125;);r&amp;&amp;(e.currWebGL=s=r)&#125;catch(t)&#123;&#125;s||(console.error(&quot;Live2D widgets: Failed to create WebGL context.&quot;),window.WebGLRenderingContext||console.error(&quot;Your browser may not support WebGL, check https://get.webgl.org/ for futher information.&quot;))&#125;()&#125;,e.currWebGL=s,e.currCanvas=_&#125;,84:function(t,e,i)&#123;&quot;use strict&quot;;function r()&#123;&#125;Object.defineProperty(e,&quot;__esModule&quot;,&#123;value:!0&#125;),e.MatrixStack=r,r.matrixStack=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],r.depth=0,r.currentMatrix=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],r.tmp=new Array(16),r.reset=function()&#123;this.depth=0&#125;,r.loadIdentity=function()&#123;for(var t=0;t&lt;16;t++)this.currentMatrix[t]=t%5==0?1:0&#125;,r.push=function()&#123;var t=16*(this.depth+1);this.matrixStack.length&lt;t+16&amp;&amp;(this.matrixStack.length=t+16);for(var e=0;e&lt;16;e++)this.matrixStack[t+e]=this.currentMatrix[e];this.depth++&#125;,r.pop=function()&#123;this.depth--,this.depth&lt;0&amp;&amp;(myError(&quot;Invalid matrix stack.&quot;),this.depth=0);for(var t=16*this.depth,e=0;e&lt;16;e++)this.currentMatrix[e]=this.matrixStack[t+e]&#125;,r.getMatrix=function()&#123;return this.currentMatrix&#125;,r.multMatrix=function(t)&#123;var e,i,r;for(e=0;e&lt;16;e++)this.tmp[e]=0;for(e=0;e&lt;4;e++)for(i=0;i&lt;4;i++)for(r=0;r&lt;4;r++)this.tmp[e+4*i]+=this.currentMatrix[e+4*r]*t[r+4*i];for(e=0;e&lt;16;e++)this.currentMatrix[e]=this.tmp[e]&#125;&#125;,85:function(t,e)&#123;t.exports=&#123;import:function()&#123;throw new Error(&quot;System.import cannot be used indirectly&quot;)&#125;&#125;&#125;,86:function(t,e,i)&#123;&quot;use strict&quot;;Object.defineProperty(e,&quot;__esModule&quot;,&#123;value:!0&#125;),e.cManager=void 0;var r=i(81),o=i(87),n=i(88),s=i(82);function _(t)&#123;this.eventemitter=t,this.models=[],this.count=-1,this.reloadFlg=!1,r.Live2DFramework.setPlatformManager(new o.PlatformManager)&#125;_.prototype.createModel=function()&#123;var t=new n.cModel;return this.models.push(t),t&#125;,_.prototype.changeModel=function(t,e)&#123;this.reloadFlg&amp;&amp;(this.reloadFlg=!1,this.releaseModel(0,t),this.createModel(),this.models[0].load(t,e))&#125;,_.prototype.getModel=function(t)&#123;return t&gt;=this.models.length?null:this.models[t]&#125;,_.prototype.releaseModel=function(t,e)&#123;this.models.length&lt;=t||(this.models[t].release(e),delete this.models[t],this.models.splice(t,1))&#125;,_.prototype.numModels=function()&#123;return this.models.length&#125;,_.prototype.setDrag=function(t,e)&#123;for(var i=0;i&lt;this.models.length;i++)this.models[i].setDrag(t,e)&#125;,_.prototype.tapEvent=function(t,e)&#123;s.cDefine.DEBUG_LOG&amp;&amp;console.log(&quot;tapEvent view x:&quot;+t+&quot; y:&quot;+e);for(var i=0;i&lt;this.models.length;i++)this.models[i].hitTest(s.cDefine.HIT_AREA_HEAD,t,e)?(this.eventemitter.emit(&quot;tapface&quot;),s.cDefine.DEBUG_LOG&amp;&amp;console.log(&quot;Tap face.&quot;),this.models[i].setRandomExpression()):this.models[i].hitTest(s.cDefine.HIT_AREA_BODY,t,e)&amp;&amp;(this.eventemitter.emit(&quot;tapbody&quot;),s.cDefine.DEBUG_LOG&amp;&amp;console.log(&quot;Tap body. models[&quot;+i+&quot;]&quot;),this.models[i].startRandomMotion(s.cDefine.MOTION_GROUP_TAP_BODY,s.cDefine.PRIORITY_NORMAL));return!0&#125;,e.cManager=_&#125;,87:function(t,e,i)&#123;&quot;use strict&quot;;Object.defineProperty(e,&quot;__esModule&quot;,&#123;value:!0&#125;),e.PlatformManager=n;var r=i(83),o=i(80);function n()&#123;&#125;n.prototype.loadBytes=function(t,e)&#123;var i=new XMLHttpRequest;i.open(&quot;GET&quot;,t,!0),i.responseType=&quot;arraybuffer&quot;,i.onload=function()&#123;switch(i.status)&#123;case 200:e(i.response);break;default:console.error(&quot;Failed to load (&quot;+i.status+&quot;) : &quot;+t)&#125;&#125;,i.send(null)&#125;,n.prototype.loadString=function(t)&#123;this.loadBytes(t,function(t)&#123;return t&#125;)&#125;,n.prototype.loadLive2DModel=function(t,e)&#123;var i=null;this.loadBytes(t,function(t)&#123;i=o.Live2DModelWebGL.loadModel(t),e(i)&#125;)&#125;,n.prototype.loadTexture=function(t,e,i,o)&#123;var n=new Image;n.crossOrigin=&quot;Anonymous&quot;,n.src=i,n.onload=onload,n.onerror=onerror,n.onload=function()&#123;var i=r.currWebGL,s=i.createTexture();if(!s)return console.error(&quot;Failed to generate gl texture name.&quot;),-1;t.isPremultipliedAlpha()||i.pixelStorei(i.UNPACK_PREMULTIPLY_ALPHA_WEBGL,1),i.pixelStorei(i.UNPACK_FLIP_Y_WEBGL,1),i.activeTexture(i.TEXTURE0),i.bindTexture(i.TEXTURE_2D,s),i.texImage2D(i.TEXTURE_2D,0,i.RGBA,i.RGBA,i.UNSIGNED_BYTE,n),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MAG_FILTER,i.LINEAR),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MIN_FILTER,i.LINEAR_MIPMAP_NEAREST),i.generateMipmap(i.TEXTURE_2D),t.setTexture(e,s),s=null,&quot;function&quot;==typeof o&amp;&amp;o()&#125;,n.onerror=function()&#123;console.error(&quot;Failed to load image : &quot;+i)&#125;&#125;,n.prototype.jsonParseFromBytes=function(t)&#123;var e,i=new Uint8Array(t,0,3);return e=239==i[0]&amp;&amp;187==i[1]&amp;&amp;191==i[2]?String.fromCharCode.apply(null,new Uint8Array(t,3)):String.fromCharCode.apply(null,new Uint8Array(t)),JSON.parse(e)&#125;,n.prototype.log=function(t)&#123;console.log(t)&#125;&#125;,88:function(t,e,i)&#123;&quot;use strict&quot;;Object.defineProperty(e,&quot;__esModule&quot;,&#123;value:!0&#125;),e.cModel=a;var r=i(81),o=i(89),n=i(84),s=i(82),_=i(80);function a()&#123;r.L2DBaseModel.prototype.constructor.call(this),this.modelHomeDir=&quot;&quot;,this.modelSetting=null,this.tmpMatrix=[]&#125;a.prototype=new r.L2DBaseModel,a.prototype.load=function(t,e,i)&#123;this.setUpdating(!0),this.setInitialized(!1),this.modelHomeDir=e.substring(0,e.lastIndexOf(&quot;/&quot;)+1),this.modelSetting=new o.ModelSettingJson;var n=this;this.modelSetting.loadModelSetting(e,function()&#123;var t=n.modelHomeDir+n.modelSetting.getModelFile();n.loadModelData(t,function(t)&#123;for(var e=0;e&lt;n.modelSetting.getTextureNum();e++)&#123;if(/^https?:\\/\\/|^\\/\\//i.test(n.modelSetting.getTextureFile(e)))var o=n.modelSetting.getTextureFile(e);else o=n.modelHomeDir+n.modelSetting.getTextureFile(e);n.loadTexture(e,o,function()&#123;if(n.isTexLoaded)&#123;if(n.modelSetting.getExpressionNum()&gt;0)&#123;n.expressions=&#123;&#125;;for(var t=0;t&lt;n.modelSetting.getExpressionNum();t++)&#123;var e=n.modelSetting.getExpressionName(t),o=n.modelHomeDir+n.modelSetting.getExpressionFile(t);n.loadExpression(e,o)&#125;&#125;else n.expressionManager=null,n.expressions=&#123;&#125;;if(null==n.eyeBlink&amp;&amp;(n.eyeBlink=new r.L2DEyeBlink),null!=n.modelSetting.getPhysicsFile()?n.loadPhysics(n.modelHomeDir+n.modelSetting.getPhysicsFile()):n.physics=null,null!=n.modelSetting.getPoseFile()?n.loadPose(n.modelHomeDir+n.modelSetting.getPoseFile(),function()&#123;n.pose.updateParam(n.live2DModel)&#125;):n.pose=null,null!=n.modelSetting.getLayout())&#123;var _=n.modelSetting.getLayout();null!=_.width&amp;&amp;n.modelMatrix.setWidth(_.width),null!=_.height&amp;&amp;n.modelMatrix.setHeight(_.height),null!=_.x&amp;&amp;n.modelMatrix.setX(_.x),null!=_.y&amp;&amp;n.modelMatrix.setY(_.y),null!=_.center_x&amp;&amp;n.modelMatrix.centerX(_.center_x),null!=_.center_y&amp;&amp;n.modelMatrix.centerY(_.center_y),null!=_.top&amp;&amp;n.modelMatrix.top(_.top),null!=_.bottom&amp;&amp;n.modelMatrix.bottom(_.bottom),null!=_.left&amp;&amp;n.modelMatrix.left(_.left),null!=_.right&amp;&amp;n.modelMatrix.right(_.right)&#125;for(t=0;t&lt;n.modelSetting.getInitParamNum();t++)n.live2DModel.setParamFloat(n.modelSetting.getInitParamID(t),n.modelSetting.getInitParamValue(t));for(t=0;t&lt;n.modelSetting.getInitPartsVisibleNum();t++)n.live2DModel.setPartsOpacity(n.modelSetting.getInitPartsVisibleID(t),n.modelSetting.getInitPartsVisibleValue(t));n.live2DModel.saveParam(),n.preloadMotionGroup(s.cDefine.MOTION_GROUP_IDLE),n.mainMotionManager.stopAllMotions(),n.setUpdating(!1),n.setInitialized(!0),&quot;function&quot;==typeof i&amp;&amp;i()&#125;&#125;)&#125;&#125;)&#125;)&#125;,a.prototype.release=function(t)&#123;var e=r.Live2DFramework.getPlatformManager();t.deleteTexture(e.texture)&#125;,a.prototype.preloadMotionGroup=function(t)&#123;for(var e=this,i=0;i&lt;this.modelSetting.getMotionNum(t);i++)&#123;var r=this.modelSetting.getMotionFile(t,i);this.loadMotion(r,this.modelHomeDir+r,function(r)&#123;r.setFadeIn(e.modelSetting.getMotionFadeIn(t,i)),r.setFadeOut(e.modelSetting.getMotionFadeOut(t,i))&#125;)&#125;&#125;,a.prototype.update=function()&#123;if(null!=this.live2DModel)&#123;var t=2*((_.UtSystem.getUserTimeMSec()-this.startTimeMSec)/1e3)*Math.PI;this.mainMotionManager.isFinished()&amp;&amp;this.startRandomMotion(s.cDefine.MOTION_GROUP_IDLE,s.cDefine.PRIORITY_IDLE),this.live2DModel.loadParam(),this.mainMotionManager.updateParam(this.live2DModel)||null!=this.eyeBlink&amp;&amp;this.eyeBlink.updateParam(this.live2DModel),this.live2DModel.saveParam(),null==this.expressionManager||null==this.expressions||this.expressionManager.isFinished()||this.expressionManager.updateParam(this.live2DModel),this.live2DModel.addToParamFloat(&quot;PARAM_ANGLE_X&quot;,30*this.dragX,1),this.live2DModel.addToParamFloat(&quot;PARAM_ANGLE_Y&quot;,30*this.dragY,1),this.live2DModel.addToParamFloat(&quot;PARAM_ANGLE_Z&quot;,this.dragX*this.dragY*-30,1),this.live2DModel.addToParamFloat(&quot;PARAM_BODY_ANGLE_X&quot;,10*this.dragX,1),this.live2DModel.addToParamFloat(&quot;PARAM_EYE_BALL_X&quot;,this.dragX,1),this.live2DModel.addToParamFloat(&quot;PARAM_EYE_BALL_Y&quot;,this.dragY,1),this.live2DModel.addToParamFloat(&quot;PARAM_ANGLE_X&quot;,Number(15*Math.sin(t/6.5345)),.5),this.live2DModel.addToParamFloat(&quot;PARAM_ANGLE_Y&quot;,Number(8*Math.sin(t/3.5345)),.5),this.live2DModel.addToParamFloat(&quot;PARAM_ANGLE_Z&quot;,Number(10*Math.sin(t/5.5345)),.5),this.live2DModel.addToParamFloat(&quot;PARAM_BODY_ANGLE_X&quot;,Number(4*Math.sin(t/15.5345)),.5),this.live2DModel.setParamFloat(&quot;PARAM_BREATH&quot;,Number(.5+.5*Math.sin(t/3.2345)),1),null!=this.physics&amp;&amp;this.physics.updateParam(this.live2DModel),null==this.lipSync&amp;&amp;this.live2DModel.setParamFloat(&quot;PARAM_MOUTH_OPEN_Y&quot;,this.lipSyncValue),null!=this.pose&amp;&amp;this.pose.updateParam(this.live2DModel),this.live2DModel.update()&#125;else s.cDefine.DEBUG_LOG&amp;&amp;console.error(&quot;Failed to update.&quot;)&#125;,a.prototype.setRandomExpression=function()&#123;var t=[];for(var e in this.expressions)t.push(e);var i=parseInt(Math.random()*t.length);this.setExpression(t[i])&#125;,a.prototype.startRandomMotion=function(t,e)&#123;var i=this.modelSetting.getMotionNum(t),r=parseInt(Math.random()*i);this.startMotion(t,r,e)&#125;,a.prototype.startMotion=function(t,e,i)&#123;var r=this.modelSetting.getMotionFile(t,e);if(null!=r&amp;&amp;&quot;&quot;!=r)&#123;if(i==s.cDefine.PRIORITY_FORCE)this.mainMotionManager.setReservePriority(i);else if(!this.mainMotionManager.reserveMotion(i))return void(s.cDefine.DEBUG_LOG&amp;&amp;console.log(&quot;Motion is running.&quot;));var o,n=this;null==this.motions[t]?this.loadMotion(t,this.modelHomeDir+r,function(r)&#123;o=r,n.setFadeInFadeOut(t,e,i,o)&#125;):(o=this.motions[t],n.setFadeInFadeOut(t,e,i,o))&#125;else s.cDefine.DEBUG_LOG&amp;&amp;console.error(&quot;Failed to motion.&quot;)&#125;,a.prototype.setFadeInFadeOut=function(t,e,i,r)&#123;var o=this.modelSetting.getMotionFile(t,e);if(r.setFadeIn(this.modelSetting.getMotionFadeIn(t,e)),r.setFadeOut(this.modelSetting.getMotionFadeOut(t,e)),s.cDefine.DEBUG_LOG&amp;&amp;console.log(&quot;Start motion : &quot;+o),null==this.modelSetting.getMotionSound(t,e))this.mainMotionManager.startMotionPrio(r,i);else&#123;var n=this.modelSetting.getMotionSound(t,e),_=document.createElement(&quot;audio&quot;);_.src=this.modelHomeDir+n,s.cDefine.DEBUG_LOG&amp;&amp;console.log(&quot;Start sound : &quot;+n),_.play(),this.mainMotionManager.startMotionPrio(r,i)&#125;&#125;,a.prototype.setExpression=function(t)&#123;var e=this.expressions[t];s.cDefine.DEBUG_LOG&amp;&amp;console.log(&quot;Expression : &quot;+t),this.expressionManager.startMotion(e,!1)&#125;,a.prototype.draw=function(t)&#123;n.MatrixStack.push(),n.MatrixStack.multMatrix(this.modelMatrix.getArray()),this.tmpMatrix=n.MatrixStack.getMatrix(),this.live2DModel.setMatrix(this.tmpMatrix),this.live2DModel.draw(),n.MatrixStack.pop()&#125;,a.prototype.hitTest=function(t,e,i)&#123;for(var r=this.modelSetting.getHitAreaNum(),o=0;o&lt;r;o++)if(t==this.modelSetting.getHitAreaName(o))&#123;var n=this.modelSetting.getHitAreaID(o);return this.hitTestSimple(n,e,i)&#125;return!1&#125;&#125;,89:function(t,e,i)&#123;&quot;use strict&quot;;Object.defineProperty(e,&quot;__esModule&quot;,&#123;value:!0&#125;),e.ModelSettingJson=o;var r=i(81);function o()&#123;this.NAME=&quot;name&quot;,this.ID=&quot;id&quot;,this.MODEL=&quot;model&quot;,this.TEXTURES=&quot;textures&quot;,this.HIT_AREAS=&quot;hit_areas&quot;,this.PHYSICS=&quot;physics&quot;,this.POSE=&quot;pose&quot;,this.EXPRESSIONS=&quot;expressions&quot;,this.MOTION_GROUPS=&quot;motions&quot;,this.SOUND=&quot;sound&quot;,this.FADE_IN=&quot;fade_in&quot;,this.FADE_OUT=&quot;fade_out&quot;,this.LAYOUT=&quot;layout&quot;,this.INIT_PARAM=&quot;init_param&quot;,this.INIT_PARTS_VISIBLE=&quot;init_parts_visible&quot;,this.VALUE=&quot;val&quot;,this.FILE=&quot;file&quot;,this.json=&#123;&#125;&#125;o.prototype.loadModelSetting=function(t,e)&#123;var i=this;r.Live2DFramework.getPlatformManager().loadBytes(t,function(t)&#123;var r=String.fromCharCode.apply(null,new Uint8Array(t));i.json=JSON.parse(r),e()&#125;)&#125;,o.prototype.getTextureFile=function(t)&#123;return null==this.json[this.TEXTURES]||null==this.json[this.TEXTURES][t]?null:this.json[this.TEXTURES][t]&#125;,o.prototype.getModelFile=function()&#123;return this.json[this.MODEL]&#125;,o.prototype.getTextureNum=function()&#123;return null==this.json[this.TEXTURES]?0:this.json[this.TEXTURES].length&#125;,o.prototype.getHitAreaNum=function()&#123;return null==this.json[this.HIT_AREAS]?0:this.json[this.HIT_AREAS].length&#125;,o.prototype.getHitAreaID=function(t)&#123;return null==this.json[this.HIT_AREAS]||null==this.json[this.HIT_AREAS][t]?null:this.json[this.HIT_AREAS][t][this.ID]&#125;,o.prototype.getHitAreaName=function(t)&#123;return null==this.json[this.HIT_AREAS]||null==this.json[this.HIT_AREAS][t]?null:this.json[this.HIT_AREAS][t][this.NAME]&#125;,o.prototype.getPhysicsFile=function()&#123;return this.json[this.PHYSICS]&#125;,o.prototype.getPoseFile=function()&#123;return this.json[this.POSE]&#125;,o.prototype.getExpressionNum=function()&#123;return null==this.json[this.EXPRESSIONS]?0:this.json[this.EXPRESSIONS].length&#125;,o.prototype.getExpressionFile=function(t)&#123;return null==this.json[this.EXPRESSIONS]?null:this.json[this.EXPRESSIONS][t][this.FILE]&#125;,o.prototype.getExpressionName=function(t)&#123;return null==this.json[this.EXPRESSIONS]?null:this.json[this.EXPRESSIONS][t][this.NAME]&#125;,o.prototype.getLayout=function()&#123;return this.json[this.LAYOUT]&#125;,o.prototype.getInitParamNum=function()&#123;return null==this.json[this.INIT_PARAM]?0:this.json[this.INIT_PARAM].length&#125;,o.prototype.getMotionNum=function(t)&#123;return null==this.json[this.MOTION_GROUPS]||null==this.json[this.MOTION_GROUPS][t]?0:this.json[this.MOTION_GROUPS][t].length&#125;,o.prototype.getMotionFile=function(t,e)&#123;return null==this.json[this.MOTION_GROUPS]||null==this.json[this.MOTION_GROUPS][t]||null==this.json[this.MOTION_GROUPS][t][e]?null:this.json[this.MOTION_GROUPS][t][e][this.FILE]&#125;,o.prototype.getMotionSound=function(t,e)&#123;return null==this.json[this.MOTION_GROUPS]||null==this.json[this.MOTION_GROUPS][t]||null==this.json[this.MOTION_GROUPS][t][e]||null==this.json[this.MOTION_GROUPS][t][e][this.SOUND]?null:this.json[this.MOTION_GROUPS][t][e][this.SOUND]&#125;,o.prototype.getMotionFadeIn=function(t,e)&#123;return null==this.json[this.MOTION_GROUPS]||null==this.json[this.MOTION_GROUPS][t]||null==this.json[this.MOTION_GROUPS][t][e]||null==this.json[this.MOTION_GROUPS][t][e][this.FADE_IN]?1e3:this.json[this.MOTION_GROUPS][t][e][this.FADE_IN]&#125;,o.prototype.getMotionFadeOut=function(t,e)&#123;return null==this.json[this.MOTION_GROUPS]||null==this.json[this.MOTION_GROUPS][t]||null==this.json[this.MOTION_GROUPS][t][e]||null==this.json[this.MOTION_GROUPS][t][e][this.FADE_OUT]?1e3:this.json[this.MOTION_GROUPS][t][e][this.FADE_OUT]&#125;,o.prototype.getInitParamID=function(t)&#123;return null==this.json[this.INIT_PARAM]||null==this.json[this.INIT_PARAM][t]?null:this.json[this.INIT_PARAM][t][this.ID]&#125;,o.prototype.getInitParamValue=function(t)&#123;return null==this.json[this.INIT_PARAM]||null==this.json[this.INIT_PARAM][t]?NaN:this.json[this.INIT_PARAM][t][this.VALUE]&#125;,o.prototype.getInitPartsVisibleNum=function()&#123;return null==this.json[this.INIT_PARTS_VISIBLE]?0:this.json[this.INIT_PARTS_VISIBLE].length&#125;,o.prototype.getInitPartsVisibleID=function(t)&#123;return null==this.json[this.INIT_PARTS_VISIBLE]||null==this.json[this.INIT_PARTS_VISIBLE][t]?null:this.json[this.INIT_PARTS_VISIBLE][t][this.ID]&#125;,o.prototype.getInitPartsVisibleValue=function(t)&#123;return null==this.json[this.INIT_PARTS_VISIBLE]||null==this.json[this.INIT_PARTS_VISIBLE][t]?NaN:this.json[this.INIT_PARTS_VISIBLE][t][this.VALUE]&#125;&#125;&#125;);//# sourceMappingURL=L2Dwidget.0.min.js.map\nåŸé“¾æ¥\n","tags":["çœ‹æ¿å¨˜"]},{"title":"limiteré™æµ","url":"/2023/06/06/0.4.4-limiter%E9%99%90%E6%B5%81/","content":"limiteré™æµå•æœºé™æµæ€è·¯ä»‹ç»é‡‡ç”¨ Google çš„ Guava ä¸­çš„ RateLimiter.create æ¥è¿›è¡Œä»¤ç‰Œæ¡¶çš„åˆ†å‘ï¼Œä½†æ˜¯æˆ‘ä»¬éœ€è¦åŠ¨æ€æ§åˆ¶é™æµçš„é€Ÿç‡ï¼Œæ‰€ä»¥åœ¨è¿™ä¸Šé¢åˆ©ç”¨å•ä¾‹æ¨¡å¼çš„â€œ åŒé‡æ£€æŸ¥é” â€å’Œ â€œæ‡’æ±‰å¼â€æ¥è¿›è¡ŒåŠ¨æ€åˆ›å»º\n&lt;dependency&gt;\t\t&lt;groupId&gt;com.google.guava&lt;/groupId&gt;\t\t&lt;artifactId&gt;guava&lt;/artifactId&gt;\t\t&lt;version&gt;20.0&lt;/version&gt;&lt;/dependency&gt;\npackage com.tthk.inland.ticket.core.utils.limiters;import com.google.common.util.concurrent.RateLimiter;import lombok.extern.slf4j.Slf4j;import java.util.Optional;/** * @Description CN: åˆ©ç”¨guavaä»¤ç‰Œæ¡¶é™æµã€å•æœºé™æµã€‘ * @Description EN: Use the Guava token-bucket to limit the service * @Description KR: Guava í† í° ë²„í‚·ì„ ì‚¬ìš©í•˜ì—¬ ì„œë¹„ìŠ¤ ì œí•œ * @Author Foam * @Date 2023/5/6 **/@Slf4jpublic class GuavaRateLimiterUtils &#123;    /**     * @Description CN: é»˜è®¤é€Ÿç‡     * @Description EN: Default rate     * @Description KR: ê¸°ë³¸ ë¹„ìœ¨     **/    private final static Integer DEFAULT_RATE = 80;    private static RateLimiter instance = null;    private GuavaRateLimiterUtils()&#123;&#125;    /**     * @Description CN: åˆå§‹åŒ–ä»¤ç‰Œæ¡¶     * @Description EN: Initialize the Guava token-bucket     * @Description KR: Guava í† í° ë²„í‚· ì´ˆê¸°í™”     * @Author Foam     * @Date 2023/5/6     * @param rate é™æµé€Ÿç‡ã€æ¯ç§’ç”Ÿäº§çš„tokenã€‘ RateLimiter: Tokens produced per second     * @return boolean true: é™æµä¸­ limiting | false: æœªé™æµ pass     **/    public static boolean initRateLimiter(Integer rate)&#123;        try&#123;            Integer limiter = Optional.ofNullable(rate).orElse(DEFAULT_RATE);            if(instance == null || limiter.equals(DEFAULT_RATE))&#123;                synchronized (GuavaRateLimiterUtils.class)&#123;                    if(instance == null || limiter.equals(DEFAULT_RATE))&#123;                        // åˆ›å»ºä»¤ç‰Œæ¡¶ Create token-bucket                        instance = RateLimiter.create(limiter);                    &#125;                &#125;            &#125;            if(!instance.tryAcquire(1))&#123;                log.info(&quot;é™æµä¸­&quot;);                return true;            &#125;        &#125;catch (Exception e)&#123;            log.info(e.getMessage());        &#125;        return false;    &#125;&#125;\nåˆ†å¸ƒå¼é™æµæ€è·¯ä»‹ç»é‡‡ç”¨ Redis é˜Ÿåˆ—å®ç°æ»‘åŠ¨çª—å£çš„æ–¹å¼æ¥è¿›è¡Œé™æµï¼Œåˆ©ç”¨ Redis çš„ SETNX ç‰¹æ€§æ¥åŠ åˆ†å¸ƒå¼é”ï¼Œä¿è¯æ‰§è¡Œé¡ºåº\n&lt;!--redisson--&gt;&lt;dependency&gt;\t\t&lt;groupId&gt;org.redisson&lt;/groupId&gt;\t\t&lt;artifactId&gt;redisson&lt;/artifactId&gt;\t\t&lt;version&gt;2.9.3&lt;/version&gt;&lt;/dependency&gt;\npackage com.tthk.inland.ticket.core.utils.limiters;import lombok.extern.slf4j.Slf4j;import org.redisson.Redisson;import org.redisson.api.RLock;import org.redisson.api.RedissonClient;import org.redisson.config.Config;import java.util.concurrent.TimeUnit;/** * @Description CN: Redisé“¾æ¥å·¥å…·ç±» * @Description EN: Redis links the tool class * @Description KR: Redis ëŠ” ë„êµ¬ í´ë˜ìŠ¤ë¥¼ ì—°ê²°í•©ë‹ˆë‹¤ * @Author Foam * @Date 2023/5/6 **/@Slf4jpublic class RedisLinkUtils &#123;    // Redis link    private static volatile RedissonClient redissonClient;    // redisåœ°å€ Redis url    private static final String URL = &quot;&quot;;    // ç«¯å£ Redis port    private static final String PORT = &quot;&quot;;    // rediså¯†ç  Redis password    private static final String PASSWORD = &quot;&quot;;    // å¯¹åº”DB Redis DB    private static final Integer DB = 17;    // Limit dequeue name    public final static String TASK_NAME = &quot;REDIS_LIMIT&quot;;    // Lock name    public final static String TASK_LOCK = &quot;REDIS_LOCK&quot;;    /**     * @Description CN: è·å–rediså®¢æˆ·ç«¯     * @Description EN: Get redis client     * @Description KR: Redis í´ë¼ì´ì–¸íŠ¸ ê°€ì ¸ì˜¤ê¸°     * @Author Foam     * @Date 2023/5/6     * @return RedissonClient     **/    public static RedissonClient getRedissonClient()&#123;        if(redissonClient == null)&#123;            synchronized (RedisLinkUtils.class)&#123;                if(redissonClient == null)&#123;                    Config config = new Config();                    config.useSingleServer().setAddress(&quot;redis://&quot;+URL+&quot;:&quot;+PORT)                            .setPassword(PASSWORD)                            .setDatabase(DB);                    redissonClient = Redisson.create(config);                    // æ¸…ç©ºé˜Ÿåˆ— Queue clear                    redissonClient.getBlockingDeque(TASK_NAME).clear();                &#125;            &#125;        &#125;        return redissonClient;    &#125;    /**     * @Description CN: åˆ†å¸ƒå¼é”     * @Description EN: Distributed locking     * @Description KR: ë¶„ì‚° ì ê¸ˆ     * @Author Foam     * @Date 2023/5/6     * @param waitTime ç­‰å¾…æ—¶é—´ï¼ˆé”ç»­å‘½ï¼‰     * @param leaseTime å¼ºåˆ¶è§£é”æ—¶é—´     * @return boolean true: é”å®š lock falseï¼šæœªé”å®š unlock     **/    public static boolean acquireSecond(Integer waitTime, Integer leaseTime)&#123;        try &#123;            RLock myLock = redissonClient.getLock(TASK_LOCK);            return myLock.tryLock(waitTime, leaseTime, TimeUnit.SECONDS);        &#125; catch (InterruptedException e) &#123;            log.info(e.getMessage());        &#125;        return false;    &#125;    /**     * @Description CN: è§£é”     * @Description EN: Release lock     * @Description KR: ì ê¸ˆ í•´ì œ     * @Author Foam     * @Date 2023/5/6     **/    public static void release()&#123;        if(redissonClient != null) &#123;            RLock myLock = redissonClient.getLock(TASK_LOCK);            if(myLock != null)&#123;                myLock.unlock();            &#125;        &#125;    &#125;&#125;\npackage com.tthk.inland.ticket.core.utils.limiters;import lombok.extern.slf4j.Slf4j;import java.util.*;/** * @Description CN: Redis æ»‘åŠ¨çª—å£é™æµ * @Description EN: Redis sliding window throttling * @Description KR: * @Author Foam * @Date 2023/5/6 **/@Slf4jpublic class RedisRateLimiterUtils &#123;    /**     * @Description CN: é»˜è®¤é€Ÿç‡     * @Description EN: Default rate     * @Description KR: ê¸°ë³¸ ë¹„ìœ¨     **/    private final static Integer DEFAULT_RATE = 80;    private final static Long timeout = 1L;    /**     * @Description CN: åˆå§‹åŒ–æ»‘åŠ¨çª—å£é™æµ     * @Description EN: Initialize sliding window current limiting     * @Description KR: ìŠ¬ë¼ì´ë”© ìœˆë„ìš° ì „ë¥˜ ì œí•œ ì´ˆê¸°í™”     * @Author Foam     * @Date 2023/5/6     * @param rate é€Ÿç‡     * @return Boolean true:é™æµä¸­ false:æœªé™æµ     **/    public static Boolean initRateLimiter(Integer rate)&#123;        Long currentTimeMillis = System.currentTimeMillis();        Integer limiter = Optional.ofNullable(rate).orElse(DEFAULT_RATE);        Deque&lt;Long&gt; stack = RedisLinkUtils.getRedissonClient().getBlockingDeque(RedisLinkUtils.TASK_NAME);        try&#123;            if(stack.size() &gt;= limiter)&#123;                // è·å–åˆ†å¸ƒå¼é” Get distributed lock                if(RedisLinkUtils.acquireSecond(1,2))&#123;                    // è·å–æœ€æ—©æ—¶é—´ Get the earliest time                    Long firstTime = Optional.ofNullable(stack.peekFirst()).orElse(currentTimeMillis);                    if((currentTimeMillis - firstTime) &lt; (timeout * 1000))&#123;                        // åœ¨é™æµæ—¶é—´å†… During the current limit time                        log.info(&quot;é™æµä¸­&quot;);                        return true;                    &#125;                    // å¼¹å‡ºæœ€æ—©æ—¶é—´ Poll the earliest queue                    while (stack.size() &gt;= limiter)&#123;                        stack.pollFirst();                    &#125;                    // åˆ†å¸ƒå¼è§£é” Release distributed lock                    RedisLinkUtils.release();                &#125;else &#123;                    // æœªè·å–åˆ°åˆ†å¸ƒå¼é”ï¼Œé™æµï¼The distributed lock not obtained,current limit                    log.info(&quot;æœªè·å–åˆ°åˆ†å¸ƒå¼é”ï¼Œé™æµï¼&quot;);                    return true;                &#125;            &#125;        &#125;catch (Exception e)&#123;            log.info(e.getMessage());        &#125;        // å°¾ç«¯æ’å…¥å½“å‰æ—¶é—´æˆ³ The trailer inserts the current timestamp        RedisLinkUtils.getRedissonClient().getBlockingDeque(RedisLinkUtils.TASK_NAME).offerLast(currentTimeMillis);        return false;    &#125;    public static void main(String[] args) throws InterruptedException &#123;        for (int i = 0; i &lt; 100; i++) &#123;            while (initRateLimiter(1))&#123;                Thread.sleep(300);            &#125;;            System.out.println(i+&quot;æ¬¡&quot;);        &#125;    &#125;&#125;\n","tags":["å·¥å…·ç±»"]},{"title":"å®ä½“ç±»è½¬MAPå·¥å…·ç±»","url":"/2023/06/06/0.4.6-%E5%AE%9E%E4%BD%93%E7%B1%BB%E8%BD%ACMAP%E5%B7%A5%E5%85%B7%E7%B1%BB/","content":"å®ä½“ç±»è½¬MAPå·¥å…·ç±»package com.tthk.inland.ticket.core.utils.other;import java.lang.reflect.Field;import java.util.HashMap;import java.util.Map;public class EntityUtils &#123;\t/**\t * \t * @description å®ä½“ç±»è½¬Map\t */\tpublic static Map&lt;String, Object&gt; entityToMap(Object object) &#123;\t\tMap&lt;String, Object&gt; map = new HashMap&lt;&gt;();\t\tfor (Field field : object.getClass().getDeclaredFields()) &#123;\t\t\ttry &#123;\t\t\t\tboolean flag = field.isAccessible();\t\t\t\tfield.setAccessible(true);\t\t\t\tObject o = field.get(object);\t\t\t\tmap.put(field.getName(), o);\t\t\t\tfield.setAccessible(flag);\t\t\t&#125; catch (Exception e) &#123;\t\t\t\te.printStackTrace();\t\t\t&#125;\t\t&#125;\t\treturn map;\t&#125;\t/**\t * \t * @description Mapè½¬å®ä½“ç±»\t * @param map    éœ€è¦åˆå§‹åŒ–çš„æ•°æ®ï¼Œkeyå­—æ®µå¿…é¡»ä¸å®ä½“ç±»çš„æˆå‘˜åå­—ä¸€æ ·ï¼Œå¦åˆ™èµ‹å€¼ä¸ºç©º\t * @param entity éœ€è¦è½¬åŒ–æˆçš„å®ä½“ç±»\t */\tpublic static &lt;T&gt; T mapToEntity(Map&lt;String, Object&gt; map, Class&lt;T&gt; entity) &#123;\t\tT t = null;\t\ttry &#123;\t\t\tt = entity.newInstance();\t\t\tfor (Field field : entity.getDeclaredFields()) &#123;\t\t\t\tif (map.containsKey(field.getName())) &#123;\t\t\t\t\tboolean flag = field.isAccessible();\t\t\t\t\tfield.setAccessible(true);\t\t\t\t\tObject object = map.get(field.getName());\t\t\t\t\tif (object != null &amp;&amp; field.getType().isAssignableFrom(object.getClass())) &#123;\t\t\t\t\t\tfield.set(t, object);\t\t\t\t\t&#125;\t\t\t\t\tfield.setAccessible(flag);\t\t\t\t&#125;\t\t\t&#125;\t\t\treturn t;\t\t&#125; catch (InstantiationException | IllegalAccessException e) &#123;\t\t\te.printStackTrace();\t\t&#125;\t\treturn t;\t&#125;&#125;\n","tags":["å·¥å…·ç±»"]},{"title":"æœåŠ¡æ„é€ é™æ€å¼•ç”¨","url":"/2023/06/06/0.4.7-%E6%9C%8D%E5%8A%A1%E6%9E%84%E9%80%A0%E9%9D%99%E6%80%81%E5%BC%95%E7%94%A8/","content":"æ„é€ é™æ€å¼•ç”¨æˆ‘ä»¬æœ‰äº›é™æ€å·¥å…·ç±»ä¸­å¦‚æœéœ€è¦ä½¿ç”¨åˆ°serviceï¼Œè¿™ä¸ªæ—¶å€™å¼•å…¥å°±ä¼šæœ‰é—®é¢˜ï¼Œå¦‚ä¸‹æ‰€ç¤º\npackage com.tthk.inland.ticket.core.utils.statistic;import com.tthk.inland.ticket.core.utils.redis.RedisUtil;import org.springframework.beans.factory.annotation.Autowired;import org.springframework.stereotype.Component;@Componentpublic class StaticRedisTemplateComponet &#123;    @Autowired    private RedisUtil redisUtil;    private static void test()&#123;        redisUtil.get(&quot;test&quot;);    &#125;&#125;\næœ‰æ—¶å€™æˆ‘ä»¬åœ¨é™æ€æ–¹æ³•é‡Œé¢æ— æ³•ä½¿ç”¨@Autowiredå¼•å…¥çš„beanï¼Œå› ä¸ºæœ‰åŠ è½½é¡ºåºé—®é¢˜ä¼šæŠ¥é”™\n// è¿™ä¸€è¡Œçš„ redisUtil ä¼šçˆ†çº¢redisUtil.get(&quot;test&quot;);\nè¿™ä¸ªæ—¶å€™æˆ‘ä»¬å°±éœ€è¦å•ç‹¬å»å®ä¾‹åŒ–è¿™ä¸ªå¼•ç”¨ï¼Œå¹¶ä¸”å˜æˆé»˜è®¤çš„é™æ€æ–¹æ³•å¦‚ä¸‹ï¼š\npackage com.tthk.inland.ticket.core.utils.statistic;import com.tthk.inland.ticket.core.configurations.activemq.QueueProducerService;import com.tthk.inland.ticket.core.utils.redis.RedisUtil;import lombok.RequiredArgsConstructor;import org.springframework.stereotype.Component;import javax.annotation.PostConstruct;@Component@RequiredArgsConstructorpublic class StaticRedisTemplateComponet &#123;    private final QueueProducerService queueProducerService;    private final RedisUtil redisUtil;    private static QueueProducerService staticQueueProducerService;    private static RedisUtil staticRedisUtil;    @PostConstruct    public void init() &#123;        staticQueueProducerService = this.queueProducerService;        staticRedisUtil = this.redisUtil;    &#125;    public static RedisUtil getStaticRedisTenService() &#123;        return staticRedisUtil;    &#125;    public static QueueProducerService getStaticQueueProducerService() &#123;        return staticQueueProducerService;    &#125;&#125;\nè¿™æ ·æˆ‘ä»¬å°±å¯ä»¥ç”¨getæ–¹æ³•æ¥è¿›è¡Œè·å–\nStaticRedisTemplateComponet.getStaticRedisTenService().get(&quot;tt_interface_switch&quot;,10);\nç¬¬äºŒç§æ–¹æ³•ï¼Œæ¯”è¾ƒåŸå§‹@Autowiredä¼šæ ¹æ®beané‡Œé¢æ³¨å†Œçš„nameæ¥è¿›è¡Œæœç´¢ï¼Œå¦‚æœè·å–åˆ°äº†ï¼Œåˆ™è¿›è¡Œèµ‹å€¼\nprivate static ZXSearchNewService_new zxSearchNewService_new;private static QueueProducerService messageService;@Autowiredpublic zxSearch(QueueProducerService queueProducerService,ZXSearchNewService_new zxSearchNewService_new) &#123;    zxSearch.zxSearchNewService_new = zxSearchNewService_new;    zxSearch.messageService = queueProducerService;&#125;\n","tags":["å·¥å…·ç±»"]},{"title":"httpå·¥å…·ç±»ç»Ÿä¸€å°è£…","url":"/2023/06/06/0.4.5-http%E5%B7%A5%E5%85%B7%E7%B1%BB%E7%BB%9F%E4%B8%80%E5%B0%81%E8%A3%85/","content":"httpå·¥å…·ç±»ç»Ÿä¸€å°è£…\nä¸ªäººå°è£…ä½¿ç”¨ï¼Œä»…ä¾›å‚è€ƒ,ç”¨æ¥æ•è·æ¥å£å¼‚å¸¸ï¼Œå¹¶ä¸”é€šçŸ¥åˆ°ä¼ä¸šå¾®ä¿¡\n\npackage com.tthk.inland.ticket.core.utils.https;import cn.hutool.http.HttpRequest;import cn.hutool.http.HttpResponse;import com.alibaba.fastjson.JSONObject;import com.tthk.framework.base.api.dto.CommonResult;import com.tthk.inland.ticket.core.enums.result.ResulEnum;import com.tthk.inland.ticket.core.enums.wechat.WeChatEnums;import com.tthk.inland.ticket.core.utils.wechat.WeChatRobotUtils;import com.xxl.job.core.context.XxlJobHelper;import java.lang.reflect.Type;/** * @Description è¯·æ±‚çŠ¶æ€é€šçŸ¥å·¥å…·ç±» * @date 2023/4/13_17:08 * @author Foam */public class RequestStatusNotify &#123;    /**     * @Description å°è£…è¿”å›ç»“æœ     * @date 2023/4/13     **/    public static &lt;T&gt; CommonResult&lt;T&gt; requestStatusNotify(HttpRequest request,Class&lt;? extends T&gt; aClass,Type type)&#123;        final var execute = request.execute();        if(execute.getStatus() != 200)&#123;            XxlJobHelper.log(&quot;æ¥å£è°ƒç”¨å¤±è´¥&quot;);\t\t\t// å¾®ä¿¡é€šçŸ¥            WeChatRobotUtils.pushNotice(&quot;ã€&quot;+execute.getStatus()+&quot;ã€‘æ¥å£è°ƒç”¨å¤±è´¥:&quot;+request.getUrl(), WeChatEnums.WARN);            return CommonResult.error(ResulEnum.INTERFACE_FALT.getErrorCode());        &#125;else &#123;            T o = null;            if(aClass != null)&#123;                o = JSONObject.parseObject(execute.body(), aClass);            &#125;            if(type != null)&#123;                o = JSONObject.parseObject(execute.body(), type);            &#125;            XxlJobHelper.log(execute.getStatus()+&quot;æ¥å£è°ƒç”¨ç»“æœï¼š&quot;+JSONObject.toJSONString(o));            // å°è£…è¿”å›ç»“æœ            return CommonResult.success(o);        &#125;    &#125;    public static &lt;T&gt; CommonResult&lt;T&gt; requestStatusNotify(HttpRequest request,Type type)&#123;        return requestStatusNotify(request,null,type);    &#125;    public static &lt;T&gt; CommonResult&lt;T&gt; requestStatusNotify(HttpRequest request,Class&lt;? extends T&gt; aClass)&#123;        return requestStatusNotify(request,aClass,null);    &#125;&#125;\nä½¿ç”¨æ–¹æ³•\npublic static final String SPECIAL_PRICE_URL = APP_OPER_URL + &quot;/AppOper/GetPrice&quot;;    public static CommonResult&lt;B2CSpecialPriceVO&gt; getB2CSpecialPrice(B2CSpecialPriceDTO b2CSpecialPriceDTO)&#123;        final var body = HttpRequest.get(SPECIAL_PRICE_URL).form(EntityUtils.entityToMap(b2CSpecialPriceDTO));        return RequestStatusNotify.requestStatusNotify(body, new TypeReference&lt;CommonResult&lt;B2CSpecialPriceVO&gt;&gt;()&#123;&#125;.getType());    &#125;\n","tags":["å·¥å…·ç±»"]},{"title":"æšä¸¾å·¥å…·ç±»åˆ¤æ–­åŒ…å«å…³ç³»","url":"/2023/06/06/0.4.8-%E6%9E%9A%E4%B8%BE%E5%B7%A5%E5%85%B7%E7%B1%BB%E5%88%A4%E6%96%AD%E5%8C%85%E5%90%AB%E5%85%B3%E7%B3%BB/","content":"package com.tthk.inland.ticket.core.enums.order;import lombok.AllArgsConstructor;import lombok.Getter;import java.util.Arrays;/** * @Description é‡è¯•çŠ¶æ€æšä¸¾ * @date 2023/4/7_15:04 * @author Foam */@Getter@AllArgsConstructorpublic enum RetryEnum &#123;    SYS_ERROR(&quot;ç³»ç»Ÿé”™è¯¯ï¼Œè¯·æ‚¨ç¨åé‡è¯•&quot;),    SYS_ERROR_01(&quot;ç³»ç»Ÿå¼€äº†ä¸€ä¸ªå°å·®&quot;);    private String type;    /**     * @Description åˆ¤æ–­æ˜¯å¦éœ€è¦è¿›è¡Œé‡è¯•ï¼Œtrueï¼šéœ€è¦ï¼Œfalseï¼šä¸éœ€è¦     * @date 2023/4/7     **/    public static Boolean needRetry(String value) &#123;        return Arrays.stream(RetryEnum.values()).anyMatch(e -&gt; value.contains(e.type));    &#125;&#125;\n\næµ‹è¯•æ–¹æ³•\npackage com.tthk.inland.ticket.core.account;import com.tthk.inland.ticket.core.enums.order.RetryEnum;import lombok.extern.slf4j.Slf4j;import org.junit.jupiter.api.Test;import org.springframework.boot.test.context.SpringBootTest;/** * @Description è®¢å•æµ‹è¯•ç±» * @date 2023/4/7_15:11 * @author Foam */@SpringBootTest@Slf4jpublic class OrderTest &#123;    /**     * @Description æµ‹è¯•é‡è¯•æšä¸¾æ˜¯å¦å¯ç”¨     * @date 2023/4/7     **/    @Test    public void testEnums() &#123;        System.out.println(                RetryEnum.needRetry(&quot;ç³»ç»Ÿå¼€äº†ä¸€ä¸ªå°å·®~è¯·ç¨åé‡è¯•&quot;)        );    &#125;&#125;\n","tags":["å·¥å…·ç±»"]},{"title":"æŸ”æ€§å¯ç”¨å’Œåˆšæ€§å¯ç”¨","url":"/2023/06/06/0.4.9-%E6%9F%94%E6%80%A7%E5%8F%AF%E7%94%A8%E5%92%8C%E5%88%9A%E6%80%A7%E5%8F%AF%E7%94%A8/","content":"ç®€è¿°è¿™ä¸¤ä¸ªè¯æ±‡ä¸€èˆ¬å‡ºç°åœ¨äº‹åŠ¡å½“ä¸­åˆšæ€§å¯ç”¨åˆç§°ä¸ºåˆšæ€§äº‹åŠ¡ï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬ç»å¸¸è§åˆ°çš„â€å¼ºä¸€è‡´æ€§â€ï¼ŒACIDç†è®ºæŸ”æ€§å¯ç”¨åˆç§°ä¸ºæŸ”æ€§äº‹åŠ¡ï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬ç»å¸¸è§åˆ°çš„â€æœ€ç»ˆä¸€è‡´æ€§â€ï¼ŒBASEç†è®º\nå‰è¨€è¿›å…¥ä¸»é¢˜ä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆç®€å•èŠä¸€ä¸‹äº‹åŠ¡åœ¨ç¼–ç¨‹ä¸­ï¼Œäº‹åŠ¡æ˜¯æŒ‡ä½œä¸ºå•ä¸ªå·¥ä½œå•å…ƒæ‰§è¡Œçš„ä¸€ç³»åˆ—æ“ä½œï¼Œç”¨äºç¡®ä¿æ•°æ®åº“æˆ–è€…å…¶å®ƒç³»ç»Ÿä¸­æ•°æ®çš„ä¸€è‡´æ€§å’Œå®Œæ•´æ€§è€Œäº‹åŠ¡é€šå¸¸å…·æœ‰å››ä¸ªå±æ€§ï¼ˆACIDï¼‰ï¼š\n\nåŸå­æ€§ï¼ˆAtomicityï¼‰\n\näº‹åŠ¡çš„åŸå­æ€§æ˜¯æŒ‡äº‹åŠ¡å¿…é¡»æ˜¯ä¸€ä¸ªåŸå­çš„æ“ä½œåºåˆ—å•å…ƒä»»ä½•ä¸€é¡¹æ“ä½œå¤±è´¥éƒ½å°†å¯¼è‡´æ•´ä¸ªäº‹åŠ¡å¤±è´¥ï¼ŒåŒæ—¶å…¶ä»–å·²ç»è¢«æ‰§è¡Œçš„æ“ä½œéƒ½å°†è¢«æ’¤é”€å¹¶å›æ»šï¼Œåªæœ‰æ‰€æœ‰çš„æ“ä½œå…¨éƒ¨æˆåŠŸï¼Œæ•´ä¸ªäº‹åŠ¡æ‰ç®—æ˜¯æˆåŠŸå®Œæˆè¦ä¹ˆæˆåŠŸï¼Œè¦ä¹ˆå¤±è´¥\n\n\nä¸€è‡´æ€§ï¼ˆConsistencyï¼‰\n\näº‹åŠ¡çš„ä¸€è‡´æ€§æ˜¯æŒ‡äº‹åŠ¡çš„æ‰§è¡Œä¸èƒ½ç ´åæ•°æ®åº“æ•°æ®çš„å®Œæ•´æ€§å’Œä¸€è‡´æ€§ï¼Œä¸€ä¸ªäº‹åŠ¡åœ¨æ‰§è¡Œä¹‹å‰å’Œæ‰§è¡Œä¹‹åï¼Œæ•°æ®åº“éƒ½å¿…é¡»å¤„äºä¸€è‡´æ€§çŠ¶æ€äº‹åŠ¡æ‰§è¡Œçš„ç»“æœå¿…é¡»æ˜¯ä½¿æ•°æ®åº“ä»ä¸€ä¸ªä¸€è‡´æ€§çŠ¶æ€è½¬å˜åˆ°å¦ä¸€ä¸ªä¸€è‡´æ€§çŠ¶æ€\n\n\néš”ç¦»æ€§ï¼ˆIsolationï¼‰\n\näº‹åŠ¡çš„éš”ç¦»æ€§æ˜¯æŒ‡åœ¨å¹¶å‘ç¯å¢ƒä¸­ï¼Œå¹¶å‘çš„äº‹åŠ¡æ˜¯ç›¸äº’éš”ç¦»çš„ï¼Œä¸€ä¸ªäº‹åŠ¡çš„æ‰§è¡Œä¸èƒ½è¢«å…¶ä»–äº‹åŠ¡å¹²æ‰°\n\n\næŒä¹…æ€§ï¼ˆDurabilityï¼‰\n\näº‹åŠ¡çš„æŒä¹…æ€§ä¹Ÿè¢«ç§°ä¸ºæ°¸ä¹…æ€§ï¼Œæ˜¯æŒ‡ä¸€ä¸ªäº‹åŠ¡ä¸€æ—¦æäº¤ï¼Œå®ƒå¯¹æ•°æ®åº“ä¸­å¯¹åº”æ•°æ®çš„çŠ¶æ€å˜æ›´å°±åº”è¯¥æ˜¯æ°¸ä¹…æ€§çš„ä¸€æ—¦æŸä¸ªäº‹åŠ¡æˆåŠŸç»“æŸï¼Œé‚£ä¹ˆå®ƒå¯¹æ•°æ®åº“æ‰€åšçš„æ›´æ–°å°±å¿…é¡»è¢«æ°¸ä¹…ä¿å­˜ä¸‹æ¥â€”â€”å³ä½¿å‘ç”Ÿç³»ç»Ÿå´©æºƒæˆ–æœºå™¨å®•æœºç­‰æ•…éšœï¼Œåªè¦æ•°æ®åº“èƒ½å¤Ÿé‡æ–°å¯åŠ¨ï¼Œé‚£ä¹ˆä¸€å®šèƒ½å¤Ÿå°†å…¶æ¢å¤åˆ°äº‹åŠ¡æˆåŠŸç»“æŸæ—¶çš„çŠ¶æ€\n\n\n\nåˆšæ€§å¯ç”¨æ­£å¸¸æˆ‘ä»¬çš„å•ä½“æœåŠ¡ï¼Œåªè¦æ»¡è¶³ACIDï¼Œå®ƒéƒ½æ˜¯åˆšæ€§å¯ç”¨çš„\næŸ”æ€§å¯ç”¨éšç€ä¸šåŠ¡çš„æ‰©å±•ï¼Œæˆ‘ä»¬çš„æœåŠ¡éœ€è¦è¿›è¡Œè·¨æœåŠ¡é—´è¿›è¡Œè°ƒç”¨ï¼Œå¹¶ä¸”ç”¨æˆ·é‡å¼€å§‹ä¸Šå‡\nä¸ºä»€ä¹ˆæˆ‘ä»¬è¦ç”¨æŸ”æ€§å¯ç”¨\næˆ‘ä»¬çš„ç³»ç»Ÿä¸å†ç»å¯¹å¯é ï¼Œå¼€å§‹å‡ºç°äº†å®•æœºï¼Œç½‘ç»œæ³¢åŠ¨ï¼ˆæ•…éšœï¼‰\nç³»ç»Ÿçš„æˆæœ¬é¢„ç®—ä¹Ÿä¸å¤Ÿï¼Œä¸ºäº†ç³»ç»Ÿèƒ½ç¨³å®šè¿è¡Œï¼Œåœ¨è®¾è®¡çš„æ—¶å€™å¯èƒ½ä¼šè¿›è¡Œå®¹ç¾ï¼ˆèµ„æºå†—ä½™ï¼‰ï¼Œä½†æ˜¯è¿™ç§å†—ä½™ä¸æ˜¯æ— é™åº¦çš„ï¼Œæˆæœ¬åœ¨å“ªé‡Œï¼Œå½“é‡åˆ°è¶…è¿‡å†—ä½™çš„æµé‡ï¼Œç…§æ ·ä¼šå‡ºç°é—®é¢˜\n\nå½“æ¡ä»¶æœ‰é™è€Œä¸èƒ½å‘ç”¨æˆ·æä¾›å®Œç¾æœåŠ¡çš„æ—¶å€™ï¼Œå¯ä»¥ç”¨æŸ”æ€§æœ‰æŸçš„æœåŠ¡ï¼Œæœ€å¤§ç¨‹åº¦çš„ä¿è¯å…³é”®æœåŠ¡å¯ç”¨æ€§é€šå¸¸æœ‰æŸçš„æœåŠ¡æ‰€éœ€çš„æˆæœ¬ä¼šä½äºå®Œç¾æœåŠ¡ï¼Œç›¸åº”çš„ä½“éªŒä¹Ÿè¾ƒå·®ï¼Œæ‰€ä»¥åœ¨ç³»ç»Ÿè®¾è®¡æ—¶éœ€è¦å¹³è¡¡äºŒè€…çš„å…³ç³»ï¼Œå°½é‡æä¾›é«˜ç­‰çº§æœåŠ¡æˆ‘ä»¬å¸¸è§çš„â€BASEç†è®ºâ€å°±æ˜¯æœ€ç»å…¸çš„æŸ”æ€§å¯ç”¨ï¼ŒTCCè¡¥å¿å‹äº‹åŠ¡å’ŒMQé€šçŸ¥å‹äº‹åŠ¡\nBASEç†è®ºåœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­ï¼Œä¸€èˆ¬æœ‰ä¸‰ä¸ªæŒ‡æ ‡ï¼Œç®€ç§°ï¼šCAPç†è®ºCAPç†è®ºConsistency ä¸€è‡´æ€§ï¼šè¯»å†™æ“ä½œåçš„å€¼å¿…é¡»ä¸€ç›´Avaliability å¯ç”¨æ€§ï¼šæ”¶åˆ°è¯·æ±‚å¿…é¡»åœ¨è§„å®šæ—¶é—´å†…ç»™å‡ºå›åº”Partition tolerance åˆ†åŒºå®¹é”™æ€§ï¼šåœ¨ä¸åŒåœ°åŒºå¯ä»¥è¿›è¡Œé€šä¿¡\n\nåˆ†å¸ƒå¼ç³»ç»Ÿä¸­ï¼Œç½‘ç»œæœ¬èº«æ— æ³•åšåˆ°100%å¯é ï¼Œæœ‰å¯èƒ½å‡ºç°æ•…éšœæ‰€ä»¥Cå’ŒAæ— æ³•åŒæ—¶åšåˆ°\n\nå…·ä½“æ¥è¯´ï¼Œå½“åˆ†å¸ƒå¼ç³»ç»Ÿé‡åˆ°ç½‘ç»œåˆ†åŒºï¼ˆå³èŠ‚ç‚¹ä¹‹é—´çš„é€šä¿¡ä¸­æ–­ï¼‰æ—¶ï¼Œå¿…é¡»åœ¨ä¸€è‡´æ€§ï¼ˆCPï¼‰å’Œå¯ç”¨æ€§ï¼ˆAPï¼‰ä¹‹é—´è¿›è¡Œé€‰æ‹©ã€‚å¦‚æœé€‰æ‹©ä¿è¯ä¸€è‡´æ€§ï¼Œé‚£ä¹ˆåœ¨ç½‘ç»œåˆ†åŒºæœŸé—´ï¼Œç³»ç»Ÿå°†æ— æ³•æä¾›æœåŠ¡ï¼Œå³ä¸å¯ç”¨ã€‚å¦‚æœé€‰æ‹©ä¿è¯å¯ç”¨æ€§ï¼Œé‚£ä¹ˆåœ¨ç½‘ç»œåˆ†åŒºæœŸé—´ï¼Œç³»ç»Ÿå°†æ— æ³•ä¿è¯æ•°æ®çš„ä¸€è‡´æ€§ã€‚ä»€ä¹ˆæ˜¯BASEç†è®ºBASEç†è®ºæœ¬è´¨ä¸Šæ˜¯å¯¹CAPçš„å»¶ä¼¸å’Œè¡¥å……ï¼Œæ›´å…·ä½“åœ°è¯´ï¼Œæ˜¯å¯¹CAPä¸­APæ–¹æ¡ˆçš„ä¸€ä¸ªè¡¥å……Basically Available åŸºæœ¬å¯ç”¨ï¼šç³»ç»Ÿåº”å§‹ç»ˆå¯ç”¨ï¼Œå³ä½¿é¢ä¸´ç½‘ç»œåˆ†åŒºæˆ–è€…å…¶å®ƒæ•…éšœSoft State è½¯çŠ¶æ€ï¼šç³»ç»Ÿå…è®¸å­˜åœ¨ä¸­é—´çŠ¶æ€ï¼Œè¯¥ä¸­é—´çŠ¶æ€ä¸ä¼šå½±å“ç³»ç»Ÿæ•´ä½“å¯ç”¨æ€§Eventual Consistency æœ€ç»ˆä¸€è‡´æ€§ï¼šç³»ç»Ÿæœ€ç»ˆçš„ç»“æœä¼šå˜å¾—ä¸€è‡´ï¼Œä½†ä¸æ˜¯ç«‹åˆ»ä¸€è‡´\næŸ”æ€§å¯ç”¨çš„å®ç°æ­¥éª¤è¦å®ç°æŸ”æ€§å¯ç”¨çš„ç³»ç»Ÿï¼Œéœ€è¦åœ¨äº§å“è®¾è®¡å’ŒæŠ€æœ¯å®ç°ä¸¤ä¸ªé˜¶æ®µéƒ½æœ‰æŸ”æ€§çš„æ„è¯†\n\næœåŠ¡åˆ†çº§\n\nåœ¨äº§å“è®¾è®¡é˜¶æ®µï¼Œéœ€è¦å¯¹æœåŠ¡çš„åº”ç”¨åœºæ™¯è¿›è¡Œè¿˜åŸè¦æ¸…æ¥šåœ°è®¤è¯†åˆ°å“ªäº›æœåŠ¡æ˜¯ç³»ç»Ÿçš„æ ¸å¿ƒæœåŠ¡ï¼Œå“ªäº›æœåŠ¡æ˜¯æ”¯æ’‘æœåŠ¡ï¼ˆè¿™ä¸å•å•æ˜¯ä»é‡è¦æ€§è¿›è¡Œåˆ†çº§ï¼Œè¿˜è¦è€ƒè™‘ï¼Œæœ‰äº›æœåŠ¡æ˜¯éœ€è¦å®æ—¶å®Œæˆè¿˜æ˜¯å¯ä»¥ç¦»çº¿å®Œæˆåå»¶è¿ŸåŒæ­¥ï¼‰\n\n\nè‡ªèº«èƒ½åŠ›è¯„ä¼°\n\nåœ¨äº§å“è®¾è®¡é˜¶æ®µï¼Œè¦äº†è§£è‡ªå·±æ‹¥æœ‰çš„èµ„æºï¼Œå¯¹è‡ªå·±çš„è´Ÿè½½èƒ½åŠ›æœ‰è¾ƒå¥½çš„è¯„ä¼°ç®€å•çš„è¯´ï¼Œå°±æ˜¯è¦æ¸…æ¥šåœ¨å„ç§æ¡ä»¶ä¸‹ï¼Œè‡ªå·±èƒ½æä¾›ä»€ä¹ˆæ ·çš„æœåŠ¡\n\n\nç³»ç»Ÿåˆ’åˆ†\n\nåœ¨æŠ€æœ¯å®ç°åˆæœŸï¼ˆç³»ç»Ÿè®¾è®¡ï¼‰ï¼Œéœ€è¦éµå¾ªå¤§ç³»ç»Ÿå°åšçš„åŸåˆ™ï¼Œå¯¹ç³»ç»Ÿè¿›è¡Œæ‹†åˆ†ï¼Œé¿å…å„ä¸ªæœåŠ¡äº’ç›¸å½±å“ï¼Œé™ä½å­æ¨¡å—è€¦åˆæ€§\n\n\nè‡ªæˆ‘ç›‘æ§\n\nç³»ç»Ÿè¦æœ‰è‡ªæˆ‘ç›‘æ§èƒ½åŠ›ï¼Œäº†è§£å½“å‰è´Ÿè½½ï¼Œè¯„ä¼°æ˜¯å¦éœ€è¦æä¾›é™çº§æœåŠ¡\n\n\né™çº§æœåŠ¡\n\næ»¡è¶³é™çº§æ¡ä»¶æ—¶ï¼Œåˆ†çº§æä¾›æŸ”æ€§æœåŠ¡\n\n\nç³»ç»Ÿæ¢å¤\n\nå½“ç³»ç»Ÿé‡æ–°æ»¡è¶³å¯ä»¥æä¾›å®Œç¾æœåŠ¡çš„æ¡ä»¶æ—¶ï¼Œå‡çº§æœåŠ¡ç­‰çº§ï¼ˆæœ‰èƒ½åŠ›æ—¶ï¼Œè¿˜åº”è¯¥å¯¹ä¹‹å‰æ”¾å¼ƒçš„å±€éƒ¨æœåŠ¡è¿›è¡Œæ¢å¤ï¼‰\n\n\n\nå‚è€ƒï¼šhttps://blog.csdn.net/jokeMqc/article/details/127503412https://blog.csdn.net/weixin_39582708/article/details/113911252https://cloud.tencent.com/developer/article/1339887https://www.jianshu.com/p/a555d9cef983\n","tags":["å·¥å…·ç±»"]},{"title":"é¢å‘å¯¹è±¡è®¾è®¡åŸåˆ™","url":"/2023/06/06/0.5.0-%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1%E8%AE%BE%E8%AE%A1%E5%8E%9F%E5%88%99/","content":"\né¢å‘å¯¹è±¡ã€Object Orientedã€‘å››å¤§ç‰¹æ€§ï¼šå°è£…ï¼Œç»§æ‰¿ï¼ŒæŠ½è±¡ï¼Œå¤šæ€\n\nä¸€ä»½å¥½çš„å¯¹è±¡è®¾è®¡ï¼Œå¾€å¾€æ˜¯ä»¥å¯¹è±¡ä¸ºä¸­å¿ƒï¼Œå……åˆ†åˆ©ç”¨æ¥å£å’Œå¤šæ€æ¥åœä¾›çµæ´»æ€§ã€åº”å¯¹å˜åŒ–ï¼Œæé«˜å¤ç”¨ã€‘\nç›®æ ‡å¯æ‰©å±•æ€§\n\næœ‰äº†æ–°çš„éœ€æ±‚ï¼Œæ–°çš„æ€§èƒ½å¯ä»¥å®¹æ˜“æ·»åŠ åˆ°ç³»ç»Ÿä¸­ï¼Œä¸å½±å“ç°æœ‰çš„æ€§èƒ½ï¼Œä¹Ÿä¸ä¼šå¸¦æ¥æ–°çš„ç¼ºé™·\n\nå¯ä¿®æ”¹æ€§\n\nç³»ç»Ÿä¸€éƒ¨åˆ†çš„ä»£ç è¦ä¿®æ”¹æ—¶ä¸ä¼šç ´åç³»ç»Ÿçš„ç°æœ‰ç»“æ„ï¼Œä¹Ÿä¸ä¼šå½±å“åˆ°å…¶å®ƒçš„éƒ¨åˆ†\n\nå¯æ›¿æ¢æ€§\n\nå¯ä»¥å°†ç³»ç»Ÿä¸­çš„æŸäº›ä»£ç æ›¿æ¢ä¸ºç›¸åŒæ¥å£çš„å…¶å®ƒç±»ï¼Œä¸ä¼šå½±å“åˆ°ç³»ç»Ÿ\n\nä¸ƒå¤§è®¾è®¡åŸåˆ™\n\n\nè®¾è®¡åŸåˆ™åç§°\nå®š ä¹‰\nä½¿ç”¨é¢‘ç‡\n\n\n\nå•ä¸€èŒè´£åŸåˆ™(Single Responsibility  Principle, SRP)\nä¸€ä¸ªç±»åªè´Ÿè´£ä¸€ä¸ªåŠŸèƒ½é¢†åŸŸä¸­çš„ç›¸åº”èŒè´£\nâ˜…â˜…â˜…â˜…â˜†\n\n\nå¼€é—­åŸåˆ™(Open-Closed Principle, OCP)\nè½¯ä»¶å®ä½“åº”å¯¹æ‰©å±•å¼€æ”¾ï¼Œè€Œå¯¹ä¿®æ”¹å…³é—­\nâ˜…â˜…â˜…â˜…â˜…\n\n\né‡Œæ°ä»£æ¢åŸåˆ™(Liskov Substitution  Principle, LSP)\næ‰€æœ‰å¼•ç”¨åŸºç±»å¯¹è±¡çš„åœ°æ–¹èƒ½å¤Ÿé€æ˜åœ°ä½¿ç”¨å…¶å­ç±»çš„å¯¹è±¡\nâ˜…â˜…â˜…â˜…â˜…\n\n\nä¾èµ–å€’è½¬åŸåˆ™(Dependence Inversion  Principle, DIP)\næŠ½è±¡ä¸åº”è¯¥ä¾èµ–äºç»†èŠ‚ï¼Œç»†èŠ‚åº”è¯¥ä¾èµ–äºæŠ½è±¡\nâ˜…â˜…â˜…â˜…â˜…\n\n\næ¥å£éš”ç¦»åŸåˆ™(Interface Segregation  Principle, ISP)\nä½¿ç”¨å¤šä¸ªä¸“é—¨çš„æ¥å£ï¼Œè€Œä¸ä½¿ç”¨å•ä¸€çš„æ€»æ¥å£\nâ˜…â˜…â˜†â˜†â˜†\n\n\nåˆæˆå¤ç”¨åŸåˆ™(Composite Reuse Principle,  CRP)\nå°½é‡ä½¿ç”¨å¯¹è±¡ç»„åˆï¼Œè€Œä¸æ˜¯ç»§æ‰¿æ¥è¾¾åˆ°å¤ç”¨çš„ç›®çš„\nâ˜…â˜…â˜…â˜…â˜†\n\n\nè¿ªç±³ç‰¹æ³•åˆ™(Law of Demeter, LoD)\nä¸€ä¸ªè½¯ä»¶å®ä½“åº”å½“å°½å¯èƒ½å°‘åœ°ä¸å…¶ä»–å®ä½“å‘ç”Ÿç›¸äº’ä½œç”¨\nâ˜…â˜…â˜…â˜†â˜†\n\n\nå•ä¸€èŒè´£åŸåˆ™\nå•ä¸€èŒè´£åŸåˆ™æ˜¯æœ€ç®€å•çš„é¢å‘å¯¹è±¡è®¾è®¡åŸåˆ™ï¼Œå®ƒç”¨äºæ§åˆ¶ç±»çš„ç²’åº¦å¤§å°\nå•ä¸€èŒè´£åŸåˆ™æ˜¯å®ç°é«˜å†…èšã€ä½è€¦åˆçš„æŒ‡å¯¼æ–¹é’ˆï¼Œå®ƒæ˜¯æœ€ç®€å•ä½†åˆæœ€éš¾è¿ç”¨çš„åŸåˆ™ï¼Œéœ€è¦è®¾è®¡äººå‘˜å‘ç°ç±»çš„ä¸åŒèŒè´£  å¹¶å°†å…¶åˆ†ç¦»ï¼Œè€Œå‘ç°ç±»çš„å¤šé‡èŒè´£éœ€è¦è®¾è®¡äººå‘˜å…·æœ‰è¾ƒå¼ºçš„åˆ†æè®¾è®¡èƒ½åŠ›å’Œç›¸å…³å®è·µç»éªŒ\n\nå•ä¸€èŒè´£åŸåˆ™åŸåˆ™çš„æ ¸å¿ƒå«æ„æ˜¯ï¼šåªèƒ½è®©ä¸€ä¸ªç±»/æ¥å£/æ–¹æ³•æœ‰ä¸”ä»…æœ‰ä¸€ä¸ªèŒè´£ã€‚è¿åå•ä¸€èŒè´£åŸåˆ™\npackage com.weirdo.principle.singleResponsibility;public class SingleResponsibility1 &#123;    public static void main(String[] args) &#123;        Vehicle vehicle = new Vehicle();        vehicle.run(&quot;æ‘©æ‰˜è½¦&quot;);        vehicle.run(&quot;æ±½è½¦&quot;);        vehicle.run(&quot;é£æœº&quot;);    &#125;        //äº¤é€šå·¥å…·ç±»    static class Vehicle&#123;        public void run(String vehicle)&#123;            System.out.println(vehicle+&quot;åœ¨å…¬è·¯ä¸Šè¿è¡Œ...&quot;);        &#125;    &#125;&#125;\néµå¾ªå•ä¸€èŒè´£åŸåˆ™ã€ç±»çº§ã€‘\npackage com.weirdo.singleResponsibility;public class SingleResponsibility2 &#123;    public static void main(String[] args) &#123;        RoadVehicle roadVehicle = new RoadVehicle();        roadVehicle.run(&quot;æ‘©æ‰˜è½¦&quot;);        roadVehicle.run(&quot;æ±½è½¦&quot;);        AirVehicle airVehicle = new AirVehicle();        airVehicle.run(&quot;é£æœº&quot;);    &#125;    static class RoadVehicle &#123;        public void run(String vehicle) &#123;            System.out.println(vehicle + &quot;åœ¨å…¬è·¯ä¸Šè¿è¡Œ...&quot;);        &#125;    &#125;    static class AirVehicle &#123;        public void run(String vehicle) &#123;            System.out.println(vehicle + &quot;åœ¨å¤©ä¸Šä¸Šè¿è¡Œ...&quot;);        &#125;    &#125;&#125;\néµå¾ªå•ä¸€èŒè´£åŸåˆ™ã€æ–¹æ³•çº§ã€‘\npackage com.weirdo.singleResponsibility;public class SingleResponsibility3 &#123;    public static void main(String[] args) &#123;        Vehicle  vehicle = new Vehicle();        vehicle.runAir(&quot;é£æœº&quot;);        vehicle.runRoad(&quot;æ±½è½¦&quot;);        vehicle.runWater(&quot;èˆªæ¯&quot;);    &#125;    static class Vehicle &#123;        public void runRoad(String vehicle) &#123;            System.out.println(vehicle + &quot;åœ¨å…¬è·¯ä¸Šè¿è¡Œ...&quot;);        &#125;        public void runAir(String vehicle) &#123;            System.out.println(vehicle + &quot;åœ¨å…¬è·¯ä¸Šè¿è¡Œ...&quot;);        &#125;        public void runWater(String vehicle) &#123;            System.out.println(vehicle + &quot;åœ¨æ°´é‡Œè¿è¡Œ...&quot;);        &#125;    &#125;&#125;\næ³¨æ„ç‚¹ï¼š\n\né™ä½ç±»çš„å¤æ‚åº¦ï¼Œä¸€ä¸ªç±»åªè´Ÿè´£å±äºè‡ªå·±çš„èŒè´£\n\næé«˜ç±»çš„å¯è¯»æ€§ï¼Œå¯ç»´æŠ¤æ€§\n\né€šå¸¸æƒ…å†µä¸‹ï¼Œåªæœ‰åœ¨é€»è¾‘è¶³å¤Ÿç®€å•çš„æ—¶å€™æ‰å¯ä»¥è¿åå•ä¸€èŒè´£åŸåˆ™ï¼Œå› ä¸ºè¿‡åº¦è®¾è®¡ä¼šå¯¼è‡´ç‰©æå¿…å\nå¼€é—­åŸåˆ™\nå¼€é—­åŸåˆ™æ˜¯é¢å‘å¯¹è±¡çš„å¯å¤ç”¨è®¾è®¡çš„ç¬¬ä¸€å—åŸºçŸ³ï¼Œå®ƒæ˜¯æœ€é‡è¦çš„é¢å‘å¯¹è±¡è®¾è®¡åŸåˆ™\n\næŠ½è±¡åŒ–æ˜¯å¼€é—­åŸåˆ™çš„å…³é”®\n\n\nhttps://juejin.cn/post/6979029066296852511https://juejin.cn/post/6844904051868434446https://juejin.cn/post/7087483087403089934\n","tags":["åŸºç¡€"]},{"title":"jenkinsä¸‰ç§éƒ¨ç½²æ–¹å¼","url":"/2023/08/31/0.5.1-jenkins%E4%B8%89%E7%A7%8D%E9%83%A8%E7%BD%B2%E6%96%B9%E5%BC%8F/","content":"Jenkins æ˜¯ä¸€æ¬¾å¼€æº CI&amp;CD è½¯ä»¶\næŒç»­é›†æˆ(CI)æŒç»­é›†æˆæ˜¯æŒ‡å¤šåå¼€å‘è¿™åœ¨å¼€å‘ä¸åŒåŠŸèƒ½ä»£ç çš„è¿‡ç¨‹ä¸­ï¼Œå¯ä»¥é¢‘ç¹çš„å°†ä»£ç åˆå¹¶åˆ°ä¸€èµ·å¹¶ä¸”ç›¸äº’ä¸å½±å“å·¥ä½œã€‚æŒç»­é›†æˆæ˜¯åœ¨ç‰ˆæœ¬æ§åˆ¶çš„åŸºç¡€ä¸Šï¼Œé€šè¿‡é¢‘ç¹çš„ä»£ç æäº¤ã€è‡ªåŠ¨åŒ–æ„å»ºå’Œå•å…ƒæµ‹è¯•åŠ å¿«é›†æˆå‘¨æœŸå’Œé—®é¢˜åé¦ˆé€Ÿåº¦ï¼Œä»è€ŒåŠæ—¶éªŒè¯ç³»ç»Ÿå¯ç”¨æ€§ã€‚ä¸ºäº†ä¿è¯åç»­çš„ç³»ç»Ÿè´¨é‡ï¼Œåœ¨æŒç»­é›†æˆè¿‡ç¨‹ä¸­ï¼Œè¿˜ä¼šåŠ å…¥ä»£ç è§„èŒƒæ‰«æã€å®‰å…¨æ¼æ´æ‰«æã€é›†æˆæµ‹è¯•ç­‰æ´»åŠ¨ï¼Œç”¨æ¥ä¿è¯ä»£ç å½¢æˆè¿‡ç¨‹ç¬¦åˆè´¨é‡è¦æ±‚ã€‚æŒç»­é›†æˆçš„é¢‘ç‡è¾¾åˆ°æ¯å¤©å¤šæ¬¡ã€é¢‘ç¹çš„é›†æˆï¼Œå¯ä»¥æå‰å‘ç°é—®é¢˜å°½æ—©è§£å†³å†²çªï¼Œä½¿åç»­çš„æŒç»­é›†æˆæ›´é¡ºç•…ã€‚\næŒç»­éƒ¨ç½²(CD)æŒç»­éƒ¨ç½²æ˜¯åŸºäºæŸç§å·¥å…·æˆ–è€…å¹³å°å®ç°ä»£ç è‡ªåŠ¨åŒ–çš„æ„å»ºã€æµ‹è¯•å’Œéƒ¨ç½²åˆ°çº¿ä¸Šç¯å¢ƒä»¥å®ç°äº¤ä»˜é«˜è´¨é‡çš„äº§å“ï¼ŒæŒç»­éƒ¨ç½²åœ¨æŸç§ç¨‹åº¦ä¸Šä»£è¡¨ä¸€ä¸ªå¼€å‘å›¢é˜Ÿçš„æ›´æ–°è¿­ä»£é€Ÿç‡ã€‚æŒç»­éƒ¨ç½²å¹¶ä¸ç‰¹æŒ‡é€šè¿‡è´¨é‡éªŒè¯çš„åˆ¶å“è‡ªåŠ¨éƒ¨ç½²åˆ°ç”Ÿäº§ç¯å¢ƒçš„ç‰¹å®šç¯èŠ‚ã€‚åœ¨æŒç»­é›†æˆè¿‡ç¨‹ä¸­ä¸æ–­ç”Ÿæˆå¯æ‰§è¡Œçš„åˆ¶å“ï¼Œéœ€è¦å°½å¿«éªŒè¯æ˜¯å¦å­˜åœ¨åŠŸèƒ½æ€§èƒ½ç­‰æ–¹é¢çš„é—®é¢˜ï¼Œæˆ–è€…å°½å¯èƒ½å¿«é€Ÿçš„è®©æœ€ç»ˆç”¨æˆ·å¯ä»¥ä½¿ç”¨è¿™äº›åŠŸèƒ½ã€‚é€šè¿‡æŒç»­éƒ¨ç½²åˆ°æµ‹è¯•ç¯å¢ƒã€å‡†ç”Ÿæˆç¯å¢ƒä¸­ï¼Œå¯ä»¥ä½¿æµ‹è¯•å›¢é˜Ÿå°½å¿«å¼€å§‹æµ‹è¯•ï¼Œå¼€å‘å›¢é˜Ÿè·å¾—å¿«é€Ÿçš„åé¦ˆå¹¶å“åº”ã€‚ä½¿ç ”å‘å’Œæµ‹è¯•çš„ååŒåŠ å¿«äº†è¿›ç¨‹ã€‚é€šè¿‡æŒç»­éƒ¨ç½²åˆ°ç”Ÿäº§ç¯å¢ƒï¼Œè®©æœ€ç»ˆç”¨æˆ·å¯è§ï¼Œåˆ™å¯ä»¥å¿«é€Ÿè·å¾—æœ€ç»ˆç”¨æˆ·çš„ä½¿ç”¨åé¦ˆï¼Œä½“ç°éœ€æ±‚çš„å¸‚åœºä»·å€¼ã€‚\næŒç»­äº¤ä»˜(CO)ä»åœ¨ä¸åŒè§’è‰²çš„è§’åº¦å¯¹äº¤ä»˜è¿›è¡Œè§£è¯»ä¼šæœ‰ä¸åŒå«ä¹‰ã€‚å¯¹äºäº§å“ç ”å‘å›¢é˜Ÿæ¥è¯´ï¼Œäº§å“çš„ç‰ˆæœ¬æ›´æ–°è¿­ä»£å’Œäº¤ä»˜ï¼Œç‰ˆæœ¬é€šè¿‡å„é˜¶æ®µæµ‹è¯•è¾¾åˆ°å¯æä¾›ç»™å®¢æˆ·ä½¿ç”¨çš„çŠ¶æ€å³ä¸ºå¯äº¤ä»˜ã€‚å¯¹äºé¡¹ç›®å®æ–½å›¢é˜Ÿæ¥è¯´ï¼ŒæŒç»­äº¤ä»˜æ˜¯è¦å°†å®¢æˆ·è¦æ±‚å®ç°çš„åŠŸèƒ½éƒ¨ç½²åˆ°å®¢æˆ·çš„ç”Ÿäº§ç¯å¢ƒï¼Œé€šè¿‡éªŒæ”¶å³ä¸ºäº¤ä»˜ã€‚å¯¹äºæœ€ç»ˆç”¨æˆ·æ¥è¯´ï¼ŒæŒç»­äº¤ä»˜æ˜¯æœ€ç»ˆç”¨æˆ·å¯ä»¥ä½¿ç”¨ç›¸å…³çš„åŠŸèƒ½å³ä¸ºäº¤ä»˜ã€‚æŒç»­äº¤ä»˜æ˜¯æŒ‡æŒç»­çš„å°†å„ç±»å˜æ›´ï¼ˆåŒ…æ‹¬æ–°åŠŸèƒ½ã€ç¼ºé™·ä¿®å¤ã€é…ç½®å˜åŒ–ã€å®éªŒç­‰ï¼‰å®‰å…¨ã€å¿«é€Ÿã€é«˜è´¨é‡åœ°è½å®åˆ°ç”Ÿäº§ç¯å¢ƒæˆ–ç”¨æˆ·æ‰‹ä¸­çš„èƒ½åŠ›ã€‚æŒç»­äº¤ä»˜çš„èƒ½åŠ›é€šè¿‡è‡ªåŠ¨åŒ–æµæ°´çº¿çš„æ–¹å¼å®ç°ï¼Œå‡å°‘ç ”å‘è¿‡ç¨‹ä¸­ä¸å¿…è¦çš„æµªè´¹ï¼Œè¿‘è€Œç¼©çŸ­æ•´ä¸ªç ”å‘è¿‡ç¨‹ä¸­æ‰€æœ‰éœ€æ±‚çš„äº¤ä»˜å‘¨æœŸã€‚æŒç»­äº¤ä»˜æ˜¯ä¸€ä¸ªæ•´ä½“è¿‡ç¨‹ï¼Œä»ä¸€ä¸ªä¸šåŠ¡ç«¯çš„æƒ³æ³•åˆ°ç³»ç»ŸåŠŸèƒ½å¯ä»¥é¢å¯¹å®¢æˆ·çš„å…¨æµç¨‹ã€‚\n\n1ã€jenkinsè§¦å‘å¼æ„å»ºï¼šç”¨äºå¼€å‘ç¯å¢ƒéƒ¨ç½²ï¼Œå¼€å‘äººå‘˜pushä»£ç æˆ–è€…åˆå¹¶ä»£ç åˆ°gitlabé¡¹ç›®çš„masteråˆ†æ”¯ï¼Œjenkinså°±éƒ¨ç½²ä»£ç åˆ°å¯¹åº”æœåŠ¡å™¨ã€‚\n2ã€jenkinså‚æ•°åŒ–æ„å»ºï¼šç”¨äºæµ‹è¯•ç¯å¢ƒé¢„ä¸Šçº¿ç¯å¢ƒéƒ¨ç½²ï¼Œå¼€å‘pushä»£ç æˆ–è€…åˆå¹¶ä»£ç åˆ°gitlabé¡¹ç›®çš„masteråˆ†æ”¯ä¹‹åï¼Œå¹¶ä¸ä¼šéƒ¨ç½²ä»£ç ï¼Œè€Œæ˜¯éœ€è¦ç™»å½•åˆ°jenkinsçš„webç•Œé¢ï¼Œç‚¹å‡»æ„å»ºæŒ‰é’®ï¼Œä¼ å…¥å¯¹åº”çš„å‚æ•°ï¼ˆæ¯”å¦‚å‚æ•°éœ€è¦æ„å»ºçš„tagï¼Œéœ€è¦éƒ¨ç½²çš„åˆ†æ”¯ï¼‰ç„¶åæ‰ä¼šéƒ¨ç½²ã€‚\n3ã€jenkinså®šæ—¶æ„å»ºï¼šç”¨äºAPPè‡ªåŠ¨æ‰“åŒ…ï¼Œå®šæ—¶æ„å»ºæ˜¯åœ¨å‚æ•°åŒ–æ„å»ºçš„åŸºç¡€ä¸Šæ·»åŠ çš„ï¼Œå¼€å‘äººå‘˜å¯ä»¥ç™»å½•jenkinsæ‰‹åŠ¨ä¼ å…¥tagè¿›è¡Œæ‰“åŒ…ï¼Œå¦‚æœä¸æ‰‹åŠ¨æ‰“åŒ…ï¼Œé‚£ä¹ˆjenkinså°±æ¯å¤©å‡Œæ™¨ä»gitlabæ‹‰å–æœ€æ–°çš„APPä»£ç æ‰“åŒ…ã€‚\n","tags":["DevOps"]},{"title":"LangChain4jæ‰“é€ è‡ªå·±çš„LLMåº”ç”¨","url":"/2025/01/15/0.5.2-LangChain4j%E6%89%93%E9%80%A0%E8%87%AA%E5%B7%B1%E7%9A%84LLM%E5%BA%94%E7%94%A8/","content":"\nLangChain4jæ˜¯Javaç”Ÿæ€ä¸­å¼ºå¤§çš„æ¡†æ¶ï¼Œå¸®åŠ©å¼€å‘è€…å¿«é€Ÿæ„å»ºåŸºäºå¤§è¯­è¨€æ¨¡å‹çš„åº”ç”¨ã€‚æœ¬æ–‡å°†å¸¦ä½ ä»é›¶å¼€å§‹ï¼ŒæŒæ¡LangChain4jçš„æ ¸å¿ƒæ¦‚å¿µå’ŒSpring Booté›†æˆæŠ€å·§ï¼Œæ‰“é€ å±äºè‡ªå·±çš„AIåº”ç”¨ã€‚\n\nLangChain4jç®€ä»‹LangChain4jæ˜¯ä¸€ä¸ªå¼€æºæ¡†æ¶ï¼Œä¸“é—¨ä¸ºJavaå¼€å‘è€…è®¾è®¡ï¼Œç”¨äºå¼€å‘åŸºäºå¤§è¯­è¨€æ¨¡å‹çš„åº”ç”¨ç¨‹åºã€‚å®ƒæä¾›äº†ä¸€å¥—å®Œæ•´çš„å·¥å…·é“¾ï¼ŒåŒ…æ‹¬æ¨¡å‹é›†æˆã€æç¤ºå·¥ç¨‹ã€é“¾å¼è°ƒç”¨ã€è®°å¿†ç®¡ç†ã€ä»£ç†ç³»ç»Ÿç­‰æ ¸å¿ƒç»„ä»¶ï¼Œå¹¶ä¸Spring Bootç­‰Javaç”Ÿæ€å®Œç¾é›†æˆã€‚\nä¸ºä»€ä¹ˆé€‰æ‹©LangChain4jï¼Ÿ\nJavaåŸç”Ÿæ”¯æŒï¼šä¸“ä¸ºJavaç”Ÿæ€è®¾è®¡ï¼Œä¸Spring Bootå®Œç¾é›†æˆ\nç±»å‹å®‰å…¨ï¼šåˆ©ç”¨Javaçš„ç±»å‹ç³»ç»Ÿï¼Œæä¾›æ›´å¥½çš„å¼€å‘ä½“éªŒ\nç®€åŒ–å¼€å‘æµç¨‹ï¼šæä¾›æ ‡å‡†åŒ–ç»„ä»¶ï¼Œå‡å°‘é‡å¤ä»£ç \næ¨¡å‹æ— å…³æ€§ï¼šæ”¯æŒå¤šç§LLMï¼Œå¦‚OpenAIã€Anthropicã€Hugging Faceç­‰\nå¯æ‰©å±•æ€§ï¼šæ¨¡å—åŒ–è®¾è®¡ï¼Œæ˜“äºå®šåˆ¶å’Œæ‰©å±•\nç”Ÿäº§å°±ç»ªï¼šå†…ç½®é”™è¯¯å¤„ç†ã€æ—¥å¿—è®°å½•ç­‰ä¼ä¸šçº§åŠŸèƒ½\nç¤¾åŒºæ´»è·ƒï¼šæ‹¥æœ‰å®Œå–„çš„æ–‡æ¡£å’Œæ´»è·ƒçš„å¼€æºç¤¾åŒº\n\næ ¸å¿ƒç»„ä»¶è¯¦è§£1. Modelsï¼ˆæ¨¡å‹ï¼‰LangChain4jæ”¯æŒå¤šç§ç±»å‹çš„æ¨¡å‹ï¼ŒåŒ…æ‹¬å¤§è¯­è¨€æ¨¡å‹ã€èŠå¤©æ¨¡å‹å’Œæ–‡æœ¬åµŒå…¥æ¨¡å‹ã€‚\nimport dev.langchain4j.model.openai.OpenAiChatModel;import dev.langchain4j.model.openai.OpenAiEmbeddingModel;import dev.langchain4j.model.openai.OpenAiTokenizer;// èŠå¤©æ¨¡å‹OpenAiChatModel chatModel = OpenAiChatModel.builder()    .apiKey(&quot;your-openai-api-key&quot;)    .modelName(&quot;gpt-3.5-turbo&quot;)    .temperature(0.3)    .maxTokens(1000)    .build();// åµŒå…¥æ¨¡å‹OpenAiEmbeddingModel embeddingModel = OpenAiEmbeddingModel.builder()    .apiKey(&quot;your-openai-api-key&quot;)    .modelName(&quot;text-embedding-ada-002&quot;)    .build();// åˆ†è¯å™¨OpenAiTokenizer tokenizer = new OpenAiTokenizer(&quot;gpt-3.5-turbo&quot;);\n\n2. Promptsï¼ˆæç¤ºè¯ï¼‰æç¤ºè¯æ˜¯ä¸è¯­è¨€æ¨¡å‹äº¤äº’çš„æ ¸å¿ƒï¼ŒLangChain4jæä¾›äº†ä¸°å¯Œçš„æç¤ºè¯ç®¡ç†åŠŸèƒ½ã€‚\nimport dev.langchain4j.model.input.Prompt;import dev.langchain4j.model.input.PromptTemplate;import java.util.Map;// åŸºç¡€æç¤ºè¯æ¨¡æ¿String template = &quot;&quot;&quot;ä½ æ˜¯ä¸€ä¸ªä¸“ä¸šçš„&#123;&#123;role&#125;&#125;ï¼Œè¯·å›ç­”ä»¥ä¸‹é—®é¢˜ï¼š&#123;&#123;question&#125;&#125;è¯·ç”¨&#123;&#123;language&#125;&#125;å›ç­”ã€‚&quot;&quot;&quot;;PromptTemplate promptTemplate = PromptTemplate.from(template);// ä½¿ç”¨æç¤ºè¯Map&lt;String, Object&gt; variables = Map.of(    &quot;role&quot;, &quot;æŠ€æœ¯ä¸“å®¶&quot;,    &quot;question&quot;, &quot;ä»€ä¹ˆæ˜¯å¾®æœåŠ¡æ¶æ„ï¼Ÿ&quot;,    &quot;language&quot;, &quot;ä¸­æ–‡&quot;);Prompt prompt = promptTemplate.apply(variables);// ç›´æ¥åˆ›å»ºæç¤ºè¯Prompt directPrompt = Prompt.from(&quot;&quot;&quot;ä½ æ˜¯ä¸€ä¸ªä¸“ä¸šçš„æŠ€æœ¯ä¸“å®¶ï¼Œè¯·è¯¦ç»†è§£é‡Šä»€ä¹ˆæ˜¯å¾®æœåŠ¡æ¶æ„ã€‚è¯·ä»ä»¥ä¸‹å‡ ä¸ªæ–¹é¢è¿›è¡Œè¯´æ˜ï¼š1. åŸºæœ¬æ¦‚å¿µ2. ä¸å•ä½“æ¶æ„çš„åŒºåˆ«3. ä¸»è¦ä¼˜åŠ¿å’ŒæŒ‘æˆ˜4. å®é™…åº”ç”¨åœºæ™¯&quot;&quot;&quot;);\n\n3. Chainsï¼ˆé“¾ï¼‰åœ¨LangChain4jä¸­ï¼Œé“¾å¼è°ƒç”¨é€šè¿‡æ–¹æ³•ç»„åˆå’Œç®¡é“æ¨¡å¼æ¥å®ç°å¤æ‚çš„å¤„ç†æµç¨‹ã€‚\nimport dev.langchain4j.chain.ConversationalRetrievalChain;import dev.langchain4j.data.message.AiMessage;import dev.langchain4j.data.message.UserMessage;import dev.langchain4j.memory.chat.ChatMemory;import dev.langchain4j.memory.chat.MessageWindowChatMemory;import dev.langchain4j.retriever.EmbeddingStoreRetriever;import dev.langchain4j.store.embedding.EmbeddingStore;import java.util.function.Function;// åˆ›å»ºå¯¹è¯é“¾ChatMemory chatMemory = MessageWindowChatMemory.withMaxMessages(10);ConversationalRetrievalChain chain = ConversationalRetrievalChain.builder()    .chatLanguageModel(chatModel)    .retriever(retriever)    .chatMemory(chatMemory)    .build();// ä½¿ç”¨é“¾è¿›è¡Œå¯¹è¯String question = &quot;ä»€ä¹ˆæ˜¯å¾®æœåŠ¡æ¶æ„ï¼Ÿ&quot;;AiMessage answer = chain.execute(question);// è‡ªå®šä¹‰é“¾å¼å¤„ç†Function&lt;String, String&gt; processingChain = input -&gt; &#123;    // ç¬¬ä¸€æ­¥ï¼šé¢„å¤„ç†è¾“å…¥    String processedInput = preprocess(input);    // ç¬¬äºŒæ­¥ï¼šè°ƒç”¨AIæ¨¡å‹    AiMessage response = chatModel.generate(        UserMessage.from(processedInput)    );    // ç¬¬ä¸‰æ­¥ï¼šåå¤„ç†è¾“å‡º    return postprocess(response.text());&#125;;// æ‰§è¡Œé“¾å¼å¤„ç†String result = processingChain.apply(&quot;åŸå§‹è¾“å…¥&quot;);\n\n4. Memoryï¼ˆè®°å¿†ï¼‰è®°å¿†ç»„ä»¶è®©LLMèƒ½å¤Ÿè®°ä½ä¹‹å‰çš„å¯¹è¯å†å²ï¼Œæä¾›æ›´è¿è´¯çš„äº¤äº’ä½“éªŒã€‚\nimport dev.langchain4j.memory.chat.ChatMemory;import dev.langchain4j.memory.chat.MessageWindowChatMemory;import dev.langchain4j.memory.chat.TokenWindowChatMemory;import dev.langchain4j.data.message.ChatMessage;import dev.langchain4j.data.message.UserMessage;import dev.langchain4j.data.message.AiMessage;// åŸºäºæ¶ˆæ¯çª—å£çš„è®°å¿†ChatMemory messageWindowMemory = MessageWindowChatMemory.withMaxMessages(10);// åŸºäºTokençª—å£çš„è®°å¿†ChatMemory tokenWindowMemory = TokenWindowChatMemory.withMaxTokens(1000, tokenizer);// å¯¹è¯æœåŠ¡ç±»public class ConversationalService &#123;    private final OpenAiChatModel chatModel;    private final ChatMemory chatMemory;    public ConversationalService(OpenAiChatModel chatModel, ChatMemory chatMemory) &#123;        this.chatModel = chatModel;        this.chatMemory = chatMemory;    &#125;    public String chat(String userMessage) &#123;        // æ·»åŠ ç”¨æˆ·æ¶ˆæ¯åˆ°è®°å¿†        chatMemory.add(UserMessage.from(userMessage));        // è·å–å¯¹è¯å†å²        String conversationHistory = chatMemory.messages().stream()            .map(ChatMessage::text)            .collect(Collectors.joining(&quot;\\n&quot;));        // æ„å»ºå®Œæ•´æç¤ºè¯        Prompt prompt = Prompt.from(            &quot;åŸºäºä»¥ä¸‹å¯¹è¯å†å²å›ç­”ç”¨æˆ·çš„é—®é¢˜ï¼š\\n&quot; +            conversationHistory + &quot;\\n&quot; +            &quot;ç”¨æˆ·é—®é¢˜ï¼š&quot; + userMessage + &quot;\\n&quot; +            &quot;è¯·æä¾›å‡†ç¡®ã€è¯¦ç»†çš„å›ç­”ï¼š&quot;        );        // è°ƒç”¨AIæ¨¡å‹        AiMessage aiResponse = chatModel.generate(prompt.toUserMessage());        // æ·»åŠ AIå›å¤åˆ°è®°å¿†        chatMemory.add(aiResponse);        return aiResponse.text();    &#125;&#125;// ä½¿ç”¨ç¤ºä¾‹MessageWindowChatMemory memory = MessageWindowChatMemory.withMaxMessages(20);ConversationalService service = new ConversationalService(chatModel, memory);String response1 = service.chat(&quot;ä½ å¥½ï¼Œæˆ‘å«å°æ˜&quot;);String response2 = service.chat(&quot;æˆ‘åˆšæ‰è¯´ä»€ä¹ˆåå­—äº†ï¼Ÿ&quot;);\n\n5. Agentsï¼ˆä»£ç†ï¼‰åœ¨LangChain4jä¸­ï¼Œä»£ç†åŠŸèƒ½é€šè¿‡Toolæ¥å£å’ŒAiServicesæ¥å®ç°ï¼Œè®©LLMèƒ½å¤Ÿè‡ªä¸»é€‰æ‹©å·¥å…·å¹¶æ‰§è¡Œä»»åŠ¡ã€‚\nimport dev.langchain4j.agent.tool.Tool;import dev.langchain4j.agent.tool.ToolSpecification;import dev.langchain4j.service.AiServices;import dev.langchain4j.service.Result;// å®šä¹‰å·¥å…·ç±»public class SearchTools &#123;    @Tool(&quot;æœç´¢äº’è”ç½‘ä¿¡æ¯&quot;)    public String searchWeb(String query) &#123;        // è¿™é‡Œå®ç°å…·ä½“çš„æœç´¢é€»è¾‘        // ä¾‹å¦‚è°ƒç”¨æœç´¢å¼•æ“API        return &quot;æœç´¢ç»“æœï¼šæ ¹æ®æŸ¥è¯¢ &#x27;&quot; + query + &quot;&#x27; æ‰¾åˆ°çš„ç›¸å…³ä¿¡æ¯...&quot;;    &#125;    @Tool(&quot;è®¡ç®—æ•°å­¦è¡¨è¾¾å¼&quot;)    public double calculate(String expression) &#123;        // è¿™é‡Œå®ç°æ•°å­¦è®¡ç®—é€»è¾‘        // å¯ä»¥ä½¿ç”¨JavaScriptå¼•æ“æˆ–ç¬¬ä¸‰æ–¹åº“        try &#123;            // ç®€åŒ–å®ç°ï¼Œå®é™…åº”è¯¥ä½¿ç”¨æ›´å®‰å…¨çš„è®¡ç®—æ–¹å¼            return Double.parseDouble(expression);        &#125; catch (Exception e) &#123;            return 0.0;        &#125;    &#125;    @Tool(&quot;è·å–å½“å‰æ—¶é—´&quot;)    public String getCurrentTime() &#123;        return LocalDateTime.now().toString();    &#125;&#125;// å®šä¹‰AIæœåŠ¡æ¥å£interface IntelligentAssistant &#123;    @dev.langchain4j.service.UserMessage(&quot;è¯·å¸®æˆ‘å¤„ç†ä»¥ä¸‹è¯·æ±‚ï¼š&#123;&#123;request&#125;&#125;&quot;)    Result&lt;String&gt; processRequest(String request);&#125;// åˆ›å»ºå¸¦å·¥å…·çš„AIæœåŠ¡IntelligentAssistant assistant = AiServices.builder(IntelligentAssistant.class)    .chatLanguageModel(chatModel)    .tools(new SearchTools())    .build();// ä½¿ç”¨ä»£ç†Result&lt;String&gt; result = assistant.processRequest(&quot;2024å¹´æœ€æ–°çš„AIæŠ€æœ¯æœ‰å“ªäº›ï¼Ÿ&quot;);String answer = result.content();// è‡ªå®šä¹‰å·¥å…·æ‰§è¡Œå™¨public class CustomToolExecutor &#123;    private final OpenAiChatModel chatModel;    private final List&lt;ToolSpecification&gt; tools;    public CustomToolExecutor(OpenAiChatModel chatModel, List&lt;ToolSpecification&gt; tools) &#123;        this.chatModel = chatModel;        this.tools = tools;    &#125;    public String executeWithTools(String userQuery) &#123;        // æ„å»ºåŒ…å«å·¥å…·ä¿¡æ¯çš„æç¤ºè¯        StringBuilder prompt = new StringBuilder();        prompt.append(&quot;ä½ æ˜¯ä¸€ä¸ªæ™ºèƒ½åŠ©æ‰‹ï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹å·¥å…·æ¥å¸®åŠ©ç”¨æˆ·ï¼š\\n\\n&quot;);        for (ToolSpecification tool : tools) &#123;            prompt.append(String.format(&quot;- %s: %s\\n&quot;,                tool.name(), tool.description()));        &#125;        prompt.append(String.format(&quot;\\nç”¨æˆ·æŸ¥è¯¢ï¼š%s\\n&quot;, userQuery));        prompt.append(&quot;è¯·æ ¹æ®ç”¨æˆ·æŸ¥è¯¢é€‰æ‹©åˆé€‚çš„å·¥å…·æ¥å›ç­”é—®é¢˜ã€‚&quot;);        // è°ƒç”¨AIæ¨¡å‹        AiMessage response = chatModel.generate(UserMessage.from(prompt.toString()));        return response.text();    &#125;&#125;\n\nå®æˆ˜æ¡ˆä¾‹ï¼šæ™ºèƒ½é—®ç­”ç³»ç»Ÿè®©æˆ‘ä»¬é€šè¿‡ä¸€ä¸ªå®Œæ•´çš„Spring Booté¡¹ç›®æ¥å±•ç¤ºå¦‚ä½•ä½¿ç”¨LangChain4jæ„å»ºæ™ºèƒ½é—®ç­”ç³»ç»Ÿã€‚\né¡¹ç›®ç»“æ„llm-qa-system/â”œâ”€â”€ src/main/java/com/example/qa/â”‚   â”œâ”€â”€ config/                    # é…ç½®ç±»â”‚   â”‚   â”œâ”€â”€ AiConfig.java         # AIæ¨¡å‹é…ç½®â”‚   â”‚   â””â”€â”€ AppConfig.java        # åº”ç”¨é…ç½®â”‚   â”œâ”€â”€ controller/               # æ§åˆ¶å™¨â”‚   â”‚   â””â”€â”€ QaController.java     # é—®ç­”æ¥å£â”‚   â”œâ”€â”€ service/                  # ä¸šåŠ¡æœåŠ¡â”‚   â”‚   â”œâ”€â”€ QaService.java        # é—®ç­”æœåŠ¡â”‚   â”‚   â”œâ”€â”€ PromptService.java    # æç¤ºè¯æœåŠ¡â”‚   â”‚   â””â”€â”€ MemoryService.java    # è®°å¿†æœåŠ¡â”‚   â”œâ”€â”€ model/                    # æ•°æ®æ¨¡å‹â”‚   â”‚   â”œâ”€â”€ QaRequest.java        # è¯·æ±‚æ¨¡å‹â”‚   â”‚   â””â”€â”€ QaResponse.java       # å“åº”æ¨¡å‹â”‚   â””â”€â”€ util/                     # å·¥å…·ç±»â”‚       â””â”€â”€ PromptTemplates.java  # æç¤ºè¯æ¨¡æ¿â”œâ”€â”€ src/main/resources/â”‚   â”œâ”€â”€ application.yml           # åº”ç”¨é…ç½®â”‚   â””â”€â”€ templates/                # æç¤ºè¯æ¨¡æ¿â””â”€â”€ pom.xml                       # Mavenä¾èµ–\n\nMavenä¾èµ–é…ç½®&lt;!-- pom.xml --&gt;&lt;dependencies&gt;    &lt;!-- Spring Boot --&gt;    &lt;dependency&gt;        &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;        &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt;    &lt;/dependency&gt;    &lt;!-- LangChain4j --&gt;    &lt;dependency&gt;        &lt;groupId&gt;dev.langchain4j&lt;/groupId&gt;        &lt;artifactId&gt;langchain4j-open-ai-spring-boot-starter&lt;/artifactId&gt;        &lt;version&gt;0.25.0&lt;/version&gt;    &lt;/dependency&gt;    &lt;!-- å…¶ä»–ä¾èµ– --&gt;    &lt;dependency&gt;        &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;        &lt;artifactId&gt;spring-boot-starter-validation&lt;/artifactId&gt;    &lt;/dependency&gt;    &lt;dependency&gt;        &lt;groupId&gt;org.projectlombok&lt;/groupId&gt;        &lt;artifactId&gt;lombok&lt;/artifactId&gt;        &lt;optional&gt;true&lt;/optional&gt;    &lt;/dependency&gt;&lt;/dependencies&gt;\n\næ ¸å¿ƒé…ç½®ç±»// src/main/java/com/example/qa/config/AiConfig.java@Configurationpublic class AiConfig &#123;    @Value(&quot;$&#123;openai.api-key&#125;&quot;)    private String openAiApiKey;    @Bean    public OpenAiChatModel chatModel() &#123;        return OpenAiChatModel.builder()            .apiKey(openAiApiKey)            .modelName(&quot;gpt-3.5-turbo&quot;)            .temperature(0.3)            .maxTokens(1000)            .build();    &#125;    @Bean    public ChatMemory chatMemory() &#123;        return MessageWindowChatMemory.withMaxMessages(20);    &#125;&#125;\n\næ•°æ®æ¨¡å‹// src/main/java/com/example/qa/model/QaRequest.java@Data@NoArgsConstructor@AllArgsConstructorpublic class QaRequest &#123;    @NotBlank(message = &quot;é—®é¢˜ä¸èƒ½ä¸ºç©º&quot;)    private String question;    private String sessionId;    @Builder.Default    private String role = &quot;æŠ€æœ¯ä¸“å®¶&quot;;&#125;// src/main/java/com/example/qa/model/QaResponse.java@Data@NoArgsConstructor@AllArgsConstructor@Builderpublic class QaResponse &#123;    private String answer;    private String sessionId;    private long timestamp;    private boolean success;    private String errorMessage;&#125;\n\næ ¸å¿ƒæœåŠ¡ç±»// src/main/java/com/example/qa/service/QaService.java@Service@Slf4jpublic class QaService &#123;    private final OpenAiChatModel chatModel;    private final PromptService promptService;    private final MemoryService memoryService;    public QaService(OpenAiChatModel chatModel,                    PromptService promptService,                    MemoryService memoryService) &#123;        this.chatModel = chatModel;        this.promptService = promptService;        this.memoryService = memoryService;    &#125;    public QaResponse askQuestion(QaRequest request) &#123;        try &#123;            // è·å–æˆ–åˆ›å»ºä¼šè¯è®°å¿†            ChatMemory memory = memoryService.getMemory(request.getSessionId());            // æ·»åŠ ç”¨æˆ·æ¶ˆæ¯åˆ°è®°å¿†            memory.add(UserMessage.from(request.getQuestion()));            // ç”Ÿæˆæç¤ºè¯            Prompt prompt = promptService.generateQaPrompt(request, memory);            // è°ƒç”¨AIæ¨¡å‹            AiMessage aiResponse = chatModel.generate(prompt.toUserMessage());            // æ·»åŠ AIå›å¤åˆ°è®°å¿†            memory.add(aiResponse);            return QaResponse.builder()                .answer(aiResponse.text())                .sessionId(request.getSessionId())                .timestamp(System.currentTimeMillis())                .success(true)                .build();        &#125; catch (Exception e) &#123;            log.error(&quot;å¤„ç†é—®ç­”è¯·æ±‚å¤±è´¥&quot;, e);            return QaResponse.builder()                .success(false)                .errorMessage(&quot;å¤„ç†é—®é¢˜æ—¶å‡ºç°é”™è¯¯ï¼š&quot; + e.getMessage())                .timestamp(System.currentTimeMillis())                .build();        &#125;    &#125;&#125;\n\næç¤ºè¯æœåŠ¡// src/main/java/com/example/qa/service/PromptService.java@Servicepublic class PromptService &#123;    public Prompt generateQaPrompt(QaRequest request, ChatMemory memory) &#123;        // è·å–å¯¹è¯å†å²        String conversationHistory = memory.messages().stream()            .map(ChatMessage::text)            .collect(Collectors.joining(&quot;\\n&quot;));        String template = &quot;&quot;&quot;            ä½ æ˜¯ä¸€ä¸ªä¸“ä¸šçš„&#123;role&#125;ï¼Œè¯·åŸºäºä»¥ä¸‹å¯¹è¯å†å²å›ç­”ç”¨æˆ·çš„é—®é¢˜ã€‚            å¯¹è¯å†å²ï¼š            &#123;history&#125;            å½“å‰é—®é¢˜ï¼š&#123;question&#125;            å›ç­”è¦æ±‚ï¼š            1. å†…å®¹å‡†ç¡®ï¼ŒåŸºäºå¯é çš„æŠ€æœ¯çŸ¥è¯†            2. ç»“æ„æ¸…æ™°ï¼Œé€»è¾‘æ€§å¼º            3. é€‚å½“ä½¿ç”¨ä»£ç ç¤ºä¾‹è¯´æ˜            4. è¯­è¨€ç®€æ´æ˜äº†ï¼Œé¿å…åºŸè¯            5. å¦‚æœæ˜¯æŠ€æœ¯é—®é¢˜ï¼Œæä¾›å…·ä½“å¯è¡Œçš„è§£å†³æ–¹æ¡ˆ            &quot;&quot;&quot;;        Map&lt;String, Object&gt; variables = Map.of(            &quot;role&quot;, request.getRole(),            &quot;history&quot;, conversationHistory,            &quot;question&quot;, request.getQuestion()        );        PromptTemplate promptTemplate = PromptTemplate.from(template);        return promptTemplate.apply(variables);    &#125;&#125;\n\nè®°å¿†ç®¡ç†æœåŠ¡// src/main/java/com/example/qa/service/MemoryService.java@Servicepublic class MemoryService &#123;    private final ConcurrentHashMap&lt;String, ChatMemory&gt; memoryStore = new ConcurrentHashMap&lt;&gt;();    public ChatMemory getMemory(String sessionId) &#123;        if (sessionId == null || sessionId.trim().isEmpty()) &#123;            sessionId = generateSessionId();        &#125;        return memoryStore.computeIfAbsent(sessionId, k -&gt;            MessageWindowChatMemory.withMaxMessages(20));    &#125;    public void clearMemory(String sessionId) &#123;        if (sessionId != null) &#123;            memoryStore.remove(sessionId);        &#125;    &#125;    public Set&lt;String&gt; getActiveSessions() &#123;        return new HashSet&lt;&gt;(memoryStore.keySet());    &#125;    private String generateSessionId() &#123;        return UUID.randomUUID().toString();    &#125;&#125;\n\nRESTæ§åˆ¶å™¨// src/main/java/com/example/qa/controller/QaController.java@RestController@RequestMapping(&quot;/api/qa&quot;)@RequiredArgsConstructor@Slf4jpublic class QaController &#123;    private final QaService qaService;    private final MemoryService memoryService;    @PostMapping(&quot;/ask&quot;)    public ResponseEntity&lt;QaResponse&gt; askQuestion(@Valid @RequestBody QaRequest request) &#123;        log.info(&quot;æ”¶åˆ°é—®ç­”è¯·æ±‚ï¼š&#123;&#125;&quot;, request.getQuestion());        QaResponse response = qaService.askQuestion(request);        return response.isSuccess()            ? ResponseEntity.ok(response)            : ResponseEntity.badRequest().body(response);    &#125;    @PostMapping(&quot;/sessions/&#123;sessionId&#125;/clear&quot;)    public ResponseEntity&lt;Void&gt; clearSession(@PathVariable String sessionId) &#123;        memoryService.clearMemory(sessionId);        return ResponseEntity.ok().build();    &#125;    @GetMapping(&quot;/sessions&quot;)    public ResponseEntity&lt;Set&lt;String&gt;&gt; getActiveSessions() &#123;        return ResponseEntity.ok(memoryService.getActiveSessions());    &#125;&#125;\n\né«˜çº§åŠŸèƒ½æ‰©å±•// æ·»åŠ æ–‡æ¡£é—®ç­”åŠŸèƒ½import dev.langchain4j.data.document.Document;import dev.langchain4j.data.document.loader.FileSystemDocumentLoader;import dev.langchain4j.data.document.splitter.DocumentSplitters;import dev.langchain4j.store.embedding.EmbeddingStore;import dev.langchain4j.store.embedding.inmemory.InMemoryEmbeddingStore;import dev.langchain4j.retriever.EmbeddingStoreRetriever;@Servicepublic class DocumentQaService &#123;    private final OpenAiChatModel chatModel;    private final OpenAiEmbeddingModel embeddingModel;    private final EmbeddingStoreRetriever retriever;    public DocumentQaService(OpenAiChatModel chatModel,                           OpenAiEmbeddingModel embeddingModel) &#123;        this.chatModel = chatModel;        this.embeddingModel = embeddingModel;        // åˆå§‹åŒ–å‘é‡å­˜å‚¨å’Œæ£€ç´¢å™¨        this.retriever = initializeRetriever();    &#125;    private EmbeddingStoreRetriever initializeRetriever() &#123;        // åŠ è½½æ–‡æ¡£        List&lt;Document&gt; documents = FileSystemDocumentLoader.loadDocuments(            Paths.get(&quot;src/main/resources/docs&quot;),            new TextDocumentParser()        );        // åˆ†å‰²æ–‡æ¡£        List&lt;TextSegment&gt; segments = DocumentSplitters.recursive(300, 0)            .split(documents);        // åˆ›å»ºåµŒå…¥å¹¶å­˜å‚¨        EmbeddingStore&lt;TextSegment&gt; embeddingStore = new InMemoryEmbeddingStore&lt;&gt;();        List&lt;Embedding&gt; embeddings = embeddingModel.embedAll(segments).content();        for (int i = 0; i &lt; segments.size(); i++) &#123;            embeddingStore.add(segments.get(i), embeddings.get(i));        &#125;        // åˆ›å»ºæ£€ç´¢å™¨        return EmbeddingStoreRetriever.from(embeddingStore, embeddingModel, 5);    &#125;    public String askDocument(String question) &#123;        // æ£€ç´¢ç›¸å…³æ–‡æ¡£ç‰‡æ®µ        List&lt;TextSegment&gt; relevantSegments = retriever.findRelevant(question);        // æ„å»ºä¸Šä¸‹æ–‡        StringBuilder context = new StringBuilder();        context.append(&quot;åŸºäºä»¥ä¸‹æ–‡æ¡£å†…å®¹å›ç­”é—®é¢˜ï¼š\\n\\n&quot;);        for (TextSegment segment : relevantSegments) &#123;            context.append(segment.text()).append(&quot;\\n\\n&quot;);        &#125;        context.append(&quot;é—®é¢˜ï¼š&quot;).append(question);        // è°ƒç”¨AIæ¨¡å‹        AiMessage response = chatModel.generate(UserMessage.from(context.toString()));        return response.text();    &#125;&#125;\n\néƒ¨ç½²å’Œä¼˜åŒ–ç¯å¢ƒé…ç½®# application.ymlspring:  application:    name: llm-qa-system  profiles:    active: devserver:  port: 8080openai:  api-key: $&#123;OPENAI_API_KEY:your-api-key-here&#125;  model: gpt-3.5-turbo  temperature: 0.3  max-tokens: 1000logging:  level:    com.example.qa: DEBUG\n\n# docker-compose.ymlversion: &#x27;3.8&#x27;services:  llm-qa-app:    build: .    ports:      - &quot;8080:8080&quot;    environment:      - SPRING_PROFILES_ACTIVE=prod      - OPENAI_API_KEY=$&#123;OPENAI_API_KEY&#125;    volumes:      - ./logs:/app/logs    restart: unless-stopped\n\n# DockerfileFROM openjdk:17-jdk-slimWORKDIR /app# å¤åˆ¶Mavenæ„å»ºäº§ç‰©COPY target/*.jar app.jar# åˆ›å»ºérootç”¨æˆ·RUN groupadd -r appuser &amp;&amp; useradd -r -g appuser appuserUSER appuserEXPOSE 8080CMD [&quot;java&quot;, &quot;-jar&quot;, &quot;app.jar&quot;]\n\næ€§èƒ½ä¼˜åŒ–ç­–ç•¥\nç¼“å­˜æœºåˆ¶ï¼š\nimport com.github.benmanes.caffeine.cache.Cache;import com.github.benmanes.caffeine.cache.Caffeine;import java.time.Duration;@Servicepublic class AiCacheService &#123;    private final Cache&lt;String, String&gt; responseCache;    public AiCacheService() &#123;        this.responseCache = Caffeine.newBuilder()            .maximumSize(1000)            .expireAfterWrite(Duration.ofHours(1))            .build();    &#125;    public String getCachedResponse(String question) &#123;        return responseCache.getIfPresent(question);    &#125;    public void cacheResponse(String question, String response) &#123;        responseCache.put(question, response);    &#125;    public String getOrCompute(String question, Function&lt;String, String&gt; supplier) &#123;        return responseCache.get(question, supplier);    &#125;&#125;\nå¼‚æ­¥å¤„ç†ï¼š\nimport org.springframework.scheduling.annotation.Async;import org.springframework.stereotype.Service;import java.util.concurrent.CompletableFuture;@Servicepublic class AsyncAiService &#123;    private final OpenAiChatModel chatModel;    public AsyncAiService(OpenAiChatModel chatModel) &#123;        this.chatModel = chatModel;    &#125;    @Async    public CompletableFuture&lt;String&gt; asyncQuery(String question) &#123;        try &#123;            AiMessage response = chatModel.generate(UserMessage.from(question));            return CompletableFuture.completedFuture(response.text());        &#125; catch (Exception e) &#123;            return CompletableFuture.failedFuture(e);        &#125;    &#125;    // å¹¶å‘å¤„ç†å¤šä¸ªæŸ¥è¯¢    public CompletableFuture&lt;List&lt;String&gt;&gt; batchQueries(List&lt;String&gt; questions) &#123;        List&lt;CompletableFuture&lt;String&gt;&gt; futures = questions.stream()            .map(this::asyncQuery)            .collect(Collectors.toList());        return CompletableFuture.allOf(futures.toArray(new CompletableFuture[0]))            .thenApply(v -&gt; futures.stream()                .map(CompletableFuture::join)                .collect(Collectors.toList()));    &#125;&#125;\næµå¼å“åº”ï¼š\nimport reactor.core.publisher.Flux;import dev.langchain4j.model.StreamingResponseHandler;import dev.langchain4j.model.response.AiMessage;@RestControllerpublic class StreamingController &#123;    private final OpenAiStreamingChatModel streamingChatModel;    public StreamingController(OpenAiStreamingChatModel streamingChatModel) &#123;        this.streamingChatModel = streamingChatModel;    &#125;    @GetMapping(value = &quot;/chat/stream&quot;, produces = MediaType.TEXT_EVENT_STREAM_VALUE)    public Flux&lt;String&gt; streamChat(@RequestParam String message) &#123;        return Flux.create(sink -&gt; &#123;            streamingChatModel.generate(                UserMessage.from(message),                new StreamingResponseHandler&lt;AiMessage&gt;() &#123;                    @Override                    public void onNext(String token) &#123;                        sink.next(token);                    &#125;                    @Override                    public void onComplete(Response&lt;AiMessage&gt; response) &#123;                        sink.complete();                    &#125;                    @Override                    public void onError(Throwable error) &#123;                        sink.error(error);                    &#125;                &#125;            );        &#125;);    &#125;&#125;\n\næœ€ä½³å®è·µ1. é”™è¯¯å¤„ç†import io.github.resilience4j.retry.annotation.Retry;import io.github.resilience4j.circuitbreaker.annotation.CircuitBreaker;import org.springframework.stereotype.Service;@Servicepublic class ResilientAiService &#123;    private final OpenAiChatModel chatModel;    public ResilientAiService(OpenAiChatModel chatModel) &#123;        this.chatModel = chatModel;    &#125;    @Retry(name = &quot;ai-service&quot;, fallbackMethod = &quot;fallbackQuery&quot;)    @CircuitBreaker(name = &quot;ai-service&quot;, fallbackMethod = &quot;fallbackQuery&quot;)    public String robustQuery(String question) &#123;        AiMessage response = chatModel.generate(UserMessage.from(question));        return response.text();    &#125;    public String fallbackQuery(String question, Throwable t) &#123;        log.error(&quot;AIæœåŠ¡è°ƒç”¨å¤±è´¥ï¼Œä½¿ç”¨é™çº§æ–¹æ¡ˆ&quot;, t);        return &quot;æŠ±æ­‰ï¼ŒAIæœåŠ¡æš‚æ—¶ä¸å¯ç”¨ï¼Œè¯·ç¨åå†è¯•ã€‚&quot;;    &#125;&#125;\n\n2. æ—¥å¿—è®°å½•import org.slf4j.Logger;import org.slf4j.LoggerFactory;import org.springframework.stereotype.Service;@Service@Slf4jpublic class LoggingAiService &#123;    private final OpenAiChatModel chatModel;    public LoggingAiService(OpenAiChatModel chatModel) &#123;        this.chatModel = chatModel;    &#125;    public String queryWithLogging(String question, String userId) &#123;        long startTime = System.currentTimeMillis();        try &#123;            log.info(&quot;ç”¨æˆ·[&#123;&#125;]å‘èµ·AIæŸ¥è¯¢: &#123;&#125;&quot;, userId, question);            AiMessage response = chatModel.generate(UserMessage.from(question));            String answer = response.text();            long duration = System.currentTimeMillis() - startTime;            log.info(&quot;ç”¨æˆ·[&#123;&#125;]æŸ¥è¯¢å®Œæˆï¼Œè€—æ—¶: &#123;&#125;ms&quot;, userId, duration);            return answer;        &#125; catch (Exception e) &#123;            long duration = System.currentTimeMillis() - startTime;            log.error(&quot;ç”¨æˆ·[&#123;&#125;]æŸ¥è¯¢å¤±è´¥ï¼Œè€—æ—¶: &#123;&#125;msï¼Œé”™è¯¯: &#123;&#125;&quot;,                     userId, duration, e.getMessage(), e);            throw e;        &#125;    &#125;&#125;\n\n3. å®‰å…¨è€ƒè™‘import org.springframework.security.core.Authentication;import org.springframework.stereotype.Service;@Servicepublic class SecureAiService &#123;    private final OpenAiChatModel chatModel;    private final RateLimiter rateLimiter;    public SecureAiService(OpenAiChatModel chatModel) &#123;        this.chatModel = chatModel;        // é…ç½®é€Ÿç‡é™åˆ¶å™¨        this.rateLimiter = RateLimiter.create(10.0); // æ¯ç§’10ä¸ªè¯·æ±‚    &#125;    public String secureQuery(String question, Authentication authentication) &#123;        // é€Ÿç‡é™åˆ¶        if (!rateLimiter.tryAcquire()) &#123;            throw new RuntimeException(&quot;è¯·æ±‚è¿‡äºé¢‘ç¹ï¼Œè¯·ç¨åå†è¯•&quot;);        &#125;        // è¾“å…¥éªŒè¯å’Œè¿‡æ»¤        String sanitizedQuestion = sanitizeInput(question);        // å†…å®¹å®‰å…¨æ£€æŸ¥        if (!isContentSafe(sanitizedQuestion)) &#123;            throw new RuntimeException(&quot;è¾“å…¥å†…å®¹åŒ…å«ä¸å½“å†…å®¹&quot;);        &#125;        try &#123;            AiMessage response = chatModel.generate(UserMessage.from(sanitizedQuestion));            String answer = response.text();            // è¾“å‡ºå†…å®¹å®‰å…¨æ£€æŸ¥            if (!isContentSafe(answer)) &#123;                log.warn(&quot;AIè¾“å‡ºåŒ…å«ä¸å½“å†…å®¹ï¼Œå·²è¿‡æ»¤&quot;);                return &quot;æŠ±æ­‰ï¼Œæ— æ³•æä¾›ç›¸å…³å›ç­”ã€‚&quot;;            &#125;            return answer;        &#125; catch (Exception e) &#123;            log.error(&quot;AIæœåŠ¡è°ƒç”¨å¤±è´¥&quot;, e);            throw new RuntimeException(&quot;æœåŠ¡æš‚æ—¶ä¸å¯ç”¨&quot;);        &#125;    &#125;    private String sanitizeInput(String input) &#123;        // å®ç°è¾“å…¥è¿‡æ»¤é€»è¾‘        return input.replaceAll(&quot;&lt;script.*?&gt;.*?&lt;/script&gt;&quot;, &quot;&quot;)                   .replaceAll(&quot;javascript:&quot;, &quot;&quot;)                   .trim();    &#125;    private boolean isContentSafe(String content) &#123;        // å®ç°å†…å®¹å®‰å…¨æ£€æŸ¥é€»è¾‘        // è¿™é‡Œå¯ä»¥é›†æˆç¬¬ä¸‰æ–¹å†…å®¹å®¡æ ¸æœåŠ¡        return !content.toLowerCase().contains(&quot;ä¸å½“å†…å®¹&quot;);    &#125;&#125;\n\n4. ç›‘æ§å’ŒæŒ‡æ ‡import io.micrometer.core.instrument.Counter;import io.micrometer.core.instrument.MeterRegistry;import io.micrometer.core.instrument.Timer;import org.springframework.stereotype.Service;@Servicepublic class MonitoredAiService &#123;    private final Counter queryCounter;    private final Counter errorCounter;    private final Timer queryTimer;    private final OpenAiChatModel chatModel;    public MonitoredAiService(MeterRegistry registry, OpenAiChatModel chatModel) &#123;        this.chatModel = chatModel;        // æ³¨å†Œç›‘æ§æŒ‡æ ‡        this.queryCounter = Counter.builder(&quot;ai.queries.total&quot;)            .description(&quot;Total number of AI queries&quot;)            .register(registry);        this.errorCounter = Counter.builder(&quot;ai.errors.total&quot;)            .description(&quot;Total number of AI query errors&quot;)            .register(registry);        this.queryTimer = Timer.builder(&quot;ai.query.duration&quot;)            .description(&quot;AI query duration&quot;)            .register(registry);    &#125;    public String monitoredQuery(String question) &#123;        queryCounter.increment();        return queryTimer.recordCallable(() -&gt; &#123;            try &#123;                AiMessage response = chatModel.generate(UserMessage.from(question));                return response.text();            &#125; catch (Exception e) &#123;                errorCounter.increment();                throw e;            &#125;        &#125;);    &#125;&#125;\n\nå®‰å…¨è€ƒè™‘è¦ç‚¹\nAPIå¯†é’¥ç®¡ç†ï¼šä½¿ç”¨Spring Cloud Configæˆ–Vaultè¿›è¡Œå¯†é’¥ç®¡ç†\nè¾“å…¥éªŒè¯ï¼šä½¿ç”¨Bean Validationå’Œè‡ªå®šä¹‰éªŒè¯å™¨\né€Ÿç‡é™åˆ¶ï¼šé›†æˆSpring Cloud Gatewayæˆ–Resilience4j\nå†…å®¹å®¡æ ¸ï¼šé›†æˆç¬¬ä¸‰æ–¹å†…å®¹å®¡æ ¸æœåŠ¡\nå®¡è®¡æ—¥å¿—ï¼šè®°å½•æ‰€æœ‰AIäº¤äº’ç”¨äºå®‰å…¨å®¡è®¡\nHTTPSé€šä¿¡ï¼šç¡®ä¿æ‰€æœ‰APIè°ƒç”¨ä½¿ç”¨HTTPS\n\næ€»ç»“ä¸æ³¨æ„äº‹é¡¹æŠ€æœ¯è¦ç‚¹æ€»ç»“\nLangChain4jæ˜¯Javaç”Ÿæ€ä¸­å¼ºå¤§çš„LLMåº”ç”¨å¼€å‘æ¡†æ¶\næ ¸å¿ƒç»„ä»¶åŒ…æ‹¬Modelsã€Promptsã€Chainsã€Memoryã€Agentsã€Tools\nSpring Booté›†æˆæä¾›äº†ä¼ä¸šçº§çš„åº”ç”¨å¼€å‘ä½“éªŒ\nå®é™…åº”ç”¨å¯ä»¥æ„å»ºé—®ç­”ç³»ç»Ÿã€æ–‡æ¡£åˆ†æã€ä»£ç ç”Ÿæˆç­‰å¤šç§åœºæ™¯\néƒ¨ç½²ä¼˜åŒ–éœ€è¦è€ƒè™‘æ€§èƒ½ã€ç¼“å­˜ã€å®‰å…¨ã€ç›‘æ§ç­‰å› ç´ \n\nä½¿ç”¨æ³¨æ„äº‹é¡¹\nåˆç†æ§åˆ¶APIè°ƒç”¨é¢‘ç‡ï¼Œé¿å…è¶…å‡ºOpenAIçš„é€Ÿç‡é™åˆ¶\næ³¨æ„æ•°æ®éšç§å’Œå®‰å…¨é—®é¢˜ï¼Œéµå®ˆç›¸å…³æ³•å¾‹æ³•è§„\næ ¹æ®å®é™…éœ€æ±‚é€‰æ‹©åˆé€‚çš„æ¨¡å‹å’Œå‚æ•°é…ç½®\nå®šæœŸæ›´æ–°LangChain4jå’ŒSpring Bootç‰ˆæœ¬ï¼Œä¿æŒå®‰å…¨æ€§å’Œæ€§èƒ½\nåœ¨ç”Ÿäº§ç¯å¢ƒä¸­ä½¿ç”¨è¿æ¥æ± å’Œç†”æ–­å™¨æé«˜ç³»ç»Ÿç¨³å®šæ€§\nç›‘æ§AIæœåŠ¡çš„è°ƒç”¨æƒ…å†µå’Œæ€§èƒ½æŒ‡æ ‡\n\næ‰©å±•é˜…è¯»å»ºè®®\næ·±å…¥å­¦ä¹ LangChain4jå®˜æ–¹æ–‡æ¡£å’Œç¤ºä¾‹ä»£ç \næ¢ç´¢Spring AIé¡¹ç›®ï¼Œäº†è§£æ›´å¤šAIé›†æˆæ–¹æ¡ˆ\nå­¦ä¹ Spring Bootæœ€ä½³å®è·µå’Œå¾®æœåŠ¡æ¶æ„\nå…³æ³¨LLMæŠ€æœ¯çš„æœ€æ–°å‘å±•åŠ¨æ€å’Œè¡Œä¸šè¶‹åŠ¿\nå­¦ä¹ ç›¸å…³çš„AIå®‰å…¨ã€ä¼¦ç†å’Œåˆè§„è¦æ±‚\nç ”ç©¶å‘é‡æ•°æ®åº“å’ŒRAGï¼ˆæ£€ç´¢å¢å¼ºç”Ÿæˆï¼‰æŠ€æœ¯\n\né€šè¿‡æœ¬æ–‡çš„ä»‹ç»ï¼Œä½ å·²ç»æŒæ¡äº†ä½¿ç”¨LangChain4jæ„å»ºLLMåº”ç”¨çš„åŸºæœ¬æŠ€èƒ½ã€‚å¼€å§‹åŠ¨æ‰‹å®è·µï¼Œæ‰“é€ å±äºè‡ªå·±çš„AIåº”ç”¨å§ï¼\nå‚è€ƒèµ„æ–™\nLangChain4jå®˜æ–¹æ–‡æ¡£\nLangChain4j GitHubä»“åº“\nOpenAI APIæ–‡æ¡£\nSpring Bootå®˜æ–¹æ–‡æ¡£\nSpring WebFluxå“åº”å¼ç¼–ç¨‹\nResilience4jæ•…éšœæ¢å¤åº“\nMicrometerç›‘æ§æŒ‡æ ‡\nDockeræœ€ä½³å®è·µ\nSpring Securityå®‰å…¨æ¡†æ¶\nå‘é‡æ•°æ®åº“å¯¹æ¯”åˆ†æ\n\n","tags":["LangChain4j","å¤§è¯­è¨€æ¨¡å‹","LLM","AIåº”ç”¨","Java","Spring Boot"]},{"title":"Spring AIæ‰“é€ è‡ªå·±çš„LLMåº”ç”¨","url":"/2025/01/16/0.5.3-SpringAI%E6%89%93%E9%80%A0%E8%87%AA%E5%B7%B1%E7%9A%84LLM%E5%BA%94%E7%94%A8/","content":"\nSpring AIæ˜¯Springå®˜æ–¹æ¨å‡ºçš„AIæ¡†æ¶ï¼Œä¸ºJavaå¼€å‘è€…æä¾›äº†åŸç”Ÿçš„AIå¼€å‘ä½“éªŒã€‚æœ¬æ–‡å°†å¸¦ä½ ä»é›¶å¼€å§‹ï¼ŒæŒæ¡Spring AIçš„æ ¸å¿ƒæ¦‚å¿µå’ŒSpring Booté›†æˆæŠ€å·§ï¼Œæ‰“é€ å±äºè‡ªå·±çš„AIåº”ç”¨ã€‚\n\nSpring AIç®€ä»‹Spring AIæ˜¯Springå®˜æ–¹æ¨å‡ºçš„AIæ¡†æ¶ï¼Œä¸“é—¨ä¸ºJavaå’ŒSpringå¼€å‘è€…è®¾è®¡ï¼Œæä¾›äº†ä¸€å¥—ç®€æ´ã€ç›´è§‚ä¸”ç¬¦åˆSpringç”Ÿæ€çš„AIå¼€å‘APIã€‚å®ƒé›†æˆäº†å¤šç§ä¸»æµçš„AIæ¨¡å‹å’ŒæœåŠ¡ï¼Œè®©å¼€å‘è€…èƒ½å¤Ÿè½»æ¾æ„å»ºAIé©±åŠ¨çš„åº”ç”¨ã€‚\nä¸ºä»€ä¹ˆé€‰æ‹©Spring AIï¼Ÿ\nSpringç”Ÿæ€å®Œç¾é›†æˆï¼šæ— ç¼é›†æˆSpring Bootã€Spring Cloudç­‰\nå®˜æ–¹ç»´æŠ¤ï¼šSpringå®˜æ–¹é¡¹ç›®ï¼Œè´¨é‡ä¿è¯\nç®€æ´çš„APIï¼šç›´è§‚çš„ç¼–ç¨‹æ¨¡å‹ï¼Œå­¦ä¹ æˆæœ¬ä½\nä¼ä¸šçº§æ”¯æŒï¼šå®Œæ•´çš„ç”Ÿäº§ç¯å¢ƒç‰¹æ€§æ”¯æŒ\nå¤šæ¨¡å‹æ”¯æŒï¼šæ”¯æŒOpenAIã€Azure OpenAIã€Ollamaç­‰å¤šç§æ¨¡å‹\nå·¥å…·é›†æˆï¼šå†…ç½®ä¸°å¯Œçš„å·¥å…·å’Œå¢å¼ºå™¨\nç¤¾åŒºæ´»è·ƒï¼šSpringç¤¾åŒºå¼ºå¤§çš„æ”¯æŒ\n\næ ¸å¿ƒç»„ä»¶è¯¦è§£1. ChatClientï¼ˆèŠå¤©å®¢æˆ·ç«¯ï¼‰ChatClientæ˜¯Spring AIçš„æ ¸å¿ƒç»„ä»¶ï¼Œæä¾›ç®€æ´çš„èŠå¤©äº¤äº’APIã€‚\n@Configurationpublic class AiConfig &#123;    @Bean    public ChatClient chatClient(ChatClient.Builder builder) &#123;        return builder            .defaultAdvisors(new SimpleLoggerAdvisor())            .build();    &#125;&#125;// ä½¿ç”¨ç¤ºä¾‹@Servicepublic class ChatService &#123;    private final ChatClient chatClient;    public ChatService(ChatClient chatClient) &#123;        this.chatClient = chatClient;    &#125;    public String chat(String message) &#123;        return chatClient.prompt()            .user(message)            .call()            .content();    &#125;    public String chatWithSystem(String systemMessage, String userMessage) &#123;        return chatClient.prompt()            .system(systemMessage)            .user(userMessage)            .call()            .content();    &#125;&#125;\n\n2. Prompt Templatesï¼ˆæç¤ºè¯æ¨¡æ¿ï¼‰Spring AIæä¾›äº†ä¸°å¯Œçš„æç¤ºè¯æ¨¡æ¿æ”¯æŒã€‚\n@Servicepublic class PromptService &#123;    public String generatePrompt(String role, String question, String language) &#123;        return &quot;&quot;&quot;            ä½ æ˜¯ä¸€ä¸ªä¸“ä¸šçš„%sï¼Œè¯·å›ç­”ä»¥ä¸‹é—®é¢˜ï¼š            %s            è¯·ç”¨%så›ç­”ã€‚            &quot;&quot;&quot;.formatted(role, question, language);    &#125;    // ä½¿ç”¨PromptTemplate    public String chatWithTemplate(String role, String question) &#123;        PromptTemplate template = new PromptTemplate(&quot;&quot;&quot;            ä½ æ˜¯ä¸€ä¸ªä¸“ä¸šçš„&#123;role&#125;ï¼Œè¯·è¯¦ç»†è§£é‡Šï¼š            &#123;question&#125;            è¯·æä¾›å…·ä½“ç¤ºä¾‹å’Œæœ€ä½³å®è·µã€‚            &quot;&quot;&quot;);        return chatClient.prompt(template)            .user(Map.of(&quot;role&quot;, role, &quot;question&quot;, question))            .call()            .content();    &#125;&#125;\n\n3. Advisorsï¼ˆå¢å¼ºå™¨ï¼‰Advisoræ˜¯Spring AIä¸­ç”¨äºå¢å¼ºAIå“åº”çš„æœºåˆ¶ã€‚\n@Configurationpublic class AdvisorConfig &#123;    // æ—¥å¿—å¢å¼ºå™¨    @Bean    public Advisor loggingAdvisor() &#123;        return new SimpleLoggerAdvisor();    &#125;    // è‡ªå®šä¹‰å¢å¼ºå™¨    @Bean    public Advisor customAdvisor() &#123;        return new DefaultPromptAugmentor() &#123;            @Override            public AdvisedRequest adviseRequest(AdvisedRequest request, Map&lt;String, Object&gt; context) &#123;                // åœ¨è¯·æ±‚å‰æ·»åŠ è‡ªå®šä¹‰é€»è¾‘                String enhancedUserMessage = &quot;è¯·è¯¦ç»†å›ç­”ä»¥ä¸‹é—®é¢˜ï¼Œå¹¶æä¾›ç¤ºä¾‹ï¼š\\n&quot; + request.user().text();                return AdvisedRequest.from(request)                    .withUser(enhancedUserMessage)                    .build();            &#125;        &#125;;    &#125;    // é€Ÿç‡é™åˆ¶å¢å¼ºå™¨    @Bean    public Advisor rateLimitAdvisor() &#123;        return new RateLimitChatMemoryAdvisor(Duration.ofMinutes(10), 50);    &#125;&#125;\n\n4. Function Callbacksï¼ˆå‡½æ•°è°ƒç”¨ï¼‰Spring AIæ”¯æŒå·¥å…·è°ƒç”¨ï¼Œè®©AIèƒ½å¤Ÿæ‰§è¡Œç‰¹å®šä»»åŠ¡ã€‚\n// å®šä¹‰å·¥å…·ç±»public class SearchTools &#123;    @Tool(description = &quot;æœç´¢äº’è”ç½‘ä¿¡æ¯&quot;)    public String searchWeb(String query) &#123;        // è¿™é‡Œå®ç°æœç´¢é€»è¾‘        return &quot;æœç´¢ &#x27;&quot; + query + &quot;&#x27; çš„ç»“æœ...&quot;;    &#125;    @Tool(description = &quot;è®¡ç®—æ•°å­¦è¡¨è¾¾å¼&quot;)    public double calculate(String expression) &#123;        try &#123;            // ä½¿ç”¨JavaScriptå¼•æ“è®¡ç®—            ScriptEngineManager manager = new ScriptEngineManager();            ScriptEngine engine = manager.getEngineByName(&quot;JavaScript&quot;);            return ((Number) engine.eval(expression)).doubleValue();        &#125; catch (Exception e) &#123;            return 0.0;        &#125;    &#125;    @Tool(description = &quot;è·å–å½“å‰æ—¶é—´&quot;)    public String getCurrentTime() &#123;        return LocalDateTime.now().format(DateTimeFormatter.ISO_LOCAL_DATE_TIME);    &#125;&#125;// é…ç½®å‡½æ•°è°ƒç”¨@Configurationpublic class FunctionConfig &#123;    @Bean    public FunctionCallbackContext functionCallbackContext() &#123;        FunctionCallbackContext context = new FunctionCallbackContext();        // æ³¨å†Œå·¥å…·        context.addCallback(&quot;searchWeb&quot;, new FunctionCallback() &#123;            @Override            public String call(String input) &#123;                return new SearchTools().searchWeb(input);            &#125;        &#125;);        return context;    &#125;&#125;// åœ¨ChatClientä¸­ä½¿ç”¨@Servicepublic class FunctionCallService &#123;    public String chatWithTools(String message) &#123;        return chatClient.prompt()            .user(message)            .functions(&quot;searchWeb&quot;, &quot;calculate&quot;, &quot;getCurrentTime&quot;)            .call()            .content();    &#125;&#125;\n\n5. Vector Storeï¼ˆå‘é‡å­˜å‚¨ï¼‰Spring AIæ”¯æŒå¤šç§å‘é‡å­˜å‚¨ï¼Œç”¨äºå®ç°RAGï¼ˆæ£€ç´¢å¢å¼ºç”Ÿæˆï¼‰ã€‚\n@Configurationpublic class VectorStoreConfig &#123;    @Bean    public VectorStore vectorStore(EmbeddingModel embeddingModel) &#123;        // ä½¿ç”¨å†…å­˜å‘é‡å­˜å‚¨ï¼ˆç”Ÿäº§ç¯å¢ƒå»ºè®®ä½¿ç”¨Redisã€PostgreSQLç­‰ï¼‰        return new SimpleVectorStore(embeddingModel);    &#125;    @Bean    public EmbeddingModel embeddingModel() &#123;        return new OpenAiEmbeddingModel(OpenAiApi.builder()            .apiKey(System.getenv(&quot;OPENAI_API_KEY&quot;))            .build());    &#125;&#125;@Servicepublic class RagService &#123;    private final VectorStore vectorStore;    private final EmbeddingModel embeddingModel;    private final ChatClient chatClient;    public RagService(VectorStore vectorStore,                     EmbeddingModel embeddingModel,                     ChatClient chatClient) &#123;        this.vectorStore = vectorStore;        this.embeddingModel = embeddingModel;        this.chatClient = chatClient;    &#125;    // æ–‡æ¡£å…¥åº“    public void storeDocument(String content, String metadata) &#123;        TextSegment segment = TextSegment.from(content);        Embedding embedding = embeddingModel.embed(segment).content();        Document document = new Document(segment, Map.of(&quot;source&quot;, metadata));        vectorStore.add(List.of(document));    &#125;    // æ£€ç´¢å¢å¼ºé—®ç­”    public String askWithContext(String question) &#123;        // æ£€ç´¢ç›¸å…³æ–‡æ¡£        List&lt;Document&gt; relevantDocs = vectorStore.similaritySearch(            SearchRequest.builder()                .query(question)                .topK(3)                .build()        );        // æ„å»ºä¸Šä¸‹æ–‡        String context = relevantDocs.stream()            .map(doc -&gt; doc.getText())            .collect(Collectors.joining(&quot;\\n\\n&quot;));        return chatClient.prompt()            .system(&quot;åŸºäºä»¥ä¸‹æ–‡æ¡£å†…å®¹å›ç­”é—®é¢˜ï¼š\\n&quot; + context)            .user(question)            .call()            .content();    &#125;&#125;\n\nå®æˆ˜æ¡ˆä¾‹ï¼šæ™ºèƒ½é—®ç­”ç³»ç»Ÿé¡¹ç›®ç»“æ„spring-ai-qa-system/â”œâ”€â”€ src/main/java/com/example/springai/â”‚   â”œâ”€â”€ config/                    # é…ç½®ç±»â”‚   â”‚   â”œâ”€â”€ AiConfig.java         # AIé…ç½®â”‚   â”‚   â”œâ”€â”€ VectorStoreConfig.java # å‘é‡å­˜å‚¨é…ç½®â”‚   â”‚   â””â”€â”€ AdvisorConfig.java     # å¢å¼ºå™¨é…ç½®â”‚   â”œâ”€â”€ controller/               # æ§åˆ¶å™¨â”‚   â”‚   â””â”€â”€ QaController.java     # é—®ç­”æ¥å£â”‚   â”œâ”€â”€ service/                  # ä¸šåŠ¡æœåŠ¡â”‚   â”‚   â”œâ”€â”€ ChatService.java      # èŠå¤©æœåŠ¡â”‚   â”‚   â”œâ”€â”€ RagService.java       # RAGæœåŠ¡â”‚   â”‚   â””â”€â”€ PromptService.java    # æç¤ºè¯æœåŠ¡â”‚   â”œâ”€â”€ model/                    # æ•°æ®æ¨¡å‹â”‚   â”‚   â”œâ”€â”€ ChatRequest.java      # è¯·æ±‚æ¨¡å‹â”‚   â”‚   â””â”€â”€ ChatResponse.java     # å“åº”æ¨¡å‹â”‚   â””â”€â”€ tools/                    # å·¥å…·ç±»â”‚       â””â”€â”€ SearchTools.java      # æœç´¢å·¥å…·â”œâ”€â”€ src/main/resources/â”‚   â”œâ”€â”€ application.yml           # åº”ç”¨é…ç½®â””â”€â”€ pom.xml                       # Mavenä¾èµ–\n\nMavenä¾èµ–é…ç½®&lt;!-- pom.xml --&gt;&lt;dependencies&gt;    &lt;!-- Spring Boot --&gt;    &lt;dependency&gt;        &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;        &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt;    &lt;/dependency&gt;    &lt;!-- Spring AI --&gt;    &lt;dependency&gt;        &lt;groupId&gt;org.springframework.ai&lt;/groupId&gt;        &lt;artifactId&gt;spring-ai-openai-spring-boot-starter&lt;/artifactId&gt;        &lt;version&gt;1.0.0-M3&lt;/version&gt;    &lt;/dependency&gt;    &lt;!-- å‘é‡å­˜å‚¨ï¼ˆå¯é€‰ï¼‰ --&gt;    &lt;dependency&gt;        &lt;groupId&gt;org.springframework.ai&lt;/groupId&gt;        &lt;artifactId&gt;spring-ai-pgvector-store-spring-boot-starter&lt;/artifactId&gt;        &lt;version&gt;1.0.0-M3&lt;/version&gt;    &lt;/dependency&gt;    &lt;!-- å…¶ä»–ä¾èµ– --&gt;    &lt;dependency&gt;        &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;        &lt;artifactId&gt;spring-boot-starter-validation&lt;/artifactId&gt;    &lt;/dependency&gt;    &lt;dependency&gt;        &lt;groupId&gt;org.projectlombok&lt;/groupId&gt;        &lt;artifactId&gt;lombok&lt;/artifactId&gt;        &lt;optional&gt;true&lt;/optional&gt;    &lt;/dependency&gt;&lt;/dependencies&gt;\n\næ ¸å¿ƒæœåŠ¡å®ç°// ChatService.java@Service@Slf4jpublic class ChatService &#123;    private final ChatClient chatClient;    private final PromptService promptService;    public ChatService(ChatClient chatClient, PromptService promptService) &#123;        this.chatClient = chatClient;        this.promptService = promptService;    &#125;    public ChatResponse chat(ChatRequest request) &#123;        try &#123;            // ç”Ÿæˆæç¤ºè¯            String prompt = promptService.generatePrompt(request);            // è°ƒç”¨AI            String response = chatClient.prompt()                .system(prompt)                .user(request.getMessage())                .call()                .content();            return ChatResponse.builder()                .response(response)                .timestamp(System.currentTimeMillis())                .success(true)                .build();        &#125; catch (Exception e) &#123;            log.error(&quot;èŠå¤©æœåŠ¡è°ƒç”¨å¤±è´¥&quot;, e);            return ChatResponse.builder()                .success(false)                .errorMessage(e.getMessage())                .timestamp(System.currentTimeMillis())                .build();        &#125;    &#125;    // æµå¼å“åº”    public Flux&lt;String&gt; streamChat(ChatRequest request) &#123;        String prompt = promptService.generatePrompt(request);        return chatClient.prompt()            .system(prompt)            .user(request.getMessage())            .stream()            .content();    &#125;&#125;\n\nRESTæ§åˆ¶å™¨@RestController@RequestMapping(&quot;/api/chat&quot;)@RequiredArgsConstructor@Slf4jpublic class ChatController &#123;    private final ChatService chatService;    private final RagService ragService;    @PostMapping(&quot;/simple&quot;)    public ResponseEntity&lt;ChatResponse&gt; simpleChat(@Valid @RequestBody ChatRequest request) &#123;        log.info(&quot;æ”¶åˆ°ç®€å•èŠå¤©è¯·æ±‚ï¼š&#123;&#125;&quot;, request.getMessage());        ChatResponse response = chatService.chat(request);        return ResponseEntity.ok(response);    &#125;    @PostMapping(&quot;/rag&quot;)    public ResponseEntity&lt;ChatResponse&gt; ragChat(@Valid @RequestBody ChatRequest request) &#123;        log.info(&quot;æ”¶åˆ°RAGèŠå¤©è¯·æ±‚ï¼š&#123;&#125;&quot;, request.getMessage());        String answer = ragService.askWithContext(request.getMessage());        ChatResponse response = ChatResponse.builder()            .response(answer)            .timestamp(System.currentTimeMillis())            .success(true)            .build();        return ResponseEntity.ok(response);    &#125;    @PostMapping(value = &quot;/stream&quot;, produces = MediaType.TEXT_EVENT_STREAM_VALUE)    public Flux&lt;String&gt; streamChat(@Valid @RequestBody ChatRequest request) &#123;        log.info(&quot;æ”¶åˆ°æµå¼èŠå¤©è¯·æ±‚ï¼š&#123;&#125;&quot;, request.getMessage());        return chatService.streamChat(request);    &#125;    @PostMapping(&quot;/tools&quot;)    public ResponseEntity&lt;ChatResponse&gt; chatWithTools(@Valid @RequestBody ChatRequest request) &#123;        log.info(&quot;æ”¶åˆ°å·¥å…·èŠå¤©è¯·æ±‚ï¼š&#123;&#125;&quot;, request.getMessage());        // è¿™é‡Œå¯ä»¥è°ƒç”¨å¸¦æœ‰å·¥å…·çš„èŠå¤©æœåŠ¡        ChatResponse response = chatService.chat(request);        return ResponseEntity.ok(response);    &#125;&#125;\n\nåº”ç”¨é…ç½®# application.ymlspring:  application:    name: spring-ai-qa-system  ai:    openai:      api-key: $&#123;OPENAI_API_KEY:your-api-key-here&#125;      chat:        model: gpt-3.5-turbo        temperature: 0.3        max-tokens: 1000      embedding:        model: text-embedding-ada-002server:  port: 8080logging:  level:    org.springframework.ai: DEBUG    com.example.springai: INFO\n\né«˜çº§åŠŸèƒ½æ‰©å±•1. å¤šæ¨¡å‹æ”¯æŒ@Configurationpublic class MultiModelConfig &#123;    @Bean    @Qualifier(&quot;gpt4ChatClient&quot;)    public ChatClient gpt4ChatClient(ChatClient.Builder builder) &#123;        return builder            .defaultOptions(ChatOptions.builder()                .model(&quot;gpt-4&quot;)                .temperature(0.1)                .build())            .build();    &#125;    @Bean    @Qualifier(&quot;gpt35ChatClient&quot;)    public ChatClient gpt35ChatClient(ChatClient.Builder builder) &#123;        return builder            .defaultOptions(ChatOptions.builder()                .model(&quot;gpt-3.5-turbo&quot;)                .temperature(0.7)                .build())            .build();    &#125;&#125;@Servicepublic class MultiModelService &#123;    private final ChatClient gpt4Client;    private final ChatClient gpt35Client;    public MultiModelService(            @Qualifier(&quot;gpt4ChatClient&quot;) ChatClient gpt4Client,            @Qualifier(&quot;gpt35ChatClient&quot;) ChatClient gpt35Client) &#123;        this.gpt4Client = gpt4Client;        this.gpt35Client = gpt35Client;    &#125;    public String chatWithModel(String message, String model) &#123;        ChatClient client = &quot;gpt4&quot;.equals(model) ? gpt4Client : gpt35Client;        return client.prompt()            .user(message)            .call()            .content();    &#125;&#125;\n\n2. è‡ªå®šä¹‰å¢å¼ºå™¨@Componentpublic class CustomLoggingAdvisor implements Advisor &#123;    private static final Logger log = LoggerFactory.getLogger(CustomLoggingAdvisor.class);    @Override    public AdvisedRequest adviseRequest(AdvisedRequest request, Map&lt;String, Object&gt; context) &#123;        log.info(&quot;AIè¯·æ±‚ - ç”¨æˆ·: &#123;&#125;, ç³»ç»Ÿ: &#123;&#125;, æ¶ˆæ¯é•¿åº¦: &#123;&#125;&quot;,            request.user().text(),            request.system().text(),            request.user().text().length());        return request;    &#125;    @Override    public ChatResponse adviseResponse(ChatResponse response, Map&lt;String, Object&gt; context) &#123;        log.info(&quot;AIå“åº” - æˆåŠŸ: &#123;&#125;, å“åº”é•¿åº¦: &#123;&#125;, Tokenä½¿ç”¨: &#123;&#125;&quot;,            response != null,            response != null ? response.getResult().getOutput().getContent().length() : 0,            response != null ? response.getMetadata().getUsage().getTotalTokens() : 0);        return response;    &#125;&#125;\n\néƒ¨ç½²å’Œä¼˜åŒ–Dockeréƒ¨ç½²# DockerfileFROM openjdk:17-jdk-slimWORKDIR /appCOPY target/*.jar app.jarEXPOSE 8080CMD [&quot;java&quot;, &quot;-jar&quot;, &quot;app.jar&quot;]\n\n# docker-compose.ymlversion: &#x27;3.8&#x27;services:  spring-ai-app:    build: .    ports:      - &quot;8080:8080&quot;    environment:      - OPENAI_API_KEY=$&#123;OPENAI_API_KEY&#125;    restart: unless-stopped\n\næ€§èƒ½ä¼˜åŒ–ç­–ç•¥\nç¼“å­˜æœºåˆ¶\n@Configurationpublic class CacheConfig &#123;    @Bean    public CacheManager cacheManager() &#123;        CaffeineCacheManager cacheManager = new CaffeineCacheManager();        cacheManager.setCaffeine(Caffeine.newBuilder()            .maximumSize(1000)            .expireAfterWrite(Duration.ofMinutes(30)));        return cacheManager;    &#125;&#125;@Service@Cacheable(&quot;ai-responses&quot;)public String cachedChat(String message) &#123;    return chatClient.prompt()        .user(message)        .call()        .content();&#125;\nå¼‚æ­¥å¤„ç†\n@Servicepublic class AsyncChatService &#123;    @Async    public CompletableFuture&lt;String&gt; asyncChat(String message) &#123;        return CompletableFuture.supplyAsync(() -&gt;            chatClient.prompt()                .user(message)                .call()                .content()        );    &#125;    public List&lt;String&gt; batchChat(List&lt;String&gt; messages) &#123;        return messages.stream()            .map(message -&gt; chatClient.prompt()                .user(message)                .call()                .content())            .collect(Collectors.toList());    &#125;&#125;\n\næœ€ä½³å®è·µ1. é”™è¯¯å¤„ç†@Servicepublic class ResilientChatService &#123;    @Retryable(        value = &#123;AiException.class&#125;,        maxAttempts = 3,        backoff = @Backoff(delay = 1000, multiplier = 2)    )    public String resilientChat(String message) &#123;        try &#123;            return chatClient.prompt()                .user(message)                .call()                .content();        &#125; catch (AiException e) &#123;            log.error(&quot;AIæœåŠ¡è°ƒç”¨å¤±è´¥ï¼Œé‡è¯•ä¸­...&quot;, e);            throw e;        &#125;    &#125;    @Recover    public String recover(AiException e, String message) &#123;        log.error(&quot;AIæœåŠ¡è°ƒç”¨å¤±è´¥ï¼Œä½¿ç”¨é™çº§æ–¹æ¡ˆ&quot;, e);        return &quot;æŠ±æ­‰ï¼ŒAIæœåŠ¡æš‚æ—¶ä¸å¯ç”¨ï¼Œè¯·ç¨åå†è¯•ã€‚&quot;;    &#125;&#125;\n\n2. ç›‘æ§å’ŒæŒ‡æ ‡@Configurationpublic class MetricsConfig &#123;    @Bean    public MeterRegistryCustomizer&lt;MeterRegistry&gt; metricsCustomizer() &#123;        return registry -&gt; &#123;            registry.config()                .commonTags(&quot;application&quot;, &quot;spring-ai-qa-system&quot;);        &#125;;    &#125;&#125;@Servicepublic class MonitoredChatService &#123;    private final Counter chatRequests;    private final Counter chatErrors;    private final Timer chatDuration;    public MonitoredChatService(MeterRegistry registry) &#123;        this.chatRequests = Counter.builder(&quot;ai.chat.requests&quot;)            .description(&quot;Number of chat requests&quot;)            .register(registry);        this.chatErrors = Counter.builder(&quot;ai.chat.errors&quot;)            .description(&quot;Number of chat errors&quot;)            .register(registry);        this.chatDuration = Timer.builder(&quot;ai.chat.duration&quot;)            .description(&quot;Chat request duration&quot;)            .register(registry);    &#125;    public String monitoredChat(String message) &#123;        chatRequests.increment();        return chatDuration.recordCallable(() -&gt; &#123;            try &#123;                return chatClient.prompt()                    .user(message)                    .call()                    .content();            &#125; catch (Exception e) &#123;                chatErrors.increment();                throw e;            &#125;        &#125;);    &#125;&#125;\n\n3. å®‰å…¨è€ƒè™‘@Configurationpublic class SecurityConfig &#123;    @Bean    public SecurityFilterChain filterChain(HttpSecurity http) throws Exception &#123;        http            .csrf().disable()            .authorizeHttpRequests(authz -&gt; authz                .requestMatchers(&quot;/api/chat/**&quot;).authenticated()                .anyRequest().permitAll()            )            .httpBasic();        return http.build();    &#125;    @Bean    public RateLimiter rateLimiter() &#123;        return RateLimiter.create(10.0); // æ¯ç§’10ä¸ªè¯·æ±‚    &#125;&#125;@Servicepublic class SecureChatService &#123;    private final RateLimiter rateLimiter;    public SecureChatService(RateLimiter rateLimiter) &#123;        this.rateLimiter = rateLimiter;    &#125;    public String secureChat(String message, Authentication auth) &#123;        // é€Ÿç‡é™åˆ¶        if (!rateLimiter.tryAcquire()) &#123;            throw new RuntimeException(&quot;è¯·æ±‚è¿‡äºé¢‘ç¹ï¼Œè¯·ç¨åå†è¯•&quot;);        &#125;        // è¾“å…¥è¿‡æ»¤        String sanitizedMessage = sanitizeInput(message);        // è°ƒç”¨AI        String response = chatClient.prompt()            .user(sanitizedMessage)            .call()            .content();        // è¾“å‡ºè¿‡æ»¤        return sanitizeOutput(response);    &#125;    private String sanitizeInput(String input) &#123;        // å®ç°è¾“å…¥è¿‡æ»¤é€»è¾‘        return input.trim();    &#125;    private String sanitizeOutput(String output) &#123;        // å®ç°è¾“å‡ºè¿‡æ»¤é€»è¾‘        return output.trim();    &#125;&#125;\n\næ€»ç»“ä¸æ³¨æ„äº‹é¡¹æŠ€æœ¯è¦ç‚¹æ€»ç»“\nSpring AIæ˜¯Springå®˜æ–¹æ¨å‡ºçš„AIæ¡†æ¶ï¼Œæä¾›äº†åŸç”Ÿçš„Springé›†æˆä½“éªŒ\næ ¸å¿ƒç»„ä»¶åŒ…æ‹¬ChatClientã€Advisorã€Function Callbacksã€Vector Storeç­‰\nSpring Booté›†æˆæä¾›äº†å®Œæ•´çš„åº”ç”¨å¼€å‘ä½“éªŒ\nå¤šæ¨¡å‹æ”¯æŒå¯ä»¥çµæ´»é€‰æ‹©ä¸åŒçš„AIæ¨¡å‹\nä¼ä¸šçº§ç‰¹æ€§åŒ…æ‹¬ç›‘æ§ã€å®‰å…¨ã€ç¼“å­˜ç­‰ç”Ÿäº§ç¯å¢ƒå¿…éœ€åŠŸèƒ½\n\nä½¿ç”¨æ³¨æ„äº‹é¡¹\nåˆç†ç®¡ç†APIå¯†é’¥ï¼Œé¿å…æ³„éœ²\næ³¨æ„é€Ÿç‡é™åˆ¶å’Œæˆæœ¬æ§åˆ¶\nåœ¨ç”Ÿäº§ç¯å¢ƒä¸­ä½¿ç”¨é€‚å½“çš„ç¼“å­˜å’Œç›‘æ§\nå®šæœŸæ›´æ–°Spring AIç‰ˆæœ¬ï¼Œè·å–æœ€æ–°åŠŸèƒ½\néµå®ˆç›¸å…³æ³•å¾‹æ³•è§„ï¼Œç¡®ä¿å†…å®¹åˆè§„\n\næ‰©å±•é˜…è¯»å»ºè®®\næ·±å…¥å­¦ä¹ Spring AIå®˜æ–¹æ–‡æ¡£\näº†è§£Springç”Ÿæ€çš„å…¶ä»–AIç›¸å…³é¡¹ç›®\nå­¦ä¹ Spring Bootæœ€ä½³å®è·µ\nå…³æ³¨AIæŠ€æœ¯çš„æœ€æ–°å‘å±•è¶‹åŠ¿\nç ”ç©¶å‘é‡æ•°æ®åº“å’ŒRAGæŠ€æœ¯\n\né€šè¿‡æœ¬æ–‡çš„ä»‹ç»ï¼Œä½ å·²ç»æŒæ¡äº†ä½¿ç”¨Spring AIæ„å»ºLLMåº”ç”¨çš„åŸºæœ¬æŠ€èƒ½ã€‚Spring AIä»¥å…¶ç®€æ´çš„APIè®¾è®¡å’Œå¼ºå¤§çš„Springç”Ÿæ€é›†æˆï¼Œä¸ºJavaå¼€å‘è€…æä¾›äº†ä¸€æ¡å¿«é€Ÿæ„å»ºAIåº”ç”¨çš„æ·å¾„ã€‚\nå‚è€ƒèµ„æ–™\nSpring AIå®˜æ–¹æ–‡æ¡£\nSpring AI GitHubä»“åº“\nOpenAI APIæ–‡æ¡£\nSpring Bootå®˜æ–¹æ–‡æ¡£\nSpring WebFluxæ–‡æ¡£\nResilience4jæ–‡æ¡£\nMicrometeræ–‡æ¡£\nDockeræœ€ä½³å®è·µ\nSpring Securityæ–‡æ¡£\nå‘é‡æ•°æ®åº“æ¯”è¾ƒ\n\n","tags":["å¤§è¯­è¨€æ¨¡å‹","LLM","AIåº”ç”¨","Java","Spring Boot","Spring AI"]},{"title":"0.5.6-å‘é‡æ•°æ®åº“æ­å»ºä¸ä¸»æµäº§å“å¯¹æ¯”","url":"/2025/01/21/0.5.6-%E5%90%91%E9%87%8F%E6%95%B0%E6%8D%AE%E5%BA%93%E6%90%AD%E5%BB%BA%E4%B8%8E%E4%B8%BB%E6%B5%81%E4%BA%A7%E5%93%81%E5%AF%B9%E6%AF%94-old/","content":"\néšç€AIåº”ç”¨çš„å¿«é€Ÿå‘å±•ï¼Œå‘é‡æ•°æ®åº“å·²æˆä¸ºæ”¯æ’‘å¤§æ¨¡å‹åº”ç”¨çš„å…³é”®åŸºç¡€è®¾æ–½ã€‚æœ¬æ–‡å°†ä»é›¶å¼€å§‹ä»‹ç»å‘é‡æ•°æ®åº“çš„æ­å»ºè¿‡ç¨‹ï¼Œå¹¶è¯¦ç»†å¯¹æ¯”å¸‚é¢ä¸Šä¸»æµå‘é‡æ•°æ®åº“äº§å“çš„ç‰¹ç‚¹ã€ä¼˜åŠ¿å’Œé€‚ç”¨åœºæ™¯ã€‚\n\nğŸ¯ å‘é‡æ•°æ®åº“æ¦‚è¿°ä»€ä¹ˆæ˜¯å‘é‡æ•°æ®åº“ï¼Ÿå‘é‡æ•°æ®åº“ï¼ˆVector Databaseï¼‰æ˜¯ä¸€ç§ä¸“é—¨è®¾è®¡ç”¨äºå­˜å‚¨ã€ç´¢å¼•å’Œæ£€ç´¢é«˜ç»´å‘é‡æ•°æ®çš„æ•°æ®åº“ç³»ç»Ÿã€‚å®ƒä¸»è¦ç”¨äºï¼š\n\nè¯­ä¹‰æœç´¢ï¼šåŸºäºå‘é‡ç›¸ä¼¼åº¦çš„å†…å®¹æ£€ç´¢\næ¨èç³»ç»Ÿï¼šåŸºäºç”¨æˆ·åå¥½çš„ä¸ªæ€§åŒ–æ¨è\nå›¾åƒè¯†åˆ«ï¼šå›¾ç‰‡ç›¸ä¼¼åº¦åŒ¹é…\nè‡ªç„¶è¯­è¨€å¤„ç†ï¼šæ–‡æœ¬ç›¸ä¼¼åº¦åˆ†æ\nRAGåº”ç”¨ï¼šæ£€ç´¢å¢å¼ºç”Ÿæˆç³»ç»Ÿ\n\næ ¸å¿ƒæ¦‚å¿µ1. å‘é‡åµŒå…¥ï¼ˆVector Embeddingsï¼‰# æ–‡æœ¬è½¬æ¢ä¸ºå‘é‡text = &quot;æœºå™¨å­¦ä¹ æ˜¯äººå·¥æ™ºèƒ½çš„é‡è¦åˆ†æ”¯&quot;vector = embedding_model.encode(text)# vector.shape = (768,) æˆ–å…¶ä»–ç»´åº¦\n\n2. ç›¸ä¼¼åº¦åº¦é‡\nä½™å¼¦ç›¸ä¼¼åº¦ï¼ˆCosine Similarityï¼‰\næ¬§å‡ é‡Œå¾—è·ç¦»ï¼ˆEuclidean Distanceï¼‰\nç‚¹ç§¯ç›¸ä¼¼åº¦ï¼ˆDot Productï¼‰\næ±‰æ˜è·ç¦»ï¼ˆHamming Distanceï¼‰\n\n3. ç´¢å¼•ç®—æ³•\nHNSW (Hierarchical Navigable Small World)\nIVF (Inverted File Index)\nPQ (Product Quantization)\nLSH (Locality Sensitive Hashing)\n\nğŸ—ï¸ ä¸»æµå‘é‡æ•°æ®åº“å¯¹æ¯”1. Milvus - å¼€æºå† å†›æ ¸å¿ƒç‰¹æ€§# Milvusé…ç½®æ–‡ä»¶ç¤ºä¾‹version: &#x27;3.8&#x27;services:  milvus-etcd:    image: quay.io/coreos/etcd:v3.5.5    container_name: milvus-etcd  milvus-minio:    image: minio/minio:RELEASE.2023-03-20T20-16-18Z    container_name: milvus-minio  milvus-standalone:    image: milvusdb/milvus:v2.3.0    container_name: milvus-standalone    ports:      - &quot;19530:19530&quot;    depends_on:      - milvus-etcd      - milvus-minio\n\nä¼˜åŠ¿\nâœ… é«˜æ€§èƒ½ï¼šæ”¯æŒæ•°åäº¿å‘é‡çš„é«˜æ•ˆæ£€ç´¢\nâœ… å¯æ‰©å±•ï¼šæ”¯æŒåˆ†å¸ƒå¼éƒ¨ç½²\nâœ… ä¸°å¯Œç‰¹æ€§ï¼šæ”¯æŒå¤šç§ç´¢å¼•ç®—æ³•å’Œç›¸ä¼¼åº¦åº¦é‡\nâœ… äº‘åŸç”Ÿï¼šæ”¯æŒKuberneteséƒ¨ç½²\nâœ… å¤šè¯­è¨€æ”¯æŒï¼šPython, Go, Java, C++ç­‰\n\nåŠ£åŠ¿\nâŒ éƒ¨ç½²å¤æ‚ï¼šéœ€è¦å¤šä¸ªç»„ä»¶ååŒå·¥ä½œ\nâŒ èµ„æºæ¶ˆè€—ï¼šå¯¹å†…å­˜å’Œå­˜å‚¨è¦æ±‚è¾ƒé«˜\nâŒ å­¦ä¹ æ›²çº¿ï¼šé…ç½®å’Œè°ƒä¼˜ç›¸å¯¹å¤æ‚\n\né€‚ç”¨åœºæ™¯\nå¤§è§„æ¨¡å‘é‡æ£€ç´¢åº”ç”¨\né«˜å¹¶å‘åœ¨çº¿æœåŠ¡\nä¼ä¸šçº§AIåº”ç”¨\n\n2. Pinecone - äº‘åŸç”Ÿé¦–é€‰æ ¸å¿ƒç‰¹æ€§import pinecone# åˆå§‹åŒ–Pineconepinecone.init(api_key=&#x27;your-api-key&#x27;, environment=&#x27;us-east1-gcp&#x27;)# åˆ›å»ºç´¢å¼•index = pinecone.Index(&#x27;my-index&#x27;)# æ’å…¥å‘é‡vectors = [    (&#x27;id1&#x27;, [0.1, 0.2, 0.3, ...]),    (&#x27;id2&#x27;, [0.4, 0.5, 0.6, ...])]index.upsert(vectors)# æ£€ç´¢ç›¸ä¼¼å‘é‡query_vector = [0.1, 0.2, 0.3, ...]results = index.query(vector=query_vector, top_k=10)\n\nä¼˜åŠ¿\nâœ… å¼€ç®±å³ç”¨ï¼šæ— éœ€éƒ¨ç½²å’Œç®¡ç†åŸºç¡€è®¾æ–½\nâœ… è‡ªåŠ¨æ‰©å±•ï¼šæ ¹æ®è´Ÿè½½è‡ªåŠ¨è°ƒæ•´èµ„æº\nâœ… é«˜å¯ç”¨æ€§ï¼š99.9%çš„SLAä¿è¯\nâœ… ç®€å•æ˜“ç”¨ï¼šRESTful APIå’Œå¤šç§è¯­è¨€SDK\nâœ… å†…ç½®ä¼˜åŒ–ï¼šè‡ªåŠ¨ç´¢å¼•ä¼˜åŒ–å’Œæ€§èƒ½è°ƒä¼˜\n\nåŠ£åŠ¿\nâŒ æˆæœ¬è¾ƒé«˜ï¼šæŒ‰ä½¿ç”¨é‡è®¡è´¹\nâŒ æ•°æ®æ§åˆ¶ï¼šæ•°æ®å­˜å‚¨åœ¨Pineconeäº‘ç«¯\nâŒ ç½‘ç»œå»¶è¿Ÿï¼šä¾èµ–ç½‘ç»œè¿æ¥\nâŒ å®šåˆ¶é™åˆ¶ï¼šåŠŸèƒ½å®šåˆ¶ç©ºé—´æœ‰é™\n\né€‚ç”¨åœºæ™¯\nå¿«é€ŸåŸå‹å¼€å‘\nä¸­å°å‹AIåº”ç”¨\næ— åŸºç¡€è®¾æ–½ç®¡ç†éœ€æ±‚çš„é¡¹ç›®\n\n3. Weaviate - GraphQLä¼˜å…ˆæ ¸å¿ƒç‰¹æ€§# docker-compose.ymlversion: &#x27;3.4&#x27;services:  weaviate:    image: semitechnologies/weaviate:latest    ports:      - &quot;8080:8080&quot;    environment:      QUERY_DEFAULTS_LIMIT: 25      AUTHENTICATION_ANONYMOUS_ACCESS_ENABLED: &#x27;true&#x27;      PERSISTENCE_DATA_PATH: &#x27;/var/lib/weaviate&#x27;\n\nGraphQLæŸ¥è¯¢ç¤ºä¾‹&#123;  Get &#123;    Things &#123;      City &#123;        name        population        _additional &#123;          certainty        &#125;      &#125;    &#125;  &#125;&#125;\n\nä¼˜åŠ¿\nâœ… GraphQLæ”¯æŒï¼šç›´è§‚çš„æŸ¥è¯¢è¯­è¨€\nâœ… æ··åˆæœç´¢ï¼šæ”¯æŒå‘é‡+å…³é”®è¯æ··åˆæœç´¢\nâœ… æ¨¡å¼çµæ´»ï¼šåŠ¨æ€schemaå®šä¹‰\nâœ… æ’ä»¶ç”Ÿæ€ï¼šä¸°å¯Œçš„æ’ä»¶å’Œé›†æˆ\nâœ… å¤šç§Ÿæˆ·ï¼šæ”¯æŒå¤šç§Ÿæˆ·æ¶æ„\n\nåŠ£åŠ¿\nâŒ æ€§èƒ½é™åˆ¶ï¼šåœ¨å¤§è§„æ¨¡æ•°æ®ä¸‹æ€§èƒ½å¯èƒ½ä¸‹é™\nâŒ èµ„æºæ¶ˆè€—ï¼šå†…å­˜ä½¿ç”¨ç›¸å¯¹è¾ƒé«˜\nâŒ éƒ¨ç½²å¤æ‚ï¼šéœ€è¦é…ç½®å¤šä¸ªç»„ä»¶\n\né€‚ç”¨åœºæ™¯\néœ€è¦å¤æ‚æŸ¥è¯¢çš„åº”ç”¨\næ··åˆæœç´¢åœºæ™¯\nå¿«é€ŸåŸå‹å¼€å‘\n\n4. Qdrant - Rusté«˜æ€§èƒ½æ ¸å¿ƒç‰¹æ€§# docker-compose.ymlversion: &#x27;3.8&#x27;services:  qdrant:    image: qdrant/qdrant:v1.7.0    ports:      - &quot;6333:6333&quot;    volumes:      - ./qdrant_data:/qdrant/storage\n\nPythonå®¢æˆ·ç«¯ç¤ºä¾‹from qdrant_client import QdrantClient# è¿æ¥Qdrantclient = QdrantClient(&quot;localhost&quot;, port=6333)# åˆ›å»ºé›†åˆclient.create_collection(    collection_name=&quot;my_collection&quot;,    vectors_config=VectorParams(size=768, distance=Distance.COSINE))# æ’å…¥å‘é‡client.upsert(    collection_name=&quot;my_collection&quot;,    points=[        PointStruct(id=1, vector=[0.1, 0.2, 0.3, ...], payload=&#123;&quot;text&quot;: &quot;hello world&quot;&#125;),        PointStruct(id=2, vector=[0.4, 0.5, 0.6, ...], payload=&#123;&quot;text&quot;: &quot;goodbye world&quot;&#125;)    ])\n\nä¼˜åŠ¿\nâœ… é«˜æ€§èƒ½ï¼šRustç¼–å†™ï¼Œæ€§èƒ½ä¼˜å¼‚\nâœ… ç®€å•éƒ¨ç½²ï¼šå•å®¹å™¨å³å¯è¿è¡Œ\nâœ… RESTful APIï¼šæ ‡å‡†åŒ–çš„APIè®¾è®¡\nâœ… è¿‡æ»¤æ”¯æŒï¼šæ”¯æŒå…ƒæ•°æ®è¿‡æ»¤\nâœ… å¼€æºå…è´¹ï¼šå®Œå…¨å¼€æºï¼Œæ— å•†ä¸šé™åˆ¶\n\nåŠ£åŠ¿\nâŒ åŠŸèƒ½ç›¸å¯¹ç®€å•ï¼šç›¸æ¯”å•†ä¸šäº§å“åŠŸèƒ½è¾ƒå°‘\nâŒ ç”Ÿæ€ç³»ç»Ÿï¼šç¤¾åŒºå’Œç¬¬ä¸‰æ–¹å·¥å…·ç›¸å¯¹è¾ƒå°‘\nâŒ ç›‘æ§å·¥å…·ï¼šå†…ç½®ç›‘æ§åŠŸèƒ½æœ‰é™\n\né€‚ç”¨åœºæ™¯\nå¯¹æ€§èƒ½è¦æ±‚æé«˜çš„åº”ç”¨\nå¼€æºä¼˜å…ˆçš„é¡¹ç›®\nç®€å•å‘é‡æ£€ç´¢éœ€æ±‚\n\n5. ChromaDB - Pythonå‹å¥½æ ¸å¿ƒç‰¹æ€§import chromadb# åˆ›å»ºå®¢æˆ·ç«¯client = chromadb.Client()# åˆ›å»ºé›†åˆcollection = client.create_collection(name=&quot;my_collection&quot;)# æ·»åŠ æ–‡æ¡£å’Œå‘é‡collection.add(    documents=[&quot;This is a document&quot;, &quot;This is another document&quot;],    metadatas=[&#123;&quot;source&quot;: &quot;doc1&quot;&#125;, &#123;&quot;source&quot;: &quot;doc2&quot;&#125;],    ids=[&quot;id1&quot;, &quot;id2&quot;])# æŸ¥è¯¢ç›¸ä¼¼æ–‡æ¡£results = collection.query(    query_texts=[&quot;This is a query document&quot;],    n_results=2)\n\nä¼˜åŠ¿\nâœ… Pythonä¼˜å…ˆï¼šå®Œç¾çš„Pythoné›†æˆ\nâœ… è½»é‡çº§ï¼šæ— éœ€å¤–éƒ¨ä¾èµ–å³å¯è¿è¡Œ\nâœ… æ˜“äºä½¿ç”¨ï¼šç®€æ´çš„APIè®¾è®¡\nâœ… å¼€æºå…è´¹ï¼šApache 2.0è®¸å¯è¯\nâœ… å¿«é€ŸåŸå‹ï¼šé€‚åˆå¿«é€Ÿå¼€å‘å’Œæµ‹è¯•\n\nåŠ£åŠ¿\nâŒ ç”Ÿäº§å°±ç»ªï¼šä¸é€‚åˆå¤§è§„æ¨¡ç”Ÿäº§ç¯å¢ƒ\nâŒ æŒä¹…åŒ–ï¼šé»˜è®¤ä½¿ç”¨å†…å­˜å­˜å‚¨\nâŒ å¹¶å‘æ”¯æŒï¼šå¹¶å‘æ€§èƒ½æœ‰é™\nâŒ ä¼ä¸šåŠŸèƒ½ï¼šç¼ºå°‘ä¼ä¸šçº§åŠŸèƒ½\n\né€‚ç”¨åœºæ™¯\nå¿«é€ŸåŸå‹å¼€å‘\nå°å‹é¡¹ç›®\nå­¦ä¹ å’Œæµ‹è¯•\nPythonä¸ºä¸»çš„AIåº”ç”¨\n\n6. å…¶ä»–ä¸»æµäº§å“å¯¹æ¯”\n\n\näº§å“\néƒ¨ç½²æ–¹å¼\nå…è´¹é¢åº¦\næ€§èƒ½\næ˜“ç”¨æ€§\nä¼ä¸šåŠŸèƒ½\næ¨èæŒ‡æ•°\n\n\n\nMilvus\nè‡ªæ‰˜ç®¡\nå®Œå…¨å…è´¹\nâ­â­â­â­â­\nâ­â­â­\nâ­â­â­â­â­\nâ­â­â­â­â­\n\n\nPinecone\näº‘æœåŠ¡\n1Må‘é‡\nâ­â­â­â­â­\nâ­â­â­â­â­\nâ­â­â­â­â­\nâ­â­â­â­\n\n\nWeaviate\nè‡ªæ‰˜ç®¡\nå®Œå…¨å…è´¹\nâ­â­â­â­\nâ­â­â­â­\nâ­â­â­â­\nâ­â­â­â­\n\n\nQdrant\nè‡ªæ‰˜ç®¡\nå®Œå…¨å…è´¹\nâ­â­â­â­â­\nâ­â­â­â­\nâ­â­â­â­\nâ­â­â­â­â­\n\n\nChromaDB\nè‡ªæ‰˜ç®¡\nå®Œå…¨å…è´¹\nâ­â­â­\nâ­â­â­â­â­\nâ­â­\nâ­â­â­\n\n\nFaiss\nåµŒå…¥å¼\nå®Œå…¨å…è´¹\nâ­â­â­â­â­\nâ­â­\nâ­\nâ­â­â­\n\n\nğŸ› ï¸ è¯¦ç»†æ­å»ºæŒ‡å—æ–¹æ¡ˆä¸€ï¼šä½¿ç”¨Milvusï¼ˆæ¨èç”Ÿäº§ç¯å¢ƒï¼‰1. ç¯å¢ƒå‡†å¤‡# å®‰è£…Dockerå’ŒDocker Composecurl -fsSL https://get.docker.com -o get-docker.shsudo sh get-docker.sh# å®‰è£…Docker Composesudo curl -L &quot;https://github.com/docker/compose/releases/download/v2.20.0/docker-compose-$(uname -s)-$(uname -m)&quot; -o /usr/local/bin/docker-composesudo chmod +x /usr/local/bin/docker-compose\n\n2. åˆ›å»ºdocker-compose.ymlversion: &#x27;3.8&#x27;services:  etcd:    container_name: milvus-etcd    image: quay.io/coreos/etcd:v3.5.5    environment:      - ETCD_AUTO_COMPACTION_MODE=revision      - ETCD_AUTO_COMPACTION_RETENTION=1000      - ETCD_QUOTA_BACKEND_BYTES=4294967296      - ETCD_SNAPSHOT_COUNT=50000    volumes:      - etcd_data:/etcd    command: etcd -advertise-client-urls=http://127.0.0.1:2379 -listen-client-urls http://0.0.0.0:2379 --data-dir /etcd    healthcheck:      test: [&quot;CMD&quot;, &quot;etcdctl&quot;, &quot;endpoint&quot;, &quot;health&quot;]      interval: 30s      timeout: 20s      retries: 3  minio:    container_name: milvus-minio    image: minio/minio:RELEASE.2023-03-20T20-16-18Z    environment:      MINIO_ACCESS_KEY: minioadmin      MINIO_SECRET_KEY: minioadmin    ports:      - &quot;9001:9001&quot;      - &quot;9000:9000&quot;    volumes:      - minio_data:/minio_data    command: minio server /minio_data --console-address &quot;:9001&quot;    healthcheck:      test: [&quot;CMD&quot;, &quot;curl&quot;, &quot;-f&quot;, &quot;http://localhost:9000/minio/health/live&quot;]      interval: 30s      timeout: 20s      retries: 3  milvus-standalone:    container_name: milvus-standalone    image: milvusdb/milvus:v2.3.0    command: [&quot;milvus&quot;, &quot;run&quot;, &quot;standalone&quot;]    environment:      ETCD_ENDPOINTS: etcd:2379      MINIO_ADDRESS: minio:9000    volumes:      - milvus_data:/var/lib/milvus    ports:      - &quot;19530:19530&quot;      - &quot;9091:9091&quot;    depends_on:      - &quot;etcd&quot;      - &quot;minio&quot;    healthcheck:      test: [&quot;CMD&quot;, &quot;curl&quot;, &quot;-f&quot;, &quot;http://localhost:9091/healthz&quot;]      interval: 30s      start_period: 90s      timeout: 20s      retries: 3networks:  default:    name: milvusvolumes:  etcd_data:  minio_data:  milvus_data:\n\n3. å¯åŠ¨æœåŠ¡# å¯åŠ¨æ‰€æœ‰æœåŠ¡docker-compose up -d# æŸ¥çœ‹å¯åŠ¨çŠ¶æ€docker-compose ps# æŸ¥çœ‹æ—¥å¿—docker-compose logs -f milvus-standalone\n\n4. éªŒè¯å®‰è£…# å®‰è£…Pythonå®¢æˆ·ç«¯pip install pymilvus# æµ‹è¯•è¿æ¥python3 -c &quot;from pymilvus import connectionsconnections.connect(&#x27;default&#x27;, host=&#x27;localhost&#x27;, port=&#x27;19530&#x27;)print(&#x27;Milvusè¿æ¥æˆåŠŸï¼&#x27;)&quot;\n\næ–¹æ¡ˆäºŒï¼šä½¿ç”¨Pineconeï¼ˆæ¨èå¿«é€Ÿå¼€å§‹ï¼‰1. æ³¨å†Œè´¦æˆ·# è®¿é—®Pineconeå®˜ç½‘æ³¨å†Œopen https://www.pinecone.io/\n\n2. åˆ›å»ºAPIå¯†é’¥import pinecone# åˆå§‹åŒ–ï¼ˆæ›¿æ¢ä¸ºä½ çš„APIå¯†é’¥ï¼‰pinecone.init(api_key=&#x27;your-api-key&#x27;, environment=&#x27;us-east1-gcp&#x27;)# æŸ¥çœ‹å¯ç”¨ç¯å¢ƒprint(pinecone.list_environments())\n\n3. åˆ›å»ºç¬¬ä¸€ä¸ªç´¢å¼•# åˆ›å»ºç´¢å¼•index_name = &#x27;my-first-index&#x27;dimension = 768  # å‘é‡ç»´åº¦pinecone.create_index(    name=index_name,    dimension=dimension,    metric=&#x27;cosine&#x27;  # ç›¸ä¼¼åº¦åº¦é‡)# è¿æ¥åˆ°ç´¢å¼•index = pinecone.Index(index_name)print(f&quot;ç´¢å¼• &#x27;&#123;index_name&#125;&#x27; åˆ›å»ºæˆåŠŸï¼&quot;)\n\næ–¹æ¡ˆä¸‰ï¼šä½¿ç”¨Qdrantï¼ˆæ¨èè½»é‡çº§éƒ¨ç½²ï¼‰1. Dockeréƒ¨ç½²# æ‹‰å–é•œåƒdocker pull qdrant/qdrant# åˆ›å»ºæ•°æ®ç›®å½•mkdir -p qdrant_data# å¯åŠ¨å®¹å™¨docker run -p 6333:6333 -p 6334:6334 \\  -v $(pwd)/qdrant_data:/qdrant/storage \\  qdrant/qdrant\n\n2. Pythonå®¢æˆ·ç«¯æµ‹è¯•from qdrant_client import QdrantClient# è¿æ¥åˆ°Qdrantclient = QdrantClient(host=&quot;localhost&quot;, port=6333)# åˆ›å»ºé›†åˆclient.create_collection(    collection_name=&quot;test_collection&quot;,    vectors_config=VectorParams(size=768, distance=Distance.COSINE),)print(&quot;Qdrantè®¾ç½®å®Œæˆï¼&quot;)\n\nğŸ”§ æ€§èƒ½ä¼˜åŒ–ç­–ç•¥1. ç´¢å¼•ä¼˜åŒ–IVFç´¢å¼•é…ç½®# Milvus IVFé…ç½®index_params = &#123;    &quot;metric_type&quot;: &quot;COSINE&quot;,    &quot;index_type&quot;: &quot;IVF_FLAT&quot;,    &quot;params&quot;: &#123;&quot;nlist&quot;: 1024&#125;&#125;# åˆ›å»ºç´¢å¼•collection.create_index(&quot;vector&quot;, index_params)\n\nHNSWç´¢å¼•é…ç½®# Qdrant HNSWé…ç½®index_params = &#123;    &quot;type&quot;: &quot;HNSW&quot;,    &quot;m&quot;: 16,              # è¿æ¥æ•°    &quot;ef_construct&quot;: 200,  # æ„å»ºæ—¶efå‚æ•°    &quot;ef&quot;: 64,             # æŸ¥è¯¢æ—¶efå‚æ•°    &quot;distance&quot;: &quot;Cosine&quot;&#125;\n\n2. æ‰¹é‡æ“ä½œä¼˜åŒ–# æ‰¹é‡æ’å…¥ä¼˜åŒ–def batch_insert_vectors(collection, vectors, batch_size=1000):    for i in range(0, len(vectors), batch_size):        batch = vectors[i:i + batch_size]        collection.insert(batch)        print(f&quot;å·²æ’å…¥ &#123;i + len(batch)&#125; / &#123;len(vectors)&#125; ä¸ªå‘é‡&quot;)# ä½¿ç”¨ç¤ºä¾‹batch_insert_vectors(collection, all_vectors, batch_size=2000)\n\n3. æŸ¥è¯¢æ€§èƒ½ä¼˜åŒ–# é¢„çƒ­ç´¢å¼•def warmup_index(index, sample_queries, n_queries=100):    for _ in range(n_queries):        query = random.choice(sample_queries)        index.search(query, top_k=10)    print(&quot;ç´¢å¼•é¢„çƒ­å®Œæˆ&quot;)# å¹¶å‘æŸ¥è¯¢ä¼˜åŒ–import asyncioimport aiohttpasync def concurrent_search(index, queries, concurrency=10):    semaphore = asyncio.Semaphore(concurrency)        async def search_single(query):        async with semaphore:            return await index.search(query, top_k=10)        tasks = [search_single(query) for query in queries]    results = await asyncio.gather(*tasks)    return results\n\nğŸ“Š ç›‘æ§å’Œç»´æŠ¤1. æ€§èƒ½ç›‘æ§# Milvusæ€§èƒ½ç›‘æ§from pymilvus import connections, utilitydef monitor_milvus():    # è¿æ¥åˆ°Milvus    connections.connect(&quot;default&quot;, host=&quot;localhost&quot;, port=&quot;19530&quot;)        # è·å–ç³»ç»Ÿä¿¡æ¯    system_info = utility.get_system_info()    print(&quot;ç³»ç»Ÿä¿¡æ¯:&quot;, system_info)        # è·å–é›†åˆç»Ÿè®¡    collections = utility.list_collections()    for collection in collections:        stats = utility.get_collection_stats(collection)        print(f&quot;&#123;collection&#125; ç»Ÿè®¡:&quot;, stats)# Qdrantç›‘æ§from qdrant_client import QdrantClientdef monitor_qdrant():    client = QdrantClient(&quot;localhost&quot;, port=6333)        # è·å–é›†ç¾¤ä¿¡æ¯    info = client.get_collections()    print(&quot;Qdrantä¿¡æ¯:&quot;, info)        # è·å–é›†åˆè¯¦æƒ…    for collection in info.collections:        details = client.get_collection(collection.name)        print(f&quot;&#123;collection.name&#125; è¯¦æƒ…:&quot;, details)\n\n2. å¤‡ä»½å’Œæ¢å¤# Milvuså¤‡ä»½docker exec milvus-etcd etcdctl snapshot save /backup/etcd-snapshot.db# Qdrantå¤‡ä»½docker exec qdrant-container \\  tar czf /backup/qdrant-backup.tar.gz /qdrant/storage# Pineconeå¯¼å‡ºï¼ˆé€šè¿‡APIï¼‰import pineconeindex = pinecone.Index(&#x27;my-index&#x27;)vectors = index.query(vector=[0]*768, top_k=10000, include_values=True)\n\nğŸ¯ é€‰æ‹©å»ºè®®å¿«é€Ÿä¸Šæ‰‹ï¼ˆå­¦ä¹ /åŸå‹ï¼‰# æ¨èChromaDBpip install chromadb\n\nä¸­å°å‹é¡¹ç›®# æ¨èQdrantæˆ–Weaviatedocker run -p 6333:6333 qdrant/qdrant\n\nå¤§å‹ç”Ÿäº§ç¯å¢ƒ# æ¨èMilvus# ä½¿ç”¨ä¸Šé¢çš„docker-composeé…ç½®\n\näº‘æœåŠ¡é¦–é€‰# æ¨èPinecone# é›¶è¿ç»´ï¼Œé«˜å¯ç”¨\n\nğŸ”„ å‘å±•è¶‹åŠ¿1. äº‘åŸç”Ÿè¶‹åŠ¿\nServerlesså‘é‡æ•°æ®åº“ï¼šæŒ‰éœ€ä»˜è´¹ï¼Œæ— éœ€ç®¡ç†\nå¤šäº‘éƒ¨ç½²ï¼šæ”¯æŒAWSã€GCPã€Azureç­‰\nè¾¹ç¼˜è®¡ç®—ï¼šå‘é‡æ•°æ®åº“å‘è¾¹ç¼˜å»¶ä¼¸\n\n2. åŠŸèƒ½å¢å¼º\næ··åˆæœç´¢ï¼šå‘é‡+å…³é”®è¯+ç»“æ„åŒ–æ•°æ®æ··åˆ\nå®æ—¶æ›´æ–°ï¼šæµå¼æ•°æ®å®æ—¶å‘é‡åŒ–å’Œç´¢å¼•\nå¤šæ¨¡æ€æ”¯æŒï¼šæ–‡æœ¬ã€å›¾åƒã€éŸ³é¢‘ç­‰å¤šæ¨¡æ€å‘é‡\n\n3. æ€§èƒ½ä¼˜åŒ–\nGPUåŠ é€Ÿï¼šåˆ©ç”¨GPUè¿›è¡Œå‘é‡è®¡ç®—\né‡åŒ–æŠ€æœ¯ï¼šå‡å°‘å­˜å‚¨ç©ºé—´å’Œè®¡ç®—å¼€é”€\nåˆ†å¸ƒå¼æ¶æ„ï¼šæ”¯æŒPBçº§å‘é‡æ•°æ®çš„å¤„ç†\n\nğŸ“š æ€»ç»“æ ¸å¿ƒè¦ç‚¹å›é¡¾\nå‘é‡æ•°æ®åº“æ˜¯AIåº”ç”¨çš„åŸºç¡€è®¾æ–½\n\næ”¯æŒè¯­ä¹‰æœç´¢ã€æ¨èç³»ç»Ÿã€RAGåº”ç”¨ç­‰\nå‘é‡åµŒå…¥ + ç›¸ä¼¼åº¦æ£€ç´¢çš„æ ¸å¿ƒæ¨¡å¼\n\n\né€‰æ‹©åˆé€‚çš„å‘é‡æ•°æ®åº“\n\nå­¦ä¹ /åŸå‹ï¼šChromaDB\nä¸­å°å‹é¡¹ç›®ï¼šQdrantã€Weaviate\nå¤§å‹ç”Ÿäº§ï¼šMilvus\näº‘æœåŠ¡ï¼šPinecone\n\n\næ€§èƒ½å’Œæˆæœ¬çš„å¹³è¡¡\n\nè‡ªæ‰˜ç®¡ï¼šå®Œå…¨æ§åˆ¶ï¼Œä½†éœ€è¦è¿ç»´\näº‘æœåŠ¡ï¼šå¼€ç®±å³ç”¨ï¼Œä½†æœ‰ä½¿ç”¨æˆæœ¬\n\n\nå‘å±•è¶‹åŠ¿å…³æ³¨\n\näº‘åŸç”Ÿå’ŒServerless\nå¤šæ¨¡æ€å’Œæ··åˆæœç´¢\nå®æ—¶å¤„ç†å’Œè¾¹ç¼˜è®¡ç®—\n\n\n\næŠ€æœ¯æ ˆæ¨èå…¥é—¨çº§# ChromaDB + Sentence Transformerspip install chromadb sentence-transformers\n\nç”Ÿäº§çº§# Milvus + OpenAI Embeddingspip install pymilvus openai\n\näº‘æœåŠ¡# Pinecone + LangChainpip install pinecone langchain\n\nå‘é‡æ•°æ®åº“å·²æˆä¸ºç°ä»£AIåº”ç”¨ä¸å¯æˆ–ç¼ºçš„ç»„ä»¶ï¼Œé€‰æ‹©åˆé€‚çš„å‘é‡æ•°æ®åº“å¹¶æŒæ¡å…¶æ­å»ºå’Œä¼˜åŒ–æ–¹æ³•ï¼Œå°†ä¸ºæ‚¨çš„AIé¡¹ç›®å¥ å®šåšå®çš„æŠ€æœ¯åŸºç¡€ã€‚\n\nğŸ”— ç›¸å…³èµ„æº\n\nMilvuså®˜æ–¹æ–‡æ¡£\nPineconeæ–‡æ¡£\nQdrantæ–‡æ¡£\nWeaviateæ–‡æ¡£\nChromaDBæ–‡æ¡£\n\n\nğŸ¯ å¼€å§‹æ‚¨çš„å‘é‡æ•°æ®åº“ä¹‹æ—…ï¼ ğŸš€\n","tags":["AIåº”ç”¨","å‘é‡æ•°æ®åº“","VectorDB","Milvus","Pinecone","Weaviate","Qdrant","ChromaDB","æœºå™¨å­¦ä¹ ","æ£€ç´¢å¢å¼ºç”Ÿæˆ"]},{"title":"Javaé«˜å¾·åœ°å›¾MCPå®šåˆ¶æ—…æ¸¸è·¯çº¿","url":"/2025/01/17/0.5.4-Java%E9%AB%98%E5%BE%B7%E5%9C%B0%E5%9B%BEMCP%E5%AE%9A%E5%88%B6%E6%97%85%E6%B8%B8%E8%B7%AF%E7%BA%BF/","content":"\nä½¿ç”¨Javaé›†æˆé«˜å¾·åœ°å›¾MCPæœåŠ¡ï¼Œæ‰“é€ æ™ºèƒ½åŒ–çš„å®šåˆ¶æ—…æ¸¸è·¯çº¿è§„åˆ’ç³»ç»Ÿã€‚æœ¬æ–‡å°†å¸¦ä½ ä»é›¶å¼€å§‹ï¼ŒæŒæ¡é«˜å¾·åœ°å›¾Java SDKçš„ä½¿ç”¨æŠ€å·§ï¼Œå®ç°å®Œæ•´çš„æ—…æ¸¸è·¯çº¿è§„åˆ’åŠŸèƒ½ã€‚\n\né«˜å¾·åœ°å›¾MCPç®€ä»‹é«˜å¾·åœ°å›¾MCPï¼ˆMaps Content Platformï¼‰æ˜¯é«˜å¾·åœ°å›¾æä¾›çš„ä¸€å¥—å¼€æ”¾å¹³å°æœåŠ¡ï¼Œå¼€å‘è€…å¯ä»¥é€šè¿‡APIè°ƒç”¨è·å–ä¸°å¯Œçš„åœ°å›¾æ•°æ®å’Œåœ°ç†ä¿¡æ¯æœåŠ¡ã€‚é«˜å¾·åœ°å›¾Java SDKæä¾›äº†å®Œæ•´çš„Javaå°è£…ï¼Œè®©Javaå¼€å‘è€…èƒ½å¤Ÿè½»æ¾é›†æˆé«˜å¾·åœ°å›¾çš„å„é¡¹åŠŸèƒ½ã€‚\nä¸ºä»€ä¹ˆé€‰æ‹©é«˜å¾·åœ°å›¾MCPï¼Ÿ\næ•°æ®ä¸°å¯Œå‡†ç¡®ï¼šä¸­å›½æœ€æƒå¨çš„åœ°å›¾æ•°æ®æä¾›å•†\næœåŠ¡ç¨³å®šå¯é ï¼šä¼ä¸šçº§SLAä¿è¯ï¼ŒæœåŠ¡å¯ç”¨æ€§99.9%\nåŠŸèƒ½å…¨é¢ï¼šè¦†ç›–è·¯å¾„è§„åˆ’ã€åœ°ç†ç¼–ç ã€POIæœç´¢ç­‰å…¨æ–¹ä½æœåŠ¡\nJava SDKå®Œå–„ï¼šå®˜æ–¹ç»´æŠ¤çš„Java SDKï¼Œæ›´æ–°åŠæ—¶\næˆæœ¬å¯æ§ï¼šæŒ‰éœ€ä»˜è´¹ï¼Œé€‚åˆå„ç§è§„æ¨¡åº”ç”¨\nåˆè§„å®‰å…¨ï¼šç¬¦åˆä¸­å›½æ³•å¾‹æ³•è§„ï¼Œæ”¯æŒæ•°æ®åŠ å¯†ä¼ è¾“\n\næ ¸å¿ƒåŠŸèƒ½è¯¦è§£1. POIæœç´¢ï¼ˆå…´è¶£ç‚¹æœç´¢ï¼‰POIï¼ˆPoint of Interestï¼‰æœç´¢æ˜¯åœ°å›¾åº”ç”¨çš„åŸºç¡€åŠŸèƒ½ï¼Œç”¨äºæŸ¥æ‰¾é™„è¿‘çš„æ™¯ç‚¹ã€é¤å…ã€é…’åº—ç­‰ã€‚\n@Service@Slf4jpublic class PoiSearchService &#123;    private final AmapRestTemplate restTemplate;    private final String apiKey;    public PoiSearchService(@Value(&quot;$&#123;amap.api-key&#125;&quot;) String apiKey) &#123;        this.apiKey = apiKey;        this.restTemplate = new AmapRestTemplate();    &#125;    /**     * æœç´¢é™„è¿‘çš„æ™¯ç‚¹     */    public List&lt;PoiInfo&gt; searchNearbyAttractions(String location, int radius) &#123;        String url = String.format(            &quot;https://restapi.amap.com/v3/place/around?key=%s&amp;location=%s&amp;radius=%d&amp;types=110200|110201&quot;,            apiKey, location, radius        );        try &#123;            AmapPoiResponse response = restTemplate.getForObject(url, AmapPoiResponse.class);            if (response != null &amp;&amp; &quot;1&quot;.equals(response.getStatus())) &#123;                return response.getPois().stream()                    .map(this::convertToPoiInfo)                    .collect(Collectors.toList());            &#125;            return Collections.emptyList();        &#125; catch (Exception e) &#123;            log.error(&quot;POIæœç´¢å¤±è´¥&quot;, e);            return Collections.emptyList();        &#125;    &#125;    /**     * æ ¹æ®å…³é”®è¯æœç´¢æ™¯ç‚¹     */    public List&lt;PoiInfo&gt; searchAttractionsByKeyword(String keyword, String city) &#123;        String url = String.format(            &quot;https://restapi.amap.com/v3/place/text?key=%s&amp;keywords=%s&amp;city=%s&amp;types=110200&quot;,            apiKey, URLEncoder.encode(keyword, StandardCharsets.UTF_8), city        );        try &#123;            AmapPoiResponse response = restTemplate.getForObject(url, AmapPoiResponse.class);            if (response != null &amp;&amp; &quot;1&quot;.equals(response.getStatus())) &#123;                return response.getPois().stream()                    .map(this::convertToPoiInfo)                    .collect(Collectors.toList());            &#125;            return Collections.emptyList();        &#125; catch (Exception e) &#123;            log.error(&quot;å…³é”®è¯æœç´¢å¤±è´¥&quot;, e);            return Collections.emptyList();        &#125;    &#125;    private PoiInfo convertToPoiInfo(AmapPoi amapPoi) &#123;        return PoiInfo.builder()            .id(amapPoi.getId())            .name(amapPoi.getName())            .location(amapPoi.getLocation())            .address(amapPoi.getAddress())            .tel(amapPoi.getTel())            .tag(amapPoi.getTag())            .website(amapPoi.getWebsite())            .photos(parsePhotos(amapPoi.getPhotos()))            .build();    &#125;    private List&lt;String&gt; parsePhotos(String photos) &#123;        if (StringUtils.isEmpty(photos)) &#123;            return Collections.emptyList();        &#125;        return Arrays.stream(photos.split(&quot;;&quot;))            .filter(StringUtils::isNotEmpty)            .collect(Collectors.toList());    &#125;&#125;\n\n2. è·¯å¾„è§„åˆ’è·¯å¾„è§„åˆ’æ˜¯æ—…æ¸¸åº”ç”¨çš„æ ¸å¿ƒåŠŸèƒ½ï¼Œæ”¯æŒé©¾è½¦ã€å…¬äº¤ã€åœ°é“ç­‰å¤šç§å‡ºè¡Œæ–¹å¼ã€‚\n@Servicepublic class RoutePlanningService &#123;    private final AmapRestTemplate restTemplate;    private final String apiKey;    public RoutePlanningService(@Value(&quot;$&#123;amap.api-key&#125;&quot;) String apiKey) &#123;        this.apiKey = apiKey;        this.restTemplate = new AmapRestTemplate();    &#125;    /**     * é©¾è½¦è·¯å¾„è§„åˆ’     */    public DrivingRoute planDrivingRoute(String origin, String destination) &#123;        String url = String.format(            &quot;https://restapi.amap.com/v3/direction/driving?key=%s&amp;origin=%s&amp;destination=%s&amp;extensions=all&quot;,            apiKey, origin, destination        );        try &#123;            AmapDrivingResponse response = restTemplate.getForObject(url, AmapDrivingResponse.class);            if (response != null &amp;&amp; &quot;1&quot;.equals(response.getStatus())) &#123;                return convertToDrivingRoute(response);            &#125;            throw new RoutePlanningException(&quot;è·¯å¾„è§„åˆ’å¤±è´¥ï¼š&quot; + response.getInfo());        &#125; catch (Exception e) &#123;            log.error(&quot;é©¾è½¦è·¯å¾„è§„åˆ’å¤±è´¥&quot;, e);            throw new RoutePlanningException(&quot;è·¯å¾„è§„åˆ’æœåŠ¡æš‚æ—¶ä¸å¯ç”¨&quot;, e);        &#125;    &#125;    /**     * å…¬äº¤è·¯å¾„è§„åˆ’     */    public BusRoute planBusRoute(String origin, String destination, String city) &#123;        String url = String.format(            &quot;https://restapi.amap.com/v3/direction/transit/integrated?key=%s&amp;origin=%s&amp;destination=%s&amp;city=%s&amp;extensions=all&quot;,            apiKey, origin, destination, city        );        try &#123;            AmapBusResponse response = restTemplate.getForObject(url, AmapBusResponse.class);            if (response != null &amp;&amp; &quot;1&quot;.equals(response.getStatus())) &#123;                return convertToBusRoute(response);            &#125;            throw new RoutePlanningException(&quot;å…¬äº¤è·¯å¾„è§„åˆ’å¤±è´¥ï¼š&quot; + response.getInfo());        &#125; catch (Exception e) &#123;            log.error(&quot;å…¬äº¤è·¯å¾„è§„åˆ’å¤±è´¥&quot;, e);            throw new RoutePlanningException(&quot;å…¬äº¤è·¯å¾„è§„åˆ’æœåŠ¡æš‚æ—¶ä¸å¯ç”¨&quot;, e);        &#125;    &#125;    /**     * æ­¥è¡Œè·¯å¾„è§„åˆ’     */    public WalkingRoute planWalkingRoute(String origin, String destination) &#123;        String url = String.format(            &quot;https://restapi.amap.com/v3/direction/walking?key=%s&amp;origin=%s&amp;destination=%s&quot;,            apiKey, origin, destination        );        try &#123;            AmapWalkingResponse response = restTemplate.getForObject(url, AmapWalkingResponse.class);            if (response != null &amp;&amp; &quot;1&quot;.equals(response.getStatus())) &#123;                return convertToWalkingRoute(response);            &#125;            throw new RoutePlanningException(&quot;æ­¥è¡Œè·¯å¾„è§„åˆ’å¤±è´¥ï¼š&quot; + response.getInfo());        &#125; catch (Exception e) &#123;            log.error(&quot;æ­¥è¡Œè·¯å¾„è§„åˆ’å¤±è´¥&quot;, e);            throw new RoutePlanningException(&quot;æ­¥è¡Œè·¯å¾„è§„åˆ’æœåŠ¡æš‚æ—¶ä¸å¯ç”¨&quot;, e);        &#125;    &#125;    private DrivingRoute convertToDrivingRoute(AmapDrivingResponse response) &#123;        // è½¬æ¢é€»è¾‘        return DrivingRoute.builder()            .distance(response.getRoute().getPaths().get(0).getDistance())            .duration(response.getRoute().getPaths().get(0).getDuration())            .taxiCost(response.getRoute().getPaths().get(0).getTaxiCost())            .steps(convertDrivingSteps(response.getRoute().getPaths().get(0).getSteps()))            .build();    &#125;    private List&lt;DrivingStep&gt; convertDrivingSteps(List&lt;AmapDrivingStep&gt; steps) &#123;        return steps.stream()            .map(step -&gt; DrivingStep.builder()                .instruction(step.getInstruction())                .orientation(step.getOrientation())                .road(step.getRoad())                .distance(step.getDistance())                .duration(step.getDuration())                .polyline(step.getPolyline())                .build())            .collect(Collectors.toList());    &#125;&#125;\n\n3. åœ°ç†ç¼–ç ä¸é€†åœ°ç†ç¼–ç åœ°ç†ç¼–ç å¯ä»¥å°†åœ°å€è½¬æ¢ä¸ºåæ ‡ï¼Œé€†åœ°ç†ç¼–ç å¯ä»¥å°†åæ ‡è½¬æ¢ä¸ºåœ°å€ä¿¡æ¯ã€‚\n@Servicepublic class GeocodingService &#123;    private final AmapRestTemplate restTemplate;    private final String apiKey;    public GeocodingService(@Value(&quot;$&#123;amap.api-key&#125;&quot;) String apiKey) &#123;        this.apiKey = apiKey;        this.restTemplate = new AmapRestTemplate();    &#125;    /**     * åœ°ç†ç¼–ç ï¼šåœ°å€è½¬åæ ‡     */    public List&lt;GeocodeResult&gt; geocode(String address, String city) &#123;        String url = String.format(            &quot;https://restapi.amap.com/v3/geocode/geo?key=%s&amp;address=%s&amp;city=%s&quot;,            apiKey,            URLEncoder.encode(address, StandardCharsets.UTF_8),            URLEncoder.encode(city, StandardCharsets.UTF_8)        );        try &#123;            AmapGeocodeResponse response = restTemplate.getForObject(url, AmapGeocodeResponse.class);            if (response != null &amp;&amp; &quot;1&quot;.equals(response.getStatus())) &#123;                return response.getGeocodes().stream()                    .map(this::convertToGeocodeResult)                    .collect(Collectors.toList());            &#125;            return Collections.emptyList();        &#125; catch (Exception e) &#123;            log.error(&quot;åœ°ç†ç¼–ç å¤±è´¥&quot;, e);            return Collections.emptyList();        &#125;    &#125;    /**     * é€†åœ°ç†ç¼–ç ï¼šåæ ‡è½¬åœ°å€     */    public RegeocodeResult regeocode(String location) &#123;        String url = String.format(            &quot;https://restapi.amap.com/v3/geocode/regeo?key=%s&amp;location=%s&amp;extensions=all&quot;,            apiKey, location        );        try &#123;            AmapRegeocodeResponse response = restTemplate.getForObject(url, AmapRegeocodeResponse.class);            if (response != null &amp;&amp; &quot;1&quot;.equals(response.getStatus())) &#123;                return convertToRegeocodeResult(response);            &#125;            throw new GeocodingException(&quot;é€†åœ°ç†ç¼–ç å¤±è´¥ï¼š&quot; + response.getInfo());        &#125; catch (Exception e) &#123;            log.error(&quot;é€†åœ°ç†ç¼–ç å¤±è´¥&quot;, e);            throw new GeocodingException(&quot;é€†åœ°ç†ç¼–ç æœåŠ¡æš‚æ—¶ä¸å¯ç”¨&quot;, e);        &#125;    &#125;    /**     * æ‰¹é‡åœ°ç†ç¼–ç      */    public List&lt;GeocodeResult&gt; batchGeocode(List&lt;String&gt; addresses, String city) &#123;        return addresses.stream()            .map(address -&gt; geocode(address, city))            .flatMap(List::stream)            .collect(Collectors.toList());    &#125;    private GeocodeResult convertToGeocodeResult(AmapGeocode geocode) &#123;        return GeocodeResult.builder()            .formattedAddress(geocode.getFormattedAddress())            .location(geocode.getLocation())            .province(geocode.getProvince())            .city(geocode.getCity())            .district(geocode.getDistrict())            .township(geocode.getTownship())            .neighborhood(geocode.getNeighborhood())            .building(geocode.getBuilding())            .adcode(geocode.getAdcode())            .build();    &#125;    private RegeocodeResult convertToRegeocodeResult(AmapRegeocodeResponse response) &#123;        AmapRegeocode regeocode = response.getRegeocode();        return RegeocodeResult.builder()            .formattedAddress(regeocode.getFormattedAddress())            .addressComponent(convertAddressComponent(regeocode.getAddressComponent()))            .roads(convertRoads(regeocode.getRoads()))            .pois(convertPois(regeocode.getPois()))            .aois(convertAois(regeocode.getAois()))            .build();    &#125;&#125;\n\n4. è·ç¦»æµ‹é‡è®¡ç®—ä¸¤ä¸ªåœ°ç‚¹ä¹‹é—´çš„è·ç¦»ï¼Œæ”¯æŒç›´çº¿è·ç¦»å’Œé©¾è½¦è·ç¦»ã€‚\n@Servicepublic class DistanceService &#123;    private final AmapRestTemplate restTemplate;    private final String apiKey;    public DistanceService(@Value(&quot;$&#123;amap.api-key&#125;&quot;) String apiKey) &#123;        this.apiKey = apiKey;        this.restTemplate = new AmapRestTemplate();    &#125;    /**     * è®¡ç®—ç›´çº¿è·ç¦»     */    public double calculateStraightDistance(String origin, String destination) &#123;        try &#123;            String[] originCoords = origin.split(&quot;,&quot;);            String[] destCoords = destination.split(&quot;,&quot;);            double lat1 = Double.parseDouble(originCoords[1]);            double lon1 = Double.parseDouble(originCoords[0]);            double lat2 = Double.parseDouble(destCoords[1]);            double lon2 = Double.parseDouble(destCoords[0]);            return calculateHaversineDistance(lat1, lon1, lat2, lon2);        &#125; catch (Exception e) &#123;            log.error(&quot;è®¡ç®—ç›´çº¿è·ç¦»å¤±è´¥&quot;, e);            return 0.0;        &#125;    &#125;    /**     * è®¡ç®—é©¾è½¦è·ç¦»     */    public DrivingDistance calculateDrivingDistance(String origin, String destination) &#123;        String url = String.format(            &quot;https://restapi.amap.com/v3/distance?key=%s&amp;origins=%s&amp;destination=%s&amp;type=1&quot;,            apiKey, origin, destination        );        try &#123;            AmapDistanceResponse response = restTemplate.getForObject(url, AmapDistanceResponse.class);            if (response != null &amp;&amp; &quot;1&quot;.equals(response.getStatus())) &#123;                AmapDistanceResult result = response.getResults().get(0);                return DrivingDistance.builder()                    .distance(result.getDistance())                    .duration(result.getDuration())                    .build();            &#125;            throw new DistanceCalculationException(&quot;é©¾è½¦è·ç¦»è®¡ç®—å¤±è´¥ï¼š&quot; + response.getInfo());        &#125; catch (Exception e) &#123;            log.error(&quot;è®¡ç®—é©¾è½¦è·ç¦»å¤±è´¥&quot;, e);            throw new DistanceCalculationException(&quot;è·ç¦»è®¡ç®—æœåŠ¡æš‚æ—¶ä¸å¯ç”¨&quot;, e);        &#125;    &#125;    /**     * æ‰¹é‡è®¡ç®—è·ç¦»     */    public List&lt;DrivingDistance&gt; batchCalculateDistances(String origins, String destination) &#123;        String url = String.format(            &quot;https://restapi.amap.com/v3/distance?key=%s&amp;origins=%s&amp;destination=%s&amp;type=1&quot;,            apiKey, origins, destination        );        try &#123;            AmapDistanceResponse response = restTemplate.getForObject(url, AmapDistanceResponse.class);            if (response != null &amp;&amp; &quot;1&quot;.equals(response.getStatus())) &#123;                return response.getResults().stream()                    .map(result -&gt; DrivingDistance.builder()                        .distance(result.getDistance())                        .duration(result.getDuration())                        .build())                    .collect(Collectors.toList());            &#125;            return Collections.emptyList();        &#125; catch (Exception e) &#123;            log.error(&quot;æ‰¹é‡è®¡ç®—è·ç¦»å¤±è´¥&quot;, e);            return Collections.emptyList();        &#125;    &#125;    /**     * ä½¿ç”¨Haversineå…¬å¼è®¡ç®—çƒé¢è·ç¦»     */    private double calculateHaversineDistance(double lat1, double lon1, double lat2, double lon2) &#123;        final int EARTH_RADIUS = 6371; // åœ°çƒåŠå¾„ï¼Œå•ä½ï¼šå…¬é‡Œ        double latDistance = Math.toRadians(lat2 - lat1);        double lonDistance = Math.toRadians(lon2 - lon1);        double a = Math.sin(latDistance / 2) * Math.sin(latDistance / 2)                + Math.cos(Math.toRadians(lat1)) * Math.cos(Math.toRadians(lat2))                * Math.sin(lonDistance / 2) * Math.sin(lonDistance / 2);        double c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));        return EARTH_RADIUS * c;    &#125;&#125;\n\nå®æˆ˜æ¡ˆä¾‹ï¼šæ™ºèƒ½æ—…æ¸¸è·¯çº¿è§„åˆ’ç³»ç»Ÿé¡¹ç›®ç»“æ„java-amap-tour-planning/â”œâ”€â”€ src/main/java/com/example/amap/â”‚   â”œâ”€â”€ config/                    # é…ç½®ç±»â”‚   â”‚   â”œâ”€â”€ AmapConfig.java       # é«˜å¾·åœ°å›¾é…ç½®â”‚   â”‚   â””â”€â”€ WebConfig.java        # Webé…ç½®â”‚   â”œâ”€â”€ controller/               # æ§åˆ¶å™¨â”‚   â”‚   â”œâ”€â”€ TourController.java   # æ—…æ¸¸è·¯çº¿æ¥å£â”‚   â”‚   â””â”€â”€ MapController.java    # åœ°å›¾æœåŠ¡æ¥å£â”‚   â”œâ”€â”€ service/                  # ä¸šåŠ¡æœåŠ¡â”‚   â”‚   â”œâ”€â”€ PoiSearchService.java # POIæœç´¢æœåŠ¡â”‚   â”‚   â”œâ”€â”€ RoutePlanningService.java # è·¯çº¿è§„åˆ’æœåŠ¡â”‚   â”‚   â”œâ”€â”€ GeocodingService.java # åœ°ç†ç¼–ç æœåŠ¡â”‚   â”‚   â””â”€â”€ DistanceService.java  # è·ç¦»è®¡ç®—æœåŠ¡â”‚   â”œâ”€â”€ model/                    # æ•°æ®æ¨¡å‹â”‚   â”‚   â”œâ”€â”€ request/              # è¯·æ±‚æ¨¡å‹â”‚   â”‚   â”‚   â”œâ”€â”€ TourPlanRequest.javaâ”‚   â”‚   â”‚   â””â”€â”€ RouteRequest.javaâ”‚   â”‚   â”œâ”€â”€ response/             # å“åº”æ¨¡å‹â”‚   â”‚   â”‚   â”œâ”€â”€ TourPlanResponse.javaâ”‚   â”‚   â”‚   â””â”€â”€ RouteResponse.javaâ”‚   â”‚   â””â”€â”€ entity/               # å®ä½“æ¨¡å‹â”‚   â”‚       â”œâ”€â”€ PoiInfo.javaâ”‚   â”‚       â”œâ”€â”€ Route.javaâ”‚   â”‚       â””â”€â”€ Location.javaâ”‚   â”œâ”€â”€ exception/                # å¼‚å¸¸å¤„ç†â”‚   â”‚   â”œâ”€â”€ AmapApiException.javaâ”‚   â”‚   â””â”€â”€ GlobalExceptionHandler.javaâ”‚   â””â”€â”€ utils/                    # å·¥å…·ç±»â”‚       â”œâ”€â”€ AmapRestTemplate.java # é«˜å¾·APIå·¥å…·â”‚       â””â”€â”€ LocationUtils.java    # ä½ç½®å·¥å…·ç±»â”œâ”€â”€ src/main/resources/â”‚   â”œâ”€â”€ application.yml           # åº”ç”¨é…ç½®â”‚   â””â”€â”€ static/                   # é™æ€èµ„æºâ””â”€â”€ pom.xml                       # Mavenä¾èµ–\n\nMavenä¾èµ–é…ç½®&lt;!-- pom.xml --&gt;&lt;dependencies&gt;    &lt;!-- Spring Boot --&gt;    &lt;dependency&gt;        &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;        &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt;    &lt;/dependency&gt;    &lt;!-- é«˜å¾·åœ°å›¾Java SDK --&gt;    &lt;dependency&gt;        &lt;groupId&gt;com.amap.api&lt;/groupId&gt;        &lt;artifactId&gt;amap-java-sdk&lt;/artifactId&gt;        &lt;version&gt;1.0.0&lt;/version&gt;    &lt;/dependency&gt;    &lt;!-- HTTPå®¢æˆ·ç«¯ --&gt;    &lt;dependency&gt;        &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;        &lt;artifactId&gt;spring-boot-starter-webflux&lt;/artifactId&gt;    &lt;/dependency&gt;    &lt;!-- JSONå¤„ç† --&gt;    &lt;dependency&gt;        &lt;groupId&gt;com.fasterxml.jackson.core&lt;/groupId&gt;        &lt;artifactId&gt;jackson-databind&lt;/artifactId&gt;    &lt;/dependency&gt;    &lt;!-- å…¶ä»–å·¥å…· --&gt;    &lt;dependency&gt;        &lt;groupId&gt;org.apache.commons&lt;/groupId&gt;        &lt;artifactId&gt;commons-lang3&lt;/artifactId&gt;    &lt;/dependency&gt;    &lt;!-- Lombok --&gt;    &lt;dependency&gt;        &lt;groupId&gt;org.projectlombok&lt;/groupId&gt;        &lt;artifactId&gt;lombok&lt;/artifactId&gt;        &lt;optional&gt;true&lt;/optional&gt;    &lt;/dependency&gt;&lt;/dependencies&gt;\n\næ ¸å¿ƒæ§åˆ¶å™¨@RestController@RequestMapping(&quot;/api/tour&quot;)@RequiredArgsConstructor@Slf4jpublic class TourController &#123;    private final TourPlanningService tourPlanningService;    private final PoiSearchService poiSearchService;    private final RoutePlanningService routePlanningService;    @PostMapping(&quot;/plan&quot;)    public ResponseEntity&lt;TourPlanResponse&gt; createTourPlan(@Valid @RequestBody TourPlanRequest request) &#123;        log.info(&quot;åˆ›å»ºæ—…æ¸¸è®¡åˆ’ï¼š&#123;&#125;&quot;, request.getDestination());        try &#123;            TourPlanResponse response = tourPlanningService.createTourPlan(request);            return ResponseEntity.ok(response);        &#125; catch (Exception e) &#123;            log.error(&quot;åˆ›å»ºæ—…æ¸¸è®¡åˆ’å¤±è´¥&quot;, e);            return ResponseEntity.internalServerError()                .body(TourPlanResponse.error(&quot;åˆ›å»ºæ—…æ¸¸è®¡åˆ’å¤±è´¥ï¼š&quot; + e.getMessage()));        &#125;    &#125;    @GetMapping(&quot;/attractions&quot;)    public ResponseEntity&lt;List&lt;PoiInfo&gt;&gt; searchAttractions(            @RequestParam String location,            @RequestParam(defaultValue = &quot;5000&quot;) int radius) &#123;        log.info(&quot;æœç´¢æ™¯ç‚¹ï¼šä½ç½®=&#123;&#125;, åŠå¾„=&#123;&#125;&quot;, location, radius);        try &#123;            List&lt;PoiInfo&gt; attractions = poiSearchService.searchNearbyAttractions(location, radius);            return ResponseEntity.ok(attractions);        &#125; catch (Exception e) &#123;            log.error(&quot;æœç´¢æ™¯ç‚¹å¤±è´¥&quot;, e);            return ResponseEntity.internalServerError().build();        &#125;    &#125;    @PostMapping(&quot;/route&quot;)    public ResponseEntity&lt;RouteResponse&gt; planRoute(@Valid @RequestBody RouteRequest request) &#123;        log.info(&quot;è§„åˆ’è·¯çº¿ï¼šä»&#123;&#125;åˆ°&#123;&#125;&quot;, request.getOrigin(), request.getDestination());        try &#123;            RouteResponse response = routePlanningService.planRoute(request);            return ResponseEntity.ok(response);        &#125; catch (Exception e) &#123;            log.error(&quot;è·¯çº¿è§„åˆ’å¤±è´¥&quot;, e);            return ResponseEntity.internalServerError()                .body(RouteResponse.error(&quot;è·¯çº¿è§„åˆ’å¤±è´¥ï¼š&quot; + e.getMessage()));        &#125;    &#125;    @GetMapping(&quot;/attractions/search&quot;)    public ResponseEntity&lt;List&lt;PoiInfo&gt;&gt; searchAttractionsByKeyword(            @RequestParam String keyword,            @RequestParam String city) &#123;        log.info(&quot;å…³é”®è¯æœç´¢æ™¯ç‚¹ï¼škeyword=&#123;&#125;, city=&#123;&#125;&quot;, keyword, city);        try &#123;            List&lt;PoiInfo&gt; attractions = poiSearchService.searchAttractionsByKeyword(keyword, city);            return ResponseEntity.ok(attractions);        &#125; catch (Exception e) &#123;            log.error(&quot;å…³é”®è¯æœç´¢æ™¯ç‚¹å¤±è´¥&quot;, e);            return ResponseEntity.internalServerError().build();        &#125;    &#125;&#125;\n\næ—…æ¸¸è·¯çº¿è§„åˆ’æœåŠ¡@Service@Slf4jpublic class TourPlanningService &#123;    private final PoiSearchService poiSearchService;    private final RoutePlanningService routePlanningService;    private final GeocodingService geocodingService;    private final DistanceService distanceService;    public TourPlanningService(PoiSearchService poiSearchService,                             RoutePlanningService routePlanningService,                             GeocodingService geocodingService,                             DistanceService distanceService) &#123;        this.poiSearchService = poiSearchService;        this.routePlanningService = routePlanningService;        this.geocodingService = geocodingService;        this.distanceService = distanceService;    &#125;    public TourPlanResponse createTourPlan(TourPlanRequest request) &#123;        try &#123;            // 1. æœç´¢ç›®çš„åœ°é™„è¿‘çš„æ™¯ç‚¹            List&lt;PoiInfo&gt; attractions = poiSearchService.searchNearbyAttractions(                request.getDestination(), request.getSearchRadius());            // 2. æ ¹æ®åå¥½è¿‡æ»¤æ™¯ç‚¹            List&lt;PoiInfo&gt; filteredAttractions = filterAttractionsByPreferences(                attractions, request.getPreferences());            // 3. æ™ºèƒ½æ’åºæ™¯ç‚¹            List&lt;PoiInfo&gt; sortedAttractions = sortAttractionsByPopularity(filteredAttractions);            // 4. ç”Ÿæˆæ—…æ¸¸è·¯çº¿            List&lt;TourDay&gt; tourDays = generateTourSchedule(                sortedAttractions, request.getDays(), request.getStartLocation());            // 5. è®¡ç®—æ€»è·ç¦»å’Œæ—¶é—´            TourStatistics statistics = calculateTourStatistics(tourDays);            return TourPlanResponse.builder()                .destination(request.getDestination())                .days(request.getDays())                .attractions(sortedAttractions)                .tourDays(tourDays)                .statistics(statistics)                .success(true)                .build();        &#125; catch (Exception e) &#123;            log.error(&quot;åˆ›å»ºæ—…æ¸¸è®¡åˆ’å¤±è´¥&quot;, e);            return TourPlanResponse.error(&quot;åˆ›å»ºæ—…æ¸¸è®¡åˆ’å¤±è´¥ï¼š&quot; + e.getMessage());        &#125;    &#125;    private List&lt;PoiInfo&gt; filterAttractionsByPreferences(List&lt;PoiInfo&gt; attractions,                                                       List&lt;String&gt; preferences) &#123;        if (preferences == null || preferences.isEmpty()) &#123;            return attractions;        &#125;        return attractions.stream()            .filter(attraction -&gt; preferences.stream()                .anyMatch(pref -&gt; attraction.getTag().contains(pref)))            .collect(Collectors.toList());    &#125;    private List&lt;PoiInfo&gt; sortAttractionsByPopularity(List&lt;PoiInfo&gt; attractions) &#123;        // è¿™é‡Œå¯ä»¥æ ¹æ®è¯„åˆ†ã€è¯„è®ºæ•°ç­‰æŒ‡æ ‡è¿›è¡Œæ’åº        // æš‚æ—¶æŒ‰åç§°é•¿åº¦æ’åºä½œä¸ºç¤ºä¾‹        return attractions.stream()            .sorted((a, b) -&gt; Integer.compare(b.getName().length(), a.getName().length()))            .collect(Collectors.toList());    &#125;    private List&lt;TourDay&gt; generateTourSchedule(List&lt;PoiInfo&gt; attractions, int days, String startLocation) &#123;        List&lt;TourDay&gt; tourDays = new ArrayList&lt;&gt;();        // ç®€å•åœ°å°†æ™¯ç‚¹å¹³å‡åˆ†é…åˆ°æ¯ä¸€å¤©        int attractionsPerDay = (int) Math.ceil((double) attractions.size() / days);        for (int day = 1; day &lt;= days; day++) &#123;            int startIndex = (day - 1) * attractionsPerDay;            int endIndex = Math.min(startIndex + attractionsPerDay, attractions.size());            List&lt;PoiInfo&gt; dayAttractions = attractions.subList(startIndex, endIndex);            // ä¸ºæ¯ä¸€å¤©ç”Ÿæˆè·¯çº¿è§„åˆ’            List&lt;Route&gt; dayRoutes = new ArrayList&lt;&gt;();            if (!dayAttractions.isEmpty()) &#123;                dayRoutes = planDayRoutes(startLocation, dayAttractions);            &#125;            TourDay tourDay = TourDay.builder()                .day(day)                .attractions(dayAttractions)                .routes(dayRoutes)                .build();            tourDays.add(tourDay);        &#125;        return tourDays;    &#125;    private List&lt;Route&gt; planDayRoutes(String startLocation, List&lt;PoiInfo&gt; attractions) &#123;        List&lt;Route&gt; routes = new ArrayList&lt;&gt;();        String currentLocation = startLocation;        for (PoiInfo attraction : attractions) &#123;            try &#123;                RouteRequest routeRequest = RouteRequest.builder()                    .origin(currentLocation)                    .destination(attraction.getLocation())                    .transportMode(&quot;driving&quot;)                    .build();                RouteResponse routeResponse = routePlanningService.planRoute(routeRequest);                if (routeResponse.isSuccess()) &#123;                    routes.add(routeResponse.getRoute());                    currentLocation = attraction.getLocation();                &#125;            &#125; catch (Exception e) &#123;                log.warn(&quot;è§„åˆ’è·¯çº¿å¤±è´¥ï¼š&#123;&#125; -&gt; &#123;&#125;&quot;, currentLocation, attraction.getLocation(), e);            &#125;        &#125;        return routes;    &#125;    private TourStatistics calculateTourStatistics(List&lt;TourDay&gt; tourDays) &#123;        int totalAttractions = tourDays.stream()            .mapToInt(day -&gt; day.getAttractions().size())            .sum();        double totalDistance = tourDays.stream()            .flatMap(day -&gt; day.getRoutes().stream())            .mapToDouble(route -&gt; route.getDistance())            .sum();        long totalDuration = tourDays.stream()            .flatMap(day -&gt; day.getRoutes().stream())            .mapToLong(route -&gt; route.getDuration())            .sum();        return TourStatistics.builder()            .totalAttractions(totalAttractions)            .totalDistance(totalDistance)            .totalDuration(totalDuration)            .build();    &#125;&#125;\n\nåº”ç”¨é…ç½®# application.ymlspring:  application:    name: java-amap-tour-planning  profiles:    active: devserver:  port: 8080amap:  api-key: $&#123;AMAP_API_KEY:your-api-key-here&#125;  connect-timeout: 5000  read-timeout: 10000logging:  level:    com.example.amap: DEBUG    webapi.amap: INFOmanagement:  endpoints:    web:      exposure:        include: health,info,metrics  endpoint:    health:      show-details: when-authorized\n\nå¼‚å¸¸å¤„ç†@ControllerAdvice@Slf4jpublic class GlobalExceptionHandler &#123;    @ExceptionHandler(AmapApiException.class)    public ResponseEntity&lt;ErrorResponse&gt; handleAmapApiException(AmapApiException e) &#123;        log.error(&quot;é«˜å¾·APIå¼‚å¸¸&quot;, e);        return ResponseEntity.badRequest()            .body(ErrorResponse.builder()                .message(&quot;åœ°å›¾æœåŠ¡å¼‚å¸¸ï¼š&quot; + e.getMessage())                .timestamp(System.currentTimeMillis())                .build());    &#125;    @ExceptionHandler(Exception.class)    public ResponseEntity&lt;ErrorResponse&gt; handleGenericException(Exception e) &#123;        log.error(&quot;ç³»ç»Ÿå¼‚å¸¸&quot;, e);        return ResponseEntity.internalServerError()            .body(ErrorResponse.builder()                .message(&quot;ç³»ç»Ÿå†…éƒ¨é”™è¯¯ï¼Œè¯·ç¨åé‡è¯•&quot;)                .timestamp(System.currentTimeMillis())                .build());    &#125;&#125;\n\néƒ¨ç½²å’Œä¼˜åŒ–Dockeréƒ¨ç½²# DockerfileFROM openjdk:17-jdk-slimWORKDIR /appCOPY target/*.jar app.jarEXPOSE 8080CMD [&quot;java&quot;, &quot;-jar&quot;, &quot;app.jar&quot;]\n\n# docker-compose.ymlversion: &#x27;3.8&#x27;services:  amap-tour-app:    build: .    ports:      - &quot;8080:8080&quot;    environment:      - AMAP_API_KEY=$&#123;AMAP_API_KEY&#125;    restart: unless-stopped\n\næ€§èƒ½ä¼˜åŒ–ç­–ç•¥\nç¼“å­˜æœºåˆ¶\n@Configuration@EnableCachingpublic class CacheConfig &#123;    @Bean    public CacheManager cacheManager() &#123;        CaffeineCacheManager cacheManager = new CaffeineCacheManager();        cacheManager.setCaffeine(Caffeine.newBuilder()            .maximumSize(1000)            .expireAfterWrite(Duration.ofMinutes(30))            .recordStats());        return cacheManager;    &#125;&#125;@Service@Cacheable(&quot;poi-search&quot;)public List&lt;PoiInfo&gt; cachedPoiSearch(String location, int radius) &#123;    return poiSearchService.searchNearbyAttractions(location, radius);&#125;\nå¼‚æ­¥å¤„ç†\n@Servicepublic class AsyncTourService &#123;    @Async    public CompletableFuture&lt;TourPlanResponse&gt; createTourPlanAsync(TourPlanRequest request) &#123;        return CompletableFuture.supplyAsync(() -&gt;            tourPlanningService.createTourPlan(request));    &#125;    public CompletableFuture&lt;List&lt;PoiInfo&gt;&gt; searchAttractionsAsync(String location, int radius) &#123;        return CompletableFuture.supplyAsync(() -&gt;            poiSearchService.searchNearbyAttractions(location, radius));    &#125;&#125;\n\næœ€ä½³å®è·µ1. APIå¯†é’¥å®‰å…¨ç®¡ç†@Configurationpublic class AmapConfig &#123;    @Bean    @ConfigurationProperties(prefix = &quot;amap&quot;)    public AmapProperties amapProperties() &#123;        return new AmapProperties();    &#125;    @Bean    public AmapClient amapClient(AmapProperties properties,                                @Value(&quot;$&#123;amap.api-key&#125;&quot;) String apiKey) &#123;        return AmapClient.builder()            .apiKey(apiKey)            .connectTimeout(properties.getConnectTimeout())            .readTimeout(properties.getReadTimeout())            .build();    &#125;&#125;@Data@ConfigurationProperties(prefix = &quot;amap&quot;)public class AmapProperties &#123;    private int connectTimeout = 5000;    private int readTimeout = 10000;    private String apiKey;&#125;\n\n2. è¯·æ±‚é™æµ@Configurationpublic class RateLimitConfig &#123;    @Bean    public RateLimiter amapRateLimiter() &#123;        return RateLimiter.create(100.0); // æ¯ç§’100ä¸ªè¯·æ±‚    &#125;&#125;@Aspect@Componentpublic class RateLimitAspect &#123;    private final RateLimiter rateLimiter;    public RateLimitAspect(RateLimiter rateLimiter) &#123;        this.rateLimiter = rateLimiter;    &#125;    @Around(&quot;@annotation(com.example.amap.annotation.RateLimited)&quot;)    public Object rateLimit(ProceedingJoinPoint joinPoint) throws Throwable &#123;        if (!rateLimiter.tryAcquire()) &#123;            throw new RuntimeException(&quot;è¯·æ±‚è¿‡äºé¢‘ç¹ï¼Œè¯·ç¨åå†è¯•&quot;);        &#125;        return joinPoint.proceed();    &#125;&#125;\n\n3. ç›‘æ§å’Œå‘Šè­¦@Servicepublic class AmapMetricsService &#123;    private final Counter apiCallCounter;    private final Counter apiErrorCounter;    private final Timer apiCallTimer;    public AmapMetricsService(MeterRegistry registry) &#123;        this.apiCallCounter = Counter.builder(&quot;amap.api.calls&quot;)            .description(&quot;Number of Amap API calls&quot;)            .register(registry);        this.apiErrorCounter = Counter.builder(&quot;amap.api.errors&quot;)            .description(&quot;Number of Amap API errors&quot;)            .register(registry);        this.apiCallTimer = Timer.builder(&quot;amap.api.duration&quot;)            .description(&quot;Amap API call duration&quot;)            .register(registry);    &#125;    public &lt;T&gt; T executeWithMetrics(Supplier&lt;T&gt; supplier, String operation) &#123;        apiCallCounter.increment();        return apiCallTimer.recordCallable(() -&gt; &#123;            try &#123;                return supplier.get();            &#125; catch (Exception e) &#123;                apiErrorCounter.increment();                throw e;            &#125;        &#125;);    &#125;&#125;\n\næ€»ç»“ä¸æ³¨æ„äº‹é¡¹æŠ€æœ¯è¦ç‚¹æ€»ç»“\né«˜å¾·åœ°å›¾MCPæ˜¯ä¸­å›½é¢†å…ˆçš„åœ°å›¾æœåŠ¡å¹³å°ï¼Œæä¾›ä¸°å¯Œçš„åœ°ç†ä¿¡æ¯æœåŠ¡\nJava SDKæä¾›äº†å®Œæ•´çš„Javaå°è£…ï¼Œæ”¯æŒPOIæœç´¢ã€è·¯å¾„è§„åˆ’ã€åœ°ç†ç¼–ç ç­‰åŠŸèƒ½\nSpring Booté›†æˆå¯ä»¥å¿«é€Ÿæ„å»ºä¼ä¸šçº§çš„æ—…æ¸¸è·¯çº¿è§„åˆ’åº”ç”¨\næ€§èƒ½ä¼˜åŒ–é€šè¿‡ç¼“å­˜ã€å¼‚æ­¥å¤„ç†ç­‰æ‰‹æ®µæå‡ç³»ç»Ÿå“åº”é€Ÿåº¦\nç›‘æ§å‘Šè­¦ç¡®ä¿ç³»ç»Ÿç¨³å®šè¿è¡Œå’Œé—®é¢˜åŠæ—¶å‘ç°\n\nä½¿ç”¨æ³¨æ„äº‹é¡¹\nåˆç†ç®¡ç†APIè°ƒç”¨é¢‘ç‡ï¼Œé¿å…è¶…å‡ºé«˜å¾·åœ°å›¾çš„é™åˆ¶\næ³¨æ„æ•°æ®å®‰å…¨å’Œéšç§ä¿æŠ¤ï¼Œéµå®ˆç›¸å…³æ³•å¾‹æ³•è§„\nåœ¨ç”Ÿäº§ç¯å¢ƒä¸­ä½¿ç”¨HTTPSè¿›è¡ŒAPIè°ƒç”¨\nå®šæœŸæ›´æ–°é«˜å¾·åœ°å›¾SDKç‰ˆæœ¬ï¼Œè·å–æœ€æ–°åŠŸèƒ½å’Œå®‰å…¨è¡¥ä¸\nç›‘æ§APIè°ƒç”¨æƒ…å†µå’Œç³»ç»Ÿæ€§èƒ½æŒ‡æ ‡\n\næ‰©å±•é˜…è¯»å»ºè®®\næ·±å…¥å­¦ä¹ é«˜å¾·åœ°å›¾MCPå®˜æ–¹æ–‡æ¡£\näº†è§£åœ°ç†ä¿¡æ¯ç³»ç»Ÿï¼ˆGISï¼‰çš„ç›¸å…³æ¦‚å¿µ\nå­¦ä¹ Spring Bootå¾®æœåŠ¡æ¶æ„\nç ”ç©¶åœ°å›¾å¯è§†åŒ–å’Œäº¤äº’è®¾è®¡\nå…³æ³¨æ—…æ¸¸è¡Œä¸šæ•°å­—åŒ–è½¬å‹è¶‹åŠ¿\n\né€šè¿‡æœ¬æ–‡çš„ä»‹ç»ï¼Œä½ å·²ç»æŒæ¡äº†ä½¿ç”¨Javaé›†æˆé«˜å¾·åœ°å›¾MCPå¼€å‘å®šåˆ¶æ—…æ¸¸è·¯çº¿ç³»ç»Ÿçš„æ ¸å¿ƒæŠ€èƒ½ã€‚é«˜å¾·åœ°å›¾MCPä»¥å…¶ä¸°å¯Œçš„æ•°æ®èµ„æºå’Œç¨³å®šçš„æœåŠ¡ï¼Œä¸ºæ—…æ¸¸åº”ç”¨å¼€å‘æä¾›äº†åšå®çš„æŠ€æœ¯åŸºç¡€ã€‚\nå‚è€ƒèµ„æ–™\né«˜å¾·åœ°å›¾MCPå®˜æ–¹æ–‡æ¡£\né«˜å¾·åœ°å›¾Java SDK\nSpring Bootå®˜æ–¹æ–‡æ¡£\nåœ°ç†ç¼–ç æœåŠ¡æŒ‡å—\nè·¯å¾„è§„åˆ’APIæ–‡æ¡£\nPOIæœç´¢APIæ–‡æ¡£\nDockeræœ€ä½³å®è·µ\nSpring Cloudé™æµæŒ‡å—\n\n","tags":["Java","Spring Boot","é«˜å¾·åœ°å›¾","æ—…æ¸¸è·¯çº¿","MCP","åœ°ç†ä¿¡æ¯"]},{"title":"0.5.6-å‘é‡æ•°æ®åº“æ­å»ºä¸ä¸»æµäº§å“å¯¹æ¯”","url":"/2025/01/21/0.5.6-%E5%90%91%E9%87%8F%E6%95%B0%E6%8D%AE%E5%BA%93%E6%90%AD%E5%BB%BA%E4%B8%8E%E4%B8%BB%E6%B5%81%E4%BA%A7%E5%93%81%E5%AF%B9%E6%AF%94/","content":"\nå‘é‡æ•°æ®åº“æ˜¯ç°ä»£AIåº”ç”¨çš„æ ¸å¿ƒåŸºç¡€è®¾æ–½ï¼Œå®ƒä¸ä»…è§£å†³äº†ä¼ ç»Ÿæ•°æ®åº“åœ¨é«˜ç»´å‘é‡æ£€ç´¢ä¸Šçš„æ€§èƒ½ç“¶é¢ˆï¼Œè¿˜ä¸ºå¤§æ¨¡å‹åº”ç”¨æä¾›äº†é«˜æ•ˆçš„å¤–éƒ¨çŸ¥è¯†åº“æ”¯æŒã€‚æœ¬æ–‡å°†æ·±å…¥å‰–æå‘é‡æ•°æ®åº“çš„æŠ€æœ¯åŸç†ï¼Œé€šè¿‡Javaä»£ç ç¤ºä¾‹å±•ç¤ºå®é™…åº”ç”¨ï¼Œå¹¶è¯¦ç»†å¯¹æ¯”ä¸»æµäº§å“çš„æŠ€æœ¯ç‰¹ç‚¹å’Œä½¿ç”¨åœºæ™¯ã€‚\n\nğŸ¯ å‘é‡æ•°æ®åº“æŠ€æœ¯æ·±åº¦å‰–æå‘é‡æ•°æ®åº“çš„æœ¬è´¨ä¸ä»·å€¼å‘é‡æ•°æ®åº“æ˜¯ä¸€ç§ä¸“é—¨ä¸ºé«˜ç»´å‘é‡æ•°æ®è®¾è®¡çš„æ–°å‹æ•°æ®åº“ç³»ç»Ÿï¼Œå®ƒè§£å†³äº†ä¼ ç»Ÿå…³ç³»å‹æ•°æ®åº“åœ¨å¤„ç†å‘é‡ç›¸ä¼¼åº¦æ£€ç´¢æ—¶çš„æ ¹æœ¬æ€§é—®é¢˜ï¼š\nä¼ ç»Ÿæ•°æ®åº“çš„å±€é™æ€§-- ä¼ ç»ŸSQLæŸ¥è¯¢ï¼šæ— æ³•é«˜æ•ˆè®¡ç®—å‘é‡ç›¸ä¼¼åº¦SELECT * FROM documentsWHERE cosine_similarity(embedding, query_vector) &gt; 0.8ORDER BY cosine_similarity(embedding, query_vector) DESCLIMIT 10;\n\né—®é¢˜ï¼š\n\nâŒ æ€§èƒ½ç“¶é¢ˆï¼šé«˜ç»´å‘é‡ç›¸ä¼¼åº¦è®¡ç®—å¤æ‚åº¦O(nÂ²)\nâŒ ç´¢å¼•å¤±æ•ˆï¼šä¼ ç»ŸB-Treeç´¢å¼•ä¸æ”¯æŒå‘é‡è·ç¦»è®¡ç®—\nâŒ æ‰©å±•æ€§å·®ï¼šæ— æ³•å¤„ç†æµ·é‡å‘é‡åŒ–æ•°æ®\n\nå‘é‡æ•°æ®åº“çš„æ ¸å¿ƒä¼˜åŠ¿// å‘é‡æ•°æ®åº“æŸ¥è¯¢ï¼šæ¯«ç§’çº§å“åº”ï¼Œç²¾ç¡®æ’åºList&lt;Document&gt; results = vectorDB.search(queryVector, 10, 0.8f);\n\nä¼˜åŠ¿ï¼š\n\nâœ… äºšç§’çº§æ£€ç´¢ï¼šä¸“é—¨çš„å‘é‡ç´¢å¼•ç®—æ³•\nâœ… é«˜ç»´æ”¯æŒï¼šè½»æ¾å¤„ç†768ç»´ã€1536ç»´ç­‰é«˜ç»´å‘é‡\nâœ… æµ·é‡æ‰©å±•ï¼šæ”¯æŒäº¿çº§å‘é‡æ•°æ®çš„å­˜å‚¨å’Œæ£€ç´¢\nâœ… å¤šç§è·ç¦»åº¦é‡ï¼šä½™å¼¦ç›¸ä¼¼åº¦ã€æ¬§å‡ é‡Œå¾—è·ç¦»ç­‰\n\nå‘é‡åµŒå…¥æŠ€æœ¯è¯¦è§£æ–‡æœ¬å‘é‡åŒ–è¿‡ç¨‹public class TextEmbeddingService &#123;    @Autowired    private EmbeddingModel embeddingModel;    /**     * å°†æ–‡æœ¬è½¬æ¢ä¸ºå‘é‡     */    public float[] encodeText(String text) &#123;        // 1. æ–‡æœ¬é¢„å¤„ç†        String processedText = preprocessText(text);        // 2. åˆ†è¯å¤„ç†        List&lt;String&gt; tokens = tokenizeText(processedText);        // 3. å‘é‡åŒ–ç¼–ç         float[] vector = embeddingModel.encode(tokens);        // 4. å‘é‡å½’ä¸€åŒ–ï¼ˆå¯é€‰ï¼‰        return normalizeVector(vector);    &#125;    /**     * æ‰¹é‡æ–‡æœ¬å‘é‡åŒ–     */    public List&lt;float[]&gt; encodeBatch(List&lt;String&gt; texts) &#123;        return texts.parallelStream()                .map(this::encodeText)                .collect(Collectors.toList());    &#125;&#125;\n\nä¸»æµåµŒå…¥æ¨¡å‹å¯¹æ¯”\n\n\næ¨¡å‹\nç»´åº¦\nè¯­è¨€\nç‰¹ç‚¹\né€‚ç”¨åœºæ™¯\n\n\n\nBERT\n768\nå¤šè¯­è¨€\nä¸Šä¸‹æ–‡ç†è§£å¼º\né€šç”¨æ–‡æœ¬ç†è§£\n\n\nRoBERTa\n768\nå¤šè¯­è¨€\nè®­ç»ƒæ•°æ®æ›´å¤š\né•¿æ–‡æœ¬å¤„ç†\n\n\nSentence-BERT\n384/768\nå¤šè¯­è¨€\nè¯­ä¹‰ç›¸ä¼¼åº¦\nå¥å­åŒ¹é…\n\n\ntext2vec\n768\nä¸­æ–‡\nä¸­æ–‡ä¼˜åŒ–\nä¸­æ–‡åº”ç”¨\n\n\nOpenAI Ada\n1536\nå¤šè¯­è¨€\nAPIè°ƒç”¨\nä¼ä¸šåº”ç”¨\n\n\næ–‡å¿ƒä¸€è¨€\n384/768\nä¸­æ–‡\nç™¾åº¦è‡ªç ”\nä¸­æ–‡AIåº”ç”¨\n\n\nç›¸ä¼¼åº¦åº¦é‡ç®—æ³•è¯¦è§£1. ä½™å¼¦ç›¸ä¼¼åº¦ï¼ˆCosine Similarityï¼‰public class SimilarityCalculator &#123;    /**     * è®¡ç®—ä½™å¼¦ç›¸ä¼¼åº¦     * å…¬å¼ï¼šcos(Î¸) = (AÂ·B) / (|A|Ã—|B|)     */    public static double cosineSimilarity(float[] vectorA, float[] vectorB) &#123;        if (vectorA.length != vectorB.length) &#123;            throw new IllegalArgumentException(&quot;å‘é‡ç»´åº¦ä¸åŒ¹é…&quot;);        &#125;        double dotProduct = 0.0;        double normA = 0.0;        double normB = 0.0;        for (int i = 0; i &lt; vectorA.length; i++) &#123;            dotProduct += vectorA[i] * vectorB[i];            normA += Math.pow(vectorA[i], 2);            normB += Math.pow(vectorB[i], 2);        &#125;        return dotProduct / (Math.sqrt(normA) * Math.sqrt(normB));    &#125;&#125;\n\n2. æ¬§å‡ é‡Œå¾—è·ç¦»ï¼ˆEuclidean Distanceï¼‰/** * è®¡ç®—æ¬§å‡ é‡Œå¾—è·ç¦» * å…¬å¼ï¼šd = âˆš(âˆ‘(xi - yi)Â²) */public static double euclideanDistance(float[] vectorA, float[] vectorB) &#123;    if (vectorA.length != vectorB.length) &#123;        throw new IllegalArgumentException(&quot;å‘é‡ç»´åº¦ä¸åŒ¹é…&quot;);    &#125;    double sum = 0.0;    for (int i = 0; i &lt; vectorA.length; i++) &#123;        double diff = vectorA[i] - vectorB[i];        sum += diff * diff;    &#125;    return Math.sqrt(sum);&#125;\n\n3. ç‚¹ç§¯ç›¸ä¼¼åº¦ï¼ˆDot Productï¼‰/** * è®¡ç®—ç‚¹ç§¯ç›¸ä¼¼åº¦ * å…¬å¼ï¼šsimilarity = AÂ·B */public static double dotProduct(float[] vectorA, float[] vectorB) &#123;    if (vectorA.length != vectorB.length) &#123;        throw new IllegalArgumentException(&quot;å‘é‡ç»´åº¦ä¸åŒ¹é…&quot;);    &#125;    double result = 0.0;    for (int i = 0; i &lt; vectorA.length; i++) &#123;        result += vectorA[i] * vectorB[i];    &#125;    return result;&#125;\n\nå‘é‡ç´¢å¼•ç®—æ³•æ·±åº¦è§£æHNSW (Hierarchical Navigable Small World) ç®—æ³•HNSWæ˜¯ä¸€ç§åŸºäºå›¾çš„è¿‘ä¼¼æœ€è¿‘é‚»æœç´¢ç®—æ³•ï¼Œå…·æœ‰ä¼˜ç§€çš„æ£€ç´¢æ€§èƒ½å’Œå¯æ‰©å±•æ€§ï¼š\næ ¸å¿ƒåŸç†ï¼š\n\nåˆ†å±‚ç»“æ„ï¼šæ„å»ºå¤šå±‚å¯¼èˆªå›¾\nè´ªå¿ƒæœç´¢ï¼šåœ¨æ¯ä¸€å±‚è¿›è¡Œå±€éƒ¨æœ€ä¼˜æœç´¢\nåŠ¨æ€æ›´æ–°ï¼šæ”¯æŒå‘é‡æ•°æ®çš„åŠ¨æ€æ’å…¥å’Œåˆ é™¤\n\npublic class HNSWIndex &#123;    private int maxConnections;      // æœ€å¤§è¿æ¥æ•°    private int efConstruction;      // æ„å»ºæ—¶çš„efå‚æ•°    private int efSearch;           // æœç´¢æ—¶çš„efå‚æ•°    private int maxLayers;          // æœ€å¤§å±‚æ•°    public HNSWIndex(int maxConnections, int efConstruction, int efSearch) &#123;        this.maxConnections = maxConnections;        this.efConstruction = efConstruction;        this.efSearch = efSearch;        this.maxLayers = calculateMaxLayers();    &#125;    /**     * æ’å…¥å‘é‡åˆ°ç´¢å¼•     */    public void insert(float[] vector, long id) &#123;        // å®ç°HNSWæ’å…¥é€»è¾‘    &#125;    /**     * æœç´¢æœ€è¿‘é‚»å‘é‡     */    public List&lt;SearchResult&gt; search(float[] queryVector, int k) &#123;        // å®ç°HNSWæœç´¢é€»è¾‘        return new ArrayList&lt;&gt;();    &#125;&#125;\n\nğŸ—ï¸ Javaé›†æˆæ–¹æ¡ˆè¯¦è§£Spring Boot + å‘é‡æ•°æ®åº“é›†æˆæ¶æ„é¡¹ç›®ç»“æ„è®¾è®¡vector-search-demo/â”œâ”€â”€ src/main/java/com/example/vectordb/â”‚   â”œâ”€â”€ config/â”‚   â”‚   â”œâ”€â”€ VectorDBConfig.java          # å‘é‡æ•°æ®åº“é…ç½®â”‚   â”‚   â””â”€â”€ EmbeddingConfig.java         # åµŒå…¥æ¨¡å‹é…ç½®â”‚   â”œâ”€â”€ service/â”‚   â”‚   â”œâ”€â”€ EmbeddingService.java        # åµŒå…¥æœåŠ¡â”‚   â”‚   â”œâ”€â”€ VectorSearchService.java     # å‘é‡æ£€ç´¢æœåŠ¡â”‚   â”‚   â””â”€â”€ DocumentService.java         # æ–‡æ¡£ç®¡ç†æœåŠ¡â”‚   â”œâ”€â”€ controller/â”‚   â”‚   â”œâ”€â”€ SearchController.java        # æœç´¢æ¥å£â”‚   â”‚   â””â”€â”€ DocumentController.java      # æ–‡æ¡£æ¥å£â”‚   â”œâ”€â”€ model/â”‚   â”‚   â”œâ”€â”€ Document.java                # æ–‡æ¡£å®ä½“â”‚   â”‚   â”œâ”€â”€ SearchResult.java            # æœç´¢ç»“æœâ”‚   â”‚   â””â”€â”€ VectorDocument.java          # å‘é‡æ–‡æ¡£â”‚   â””â”€â”€ repository/â”‚       â””â”€â”€ VectorDocumentRepository.java # æ•°æ®è®¿é—®å±‚â”œâ”€â”€ src/main/resources/â”‚   â”œâ”€â”€ application.yml                   # åº”ç”¨é…ç½®â”‚   â””â”€â”€ embedding-models/                 # åµŒå…¥æ¨¡å‹é…ç½®â””â”€â”€ pom.xml                               # é¡¹ç›®ä¾èµ–\n\nMavenä¾èµ–é…ç½®&lt;properties&gt;    &lt;java.version&gt;17&lt;/java.version&gt;    &lt;spring-boot.version&gt;3.1.0&lt;/spring-boot.version&gt;    &lt;milvus.version&gt;2.3.1&lt;/milvus.version&gt;    &lt;openai.version&gt;0.18.0&lt;/openai.version&gt;&lt;/properties&gt;&lt;dependencies&gt;    &lt;!-- Spring Boot æ ¸å¿ƒ --&gt;    &lt;dependency&gt;        &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;        &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt;    &lt;/dependency&gt;    &lt;dependency&gt;        &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;        &lt;artifactId&gt;spring-boot-starter-data-jpa&lt;/artifactId&gt;    &lt;/dependency&gt;    &lt;!-- å‘é‡æ•°æ®åº“å®¢æˆ·ç«¯ --&gt;    &lt;dependency&gt;        &lt;groupId&gt;io.milvus&lt;/groupId&gt;        &lt;artifactId&gt;milvus-sdk-java&lt;/artifactId&gt;        &lt;version&gt;$&#123;milvus.version&#125;&lt;/version&gt;    &lt;/dependency&gt;    &lt;!-- OpenAI åµŒå…¥æ¨¡å‹ --&gt;    &lt;dependency&gt;        &lt;groupId&gt;com.theokanning.openai-gpt3-java&lt;/groupId&gt;        &lt;artifactId&gt;service&lt;/artifactId&gt;        &lt;version&gt;$&#123;openai.version&#125;&lt;/version&gt;    &lt;/dependency&gt;    &lt;!-- æœ¬åœ°åµŒå…¥æ¨¡å‹ --&gt;    &lt;dependency&gt;        &lt;groupId&gt;dev.langchain4j&lt;/groupId&gt;        &lt;artifactId&gt;langchain4j-embeddings&lt;/artifactId&gt;        &lt;version&gt;0.25.0&lt;/version&gt;    &lt;/dependency&gt;    &lt;!-- å·¥å…·åº“ --&gt;    &lt;dependency&gt;        &lt;groupId&gt;org.apache.commons&lt;/groupId&gt;        &lt;artifactId&gt;commons-math3&lt;/artifactId&gt;        &lt;version&gt;3.6.1&lt;/version&gt;    &lt;/dependency&gt;    &lt;dependency&gt;        &lt;groupId&gt;com.google.guava&lt;/groupId&gt;        &lt;artifactId&gt;guava&lt;/artifactId&gt;        &lt;version&gt;32.1.2-jre&lt;/version&gt;    &lt;/dependency&gt;&lt;/dependencies&gt;\n\næ ¸å¿ƒæœåŠ¡å®ç°åµŒå…¥æœåŠ¡@Service@Slf4jpublic class EmbeddingService &#123;    @Value(&quot;$&#123;vectordb.embedding.provider&#125;&quot;)    private String embeddingProvider;    @Value(&quot;$&#123;vectordb.embedding.openai.api-key&#125;&quot;)    private String openaiApiKey;    @Value(&quot;$&#123;vectordb.embedding.openai.model&#125;&quot;)    private String openaiModel;    @Value(&quot;$&#123;vectordb.embedding.batch-size:32&#125;&quot;)    private int batchSize;    private OpenAiEmbeddingModel openAiModel;    private LocalEmbeddingModel localModel;    @PostConstruct    public void init() &#123;        switch (embeddingProvider.toLowerCase()) &#123;            case &quot;openai&quot;:                this.openAiModel = OpenAiEmbeddingModel.builder()                        .apiKey(openaiApiKey)                        .modelName(openaiModel)                        .build();                break;            case &quot;local&quot;:                // åˆå§‹åŒ–æœ¬åœ°åµŒå…¥æ¨¡å‹                this.localModel = new LocalEmbeddingModel();                break;            default:                throw new IllegalArgumentException(&quot;ä¸æ”¯æŒçš„åµŒå…¥æä¾›å•†: &quot; + embeddingProvider);        &#125;    &#125;    /**     * å•æ–‡æœ¬å‘é‡åŒ–     */    public float[] embedText(String text) &#123;        try &#123;            log.debug(&quot;å¼€å§‹å‘é‡åŒ–æ–‡æœ¬ï¼Œé•¿åº¦: &#123;&#125;&quot;, text.length());            Embedding embedding;            switch (embeddingProvider.toLowerCase()) &#123;                case &quot;openai&quot;:                    embedding = openAiModel.embed(text).content();                    break;                case &quot;local&quot;:                    embedding = localModel.embed(text);                    break;                default:                    throw new IllegalStateException(&quot;æœªåˆå§‹åŒ–åµŒå…¥æ¨¡å‹&quot;);            &#125;            float[] vector = new float[embedding.vector().length];            for (int i = 0; i &lt; embedding.vector().length; i++) &#123;                vector[i] = embedding.vector()[i].floatValue();            &#125;            log.debug(&quot;æ–‡æœ¬å‘é‡åŒ–å®Œæˆï¼Œå‘é‡ç»´åº¦: &#123;&#125;&quot;, vector.length);            return vector;        &#125; catch (Exception e) &#123;            log.error(&quot;æ–‡æœ¬å‘é‡åŒ–å¤±è´¥&quot;, e);            throw new RuntimeException(&quot;æ–‡æœ¬å‘é‡åŒ–å¤±è´¥&quot;, e);        &#125;    &#125;    /**     * æ‰¹é‡æ–‡æœ¬å‘é‡åŒ–     */    public List&lt;float[]&gt; embedTexts(List&lt;String&gt; texts) &#123;        if (texts.isEmpty()) &#123;            return new ArrayList&lt;&gt;();        &#125;        log.debug(&quot;å¼€å§‹æ‰¹é‡å‘é‡åŒ– &#123;&#125; ä¸ªæ–‡æœ¬&quot;, texts.size());        // åˆ†æ‰¹å¤„ç†ï¼Œé¿å…å•æ¬¡è¯·æ±‚è¿‡å¤§        List&lt;float[]&gt; results = new ArrayList&lt;&gt;();        for (int i = 0; i &lt; texts.size(); i += batchSize) &#123;            int endIndex = Math.min(i + batchSize, texts.size());            List&lt;String&gt; batch = texts.subList(i, endIndex);            try &#123;                List&lt;float[]&gt; batchResults = embedBatch(batch);                results.addAll(batchResults);                log.debug(&quot;æ‰¹é‡å‘é‡åŒ–è¿›åº¦: &#123;&#125;/&#123;&#125;&quot;, endIndex, texts.size());            &#125; catch (Exception e) &#123;                log.error(&quot;æ‰¹é‡å‘é‡åŒ–å¤±è´¥ï¼Œæ‰¹æ¬¡: &#123;&#125;-&#123;&#125;&quot;, i, endIndex, e);                throw new RuntimeException(&quot;æ‰¹é‡å‘é‡åŒ–å¤±è´¥&quot;, e);            &#125;        &#125;        log.debug(&quot;æ‰¹é‡å‘é‡åŒ–å®Œæˆï¼Œå…±å¤„ç† &#123;&#125; ä¸ªæ–‡æœ¬&quot;, results.size());        return results;    &#125;    /**     * æ‰¹é‡åµŒå…¥å®ç°     */    private List&lt;float[]&gt; embedBatch(List&lt;String&gt; texts) &#123;        List&lt;float[]&gt; results = new ArrayList&lt;&gt;();        for (String text : texts) &#123;            results.add(embedText(text));        &#125;        return results;    &#125;    /**     * è®¡ç®—æ–‡æœ¬ç›¸ä¼¼åº¦     */    public double calculateSimilarity(String text1, String text2) &#123;        float[] vector1 = embedText(text1);        float[] vector2 = embedText(text2);        return SimilarityCalculator.cosineSimilarity(vector1, vector2);    &#125;    /**     * è·å–å‘é‡ç»´åº¦     */    public int getDimension() &#123;        // æ ¹æ®é…ç½®çš„åµŒå…¥æ¨¡å‹è¿”å›ç»´åº¦        switch (embeddingProvider.toLowerCase()) &#123;            case &quot;openai&quot;:                return 1536; // text-embedding-ada-002            case &quot;local&quot;:                return 768; // æœ¬åœ°æ¨¡å‹            default:                return 768; // é»˜è®¤ç»´åº¦        &#125;    &#125;&#125;\n\nå‘é‡æ•°æ®åº“æœåŠ¡@Service@Slf4jpublic class VectorSearchService &#123;    @Autowired    private MilvusServiceClient milvusClient;    @Value(&quot;$&#123;vectordb.milvus.collection&#125;&quot;)    private String collectionName;    @Value(&quot;$&#123;vectordb.milvus.dimension&#125;&quot;)    private int dimension;    @Autowired    private EmbeddingService embeddingService;    /**     * åˆ›å»ºé›†åˆ     */    @PostConstruct    public void initCollection() &#123;        try &#123;            // æ£€æŸ¥é›†åˆæ˜¯å¦å­˜åœ¨            if (!collectionExists()) &#123;                createCollection();                createIndex();                log.info(&quot;å‘é‡é›†åˆåˆ›å»ºæˆåŠŸ: &#123;&#125;&quot;, collectionName);            &#125; else &#123;                log.info(&quot;å‘é‡é›†åˆå·²å­˜åœ¨: &#123;&#125;&quot;, collectionName);            &#125;        &#125; catch (Exception e) &#123;            log.error(&quot;åˆå§‹åŒ–å‘é‡é›†åˆå¤±è´¥&quot;, e);            throw new RuntimeException(&quot;åˆå§‹åŒ–å‘é‡é›†åˆå¤±è´¥&quot;, e);        &#125;    &#125;    /**     * æ£€æŸ¥é›†åˆæ˜¯å¦å­˜åœ¨     */    private boolean collectionExists() throws Exception &#123;        R&lt;DescribeCollectionResponse&gt; response = milvusClient.describeCollection(                DescribeCollectionParam.newBuilder()                        .withCollectionName(collectionName)                        .build()        );        return response.getStatus() == R.Status.Success.getCode();    &#125;    /**     * åˆ›å»ºé›†åˆ     */    private void createCollection() throws Exception &#123;        // å®šä¹‰å­—æ®µ        FieldType idField = FieldType.newBuilder()                .withName(&quot;id&quot;)                .withDataType(DataType.Int64)                .withPrimaryKey(true)                .withAutoID(false)                .build();        FieldType vectorField = FieldType.newBuilder()                .withName(&quot;vector&quot;)                .withDataType(DataType.FloatVector)                .withDimension(dimension)                .build();        FieldType textField = FieldType.newBuilder()                .withName(&quot;text&quot;)                .withDataType(DataType.VarChar)                .withMaxLength(65535)                .build();        FieldType metadataField = FieldType.newBuilder()                .withName(&quot;metadata&quot;)                .withDataType(DataType.JSON)                .build();        // åˆ›å»ºé›†åˆ        R&lt;RpcStatus&gt; response = milvusClient.createCollection(                CreateCollectionParam.newBuilder()                        .withCollectionName(collectionName)                        .withFieldTypes(Arrays.asList(idField, vectorField, textField, metadataField))                        .build()        );        if (response.getStatus() != R.Status.Success.getCode()) &#123;            throw new RuntimeException(&quot;åˆ›å»ºé›†åˆå¤±è´¥: &quot; + response.getMessage());        &#125;    &#125;    /**     * åˆ›å»ºç´¢å¼•     */    private void createIndex() throws Exception &#123;        // åˆ›å»ºå‘é‡å­—æ®µç´¢å¼•        CreateIndexParam createIndexParam = CreateIndexParam.newBuilder()                .withCollectionName(collectionName)                .withFieldName(&quot;vector&quot;)                .withIndexType(IndexType.HNSW)                .withMetricType(MetricType.COSINE)                .withExtraParam(&quot;&#123;\\&quot;M\\&quot;:16,\\&quot;efConstruction\\&quot;:200&#125;&quot;)                .build();        R&lt;RpcStatus&gt; response = milvusClient.createIndex(createIndexParam);        if (response.getStatus() != R.Status.Success.getCode()) &#123;            throw new RuntimeException(&quot;åˆ›å»ºç´¢å¼•å¤±è´¥: &quot; + response.getMessage());        &#125;    &#125;    /**     * å‘é‡ç›¸ä¼¼åº¦æœç´¢     */    public List&lt;SearchResult&gt; search(String queryText, int limit, double threshold) &#123;        try &#123;            // å‘é‡åŒ–æŸ¥è¯¢æ–‡æœ¬            float[] queryVector = embeddingService.embedText(queryText);            // æ„å»ºæœç´¢å‚æ•°            SearchParam searchParam = SearchParam.newBuilder()                    .withCollectionName(collectionName)                    .withVectorFieldName(&quot;vector&quot;)                    .withVectors(Arrays.asList(                            Arrays.stream(queryVector)                                    .boxed()                                    .collect(Collectors.toList())                    ))                    .withTopK(limit)                    .withMetricType(MetricType.COSINE)                    .withOutFields(Arrays.asList(&quot;text&quot;, &quot;metadata&quot;))                    .build();            // æ‰§è¡Œæœç´¢            R&lt;SearchResults&gt; response = milvusClient.search(searchParam);            if (response.getStatus() != R.Status.Success.getCode()) &#123;                throw new RuntimeException(&quot;æœç´¢å¤±è´¥: &quot; + response.getMessage());            &#125;            // å¤„ç†æœç´¢ç»“æœ            List&lt;SearchResult&gt; results = new ArrayList&lt;&gt;();            SearchResults searchResults = response.getData();            for (int i = 0; i &lt; searchResults.getResults().getNumOfQueries(); i++) &#123;                List&lt;List&lt;Float&gt;&gt; scores = searchResults.getResults().getScores().get(i);                List&lt;Long&gt; ids = searchResults.getResults().getIDs().get(i);                List&lt;FieldData&gt; fields = searchResults.getResults().getFieldsData();                for (int j = 0; j &lt; ids.size(); j++) &#123;                    double score = scores.get(j);                    if (score &gt;= threshold) &#123;                        SearchResult result = new SearchResult();                        result.setId(ids.get(j));                        result.setScore(score);                        // æå–å­—æ®µæ•°æ®                        for (FieldData field : fields) &#123;                            if (&quot;text&quot;.equals(field.getFieldName())) &#123;                                List&lt;String&gt; textValues = (List&lt;String&gt;) field.getFieldValues().get(j);                                result.setText(textValues.get(0));                            &#125; else if (&quot;metadata&quot;.equals(field.getFieldName())) &#123;                                List&lt;String&gt; metadataValues = (List&lt;String&gt;) field.getFieldValues().get(j);                                result.setMetadata(JsonUtils.fromJson(metadataValues.get(0), Map.class));                            &#125;                        &#125;                        results.add(result);                    &#125;                &#125;            &#125;            log.info(&quot;å‘é‡æœç´¢å®Œæˆï¼ŒæŸ¥è¯¢: &#123;&#125;, è¿”å› &#123;&#125; ä¸ªç»“æœ&quot;, queryText, results.size());            return results;        &#125; catch (Exception e) &#123;            log.error(&quot;å‘é‡æœç´¢å¤±è´¥&quot;, e);            throw new RuntimeException(&quot;å‘é‡æœç´¢å¤±è´¥&quot;, e);        &#125;    &#125;&#125;\n\næ€§èƒ½æµ‹è¯•ä¸ä¼˜åŒ–åŸºå‡†æ€§èƒ½æµ‹è¯•@SpringBootTestpublic class VectorSearchBenchmarkTest &#123;    @Autowired    private VectorSearchService vectorSearchService;    @Autowired    private DocumentService documentService;    @Autowired    private EmbeddingService embeddingService;    /**     * æ’å…¥æ€§èƒ½æµ‹è¯•     */    @Test    public void testInsertPerformance() &#123;        List&lt;VectorDocument&gt; documents = generateTestDocuments(1000);        long startTime = System.currentTimeMillis();        vectorSearchService.insertDocuments(documents);        long endTime = System.currentTimeMillis();        long duration = endTime - startTime;        double qps = documents.size() / (duration / 1000.0);        System.out.println(&quot;æ’å…¥æ€§èƒ½æµ‹è¯•ç»“æœ:&quot;);        System.out.println(&quot;æ’å…¥æ–‡æ¡£æ•°: &quot; + documents.size());        System.out.println(&quot;è€—æ—¶: &quot; + duration + &quot;ms&quot;);        System.out.println(&quot;QPS: &quot; + String.format(&quot;%.2f&quot;, qps));        Assert.isTrue(qps &gt; 50, &quot;æ’å…¥æ€§èƒ½åº”å¤§äº50 QPS&quot;);    &#125;    /**     * æœç´¢æ€§èƒ½æµ‹è¯•     */    @Test    public void testSearchPerformance() &#123;        String query = &quot;æœºå™¨å­¦ä¹ ç®—æ³•&quot;;        int iterations = 100;        long totalTime = 0;        for (int i = 0; i &lt; iterations; i++) &#123;            long startTime = System.nanoTime();            List&lt;SearchResult&gt; results = vectorSearchService.search(query, 10, 0.7);            long endTime = System.nanoTime();            totalTime += (endTime - startTime);            Assert.notEmpty(results, &quot;æœç´¢åº”è¿”å›ç»“æœ&quot;);        &#125;        double avgTime = totalTime / iterations / 1_000_000.0; // è½¬æ¢ä¸ºæ¯«ç§’        System.out.println(&quot;æœç´¢æ€§èƒ½æµ‹è¯•ç»“æœ:&quot;);        System.out.println(&quot;æŸ¥è¯¢æ¬¡æ•°: &quot; + iterations);        System.out.println(&quot;å¹³å‡å“åº”æ—¶é—´: &quot; + String.format(&quot;%.2f&quot;, avgTime) + &quot;ms&quot;);        System.out.println(&quot;QPS: &quot; + String.format(&quot;%.2f&quot;, 1000.0 / avgTime));        Assert.isTrue(avgTime &lt; 100, &quot;æœç´¢å“åº”æ—¶é—´åº”å°äº100ms&quot;);    &#125;    /**     * å¹¶å‘æ€§èƒ½æµ‹è¯•     */    @Test    public void testConcurrentPerformance() throws InterruptedException &#123;        int threadCount = 10;        int queriesPerThread = 50;        ExecutorService executor = Executors.newFixedThreadPool(threadCount);        List&lt;Future&lt;List&lt;Long&gt;&gt;&gt; futures = new ArrayList&lt;&gt;();        long startTime = System.currentTimeMillis();        // æäº¤å¹¶å‘ä»»åŠ¡        for (int i = 0; i &lt; threadCount; i++) &#123;            Future&lt;List&lt;Long&gt;&gt; future = executor.submit(() -&gt; &#123;                List&lt;Long&gt; responseTimes = new ArrayList&lt;&gt;();                for (int j = 0; j &lt; queriesPerThread; j++) &#123;                    long queryStart = System.nanoTime();                    String query = &quot;æµ‹è¯•æŸ¥è¯¢ &quot; + j;                    List&lt;SearchResult&gt; results = vectorSearchService.search(query, 10, 0.7);                    long queryEnd = System.nanoTime();                    responseTimes.add(queryEnd - queryStart);                &#125;                return responseTimes;            &#125;);            futures.add(future);        &#125;        // æ”¶é›†ç»“æœ        List&lt;Long&gt; allResponseTimes = new ArrayList&lt;&gt;();        for (Future&lt;List&lt;Long&gt;&gt; future : futures) &#123;            allResponseTimes.addAll(future.get());        &#125;        long endTime = System.currentTimeMillis();        executor.shutdown();        double totalTime = endTime - startTime;        double avgResponseTime = allResponseTimes.stream()                .mapToLong(Long::longValue)                .average()                .orElse(0.0) / 1_000_000.0; // è½¬æ¢ä¸ºæ¯«ç§’        int totalQueries = threadCount * queriesPerThread;        double qps = totalQueries / (totalTime / 1000.0);        System.out.println(&quot;å¹¶å‘æ€§èƒ½æµ‹è¯•ç»“æœ:&quot;);        System.out.println(&quot;å¹¶å‘çº¿ç¨‹æ•°: &quot; + threadCount);        System.out.println(&quot;æ¯ä¸ªçº¿ç¨‹æŸ¥è¯¢æ•°: &quot; + queriesPerThread);        System.out.println(&quot;æ€»æŸ¥è¯¢æ•°: &quot; + totalQueries);        System.out.println(&quot;æ€»è€—æ—¶: &quot; + totalTime + &quot;ms&quot;);        System.out.println(&quot;å¹³å‡å“åº”æ—¶é—´: &quot; + String.format(&quot;%.2f&quot;, avgResponseTime) + &quot;ms&quot;);        System.out.println(&quot;QPS: &quot; + String.format(&quot;%.2f&quot;, qps));        Assert.isTrue(qps &gt; 100, &quot;å¹¶å‘QPSåº”å¤§äº100&quot;);        Assert.isTrue(avgResponseTime &lt; 200, &quot;å¹³å‡å“åº”æ—¶é—´åº”å°äº200ms&quot;);    &#125;    /**     * ç”Ÿæˆæµ‹è¯•æ–‡æ¡£     */    private List&lt;VectorDocument&gt; generateTestDocuments(int count) &#123;        List&lt;VectorDocument&gt; documents = new ArrayList&lt;&gt;();        for (int i = 0; i &lt; count; i++) &#123;            VectorDocument doc = new VectorDocument();            doc.setId((long) i);            doc.setText(&quot;è¿™æ˜¯ä¸€ä¸ªæµ‹è¯•æ–‡æ¡£ &quot; + i + &quot;ï¼ŒåŒ…å«ä¸€äº›å…³äºæœºå™¨å­¦ä¹ å’Œäººå·¥æ™ºèƒ½çš„å†…å®¹ã€‚&quot;);            doc.setMetadata(Map.of(&quot;type&quot;, &quot;test&quot;, &quot;index&quot;, i));            documents.add(doc);        &#125;        return documents;    &#125;&#125;\n\nğŸ—ï¸ ä¸»æµå‘é‡æ•°æ®åº“å¯¹æ¯”æ ¸å¿ƒå¯¹æ¯”ç»´åº¦\n\n\nç»´åº¦\nè¯´æ˜\n\n\n\néƒ¨ç½²æ–¹å¼\nè‡ªæ‰˜ç®¡ vs äº‘æœåŠ¡\n\n\næ€§èƒ½è¡¨ç°\nQPSã€å»¶è¿Ÿã€ååé‡\n\n\nåŠŸèƒ½ç‰¹æ€§\nç´¢å¼•ç±»å‹ã€ç›¸ä¼¼åº¦åº¦é‡\n\n\næ˜“ç”¨æ€§\nAPIè®¾è®¡ã€æ–‡æ¡£è´¨é‡\n\n\næˆæœ¬æ•ˆç›Š\nè®¸å¯è´¹ç”¨ã€è¿ç»´æˆæœ¬\n\n\nç”Ÿæ€é›†æˆ\næ¡†æ¶æ”¯æŒã€ç¬¬ä¸‰æ–¹å·¥å…·\n\n\nè¯¦ç»†äº§å“å¯¹æ¯”Milvus - å¼€æºå† å†›# Docker Composeé…ç½®version: &#x27;3.8&#x27;services:  milvus-etcd:    image: quay.io/coreos/etcd:v3.5.5  milvus-minio:    image: minio/minio:RELEASE.2023-03-20T20-16-18Z  milvus-standalone:    image: milvusdb/milvus:v2.3.0    ports:      - &quot;19530:19530&quot;\n\nä¼˜åŠ¿ï¼š\n\nâœ… é«˜æ€§èƒ½ï¼šæ”¯æŒæ•°åäº¿å‘é‡çš„é«˜æ•ˆæ£€ç´¢\nâœ… å¯æ‰©å±•ï¼šæ”¯æŒåˆ†å¸ƒå¼éƒ¨ç½²\nâœ… ä¸°å¯Œç‰¹æ€§ï¼šæ”¯æŒå¤šç§ç´¢å¼•ç®—æ³•å’Œç›¸ä¼¼åº¦åº¦é‡\nâœ… äº‘åŸç”Ÿï¼šæ”¯æŒKuberneteséƒ¨ç½²\nâœ… å¤šè¯­è¨€æ”¯æŒï¼šPython, Go, Java, C++ç­‰\n\nåŠ£åŠ¿ï¼š\n\nâŒ éƒ¨ç½²å¤æ‚ï¼šéœ€è¦å¤šä¸ªç»„ä»¶ååŒå·¥ä½œ\nâŒ èµ„æºæ¶ˆè€—ï¼šå¯¹å†…å­˜å’Œå­˜å‚¨è¦æ±‚è¾ƒé«˜\nâŒ å­¦ä¹ æ›²çº¿ï¼šé…ç½®å’Œè°ƒä¼˜ç›¸å¯¹å¤æ‚\n\nPinecone - äº‘åŸç”Ÿé¦–é€‰# Pythonå®¢æˆ·ç«¯ç¤ºä¾‹import pineconepinecone.init(api_key=&#x27;your-api-key&#x27;, environment=&#x27;us-east1-gcp&#x27;)index = pinecone.Index(&#x27;my-index&#x27;)# æ’å…¥å‘é‡vectors = [(&#x27;id1&#x27;, [0.1, 0.2, 0.3, ...]), (&#x27;id2&#x27;, [0.4, 0.5, 0.6, ...])]index.upsert(vectors)# æ£€ç´¢ç›¸ä¼¼å‘é‡results = index.query(vector=[0.1, 0.2, 0.3, ...], top_k=10)\n\nä¼˜åŠ¿ï¼š\n\nâœ… å¼€ç®±å³ç”¨ï¼šæ— éœ€éƒ¨ç½²å’Œç®¡ç†åŸºç¡€è®¾æ–½\nâœ… è‡ªåŠ¨æ‰©å±•ï¼šæ ¹æ®è´Ÿè½½è‡ªåŠ¨è°ƒæ•´èµ„æº\nâœ… é«˜å¯ç”¨æ€§ï¼š99.9%çš„SLAä¿è¯\nâœ… ç®€å•æ˜“ç”¨ï¼šRESTful APIå’Œå¤šç§è¯­è¨€SDK\nâœ… å†…ç½®ä¼˜åŒ–ï¼šè‡ªåŠ¨ç´¢å¼•ä¼˜åŒ–å’Œæ€§èƒ½è°ƒä¼˜\n\nQdrant - Rusté«˜æ€§èƒ½# Dockeréƒ¨ç½²version: &#x27;3.8&#x27;services:  qdrant:    image: qdrant/qdrant:v1.7.0    ports:      - &quot;6333:6333&quot;\n\n# Pythonå®¢æˆ·ç«¯from qdrant_client import QdrantClientclient = QdrantClient(host=&quot;localhost&quot;, port=6333)client.create_collection(    collection_name=&quot;my_collection&quot;,    vectors_config=VectorParams(size=768, distance=Distance.COSINE))\n\nä¼˜åŠ¿ï¼š\n\nâœ… é«˜æ€§èƒ½ï¼šRustç¼–å†™ï¼Œæ€§èƒ½ä¼˜å¼‚\nâœ… ç®€å•éƒ¨ç½²ï¼šå•å®¹å™¨å³å¯è¿è¡Œ\nâœ… RESTful APIï¼šæ ‡å‡†åŒ–çš„APIè®¾è®¡\nâœ… è¿‡æ»¤æ”¯æŒï¼šæ”¯æŒå…ƒæ•°æ®è¿‡æ»¤\nâœ… å¼€æºå…è´¹ï¼šå®Œå…¨å¼€æºï¼Œæ— å•†ä¸šé™åˆ¶\n\nChromaDB - Pythonå‹å¥½# Pythonä½¿ç”¨ç¤ºä¾‹import chromadbclient = chromadb.Client()collection = client.create_collection(name=&quot;my_collection&quot;)collection.add(    documents=[&quot;This is a document&quot;, &quot;This is another document&quot;],    metadatas=[&#123;&quot;source&quot;: &quot;doc1&quot;&#125;, &#123;&quot;source&quot;: &quot;doc2&quot;&#125;],    ids=[&quot;id1&quot;, &quot;id2&quot;])results = collection.query(    query_texts=[&quot;This is a query document&quot;],    n_results=2)\n\nä¼˜åŠ¿ï¼š\n\nâœ… Pythonä¼˜å…ˆï¼šå®Œç¾çš„Pythoné›†æˆ\nâœ… è½»é‡çº§ï¼šæ— éœ€å¤–éƒ¨ä¾èµ–å³å¯è¿è¡Œ\nâœ… æ˜“äºä½¿ç”¨ï¼šç®€æ´çš„APIè®¾è®¡\nâœ… å¼€æºå…è´¹ï¼šApache 2.0è®¸å¯è¯\nâœ… å¿«é€ŸåŸå‹ï¼šé€‚åˆå¿«é€Ÿå¼€å‘å’Œæµ‹è¯•\n\nç»¼åˆå¯¹æ¯”è¡¨\n\n\näº§å“\néƒ¨ç½²æ–¹å¼\nå…è´¹é¢åº¦\næ€§èƒ½\næ˜“ç”¨æ€§\nä¼ä¸šåŠŸèƒ½\næ¨èæŒ‡æ•°\n\n\n\nMilvus\nè‡ªæ‰˜ç®¡\nå®Œå…¨å…è´¹\nâ­â­â­â­â­\nâ­â­â­\nâ­â­â­â­â­\nâ­â­â­â­â­\n\n\nPinecone\näº‘æœåŠ¡\n1Må‘é‡\nâ­â­â­â­â­\nâ­â­â­â­â­\nâ­â­â­â­â­\nâ­â­â­â­\n\n\nQdrant\nè‡ªæ‰˜ç®¡\nå®Œå…¨å…è´¹\nâ­â­â­â­â­\nâ­â­â­â­\nâ­â­â­â­\nâ­â­â­â­â­\n\n\nChromaDB\nè‡ªæ‰˜ç®¡\nå®Œå…¨å…è´¹\nâ­â­â­\nâ­â­â­â­â­\nâ­â­\nâ­â­â­\n\n\nğŸ¯ é€‰æ‹©å»ºè®®å¿«é€Ÿä¸Šæ‰‹ï¼ˆå­¦ä¹ /åŸå‹ï¼‰# æ¨èChromaDBpip install chromadb\n\nä¸­å°å‹é¡¹ç›®# æ¨èQdrantdocker run -p 6333:6333 qdrant/qdrant\n\nå¤§å‹ç”Ÿäº§ç¯å¢ƒ# æ¨èMilvus# ä½¿ç”¨Docker Composeé…ç½®\n\näº‘æœåŠ¡é¦–é€‰# æ¨èPinecone# é›¶è¿ç»´ï¼Œé«˜å¯ç”¨\n\nğŸ“Š æ€§èƒ½åŸºå‡†æµ‹è¯•æµ‹è¯•ç¯å¢ƒé…ç½®\nCPU: Intel Xeon 8æ ¸\nå†…å­˜: 32GB\nå­˜å‚¨: SSD 1TB\næ•°æ®é›†: 1Mä¸ª768ç»´å‘é‡\næŸ¥è¯¢è´Ÿè½½: 1000å¹¶å‘æŸ¥è¯¢\n\næ€§èƒ½å¯¹æ¯”ç»“æœ\n\n\næ•°æ®åº“\næ’å…¥QPS\næŸ¥è¯¢QPS\nå¹³å‡å»¶è¿Ÿ\nå†…å­˜ä½¿ç”¨\nç£ç›˜ä½¿ç”¨\n\n\n\nMilvus\n2,500\n15,000\n12ms\n8GB\n25GB\n\n\nPinecone\n1,800\n12,000\n15ms\näº‘ç«¯\näº‘ç«¯\n\n\nQdrant\n3,200\n18,000\n8ms\n6GB\n20GB\n\n\nChromaDB\n800\n3,000\n45ms\n4GB\n15GB\n\n\nğŸ“š æ€»ç»“æŠ€æœ¯è¦ç‚¹å›é¡¾\nå‘é‡åµŒå…¥æ˜¯åŸºç¡€\n\né€‰æ‹©åˆé€‚çš„åµŒå…¥æ¨¡å‹ï¼ˆBERTã€RoBERTaã€Sentence-BERTç­‰ï¼‰\nè€ƒè™‘æ¨¡å‹ç»´åº¦å’Œè¯­è¨€æ”¯æŒ\nè¯„ä¼°APIè°ƒç”¨æˆæœ¬å’Œæ€§èƒ½\n\n\nç›¸ä¼¼åº¦ç®—æ³•å½±å“ç»“æœ\n\nä½™å¼¦ç›¸ä¼¼åº¦ï¼šé€‚ç”¨äºæ–¹å‘æ€§æ¯”è¾ƒ\næ¬§å‡ é‡Œå¾—è·ç¦»ï¼šé€‚ç”¨äºç»å¯¹è·ç¦»\nç‚¹ç§¯ç›¸ä¼¼åº¦ï¼šé€‚ç”¨äºå½’ä¸€åŒ–å‘é‡\n\n\nç´¢å¼•ç®—æ³•å†³å®šæ€§èƒ½\n\nHNSWï¼šå¹³è¡¡æ£€ç´¢ç²¾åº¦å’Œæ€§èƒ½\nIVFï¼šé€‚åˆå¤§è§„æ¨¡æ•°æ®\né€‰æ‹©åˆé€‚çš„å‚æ•°é…ç½®\n\n\nJavaç”Ÿæ€ç³»ç»Ÿå®Œå–„\n\nSpring Bootæä¾›å®Œæ•´æ¡†æ¶\nMilvusæä¾›ä¸“ä¸šå‘é‡æ•°æ®åº“\nOpenAIå’Œæœ¬åœ°æ¨¡å‹éƒ½æ”¯æŒ\n\n\n\næœ€ä½³å®è·µå»ºè®®å¼€å‘é˜¶æ®µ\nä»å°æ•°æ®å¼€å§‹ï¼šå…ˆç”¨ChromaDBéªŒè¯æ¦‚å¿µ\né€‰æ‹©åˆé€‚çš„ç›¸ä¼¼åº¦åº¦é‡ï¼šæ ¹æ®ä¸šåŠ¡åœºæ™¯é€‰æ‹©\nè®¾ç½®åˆç†çš„é˜ˆå€¼ï¼šé¿å…è¿”å›è¿‡å¤šæ— å…³ç»“æœ\n\nç”Ÿäº§éƒ¨ç½²\né€‰æ‹©åˆé€‚çš„äº§å“ï¼šæ ¹æ®è§„æ¨¡é€‰æ‹©Milvusæˆ–Pinecone\nç›‘æ§æ€§èƒ½æŒ‡æ ‡ï¼šQPSã€å»¶è¿Ÿã€å†…å­˜ä½¿ç”¨\nå®æ–½å¤‡ä»½ç­–ç•¥ï¼šå®šæœŸå¤‡ä»½å‘é‡æ•°æ®\nè€ƒè™‘æˆæœ¬æ•ˆç›Šï¼šäº‘æœåŠ¡vsè‡ªæ‰˜ç®¡çš„æƒè¡¡\n\nå‘å±•è¶‹åŠ¿å±•æœ›äº‘åŸç”Ÿè¶‹åŠ¿\nServerlesså‘é‡æ•°æ®åº“ï¼šæŒ‰éœ€ä»˜è´¹ï¼Œæ— éœ€ç®¡ç†\nå¤šäº‘éƒ¨ç½²ï¼šæ”¯æŒAWSã€GCPã€Azureç­‰\nè¾¹ç¼˜è®¡ç®—ï¼šå‘é‡æ•°æ®åº“å‘è¾¹ç¼˜å»¶ä¼¸\n\nåŠŸèƒ½å¢å¼º\næ··åˆæœç´¢ï¼šå‘é‡+å…³é”®è¯+ç»“æ„åŒ–æ•°æ®æ··åˆ\nå®æ—¶æ›´æ–°ï¼šæµå¼æ•°æ®å®æ—¶å‘é‡åŒ–å’Œç´¢å¼•\nå¤šæ¨¡æ€æ”¯æŒï¼šæ–‡æœ¬ã€å›¾åƒã€éŸ³é¢‘ç­‰å¤šæ¨¡æ€å‘é‡\n\næ€§èƒ½ä¼˜åŒ–\nGPUåŠ é€Ÿï¼šåˆ©ç”¨GPUè¿›è¡Œå‘é‡è®¡ç®—\né‡åŒ–æŠ€æœ¯ï¼šå‡å°‘å­˜å‚¨ç©ºé—´å’Œè®¡ç®—å¼€é”€\nåˆ†å¸ƒå¼æ¶æ„ï¼šæ”¯æŒPBçº§å‘é‡æ•°æ®çš„å¤„ç†\n\nå‘é‡æ•°æ®åº“å·²æˆä¸ºç°ä»£AIåº”ç”¨ä¸å¯æˆ–ç¼ºçš„ç»„ä»¶ã€‚é€šè¿‡æœ¬æ–‡çš„è¯¦ç»†ä»‹ç»å’ŒJavaä»£ç ç¤ºä¾‹ï¼Œä½ åº”è¯¥å·²ç»æŒæ¡äº†å‘é‡æ•°æ®åº“çš„æ ¸å¿ƒæ¦‚å¿µã€æŠ€æœ¯åŸç†å’Œå®é™…åº”ç”¨æ–¹æ³•ã€‚é€‰æ‹©åˆé€‚çš„å‘é‡æ•°æ®åº“ï¼Œç»“åˆä¼˜ç§€çš„Javaç”Ÿæ€ç³»ç»Ÿï¼Œä½ å¯ä»¥æ„å»ºå‡ºé«˜æ€§èƒ½ã€æ˜“ç»´æŠ¤çš„AIåº”ç”¨ç³»ç»Ÿã€‚\n\nğŸ”— ç›¸å…³èµ„æº\n\nMilvuså®˜æ–¹æ–‡æ¡£\nPineconeæ–‡æ¡£\nQdrantæ–‡æ¡£\nChromaDBæ–‡æ¡£\nSpring Bootå®˜æ–¹æ–‡æ¡£\n\n\nğŸ¯ å¼€å§‹æ‚¨çš„å‘é‡æ•°æ®åº“ä¹‹æ—…ï¼ ğŸš€\n","tags":["AIåº”ç”¨","Java","Spring Boot","å‘é‡æ•°æ®åº“","VectorDB","Milvus","Pinecone","Weaviate","Qdrant","ChromaDB","æœºå™¨å­¦ä¹ ","æ£€ç´¢å¢å¼ºç”Ÿæˆ","å‘é‡æ£€ç´¢","Embedding"]},{"title":"0.5.5-Javaå¼‚å¸¸æ—¥å¿—MCPæœåŠ¡æ¶æ„","url":"/2025/01/20/0.5.5-Java%E5%BC%82%E5%B8%B8%E6%97%A5%E5%BF%97MCP%E6%9C%8D%E5%8A%A1%E6%9E%B6%E6%9E%84/","content":"\nåœ¨å¾®æœåŠ¡æ¶æ„ä¸­ï¼Œå¼‚å¸¸æ—¥å¿—ä¸ä»…æ˜¯é—®é¢˜æ’æŸ¥çš„é‡è¦çº¿ç´¢ï¼Œæ›´æ˜¯AIè¾…åŠ©è¯Šæ–­çš„å®è´µæ•°æ®æºã€‚æœ¬æ–‡å°†è¯¦ç»†ä»‹ç»å¦‚ä½•æ„å»ºå®Œæ•´çš„Javaå¼‚å¸¸æ—¥å¿—æ•è·ã€å­˜å‚¨å’ŒMCPæœåŠ¡æ¶æ„ï¼Œè®©å¤§æ¨¡å‹èƒ½å¤Ÿæ™ºèƒ½åˆ†æå’Œå¤„ç†å¼‚å¸¸ä¿¡æ¯ã€‚\n\nğŸ¯ æ¶æ„æ¦‚è§ˆç³»ç»Ÿæ¶æ„å›¾[Javaåº”ç”¨] â†’ [å¼‚å¸¸æ•è·] â†’ [æ—¥å¿—ç»“æ„åŒ–] â†’ [MongoDBå­˜å‚¨]      â†“              â†“              â†“              â†“[ä¸šåŠ¡é€»è¾‘] â†’ [AOPæ‹¦æˆª] â†’ [æ—¥å¿—æ¨¡å‹] â†’ [ç´¢å¼•ä¼˜åŒ–]      â†“              â†“              â†“              â†“[ç›‘æ§å‘Šè­¦] â†’ [å®æ—¶åˆ†æ] â†’ [MCPæœåŠ¡] â†’ [å¤§æ¨¡å‹è°ƒç”¨]\n\næ ¸å¿ƒç»„ä»¶è¯´æ˜ğŸ“‹ æŠ€æœ¯æ ˆé€‰å‹æ ¸å¿ƒæŠ€æœ¯æ ˆ\nSpring Boot 2.7+: å¾®æœåŠ¡æ¡†æ¶\nMongoDB 5.0+: æ–‡æ¡£å‹æ•°æ®åº“\nSpring AOP: å¼‚å¸¸æ‹¦æˆª\nMCP (Model Context Protocol): å¤§æ¨¡å‹æœåŠ¡åè®®\nJackson: JSONåºåˆ—åŒ–\nSLF4J + Logback: æ—¥å¿—æ¡†æ¶\n\nä¾èµ–ç‰ˆæœ¬&lt;properties&gt;    &lt;java.version&gt;17&lt;/java.version&gt;    &lt;spring-boot.version&gt;2.7.18&lt;/spring-boot.version&gt;    &lt;mongodb.version&gt;4.11.1&lt;/mongodb.version&gt;    &lt;jackson.version&gt;2.15.3&lt;/jackson.version&gt;&lt;/properties&gt;\n\nğŸ”§ æ ¸å¿ƒå®ç°1. å¼‚å¸¸æ—¥å¿—æ¨¡å‹è®¾è®¡åŸºç¡€å¼‚å¸¸ä¿¡æ¯æ¨¡å‹@Data@Document(collection = &quot;exception_logs&quot;)public class ExceptionLog &#123;    @Id    private String id;    // åŸºç¡€ä¿¡æ¯    private String applicationName;    private String serviceName;    private String instanceId;    // å¼‚å¸¸ä¿¡æ¯    private String exceptionType;    private String exceptionMessage;    private String stackTrace;    // ä¸šåŠ¡ä¸Šä¸‹æ–‡    private String userId;    private String requestId;    private String sessionId;    private String traceId;    // è¯·æ±‚ä¿¡æ¯    private String httpMethod;    private String requestUri;    private String clientIp;    private Map&lt;String, String&gt; requestHeaders;    private Map&lt;String, Object&gt; requestParams;    private Map&lt;String, Object&gt; requestBody;    // ç³»ç»Ÿä¿¡æ¯    private String serverName;    private String serverIp;    private Integer serverPort;    private String environment;    // æ€§èƒ½ä¿¡æ¯    private Long executionTime;    private Long memoryUsage;    private Integer threadCount;    // æ—¶é—´ä¿¡æ¯    private LocalDateTime exceptionTime;    private LocalDateTime createTime;    // çŠ¶æ€ä¿¡æ¯    private ExceptionStatus status;    private String resolution;    private Integer occurrenceCount;    // åˆ†ç±»ä¿¡æ¯    private ExceptionCategory category;    private ExceptionSeverity severity;    private List&lt;String&gt; tags;    // AIåˆ†æç»“æœ    private String aiAnalysis;    private List&lt;String&gt; suggestions;    private String similarExceptions;&#125;\n\nå¼‚å¸¸çŠ¶æ€æšä¸¾public enum ExceptionStatus &#123;    NEW(&quot;æ–°å¼‚å¸¸&quot;),    ANALYZING(&quot;åˆ†æä¸­&quot;),    RESOLVED(&quot;å·²è§£å†³&quot;),    IGNORED(&quot;å·²å¿½ç•¥&quot;),    RECURRING(&quot;é‡å¤å‡ºç°&quot;);    private final String description;    ExceptionStatus(String description) &#123;        this.description = description;    &#125;&#125;\n\nå¼‚å¸¸åˆ†ç±»æšä¸¾public enum ExceptionCategory &#123;    BUSINESS_EXCEPTION(&quot;ä¸šåŠ¡å¼‚å¸¸&quot;),    SYSTEM_EXCEPTION(&quot;ç³»ç»Ÿå¼‚å¸¸&quot;),    NETWORK_EXCEPTION(&quot;ç½‘ç»œå¼‚å¸¸&quot;),    DATABASE_EXCEPTION(&quot;æ•°æ®åº“å¼‚å¸¸&quot;),    SECURITY_EXCEPTION(&quot;å®‰å…¨å¼‚å¸¸&quot;),    PERFORMANCE_EXCEPTION(&quot;æ€§èƒ½å¼‚å¸¸&quot;),    THIRD_PARTY_EXCEPTION(&quot;ç¬¬ä¸‰æ–¹æœåŠ¡å¼‚å¸¸&quot;),    UNKNOWN(&quot;æœªçŸ¥å¼‚å¸¸&quot;);&#125;\n\nå¼‚å¸¸ä¸¥é‡ç¨‹åº¦æšä¸¾public enum ExceptionSeverity &#123;    LOW(&quot;ä½&quot;),    MEDIUM(&quot;ä¸­&quot;),    HIGH(&quot;é«˜&quot;),    CRITICAL(&quot;ä¸¥é‡&quot;);    private final String description;    ExceptionSeverity(String description) &#123;        this.description = description;    &#125;&#125;\n\n2. å…¨å±€å¼‚å¸¸æ•è·å™¨å…¨å±€å¼‚å¸¸å¤„ç†å™¨@RestControllerAdvice@Slf4jpublic class GlobalExceptionHandler &#123;    @Autowired    private ExceptionLogService exceptionLogService;    @Autowired    private RequestContextHolder requestContextHolder;    /**     * å¤„ç†æ‰€æœ‰æœªæ•è·çš„å¼‚å¸¸     */    @ExceptionHandler(Exception.class)    @ResponseStatus(HttpStatus.INTERNAL_SERVER_ERROR)    public ResponseEntity&lt;ErrorResponse&gt; handleException(Exception ex, HttpServletRequest request) &#123;        // åˆ›å»ºå¼‚å¸¸æ—¥å¿—        ExceptionLog exceptionLog = createExceptionLog(ex, request, ExceptionCategory.SYSTEM_EXCEPTION, ExceptionSeverity.HIGH);        // å¼‚æ­¥ä¿å­˜å¼‚å¸¸æ—¥å¿—        CompletableFuture.runAsync(() -&gt; &#123;            try &#123;                exceptionLogService.saveAsync(exceptionLog);            &#125; catch (Exception e) &#123;                log.error(&quot;ä¿å­˜å¼‚å¸¸æ—¥å¿—å¤±è´¥&quot;, e);            &#125;        &#125;);        // è¿”å›é”™è¯¯å“åº”        ErrorResponse errorResponse = ErrorResponse.builder()                .success(false)                .errorCode(&quot;SYSTEM_ERROR&quot;)                .message(&quot;ç³»ç»Ÿå†…éƒ¨é”™è¯¯ï¼Œè¯·è”ç³»ç®¡ç†å‘˜&quot;)                .requestId(exceptionLog.getRequestId())                .timestamp(LocalDateTime.now())                .build();        return ResponseEntity.status(HttpStatus.INTERNAL_SERVER_ERROR).body(errorResponse);    &#125;    /**     * å¤„ç†ä¸šåŠ¡å¼‚å¸¸     */    @ExceptionHandler(BusinessException.class)    public ResponseEntity&lt;ErrorResponse&gt; handleBusinessException(BusinessException ex, HttpServletRequest request) &#123;        ExceptionLog exceptionLog = createExceptionLog(ex, request, ExceptionCategory.BUSINESS_EXCEPTION, ex.getSeverity());        // å¼‚æ­¥ä¿å­˜        exceptionLogService.saveAsync(exceptionLog);        ErrorResponse errorResponse = ErrorResponse.builder()                .success(false)                .errorCode(ex.getErrorCode())                .message(ex.getMessage())                .requestId(exceptionLog.getRequestId())                .timestamp(LocalDateTime.now())                .build();        return ResponseEntity.status(ex.getHttpStatus()).body(errorResponse);    &#125;    /**     * åˆ›å»ºå¼‚å¸¸æ—¥å¿—å¯¹è±¡     */    private ExceptionLog createExceptionLog(Exception ex, HttpServletRequest request,                                          ExceptionCategory category, ExceptionSeverity severity) &#123;        // è·å–è¯·æ±‚ä¸Šä¸‹æ–‡        RequestContext context = requestContextHolder.getContext();        return ExceptionLog.builder()                .applicationName(getApplicationName())                .serviceName(getServiceName())                .instanceId(getInstanceId())                .exceptionType(ex.getClass().getSimpleName())                .exceptionMessage(ex.getMessage())                .stackTrace(getStackTrace(ex))                .userId(context.getUserId())                .requestId(context.getRequestId())                .sessionId(context.getSessionId())                .traceId(context.getTraceId())                .httpMethod(request.getMethod())                .requestUri(request.getRequestURI())                .clientIp(getClientIp(request))                .requestHeaders(getRequestHeaders(request))                .requestParams(getRequestParams(request))                .requestBody(context.getRequestBody())                .serverName(getServerName())                .serverIp(getServerIp())                .serverPort(request.getServerPort())                .environment(getEnvironment())                .executionTime(context.getExecutionTime())                .memoryUsage(getMemoryUsage())                .threadCount(getThreadCount())                .exceptionTime(LocalDateTime.now())                .createTime(LocalDateTime.now())                .status(ExceptionStatus.NEW)                .category(category)                .severity(severity)                .tags(generateTags(ex))                .build();    &#125;    // è¾…åŠ©æ–¹æ³•    private String getStackTrace(Exception ex) &#123;        StringWriter sw = new StringWriter();        PrintWriter pw = new PrintWriter(sw);        ex.printStackTrace(pw);        return sw.toString();    &#125;    private String getClientIp(HttpServletRequest request) &#123;        String xForwardedFor = request.getHeader(&quot;X-Forwarded-For&quot;);        if (xForwardedFor != null &amp;&amp; !xForwardedFor.isEmpty()) &#123;            return xForwardedFor.split(&quot;,&quot;)[0].trim();        &#125;        return request.getRemoteAddr();    &#125;    private List&lt;String&gt; generateTags(Exception ex) &#123;        List&lt;String&gt; tags = new ArrayList&lt;&gt;();        tags.add(ex.getClass().getSimpleName());        // æ ¹æ®å¼‚å¸¸ç±»å‹æ·»åŠ æ ‡ç­¾        if (ex instanceof SQLException) &#123;            tags.add(&quot;database&quot;);            tags.add(&quot;sql&quot;);        &#125; else if (ex instanceof IOException) &#123;            tags.add(&quot;io&quot;);            tags.add(&quot;file&quot;);        &#125; else if (ex instanceof TimeoutException) &#123;            tags.add(&quot;timeout&quot;);            tags.add(&quot;performance&quot;);        &#125;        return tags;    &#125;&#125;\n\nä¸šåŠ¡å¼‚å¸¸åŸºç±»@Getterpublic class BusinessException extends RuntimeException &#123;    private final String errorCode;    private final HttpStatus httpStatus;    private final ExceptionSeverity severity;    private final Map&lt;String, Object&gt; context;    public BusinessException(String errorCode, String message) &#123;        super(message);        this.errorCode = errorCode;        this.httpStatus = HttpStatus.BAD_REQUEST;        this.severity = ExceptionSeverity.MEDIUM;        this.context = new HashMap&lt;&gt;();    &#125;    public BusinessException(String errorCode, String message, HttpStatus httpStatus) &#123;        super(message);        this.errorCode = errorCode;        this.httpStatus = httpStatus;        this.severity = httpStatus.is5xxServerError() ? ExceptionSeverity.HIGH : ExceptionSeverity.MEDIUM;        this.context = new HashMap&lt;&gt;();    &#125;    public BusinessException(String errorCode, String message, Throwable cause) &#123;        super(message, cause);        this.errorCode = errorCode;        this.httpStatus = HttpStatus.INTERNAL_SERVER_ERROR;        this.severity = ExceptionSeverity.HIGH;        this.context = new HashMap&lt;&gt;();    &#125;    public BusinessException addContext(String key, Object value) &#123;        this.context.put(key, value);        return this;    &#125;&#125;\n\n3. MongoDBå­˜å‚¨æœåŠ¡MongoDBé…ç½®@Configurationpublic class MongoConfig &#123;    @Bean    public MongoTemplate mongoTemplate(MongoDatabaseFactory databaseFactory) &#123;        MappingMongoConverter converter = new MappingMongoConverter(new DefaultDbRefResolver(databaseFactory), new MongoMappingContext());        converter.setCustomConversions(customConversions());        converter.afterPropertiesSet();        MongoTemplate mongoTemplate = new MongoTemplate(databaseFactory, converter);        // åˆ›å»ºç´¢å¼•        createIndexes(mongoTemplate);        return mongoTemplate;    &#125;    private CustomConversions customConversions() &#123;        List&lt;Converter&lt;?, ?&gt;&gt; converters = new ArrayList&lt;&gt;();        converters.add(new LocalDateTimeToStringConverter());        converters.add(new StringToLocalDateTimeConverter());        return new CustomConversions(converters);    &#125;    private void createIndexes(MongoTemplate mongoTemplate) &#123;        // å¤åˆç´¢å¼•ï¼šå¼‚å¸¸ç±»å‹ + æ—¶é—´        mongoTemplate.indexOps(ExceptionLog.class)                .ensureIndex(new Index()                        .on(&quot;exceptionType&quot;, Sort.Direction.ASC)                        .on(&quot;exceptionTime&quot;, Sort.Direction.DESC)                        .named(&quot;exception_type_time&quot;));        // æ—¶é—´ç´¢å¼•        mongoTemplate.indexOps(ExceptionLog.class)                .ensureIndex(new Index()                        .on(&quot;exceptionTime&quot;, Sort.Direction.DESC)                        .expire(30 * 24 * 60 * 60) // 30å¤©åè‡ªåŠ¨åˆ é™¤                        .named(&quot;exception_time_ttl&quot;));        // çŠ¶æ€ç´¢å¼•        mongoTemplate.indexOps(ExceptionLog.class)                .ensureIndex(new Index()                        .on(&quot;status&quot;, Sort.Direction.ASC)                        .named(&quot;exception_status&quot;));        // ç”¨æˆ·IDç´¢å¼•        mongoTemplate.indexOps(ExceptionLog.class)                .ensureIndex(new Index()                        .on(&quot;userId&quot;, Sort.Direction.ASC)                        .named(&quot;user_id&quot;));        // è¯·æ±‚IDç´¢å¼•        mongoTemplate.indexOps(ExceptionLog.class)                .ensureIndex(new Index()                        .on(&quot;requestId&quot;, Sort.Direction.ASC)                        .named(&quot;request_id&quot;));    &#125;&#125;\n\nå¼‚å¸¸æ—¥å¿—æœåŠ¡@Service@Slf4jpublic class ExceptionLogService &#123;    @Autowired    private MongoTemplate mongoTemplate;    @Autowired    private ApplicationEventPublisher eventPublisher;    /**     * åŒæ­¥ä¿å­˜å¼‚å¸¸æ—¥å¿—     */    public ExceptionLog save(ExceptionLog exceptionLog) &#123;        try &#123;            // è®¾ç½®åˆ›å»ºæ—¶é—´            exceptionLog.setCreateTime(LocalDateTime.now());            // æ£€æŸ¥æ˜¯å¦ä¸ºé‡å¤å¼‚å¸¸            checkDuplicateException(exceptionLog);            // ä¿å­˜åˆ°MongoDB            ExceptionLog saved = mongoTemplate.save(exceptionLog);            // å‘å¸ƒå¼‚å¸¸äº‹ä»¶            eventPublisher.publishEvent(new ExceptionLoggedEvent(saved));            log.info(&quot;å¼‚å¸¸æ—¥å¿—ä¿å­˜æˆåŠŸ: &#123;&#125;&quot;, saved.getId());            return saved;        &#125; catch (Exception e) &#123;            log.error(&quot;ä¿å­˜å¼‚å¸¸æ—¥å¿—å¤±è´¥&quot;, e);            throw new RuntimeException(&quot;ä¿å­˜å¼‚å¸¸æ—¥å¿—å¤±è´¥&quot;, e);        &#125;    &#125;    /**     * å¼‚æ­¥ä¿å­˜å¼‚å¸¸æ—¥å¿—     */    @Async    public CompletableFuture&lt;Void&gt; saveAsync(ExceptionLog exceptionLog) &#123;        return CompletableFuture.runAsync(() -&gt; &#123;            try &#123;                save(exceptionLog);            &#125; catch (Exception e) &#123;                log.error(&quot;å¼‚æ­¥ä¿å­˜å¼‚å¸¸æ—¥å¿—å¤±è´¥&quot;, e);            &#125;        &#125;);    &#125;    /**     * æ‰¹é‡ä¿å­˜å¼‚å¸¸æ—¥å¿—     */    public List&lt;ExceptionLog&gt; saveBatch(List&lt;ExceptionLog&gt; exceptionLogs) &#123;        try &#123;            return (List&lt;ExceptionLog&gt;) mongoTemplate.insertAll(exceptionLogs);        &#125; catch (Exception e) &#123;            log.error(&quot;æ‰¹é‡ä¿å­˜å¼‚å¸¸æ—¥å¿—å¤±è´¥&quot;, e);            throw new RuntimeException(&quot;æ‰¹é‡ä¿å­˜å¼‚å¸¸æ—¥å¿—å¤±è´¥&quot;, e);        &#125;    &#125;    /**     * æ£€æŸ¥é‡å¤å¼‚å¸¸     */    private void checkDuplicateException(ExceptionLog exceptionLog) &#123;        // æŸ¥è¯¢æœ€è¿‘24å°æ—¶å†…ç›¸åŒç±»å‹çš„å¼‚å¸¸        LocalDateTime startTime = LocalDateTime.now().minusHours(24);        Query query = Query.query(Criteria.where(&quot;exceptionType&quot;).is(exceptionLog.getExceptionType())                .and(&quot;exceptionMessage&quot;).is(exceptionLog.getExceptionMessage())                .and(&quot;exceptionTime&quot;).gte(startTime));        List&lt;ExceptionLog&gt; similarExceptions = mongoTemplate.find(query, ExceptionLog.class);        if (!similarExceptions.isEmpty()) &#123;            // æ›´æ–°ç¬¬ä¸€ä¸ªå¼‚å¸¸çš„å‘ç”Ÿæ¬¡æ•°            ExceptionLog firstException = similarExceptions.get(0);            firstException.setOccurrenceCount(firstException.getOccurrenceCount() + 1);            mongoTemplate.save(firstException);            // å°†å½“å‰å¼‚å¸¸æ ‡è®°ä¸ºé‡å¤            exceptionLog.setStatus(ExceptionStatus.RECURRING);            exceptionLog.setSimilarExceptions(firstException.getId());        &#125;    &#125;    /**     * æ ¹æ®IDæŸ¥è¯¢å¼‚å¸¸æ—¥å¿—     */    public Optional&lt;ExceptionLog&gt; findById(String id) &#123;        try &#123;            return Optional.ofNullable(mongoTemplate.findById(id, ExceptionLog.class));        &#125; catch (Exception e) &#123;            log.error(&quot;æŸ¥è¯¢å¼‚å¸¸æ—¥å¿—å¤±è´¥: &#123;&#125;&quot;, id, e);            return Optional.empty();        &#125;    &#125;    /**     * åˆ†é¡µæŸ¥è¯¢å¼‚å¸¸æ—¥å¿—     */    public Page&lt;ExceptionLog&gt; findAll(Pageable pageable) &#123;        try &#123;            Query query = new Query().with(pageable);            List&lt;ExceptionLog&gt; content = mongoTemplate.find(query, ExceptionLog.class);            long total = mongoTemplate.count(query, ExceptionLog.class);            return new PageImpl&lt;&gt;(content, pageable, total);        &#125; catch (Exception e) &#123;            log.error(&quot;åˆ†é¡µæŸ¥è¯¢å¼‚å¸¸æ—¥å¿—å¤±è´¥&quot;, e);            return new PageImpl&lt;&gt;(Collections.emptyList(), pageable, 0);        &#125;    &#125;    /**     * æ ¹æ®æ¡ä»¶æŸ¥è¯¢å¼‚å¸¸æ—¥å¿—     */    public List&lt;ExceptionLog&gt; findByCriteria(ExceptionLogCriteria criteria) &#123;        try &#123;            Query query = buildQuery(criteria);            return mongoTemplate.find(query, ExceptionLog.class);        &#125; catch (Exception e) &#123;            log.error(&quot;æ ¹æ®æ¡ä»¶æŸ¥è¯¢å¼‚å¸¸æ—¥å¿—å¤±è´¥&quot;, e);            return Collections.emptyList();        &#125;    &#125;    /**     * æ„å»ºæŸ¥è¯¢æ¡ä»¶     */    private Query buildQuery(ExceptionLogCriteria criteria) &#123;        Query query = new Query();        if (StringUtils.hasText(criteria.getExceptionType())) &#123;            query.addCriteria(Criteria.where(&quot;exceptionType&quot;).is(criteria.getExceptionType()));        &#125;        if (criteria.getStatus() != null) &#123;            query.addCriteria(Criteria.where(&quot;status&quot;).is(criteria.getStatus()));        &#125;        if (criteria.getCategory() != null) &#123;            query.addCriteria(Criteria.where(&quot;category&quot;).is(criteria.getCategory()));        &#125;        if (criteria.getSeverity() != null) &#123;            query.addCriteria(Criteria.where(&quot;severity&quot;).is(criteria.getSeverity()));        &#125;        if (StringUtils.hasText(criteria.getUserId())) &#123;            query.addCriteria(Criteria.where(&quot;userId&quot;).is(criteria.getUserId()));        &#125;        if (criteria.getStartTime() != null &amp;&amp; criteria.getEndTime() != null) &#123;            query.addCriteria(Criteria.where(&quot;exceptionTime&quot;)                    .gte(criteria.getStartTime())                    .lte(criteria.getEndTime()));        &#125;        if (criteria.getTags() != null &amp;&amp; !criteria.getTags().isEmpty()) &#123;            query.addCriteria(Criteria.where(&quot;tags&quot;).in(criteria.getTags()));        &#125;        return query;    &#125;    /**     * æ›´æ–°å¼‚å¸¸çŠ¶æ€     */    public boolean updateStatus(String id, ExceptionStatus status, String resolution) &#123;        try &#123;            Query query = Query.query(Criteria.where(&quot;_id&quot;).is(new ObjectId(id)));            Update update = new Update()                    .set(&quot;status&quot;, status)                    .set(&quot;resolution&quot;, resolution);            UpdateResult result = mongoTemplate.updateFirst(query, update, ExceptionLog.class);            return result.getModifiedCount() &gt; 0;        &#125; catch (Exception e) &#123;            log.error(&quot;æ›´æ–°å¼‚å¸¸çŠ¶æ€å¤±è´¥: &#123;&#125;&quot;, id, e);            return false;        &#125;    &#125;    /**     * è·å–å¼‚å¸¸ç»Ÿè®¡ä¿¡æ¯     */    public ExceptionStatistics getStatistics(LocalDateTime startTime, LocalDateTime endTime) &#123;        try &#123;            MatchOperation matchOperation = Aggregation.match(                    Criteria.where(&quot;exceptionTime&quot;).gte(startTime).lte(endTime)            );            GroupOperation groupOperation = Aggregation.group()                    .count().as(&quot;totalCount&quot;)                    .addToSet(&quot;exceptionType&quot;).as(&quot;exceptionTypes&quot;)                    .addToSet(&quot;category&quot;).as(&quot;categories&quot;)                    .addToSet(&quot;severity&quot;).as(&quot;severities&quot;);            Aggregation aggregation = Aggregation.newAggregation(matchOperation, groupOperation);            AggregationResults&lt;ExceptionStatistics&gt; results = mongoTemplate.aggregate(aggregation, &quot;exception_logs&quot;, ExceptionStatistics.class);            return results.getUniqueMappedResult();        &#125; catch (Exception e) &#123;            log.error(&quot;è·å–å¼‚å¸¸ç»Ÿè®¡ä¿¡æ¯å¤±è´¥&quot;, e);            return new ExceptionStatistics();        &#125;    &#125;&#125;\n\n4. MCPæœåŠ¡æ¥å£MCPæœåŠ¡é…ç½®@Configuration@EnableMcpServerpublic class McpServerConfig &#123;    @Bean    public McpServerTransport mcpServerTransport() &#123;        return new StdioServerTransport();    &#125;    @Bean    public McpServerCapabilities serverCapabilities() &#123;        return McpServerCapabilities.builder()                .tools(true)                .resources(true)                .prompts(true)                .logging(true)                .build();    &#125;&#125;\n\nå¼‚å¸¸åˆ†æå·¥å…·@Component@Tool@Slf4jpublic class ExceptionAnalysisTool &#123;    @Autowired    private ExceptionLogService exceptionLogService;    @Autowired    private AiAnalysisService aiAnalysisService;    /**     * åˆ†æå¼‚å¸¸æ—¥å¿—     */    @ToolMethod(description = &quot;åˆ†ææŒ‡å®šçš„å¼‚å¸¸æ—¥å¿—ï¼Œæä¾›è§£å†³æ–¹æ¡ˆå»ºè®®&quot;)    public String analyzeException(            @ToolParameter(description = &quot;å¼‚å¸¸æ—¥å¿—ID&quot;) String exceptionId,            @ToolParameter(description = &quot;æ˜¯å¦éœ€è¦è¯¦ç»†åˆ†æ&quot;, required = false) Boolean detailed) &#123;        try &#123;            // æŸ¥è¯¢å¼‚å¸¸æ—¥å¿—            Optional&lt;ExceptionLog&gt; exceptionLogOpt = exceptionLogService.findById(exceptionId);            if (!exceptionLogOpt.isPresent()) &#123;                return &quot;æœªæ‰¾åˆ°æŒ‡å®šçš„å¼‚å¸¸æ—¥å¿—&quot;;            &#125;            ExceptionLog exceptionLog = exceptionLogOpt.get();            // åŸºæœ¬ä¿¡æ¯åˆ†æ            StringBuilder analysis = new StringBuilder();            analysis.append(&quot;ğŸ” å¼‚å¸¸åˆ†ææŠ¥å‘Š\\n&quot;);            analysis.append(&quot;================\\n\\n&quot;);            analysis.append(String.format(&quot;å¼‚å¸¸ç±»å‹: %s\\n&quot;, exceptionLog.getExceptionType()));            analysis.append(String.format(&quot;å¼‚å¸¸æ¶ˆæ¯: %s\\n&quot;, exceptionLog.getExceptionMessage()));            analysis.append(String.format(&quot;å‘ç”Ÿæ—¶é—´: %s\\n&quot;, exceptionLog.getExceptionTime()));            analysis.append(String.format(&quot;ä¸¥é‡ç¨‹åº¦: %s\\n&quot;, exceptionLog.getSeverity()));            analysis.append(String.format(&quot;å¼‚å¸¸åˆ†ç±»: %s\\n&quot;, exceptionLog.getCategory()));            analysis.append(String.format(&quot;æœåŠ¡åç§°: %s\\n&quot;, exceptionLog.getServiceName()));            analysis.append(String.format(&quot;è¯·æ±‚URI: %s %s\\n&quot;, exceptionLog.getHttpMethod(), exceptionLog.getRequestUri()));            if (StringUtils.hasText(exceptionLog.getUserId())) &#123;                analysis.append(String.format(&quot;ç”¨æˆ·ID: %s\\n&quot;, exceptionLog.getUserId()));            &#125;            analysis.append(&quot;\\nğŸ“‹ å †æ ˆè·Ÿè¸ª:\\n&quot;);            analysis.append(exceptionLog.getStackTrace());            // AIåˆ†æï¼ˆå¦‚æœéœ€è¦è¯¦ç»†åˆ†æï¼‰            if (Boolean.TRUE.equals(detailed)) &#123;                analysis.append(&quot;\\nğŸ¤– AIåˆ†æç»“æœ:\\n&quot;);                try &#123;                    String aiAnalysis = aiAnalysisService.analyzeException(exceptionLog);                    analysis.append(aiAnalysis);                    // ä¿å­˜AIåˆ†æç»“æœ                    exceptionLog.setAiAnalysis(aiAnalysis);                    exceptionLogService.save(exceptionLog);                &#125; catch (Exception e) &#123;                    analysis.append(&quot;AIåˆ†æå¤±è´¥: &quot;).append(e.getMessage());                &#125;            &#125;            return analysis.toString();        &#125; catch (Exception e) &#123;            log.error(&quot;åˆ†æå¼‚å¸¸æ—¥å¿—å¤±è´¥&quot;, e);            return &quot;åˆ†æå¼‚å¸¸æ—¥å¿—æ—¶å‘ç”Ÿé”™è¯¯: &quot; + e.getMessage();        &#125;    &#125;    /**     * æŸ¥è¯¢å¼‚å¸¸ç»Ÿè®¡     */    @ToolMethod(description = &quot;æŸ¥è¯¢æŒ‡å®šæ—¶é—´èŒƒå›´å†…çš„å¼‚å¸¸ç»Ÿè®¡ä¿¡æ¯&quot;)    public String getExceptionStatistics(            @ToolParameter(description = &quot;å¼€å§‹æ—¶é—´ï¼Œæ ¼å¼ï¼šyyyy-MM-dd HH:mm:ss&quot;) String startTimeStr,            @ToolParameter(description = &quot;ç»“æŸæ—¶é—´ï¼Œæ ¼å¼ï¼šyyyy-MM-dd HH:mm:ss&quot;) String endTimeStr) &#123;        try &#123;            DateTimeFormatter formatter = DateTimeFormatter.ofPattern(&quot;yyyy-MM-dd HH:mm:ss&quot;);            LocalDateTime startTime = LocalDateTime.parse(startTimeStr, formatter);            LocalDateTime endTime = LocalDateTime.parse(endTimeStr, formatter);            ExceptionStatistics statistics = exceptionLogService.getStatistics(startTime, endTime);            StringBuilder result = new StringBuilder();            result.append(&quot;ğŸ“Š å¼‚å¸¸ç»Ÿè®¡æŠ¥å‘Š\\n&quot;);            result.append(&quot;================\\n\\n&quot;);            result.append(String.format(&quot;ç»Ÿè®¡æ—¶é—´: %s è‡³ %s\\n&quot;, startTimeStr, endTimeStr));            result.append(String.format(&quot;æ€»å¼‚å¸¸æ•°: %d\\n&quot;, statistics.getTotalCount()));            if (statistics.getExceptionTypes() != null) &#123;                result.append(String.format(&quot;å¼‚å¸¸ç±»å‹æ•°: %d\\n&quot;, statistics.getExceptionTypes().size()));                result.append(&quot;ä¸»è¦å¼‚å¸¸ç±»å‹:\\n&quot;);                statistics.getExceptionTypes().stream()                        .limit(10)                        .forEach(type -&gt; result.append(String.format(&quot;  - %s\\n&quot;, type)));            &#125;            if (statistics.getCategories() != null) &#123;                result.append(&quot;\\nå¼‚å¸¸åˆ†ç±»:\\n&quot;);                statistics.getCategories().forEach(category -&gt;                        result.append(String.format(&quot;  - %s\\n&quot;, category)));            &#125;            if (statistics.getSeverities() != null) &#123;                result.append(&quot;\\nä¸¥é‡ç¨‹åº¦åˆ†å¸ƒ:\\n&quot;);                statistics.getSeverities().forEach(severity -&gt;                        result.append(String.format(&quot;  - %s\\n&quot;, severity)));            &#125;            return result.toString();        &#125; catch (Exception e) &#123;            log.error(&quot;æŸ¥è¯¢å¼‚å¸¸ç»Ÿè®¡å¤±è´¥&quot;, e);            return &quot;æŸ¥è¯¢å¼‚å¸¸ç»Ÿè®¡æ—¶å‘ç”Ÿé”™è¯¯: &quot; + e.getMessage();        &#125;    &#125;    /**     * æœç´¢ç›¸ä¼¼å¼‚å¸¸     */    @ToolMethod(description = &quot;æœç´¢ä¸æŒ‡å®šå¼‚å¸¸ç›¸ä¼¼çš„å†å²å¼‚å¸¸&quot;)    public String findSimilarExceptions(            @ToolParameter(description = &quot;å¼‚å¸¸ç±»å‹&quot;) String exceptionType,            @ToolParameter(description = &quot;å¼‚å¸¸æ¶ˆæ¯&quot;) String exceptionMessage,            @ToolParameter(description = &quot;æœ€å¤§è¿”å›æ•°é‡&quot;, required = false) Integer limit) &#123;        try &#123;            if (limit == null) &#123;                limit = 10;            &#125;            // æ„å»ºæœç´¢æ¡ä»¶            ExceptionLogCriteria criteria = ExceptionLogCriteria.builder()                    .exceptionType(exceptionType)                    .startTime(LocalDateTime.now().minusDays(30)) // æœ€è¿‘30å¤©                    .endTime(LocalDateTime.now())                    .build();            List&lt;ExceptionLog&gt; similarExceptions = exceptionLogService.findByCriteria(criteria);            StringBuilder result = new StringBuilder();            result.append(&quot;ğŸ” ç›¸ä¼¼å¼‚å¸¸æœç´¢ç»“æœ\\n&quot;);            result.append(&quot;===================\\n\\n&quot;);            result.append(String.format(&quot;æœç´¢æ¡ä»¶: %s\\n&quot;, exceptionType));            result.append(String.format(&quot;æ‰¾åˆ°å¼‚å¸¸æ•°: %d\\n\\n&quot;, similarExceptions.size()));            // æ˜¾ç¤ºå‰Nä¸ªç›¸ä¼¼å¼‚å¸¸            similarExceptions.stream()                    .limit(limit)                    .forEach(ex -&gt; &#123;                        result.append(String.format(&quot;ID: %s\\n&quot;, ex.getId()));                        result.append(String.format(&quot;æ—¶é—´: %s\\n&quot;, ex.getExceptionTime()));                        result.append(String.format(&quot;æ¶ˆæ¯: %s\\n&quot;, ex.getExceptionMessage()));                        result.append(String.format(&quot;çŠ¶æ€: %s\\n&quot;, ex.getStatus()));                        result.append(String.format(&quot;ç”¨æˆ·: %s\\n&quot;, ex.getUserId() != null ? ex.getUserId() : &quot;æœªçŸ¥&quot;));                        result.append(&quot;---\\n&quot;);                    &#125;);            return result.toString();        &#125; catch (Exception e) &#123;            log.error(&quot;æœç´¢ç›¸ä¼¼å¼‚å¸¸å¤±è´¥&quot;, e);            return &quot;æœç´¢ç›¸ä¼¼å¼‚å¸¸æ—¶å‘ç”Ÿé”™è¯¯: &quot; + e.getMessage();        &#125;    &#125;    /**     * è·å–å¼‚å¸¸è¶‹åŠ¿åˆ†æ     */    @ToolMethod(description = &quot;åˆ†æå¼‚å¸¸å‘ç”Ÿè¶‹åŠ¿å’Œæ¨¡å¼&quot;)    public String getExceptionTrends(            @ToolParameter(description = &quot;åˆ†æå¤©æ•°&quot;, required = false) Integer days) &#123;        try &#123;            if (days == null) &#123;                days = 7;            &#125;            LocalDateTime endTime = LocalDateTime.now();            LocalDateTime startTime = endTime.minusDays(days);            // æŒ‰å¤©ç»Ÿè®¡å¼‚å¸¸æ•°é‡            List&lt;ExceptionTrend&gt; trends = getExceptionTrendsByDay(startTime, endTime);            StringBuilder result = new StringBuilder();            result.append(&quot;ğŸ“ˆ å¼‚å¸¸è¶‹åŠ¿åˆ†æ\\n&quot;);            result.append(&quot;===============\\n\\n&quot;);            result.append(String.format(&quot;åˆ†æå‘¨æœŸ: æœ€è¿‘%då¤©\\n&quot;, days));            result.append(String.format(&quot;æ•°æ®ç‚¹æ•°: %d\\n\\n&quot;, trends.size()));            result.append(&quot;æ—¥æœŸ\\t\\tå¼‚å¸¸æ•°é‡\\tä¸»è¦ç±»å‹\\n&quot;);            result.append(&quot;----------------------------------------\\n&quot;);            for (ExceptionTrend trend : trends) &#123;                result.append(String.format(&quot;%s\\t%d\\t\\t%s\\n&quot;,                        trend.getDate().toLocalDate(),                        trend.getCount(),                        trend.getTopExceptionType() != null ? trend.getTopExceptionType() : &quot;æ— &quot;));            &#125;            return result.toString();        &#125; catch (Exception e) &#123;            log.error(&quot;è·å–å¼‚å¸¸è¶‹åŠ¿å¤±è´¥&quot;, e);            return &quot;è·å–å¼‚å¸¸è¶‹åŠ¿æ—¶å‘ç”Ÿé”™è¯¯: &quot; + e.getMessage();        &#125;    &#125;    private List&lt;ExceptionTrend&gt; getExceptionTrendsByDay(LocalDateTime startTime, LocalDateTime endTime) &#123;        // è¿™é‡Œå®ç°æŒ‰å¤©ç»Ÿè®¡å¼‚å¸¸æ•°é‡çš„é€»è¾‘        // ä½¿ç”¨MongoDBèšåˆç®¡é“å®ç°        return new ArrayList&lt;&gt;();    &#125;&#125;\n\nMCPèµ„æºå¤„ç†å™¨@Component@Resource@Slf4jpublic class ExceptionLogResource &#123;    @Autowired    private ExceptionLogService exceptionLogService;    /**     * è·å–æœ€æ–°çš„å¼‚å¸¸æ—¥å¿—     */    @ResourceMethod(uri = &quot;logs://exceptions/latest&quot;, description = &quot;è·å–æœ€æ–°çš„å¼‚å¸¸æ—¥å¿—&quot;)    public String getLatestExceptions(            @ResourceParameter(description = &quot;è·å–æ•°é‡&quot;, required = false) Integer limit) &#123;        try &#123;            if (limit == null) &#123;                limit = 10;            &#125;            PageRequest pageRequest = PageRequest.of(0, limit, Sort.by(&quot;exceptionTime&quot;).descending());            Page&lt;ExceptionLog&gt; page = exceptionLogService.findAll(pageRequest);            StringBuilder result = new StringBuilder();            result.append(&quot;ğŸ“‹ æœ€æ–°å¼‚å¸¸æ—¥å¿—\\n&quot;);            result.append(&quot;===============\\n\\n&quot;);            for (ExceptionLog log : page.getContent()) &#123;                result.append(String.format(&quot;æ—¶é—´: %s\\n&quot;, log.getExceptionTime()));                result.append(String.format(&quot;ç±»å‹: %s\\n&quot;, log.getExceptionType()));                result.append(String.format(&quot;æ¶ˆæ¯: %s\\n&quot;, log.getExceptionMessage()));                result.append(String.format(&quot;ä¸¥é‡ç¨‹åº¦: %s\\n&quot;, log.getSeverity()));                result.append(String.format(&quot;çŠ¶æ€: %s\\n&quot;, log.getStatus()));                result.append(&quot;---\\n&quot;);            &#125;            return result.toString();        &#125; catch (Exception e) &#123;            log.error(&quot;è·å–æœ€æ–°å¼‚å¸¸æ—¥å¿—å¤±è´¥&quot;, e);            return &quot;è·å–æœ€æ–°å¼‚å¸¸æ—¥å¿—æ—¶å‘ç”Ÿé”™è¯¯: &quot; + e.getMessage();        &#125;    &#125;    /**     * è·å–å¼‚å¸¸æ—¥å¿—è¯¦æƒ…     */    @ResourceMethod(uri = &quot;logs://exceptions/&#123;id&#125;&quot;, description = &quot;è·å–æŒ‡å®šIDçš„å¼‚å¸¸æ—¥å¿—è¯¦æƒ…&quot;)    public String getExceptionDetails(@ResourceParameter(description = &quot;å¼‚å¸¸æ—¥å¿—ID&quot;) String id) &#123;        try &#123;            Optional&lt;ExceptionLog&gt; exceptionLogOpt = exceptionLogService.findById(id);            if (!exceptionLogOpt.isPresent()) &#123;                return &quot;æœªæ‰¾åˆ°æŒ‡å®šçš„å¼‚å¸¸æ—¥å¿—&quot;;            &#125;            ExceptionLog log = exceptionLogOpt.get();            StringBuilder result = new StringBuilder();            result.append(&quot;ğŸ“„ å¼‚å¸¸æ—¥å¿—è¯¦æƒ…\\n&quot;);            result.append(&quot;================\\n\\n&quot;);            result.append(String.format(&quot;ID: %s\\n&quot;, log.getId()));            result.append(String.format(&quot;åº”ç”¨åç§°: %s\\n&quot;, log.getApplicationName()));            result.append(String.format(&quot;æœåŠ¡åç§°: %s\\n&quot;, log.getServiceName()));            result.append(String.format(&quot;å¼‚å¸¸æ—¶é—´: %s\\n&quot;, log.getExceptionTime()));            result.append(String.format(&quot;å¼‚å¸¸ç±»å‹: %s\\n&quot;, log.getExceptionType()));            result.append(String.format(&quot;å¼‚å¸¸æ¶ˆæ¯: %s\\n&quot;, log.getExceptionMessage()));            result.append(String.format(&quot;ä¸¥é‡ç¨‹åº¦: %s\\n&quot;, log.getSeverity()));            result.append(String.format(&quot;å¼‚å¸¸åˆ†ç±»: %s\\n&quot;, log.getCategory()));            result.append(String.format(&quot;çŠ¶æ€: %s\\n&quot;, log.getStatus()));            if (StringUtils.hasText(log.getResolution())) &#123;                result.append(String.format(&quot;è§£å†³æ–¹æ¡ˆ: %s\\n&quot;, log.getResolution()));            &#125;            if (log.getOccurrenceCount() &gt; 1) &#123;                result.append(String.format(&quot;å‘ç”Ÿæ¬¡æ•°: %d\\n&quot;, log.getOccurrenceCount()));            &#125;            result.append(String.format(&quot;\\nè¯·æ±‚ä¿¡æ¯:\\n&quot;));            result.append(String.format(&quot;  æ–¹æ³•: %s\\n&quot;, log.getHttpMethod()));            result.append(String.format(&quot;  URI: %s\\n&quot;, log.getRequestUri()));            result.append(String.format(&quot;  å®¢æˆ·ç«¯IP: %s\\n&quot;, log.getClientIp()));            if (StringUtils.hasText(log.getUserId())) &#123;                result.append(String.format(&quot;  ç”¨æˆ·ID: %s\\n&quot;, log.getUserId()));            &#125;            result.append(String.format(&quot;\\nå †æ ˆè·Ÿè¸ª:\\n%s\\n&quot;, log.getStackTrace()));            return result.toString();        &#125; catch (Exception e) &#123;            log.error(&quot;è·å–å¼‚å¸¸æ—¥å¿—è¯¦æƒ…å¤±è´¥&quot;, e);            return &quot;è·å–å¼‚å¸¸æ—¥å¿—è¯¦æƒ…æ—¶å‘ç”Ÿé”™è¯¯: &quot; + e.getMessage();        &#125;    &#125;&#125;\n\n5. AIåˆ†ææœåŠ¡AIåˆ†ææœåŠ¡æ¥å£@Service@Slf4jpublic class AiAnalysisService &#123;    @Autowired    private RestTemplate restTemplate;    @Value(&quot;$&#123;ai.analysis.endpoint:http://localhost:11434/api/generate&#125;&quot;)    private String aiEndpoint;    @Value(&quot;$&#123;ai.analysis.model:llama2&#125;&quot;)    private String aiModel;    /**     * åˆ†æå¼‚å¸¸æ—¥å¿—     */    public String analyzeException(ExceptionLog exceptionLog) &#123;        try &#123;            // æ„å»ºåˆ†ææç¤º            String prompt = buildAnalysisPrompt(exceptionLog);            // è°ƒç”¨AIæ¨¡å‹            Map&lt;String, Object&gt; request = new HashMap&lt;&gt;();            request.put(&quot;model&quot;, aiModel);            request.put(&quot;prompt&quot;, prompt);            request.put(&quot;stream&quot;, false);            HttpHeaders headers = new HttpHeaders();            headers.setContentType(MediaType.APPLICATION_JSON);            HttpEntity&lt;Map&lt;String, Object&gt;&gt; entity = new HttpEntity&lt;&gt;(request, headers);            ResponseEntity&lt;Map&gt; response = restTemplate.postForEntity(aiEndpoint, entity, Map.class);            if (response.getStatusCode().is2xxSuccessful()) &#123;                Map&lt;String, Object&gt; responseBody = response.getBody();                return responseBody.get(&quot;response&quot;).toString();            &#125; else &#123;                throw new RuntimeException(&quot;AIåˆ†æè¯·æ±‚å¤±è´¥: &quot; + response.getStatusCode());            &#125;        &#125; catch (Exception e) &#123;            log.error(&quot;AIåˆ†æå¼‚å¸¸å¤±è´¥&quot;, e);            return &quot;AIåˆ†æå¤±è´¥: &quot; + e.getMessage();        &#125;    &#125;    /**     * æ„å»ºåˆ†ææç¤º     */    private String buildAnalysisPrompt(ExceptionLog exceptionLog) &#123;        StringBuilder prompt = new StringBuilder();        prompt.append(&quot;è¯·åˆ†æä»¥ä¸‹Javaå¼‚å¸¸ä¿¡æ¯ï¼Œå¹¶æä¾›è§£å†³æ–¹æ¡ˆå»ºè®®ï¼š\\n\\n&quot;);        prompt.append(&quot;å¼‚å¸¸åŸºæœ¬ä¿¡æ¯ï¼š\\n&quot;);        prompt.append(&quot;- å¼‚å¸¸ç±»å‹: &quot;).append(exceptionLog.getExceptionType()).append(&quot;\\n&quot;);        prompt.append(&quot;- å¼‚å¸¸æ¶ˆæ¯: &quot;).append(exceptionLog.getExceptionMessage()).append(&quot;\\n&quot;);        prompt.append(&quot;- å‘ç”Ÿæ—¶é—´: &quot;).append(exceptionLog.getExceptionTime()).append(&quot;\\n&quot;);        prompt.append(&quot;- ä¸¥é‡ç¨‹åº¦: &quot;).append(exceptionLog.getSeverity()).append(&quot;\\n&quot;);        prompt.append(&quot;- å¼‚å¸¸åˆ†ç±»: &quot;).append(exceptionLog.getCategory()).append(&quot;\\n&quot;);        if (StringUtils.hasText(exceptionLog.getServiceName())) &#123;            prompt.append(&quot;- æœåŠ¡åç§°: &quot;).append(exceptionLog.getServiceName()).append(&quot;\\n&quot;);        &#125;        if (StringUtils.hasText(exceptionLog.getRequestUri())) &#123;            prompt.append(&quot;- è¯·æ±‚URI: &quot;).append(exceptionLog.getRequestUri()).append(&quot;\\n&quot;);        &#125;        prompt.append(&quot;\\nå †æ ˆè·Ÿè¸ª:\\n&quot;);        prompt.append(exceptionLog.getStackTrace());        prompt.append(&quot;\\n\\nè¯·æä¾›ä»¥ä¸‹åˆ†æï¼š\\n&quot;);        prompt.append(&quot;1. å¼‚å¸¸åŸå› åˆ†æ\\n&quot;);        prompt.append(&quot;2. æ½œåœ¨å½±å“è¯„ä¼°\\n&quot;);        prompt.append(&quot;3. è§£å†³æ–¹æ¡ˆå»ºè®®\\n&quot;);        prompt.append(&quot;4. é¢„é˜²æªæ–½\\n&quot;);        prompt.append(&quot;5. ç›¸å…³ä»£ç ç¤ºä¾‹ï¼ˆå¦‚é€‚ç”¨ï¼‰\\n&quot;);        return prompt.toString();    &#125;    /**     * ç”Ÿæˆå¼‚å¸¸å¤„ç†å»ºè®®     */    public List&lt;String&gt; generateSuggestions(ExceptionLog exceptionLog) &#123;        List&lt;String&gt; suggestions = new ArrayList&lt;&gt;();        // æ ¹æ®å¼‚å¸¸ç±»å‹æä¾›å»ºè®®        switch (exceptionLog.getExceptionType()) &#123;            case &quot;NullPointerException&quot;:                suggestions.add(&quot;æ·»åŠ ç©ºå€¼æ£€æŸ¥&quot;);                suggestions.add(&quot;ä½¿ç”¨Optionalå¤„ç†å¯èƒ½ä¸ºnullçš„å¯¹è±¡&quot;);                suggestions.add(&quot;åœ¨æ–¹æ³•å‚æ•°ä¸­ä½¿ç”¨@NotNullæ³¨è§£&quot;);                break;            case &quot;SQLException&quot;:                suggestions.add(&quot;æ£€æŸ¥æ•°æ®åº“è¿æ¥é…ç½®&quot;);                suggestions.add(&quot;éªŒè¯SQLè¯­å¥è¯­æ³•&quot;);                suggestions.add(&quot;æ·»åŠ æ•°æ®åº“è¿æ¥æ± ç›‘æ§&quot;);                break;            case &quot;IOException&quot;:                suggestions.add(&quot;æ£€æŸ¥æ–‡ä»¶/ç½‘ç»œè¿æ¥çŠ¶æ€&quot;);                suggestions.add(&quot;æ·»åŠ é‡è¯•æœºåˆ¶&quot;);                suggestions.add(&quot;éªŒè¯æ–‡ä»¶æƒé™&quot;);                break;            case &quot;TimeoutException&quot;:                suggestions.add(&quot;å¢åŠ è¶…æ—¶æ—¶é—´è®¾ç½®&quot;);                suggestions.add(&quot;ä¼˜åŒ–æ•°æ®åº“æŸ¥è¯¢æ€§èƒ½&quot;);                suggestions.add(&quot;æ·»åŠ å¼‚æ­¥å¤„ç†æœºåˆ¶&quot;);                break;            default:                suggestions.add(&quot;æŸ¥çœ‹è¯¦ç»†å †æ ˆè·Ÿè¸ªä¿¡æ¯&quot;);                suggestions.add(&quot;æ£€æŸ¥ç›¸å…³æ—¥å¿—æ–‡ä»¶&quot;);                suggestions.add(&quot;è”ç³»å¼€å‘å›¢é˜Ÿè¿›è¡Œåˆ†æ&quot;);                break;        &#125;        return suggestions;    &#125;&#125;\n\nğŸ“Š æ€§èƒ½ä¼˜åŒ–1. æ•°æ®åº“ä¼˜åŒ–ç´¢å¼•ç­–ç•¥// MongoDBç´¢å¼•é…ç½®&#123;  &quot;exception_type_time&quot;: &#123;    &quot;exceptionType&quot;: 1,    &quot;exceptionTime&quot;: -1  &#125;,  &quot;exception_time_ttl&quot;: &#123;    &quot;exceptionTime&quot;: 1,    &quot;expireAfterSeconds&quot;: 2592000  // 30å¤©  &#125;,  &quot;exception_status&quot;: &#123;    &quot;status&quot;: 1  &#125;,  &quot;user_id&quot;: &#123;    &quot;userId&quot;: 1  &#125;,  &quot;request_id&quot;: &#123;    &quot;requestId&quot;: 1  &#125;&#125;\n\nåˆ†ç‰‡ç­–ç•¥// MongoDBåˆ†ç‰‡é…ç½®&#123;  &quot;_id&quot;: ObjectId(&quot;...&quot;),  &quot;shardKey&quot;: &#123;    &quot;exceptionType&quot;: 1,    &quot;exceptionTime&quot;: 1  &#125;,  &quot;chunks&quot;: [    &#123;&quot;min&quot;: &#123;&quot;exceptionType&quot;: &quot;A&quot;, &quot;exceptionTime&quot;: ISODate(&quot;2024-01-01&quot;)&#125;,     &quot;max&quot;: &#123;&quot;exceptionType&quot;: &quot;M&quot;, &quot;exceptionTime&quot;: ISODate(&quot;2024-07-01&quot;)&#125;&#125;,    &#123;&quot;min&quot;: &#123;&quot;exceptionType&quot;: &quot;M&quot;, &quot;exceptionTime&quot;: ISODate(&quot;2024-07-01&quot;)&#125;,     &quot;max&quot;: &#123;&quot;exceptionType&quot;: &quot;Z&quot;, &quot;exceptionTime&quot;: ISODate(&quot;2025-01-01&quot;)&#125;&#125;  ]&#125;\n\n2. ç¼“å­˜ç­–ç•¥Redisç¼“å­˜é…ç½®@Configurationpublic class CacheConfig &#123;    @Bean    public RedisTemplate&lt;String, Object&gt; redisTemplate(RedisConnectionFactory connectionFactory) &#123;        RedisTemplate&lt;String, Object&gt; template = new RedisTemplate&lt;&gt;();        template.setConnectionFactory(connectionFactory);        // è®¾ç½®åºåˆ—åŒ–å™¨        template.setKeySerializer(new StringRedisSerializer());        template.setValueSerializer(new Jackson2JsonRedisSerializer&lt;&gt;(Object.class));        template.setHashKeySerializer(new StringRedisSerializer());        template.setHashValueSerializer(new Jackson2JsonRedisSerializer&lt;&gt;(Object.class));        template.afterPropertiesSet();        return template;    &#125;    @Bean    public CacheManager cacheManager(RedisConnectionFactory connectionFactory) &#123;        RedisCacheConfiguration config = RedisCacheConfiguration.defaultCacheConfig()                .entryTtl(Duration.ofHours(1)) // é»˜è®¤1å°æ—¶è¿‡æœŸ                .serializeKeysWith(RedisSerializationContext.SerializationPair.fromSerializer(new StringRedisSerializer()))                .serializeValuesWith(RedisSerializationContext.SerializationPair.fromSerializer(new Jackson2JsonRedisSerializer&lt;&gt;(Object.class)));        return RedisCacheManager.builder(connectionFactory)                .cacheDefaults(config)                .build();    &#125;&#125;\n\nç¼“å­˜æœåŠ¡@Service@Slf4jpublic class ExceptionLogCacheService &#123;    @Autowired    private RedisTemplate&lt;String, Object&gt; redisTemplate;    private static final String EXCEPTION_CACHE_KEY = &quot;exception:log:&quot;;    private static final String STATISTICS_CACHE_KEY = &quot;exception:statistics:&quot;;    private static final Duration CACHE_TTL = Duration.ofMinutes(30);    /**     * ç¼“å­˜å¼‚å¸¸æ—¥å¿—     */    public void cacheExceptionLog(String id, ExceptionLog exceptionLog) &#123;        try &#123;            String key = EXCEPTION_CACHE_KEY + id;            redisTemplate.opsForValue().set(key, exceptionLog, CACHE_TTL);            log.debug(&quot;ç¼“å­˜å¼‚å¸¸æ—¥å¿—: &#123;&#125;&quot;, id);        &#125; catch (Exception e) &#123;            log.error(&quot;ç¼“å­˜å¼‚å¸¸æ—¥å¿—å¤±è´¥&quot;, e);        &#125;    &#125;    /**     * è·å–ç¼“å­˜çš„å¼‚å¸¸æ—¥å¿—     */    public ExceptionLog getCachedExceptionLog(String id) &#123;        try &#123;            String key = EXCEPTION_CACHE_KEY + id;            return (ExceptionLog) redisTemplate.opsForValue().get(key);        &#125; catch (Exception e) &#123;            log.error(&quot;è·å–ç¼“å­˜çš„å¼‚å¸¸æ—¥å¿—å¤±è´¥&quot;, e);            return null;        &#125;    &#125;    /**     * ç¼“å­˜ç»Ÿè®¡ä¿¡æ¯     */    public void cacheStatistics(String key, ExceptionStatistics statistics) &#123;        try &#123;            String cacheKey = STATISTICS_CACHE_KEY + key;            redisTemplate.opsForValue().set(cacheKey, statistics, CACHE_TTL);            log.debug(&quot;ç¼“å­˜ç»Ÿè®¡ä¿¡æ¯: &#123;&#125;&quot;, key);        &#125; catch (Exception e) &#123;            log.error(&quot;ç¼“å­˜ç»Ÿè®¡ä¿¡æ¯å¤±è´¥&quot;, e);        &#125;    &#125;    /**     * è·å–ç¼“å­˜çš„ç»Ÿè®¡ä¿¡æ¯     */    public ExceptionStatistics getCachedStatistics(String key) &#123;        try &#123;            String cacheKey = STATISTICS_CACHE_KEY + key;            return (ExceptionStatistics) redisTemplate.opsForValue().get(cacheKey);        &#125; catch (Exception e) &#123;            log.error(&quot;è·å–ç¼“å­˜çš„ç»Ÿè®¡ä¿¡æ¯å¤±è´¥&quot;, e);            return null;        &#125;    &#125;    /**     * æ¸…é™¤æ‰€æœ‰ç¼“å­˜     */    public void clearAllCache() &#123;        try &#123;            redisTemplate.delete(redisTemplate.keys(EXCEPTION_CACHE_KEY + &quot;*&quot;));            redisTemplate.delete(redisTemplate.keys(STATISTICS_CACHE_KEY + &quot;*&quot;));            log.info(&quot;æ¸…é™¤æ‰€æœ‰å¼‚å¸¸æ—¥å¿—ç¼“å­˜&quot;);        &#125; catch (Exception e) &#123;            log.error(&quot;æ¸…é™¤ç¼“å­˜å¤±è´¥&quot;, e);        &#125;    &#125;&#125;\n\nğŸš€ éƒ¨ç½²æ¶æ„Docker Composeé…ç½®version: &#x27;3.8&#x27;services:  # Javaåº”ç”¨æœåŠ¡  java-app:    build: .    ports:      - &quot;8080:8080&quot;    environment:      - SPRING_PROFILES_ACTIVE=prod      - MONGODB_URI=mongodb://mongodb:27017/exception_logs      - REDIS_URI=redis://redis:6379    depends_on:      - mongodb      - redis    networks:      - app-network  # MongoDBæ•°æ®åº“  mongodb:    image: mongo:5.0    ports:      - &quot;27017:27017&quot;    volumes:      - mongodb_data:/data/db      - ./mongo-init:/docker-entrypoint-initdb.d    environment:      - MONGO_INITDB_ROOT_USERNAME=admin      - MONGO_INITDB_ROOT_PASSWORD=password    networks:      - app-network  # Redisç¼“å­˜  redis:    image: redis:7.0-alpine    ports:      - &quot;6379:6379&quot;    volumes:      - redis_data:/data    networks:      - app-network  # MCPæœåŠ¡å™¨  mcp-server:    build: ./mcp-server    ports:      - &quot;3000:3000&quot;    environment:      - MONGODB_URI=mongodb://mongodb:27017/exception_logs      - REDIS_URI=redis://redis:6379    depends_on:      - mongodb      - redis    networks:      - app-networknetworks:  app-network:    driver: bridgevolumes:  mongodb_data:  redis_data:\n\nKuberneteséƒ¨ç½²# Javaåº”ç”¨éƒ¨ç½²apiVersion: apps/v1kind: Deploymentmetadata:  name: exception-log-servicespec:  replicas: 3  selector:    matchLabels:      app: exception-log-service  template:    metadata:      labels:        app: exception-log-service    spec:      containers:      - name: java-app        image: your-registry/exception-log-service:latest        ports:        - containerPort: 8080        env:        - name: SPRING_PROFILES_ACTIVE          value: &quot;prod&quot;        - name: MONGODB_URI          value: &quot;mongodb://mongodb-service:27017/exception_logs&quot;        - name: REDIS_URI          value: &quot;redis://redis-service:6379&quot;        resources:          requests:            memory: &quot;512Mi&quot;            cpu: &quot;250m&quot;          limits:            memory: &quot;1Gi&quot;            cpu: &quot;500m&quot;---# MongoDBéƒ¨ç½²apiVersion: apps/v1kind: StatefulSetmetadata:  name: mongodbspec:  serviceName: mongodb-service  replicas: 1  selector:    matchLabels:      app: mongodb  template:    metadata:      labels:        app: mongodb    spec:      containers:      - name: mongodb        image: mongo:5.0        ports:        - containerPort: 27017        env:        - name: MONGO_INITDB_ROOT_USERNAME          value: &quot;admin&quot;        - name: MONGO_INITDB_ROOT_PASSWORD          valueFrom:            secretKeyRef:              name: mongodb-secret              key: password        volumeMounts:        - name: mongodb-storage          mountPath: /data/db  volumeClaimTemplates:  - metadata:      name: mongodb-storage    spec:      accessModes: [&quot;ReadWriteOnce&quot;]      resources:        requests:          storage: 50Gi\n\nğŸ“ˆ ç›‘æ§å’Œå‘Šè­¦ç›‘æ§æŒ‡æ ‡@Configurationpublic class MetricsConfig &#123;    @Bean    public MeterRegistry meterRegistry() &#123;        return new SimpleMeterRegistry();    &#125;    @Bean    public ExceptionLogMetrics exceptionLogMetrics(MeterRegistry meterRegistry) &#123;        return new ExceptionLogMetrics(meterRegistry);    &#125;&#125;@Componentpublic class ExceptionLogMetrics &#123;    private final Counter exceptionCounter;    private final Timer exceptionProcessingTimer;    private final Gauge activeExceptions;    public ExceptionLogMetrics(MeterRegistry meterRegistry) &#123;        this.exceptionCounter = Counter.builder(&quot;exception_log_total&quot;)                .description(&quot;Total number of logged exceptions&quot;)                .tags(&quot;service&quot;, &quot;exception-log-service&quot;)                .register(meterRegistry);        this.exceptionProcessingTimer = Timer.builder(&quot;exception_processing_duration&quot;)                .description(&quot;Time taken to process exception logs&quot;)                .tags(&quot;service&quot;, &quot;exception-log-service&quot;)                .register(meterRegistry);        this.activeExceptions = Gauge.builder(&quot;exception_active_total&quot;, this, ExceptionLogMetrics::getActiveExceptionCount)                .description(&quot;Number of active (unresolved) exceptions&quot;)                .tags(&quot;service&quot;, &quot;exception-log-service&quot;)                .register(meterRegistry);    &#125;    public void incrementExceptionCounter(String type, String severity) &#123;        exceptionCounter.increment();    &#125;    public Timer.Sample startProcessingTimer() &#123;        return Timer.start(meterRegistry);    &#125;    private double getActiveExceptionCount() &#123;        // æŸ¥è¯¢æ´»è·ƒå¼‚å¸¸æ•°é‡çš„é€»è¾‘        return 0.0;    &#125;&#125;\n\nå‘Šè­¦é…ç½®# Prometheuså‘Šè­¦è§„åˆ™groups:  - name: exception_alerts    rules:      - alert: HighExceptionRate        expr: rate(exception_log_total[5m]) &gt; 10        for: 5m        labels:          severity: warning        annotations:          summary: &quot;å¼‚å¸¸å‘ç”Ÿç‡è¿‡é«˜&quot;          description: &quot;è¿‡å»5åˆ†é’Ÿå¼‚å¸¸å‘ç”Ÿç‡è¶…è¿‡10æ¬¡/åˆ†é’Ÿ&quot;      - alert: CriticalExceptionDetected        expr: exception_log_total&#123;severity=&quot;CRITICAL&quot;&#125; &gt; 0        for: 1m        labels:          severity: critical        annotations:          summary: &quot;æ£€æµ‹åˆ°ä¸¥é‡å¼‚å¸¸&quot;          description: &quot;å‘ç°ä¸¥é‡çº§åˆ«å¼‚å¸¸ï¼Œè¯·ç«‹å³å¤„ç†&quot;      - alert: DatabaseConnectionFailed        expr: up&#123;job=&quot;mongodb&quot;&#125; == 0        for: 5m        labels:          severity: critical        annotations:          summary: &quot;æ•°æ®åº“è¿æ¥å¤±è´¥&quot;          description: &quot;MongoDBæ•°æ®åº“è¿æ¥å¼‚å¸¸&quot;\n\nğŸ¯ ä½¿ç”¨ç¤ºä¾‹1. åŸºæœ¬å¼‚å¸¸æ•è·@Servicepublic class UserService &#123;    @Autowired    private UserRepository userRepository;    public User getUserById(String userId) &#123;        try &#123;            return userRepository.findById(userId)                    .orElseThrow(() -&gt; new BusinessException(&quot;USER_NOT_FOUND&quot;, &quot;ç”¨æˆ·ä¸å­˜åœ¨: &quot; + userId));        &#125; catch (DataAccessException e) &#123;            throw new BusinessException(&quot;DATABASE_ERROR&quot;, &quot;æ•°æ®åº“æŸ¥è¯¢å¤±è´¥&quot;, e);        &#125;    &#125;&#125;\n\n2. MCPå·¥å…·è°ƒç”¨ç¤ºä¾‹# åˆ†æå¼‚å¸¸mcp_tool analyze_exception exception_id=&quot;64f1a2b3c4d5e6f7g8h9i0j1&quot; detailed=true# æŸ¥è¯¢ç»Ÿè®¡mcp_tool get_exception_statistics start_time=&quot;2024-01-01 00:00:00&quot; end_time=&quot;2024-01-31 23:59:59&quot;# æœç´¢ç›¸ä¼¼å¼‚å¸¸mcp_tool find_similar_exceptions exception_type=&quot;NullPointerException&quot; limit=5# è·å–è¶‹åŠ¿åˆ†æmcp_tool get_exception_trends days=7\n\n3. èµ„æºè®¿é—®ç¤ºä¾‹# è·å–æœ€æ–°å¼‚å¸¸curl http://localhost:3000/logs/exceptions/latest?limit=10# è·å–å¼‚å¸¸è¯¦æƒ…curl http://localhost:3000/logs/exceptions/64f1a2b3c4d5e6f7g8h9i0j1\n\nğŸ“š æ€»ç»“æœ¬æ–‡è¯¦ç»†ä»‹ç»äº†æ„å»ºå®Œæ•´çš„Javaå¼‚å¸¸æ—¥å¿—MCPæœåŠ¡æ¶æ„çš„å…³é”®æŠ€æœ¯ç‚¹ï¼š\nğŸ—ï¸ æ¶æ„ä¼˜åŠ¿\nå®Œæ•´çš„å¼‚å¸¸ç”Ÿå‘½å‘¨æœŸç®¡ç†ï¼šä»æ•è·åˆ°åˆ†æåˆ°è§£å†³\nAIé©±åŠ¨çš„æ™ºèƒ½åˆ†æï¼šåˆ©ç”¨å¤§æ¨¡å‹æä¾›å¼‚å¸¸è¯Šæ–­å»ºè®®\né«˜æ€§èƒ½å­˜å‚¨å’ŒæŸ¥è¯¢ï¼šMongoDB + Redisçš„ä¼˜åŒ–ç»„åˆ\næ ‡å‡†åŒ–æœåŠ¡æ¥å£ï¼šMCPåè®®ä¿è¯è·¨å¹³å°å…¼å®¹æ€§\n\nğŸ”§ æŠ€æœ¯äº®ç‚¹\nå…¨å±€å¼‚å¸¸å¤„ç†ï¼šAOP + ControllerAdviceçš„ç»Ÿä¸€å¼‚å¸¸å¤„ç†\næ™ºèƒ½å¼‚å¸¸åˆ†ç±»ï¼šåŸºäºè§„åˆ™å’ŒAIçš„å¼‚å¸¸åˆ†ç±»ç³»ç»Ÿ\nå®æ—¶ç›‘æ§å‘Šè­¦ï¼šPrometheus + Grafanaçš„ç›‘æ§ä½“ç³»\nå¼¹æ€§ä¼¸ç¼©éƒ¨ç½²ï¼šDocker + Kubernetesçš„å®¹å™¨åŒ–éƒ¨ç½²\n\nğŸš€ ä¸šåŠ¡ä»·å€¼\næå‡é—®é¢˜è§£å†³æ•ˆç‡ï¼šAIåˆ†æå‡å°‘æ’æŸ¥æ—¶é—´\né™ä½è¿ç»´æˆæœ¬ï¼šè‡ªåŠ¨åŒ–å¼‚å¸¸å¤„ç†å’Œå‘Šè­¦\nå¢å¼ºç³»ç»Ÿç¨³å®šæ€§ï¼šæ•°æ®é©±åŠ¨çš„å¼‚å¸¸é¢„é˜²\næ”¯æŒæ•æ·å¼€å‘ï¼šå¿«é€Ÿå®šä½å’Œè§£å†³é—®é¢˜\n\nè¿™å¥—æ¶æ„ä¸ä»…è§£å†³äº†ä¼ ç»Ÿå¼‚å¸¸å¤„ç†ç³»ç»Ÿçš„ç—›ç‚¹ï¼Œè¿˜é€šè¿‡AIå’Œå¤§æ¨¡å‹çš„é›†æˆï¼Œå¼€åˆ›äº†æ™ºèƒ½å¼‚å¸¸åˆ†æçš„æ–°æ¨¡å¼ã€‚åœ¨å¾®æœåŠ¡æ¶æ„æ—¥ç›Šå¤æ‚çš„ä»Šå¤©ï¼Œè¿™ç§AIå¢å¼ºçš„å¼‚å¸¸å¤„ç†ç³»ç»Ÿå°†æˆä¸ºä¿éšœç³»ç»Ÿç¨³å®šæ€§çš„é‡è¦åŸºç¡€è®¾æ–½ã€‚\n\nğŸ”— ç›¸å…³é“¾æ¥\n\nSpring Bootå®˜æ–¹æ–‡æ¡£\nMongoDBå®˜æ–¹æ–‡æ¡£\nMCPåè®®è§„èŒƒ\nPrometheusç›‘æ§\n\n\nğŸ¯ ç«‹å³å¼€å§‹æ„å»ºæ‚¨çš„æ™ºèƒ½å¼‚å¸¸å¤„ç†ç³»ç»Ÿï¼ ğŸš€\n","tags":["Java","MCP","MongoDB","å¤§æ¨¡å‹","å¼‚å¸¸å¤„ç†","æ—¥å¿—åˆ†æ"]}]